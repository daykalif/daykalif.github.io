<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="stay hungry,stay foolish.">
<meta property="og:type" content="website">
<meta property="og:title" content="Daykalif">
<meta property="og:url" content="https://daykalif.github.io/page/9/index.html">
<meta property="og:site_name" content="Daykalif">
<meta property="og:description" content="stay hungry,stay foolish.">
<meta property="og:locale">
<meta property="article:author" content="r00t_daykalif">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: "",
      labels: ""
    }
  };
</script>



  <link rel="canonical" href="https://daykalif.github.io/page/9/"/>





  <title>Daykalif</title>
  








<meta name="generator" content="Hexo 7.1.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Daykalif</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-文章">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            文章
          </a>
        </li>
      
        
        <li class="menu-item menu-item-分类">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-前端">
          <a href="/categories/web/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            前端
          </a>
        </li>
      
        
        <li class="menu-item menu-item-后端">
          <a href="/categories/server/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-server"></i> <br />
            
            后端
          </a>
        </li>
      
        
        <li class="menu-item menu-item-关于我">
          <a href="/categories/aboutMe/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于我
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2020/02/19/JS/JSON-parse-JSON-stringify/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/19/JS/JSON-parse-JSON-stringify/" itemprop="url">JSON.parse & JSON.stringify</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-02-19T11:09:14+08:00">
                2020-02-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/02/19/JS/JSON-parse-JSON-stringify/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/02/19/JS/JSON-parse-JSON-stringify/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/02/19/JS/JSON-parse-JSON-stringify/" class="leancloud_visitors" data-flag-title="JSON.parse & JSON.stringify">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  574
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  2
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="妙用-JSON-stringify，区分-JSON-parse-和-JSON-stringify-的区别，论辩-toString-与-JSON-stringify-的异同点"><a href="#妙用-JSON-stringify，区分-JSON-parse-和-JSON-stringify-的区别，论辩-toString-与-JSON-stringify-的异同点" class="headerlink" title="妙用 JSON.stringify，区分 JSON.parse 和 JSON.stringify 的区别，论辩 toString 与 JSON.stringify 的异同点"></a>妙用 JSON.stringify，区分 JSON.parse 和 JSON.stringify 的区别，论辩 toString 与 JSON.stringify 的异同点</h4><h5 id="一-JSON-stringify-和-JSON-parse-的区别"><a href="#一-JSON-stringify-和-JSON-parse-的区别" class="headerlink" title="一.JSON.stringify()和 JSON.parse()的区别"></a>一.JSON.stringify()和 JSON.parse()的区别</h5><p>JSON.stringify()是将 JavaScript 对象转变成 JSON 字符串，JSON.parse()是将 JSON 字符串转变成一个对象，前者在数据进行本地缓存时用得最多，在拿数据时调用后者即可（但是需要只有 JSON 字符串才能进行转换）；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(a));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="title function_">toString</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(a); <span class="comment">//&#x27;[1,2,3]&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(b)); <span class="comment">// [1,2,3]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b2 = a.<span class="title function_">toString</span>(); <span class="comment">//&#x27;1,2,3&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(b2)); <span class="comment">//underfined:toString()得到的字符串并非JSON字符串</span></span><br></pre></td></tr></table></figure>

<h5 id="二-JSON-stringify-与-toString-的区别"><a href="#二-JSON-stringify-与-toString-的区别" class="headerlink" title="二.JSON.stringify 与 toString()的区别"></a>二.JSON.stringify 与 toString()的区别</h5><p>1.二者虽然都可以将数据转换成字符串，但二者所针对的受众目标并不相同。<br>前者不仅仅限于数组，更多的是进行对象的转换；<br>后者只针对对数组的转换，并不能对对象如之类的进行转换得到你所想要的值，有着很大的局限性。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> c = &#123;</span><br><span class="line">  <span class="attr">time</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;mk&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(c)); <span class="comment">//&#123;&quot;time&quot;:1596464272481,&quot;data&quot;:&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;mk&quot;,&quot;age&quot;:20&#125;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c.<span class="title function_">toString</span>()); <span class="comment">//[object Object]</span></span><br></pre></td></tr></table></figure>

<p>2.JSON.stringify()将目标值转成 JSON 类型的字符串，toString()只是普通类型的字符串，如果在实际拿本地缓存中的数据时，如果调用 JSON.parse()来转换对象时，<br>如果不是 JSON 类型的字符串的话会报错的。</p>
<h5 id="三-JSON-stringify-的妙用"><a href="#三-JSON-stringify-的妙用" class="headerlink" title="三.JSON.stringify()的妙用"></a>三.JSON.stringify()的妙用</h5><p>1.利用 localStorage&#x2F;sessionStorage 来本地存储数据：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">  <span class="attr">time</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;mk&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">19</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;mk&quot;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(a));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;mk&quot;</span>)));</span><br></pre></td></tr></table></figure>

<p>2.实现对象的深拷贝（出于安全性考虑）<br>在实际项目开发时，常需要对源数据进行任意操作，如果怕会影响到源数据，深拷贝倒是一种不错的选择</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]；</span><br><span class="line"><span class="keyword">let</span> b = &#123;</span><br><span class="line">    <span class="attr">time</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;mk&#x27;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> b = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(b));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(d); <span class="comment">//&#123; time: 1596465414379, data: &#123; id: 1, name: &#x27;mk&#x27;, age: 20 &#125; &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(a)));<span class="comment">//[1 , 2 , 3 ]</span></span><br></pre></td></tr></table></figure>

<p>转载文档：<br><a href="https://www.cnblogs.com/liangye/p/13430428.html">https://www.cnblogs.com/liangye/p/13430428.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2020/02/09/JS/%E6%B7%B1%E6%8B%B7%E8%B4%9D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/09/JS/%E6%B7%B1%E6%8B%B7%E8%B4%9D/" itemprop="url">深拷贝</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-02-09T13:49:53+08:00">
                2020-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/02/09/JS/%E6%B7%B1%E6%8B%B7%E8%B4%9D/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/02/09/JS/%E6%B7%B1%E6%8B%B7%E8%B4%9D/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/02/09/JS/%E6%B7%B1%E6%8B%B7%E8%B4%9D/" class="leancloud_visitors" data-flag-title="深拷贝">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  1.1k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  5
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">浅拷贝只在根属性上在堆内存中创建了一个新的对象，复制了基本类型的值，但是复杂数据类型也就是对象则是拷贝相同的地址，而深拷贝则是对于复杂数据类型在堆内存中开辟了一块内存地址</span><br><span class="line">用于存放复制的对象并且把原有的对象复制过来，这两个对象是相互独立的，也就是两个不同的地址！</span><br></pre></td></tr></table></figure>

<blockquote>
<p>将一个对象从内存中完整的拷贝一份出来，从堆内存中开辟一个新的区域存放新对象，且修改新对象不会影响原对象</p>
</blockquote>
<h5 id="1-一个简单的深拷贝"><a href="#1-一个简单的深拷贝" class="headerlink" title="1.一个简单的深拷贝"></a>1.一个简单的深拷贝</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">a</span>: &#123;</span><br><span class="line">    <span class="attr">b</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">c</span>: <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj2 = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">obj2.<span class="property">a</span> = &#123;&#125;;</span><br><span class="line">obj2.<span class="property">c</span> = obj1.<span class="property">c</span>;</span><br><span class="line">obj2.<span class="property">a</span>.<span class="property">b</span> = obj1.<span class="property">a</span>.<span class="property">b</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;原obj1:&quot;</span>, obj1); <span class="comment">//原obj1: &#123; a: &#123; b: 1 &#125;, c: 1 &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;复制的obj2&quot;</span>, obj2); <span class="comment">//复制的obj2 &#123; a: &#123; b: 1 &#125;, c: 1 &#125;</span></span><br><span class="line"><span class="comment">// 修改原obj1中的b为2</span></span><br><span class="line">obj1.<span class="property">a</span>.<span class="property">b</span> = <span class="number">2</span>;</span><br><span class="line"><span class="comment">//观察复制的obj2会不会发生改变</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;修改后的obj1:&quot;</span>, obj1); <span class="comment">// 修改后的obj1: &#123; a: &#123; b: 2 &#125;, c: 1 &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;obj2:&quot;</span>, obj2); <span class="comment">// obj2: &#123; a: &#123; b: 1 &#125;, c: 1 &#125;</span></span><br></pre></td></tr></table></figure>

<p>在上面代码中，我们新建了一个 obj2 对象，同时根据 obj1 对象的 a 属性是一个引用类型，我们给 obj2.a 的值也新建了一个新对象(即在内存中新开辟了一块内存地址)<br>然后把 obj1.a.b 属性的值数字 1 复制给 obj2.a.b。因为数字 1 是基本类型的值，所以改变 obj.a.b 的值后，obj2.a 不会受到影响，因为他们的引用是完全 2 个独立的对象，这就完成了一个简单的深拷贝</p>
<h5 id="2-JSON-stringify"><a href="#2-JSON-stringify" class="headerlink" title="2.JSON.stringify"></a>2.JSON.stringify</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JSON.stringify()是目前前端开发过程中最常用的深拷贝方式，原理是把有个对象序列化成为一个 JSON 字符串，将对象的内容转换成字符串的形式再保存到磁盘上，再用 JSON.parse()反序列化将 JSON 字符串变成一个新的对象</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> str = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj1);</span><br><span class="line"><span class="keyword">let</span> obj2 = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(str);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj2); <span class="comment">//&#123; a: 1, b: [ 1, 2, 3 ] &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//修改obj1</span></span><br><span class="line">obj1.<span class="property">a</span> = <span class="number">2</span>;</span><br><span class="line">obj1.<span class="property">b</span>.<span class="title function_">push</span>(<span class="number">4</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1); <span class="comment">//&#123; a: 2, b: [ 1, 2, 3, 4 ] &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj2); <span class="comment">//&#123; a: 1, b: [ 1, 2, 3 ] &#125;</span></span><br></pre></td></tr></table></figure>

<p>通过 JSON.stringify 实现深拷贝有几点要注意:</p>
<ul>
<li>拷贝的对象的值中如果有函数,undefined,symbol 则经过 JSON.stringify()序列化后的 JSON 字符串中这个键值对会消失</li>
<li>无法拷贝不可枚举的属性，无法拷贝对象的原型链</li>
<li>拷贝 Date 引用类型会变成字符串</li>
<li>拷贝 RegExp 引用类型会变成空对象</li>
<li>对象中含有 NaN、Infinity 和-Infinity，则序列化的结果会变成 null</li>
<li>无法拷贝对象的循环应用(即 obj[key] &#x3D; obj)</li>
</ul>
<h5 id="3-自己实现一个深拷贝"><a href="#3-自己实现一个深拷贝" class="headerlink" title="3.自己实现一个深拷贝"></a>3.自己实现一个深拷贝</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例1:</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">source</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> targetObj = source.<span class="property">constructor</span> === <span class="title class_">Array</span> ? [] : &#123;&#125;; <span class="comment">// 判断复制的目标是数组还是对象</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> keys <span class="keyword">in</span> source) &#123;</span><br><span class="line">    <span class="comment">// 遍历目标</span></span><br><span class="line">    <span class="keyword">if</span> (source.<span class="title function_">hasOwnProperty</span>(keys)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (source[keys] &amp;&amp; <span class="keyword">typeof</span> source[keys] === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// 如果值是对象，就递归一下</span></span><br><span class="line">        targetObj[keys] = source[keys].<span class="property">constructor</span> === <span class="title class_">Array</span> ? [] : &#123;&#125;;</span><br><span class="line">        targetObj[keys] = <span class="title function_">deepClone</span>(source[keys]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果不是，就直接赋值</span></span><br><span class="line">        targetObj[keys] = source[keys];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> targetObj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str1 = &#123;</span><br><span class="line">  <span class="attr">arr</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">  <span class="attr">obj</span>: &#123;</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&quot;value&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">fn</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> str3 = <span class="title function_">deepClone</span>(str1);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str3 === str1); <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str3.<span class="property">obj</span> === str1.<span class="property">obj</span>); <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str3.<span class="property">fn</span> === str1.<span class="property">fn</span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例2:</span></span><br><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">  <span class="attr">address</span>: &#123;</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&quot;beijing&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">arr</span>: [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj2 = <span class="title function_">deepClone</span>(obj1);</span><br><span class="line">obj2.<span class="property">address</span>.<span class="property">city</span> = <span class="string">&quot;shanghai&quot;</span>;</span><br><span class="line">obj2.<span class="property">arr</span>[<span class="number">0</span>] = <span class="string">&quot;a1&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1.<span class="property">address</span>.<span class="property">city</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1.<span class="property">arr</span>[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 深拷贝函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; obj 要拷贝的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">obj = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj !== <span class="string">&quot;object&quot;</span> || obj == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// obj 是 null ，或者不是对象和数组，直接返回</span></span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化返回结果</span></span><br><span class="line">  <span class="keyword">let</span> result;</span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="title class_">Array</span>) &#123;</span><br><span class="line">    result = [];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    result = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="comment">// 保证 key 不是原型的属性</span></span><br><span class="line">    <span class="keyword">if</span> (obj.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">      <span class="comment">// 递归调用！！！</span></span><br><span class="line">      result[key] = <span class="title function_">deepClone</span>(obj[key]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回结果</span></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-JQuery-中-extend-—-add-true"><a href="#4-JQuery-中-extend-—-add-true" class="headerlink" title="4.JQuery 中 $.extend() — add true"></a>4.JQuery 中 $.extend() — add true</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.extend(<span class="literal">true</span>) 为深拷贝形态.</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">test</span>: &#123; <span class="attr">math</span>: <span class="number">100</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = $.<span class="title function_">extend</span>(<span class="literal">true</span>, &#123;&#125;, obj1);</span><br><span class="line">obj1.<span class="property">a</span> = <span class="number">0</span>;</span><br><span class="line">obj1.<span class="property">test</span>.<span class="property">math</span> = <span class="number">99</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj2); <span class="comment">// &#123;a:1,b:2,test:&#123;math:100&#125;&#125;   //obj2不随obj1改变而变化</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2020/02/08/JS/%E6%B5%85%E6%8B%B7%E8%B4%9D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/08/JS/%E6%B5%85%E6%8B%B7%E8%B4%9D/" itemprop="url">浅拷贝</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-02-08T23:49:24+08:00">
                2020-02-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/02/08/JS/%E6%B5%85%E6%8B%B7%E8%B4%9D/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/02/08/JS/%E6%B5%85%E6%8B%B7%E8%B4%9D/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/02/08/JS/%E6%B5%85%E6%8B%B7%E8%B4%9D/" class="leancloud_visitors" data-flag-title="浅拷贝">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  1.2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  5
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">对于浅拷贝的理解：</span><br><span class="line">创建一个新对象，这个对象有着原始对象属性值得一份精确拷贝。如果属性是基本类型，拷贝得就是基本类型得值</span><br><span class="line">如果属性是引用类型，拷贝得就是内存地址，所以如果其中一个对象改变了地址，就会影响到另一个对象！</span><br></pre></td></tr></table></figure>

<h5 id="1-Object-assign"><a href="#1-Object-assign" class="headerlink" title="1.Object.assign()"></a>1.Object.assign()</h5><blockquote>
<p>语法：Object.assign(target,…resources)</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.ES6中拷贝对象的方法，接受的第一个参数是拷贝的目标，剩下的参数是拷贝的源对象（可以是多个）</span><br><span class="line">2.Object.assign是一个浅拷贝,它只是在根属性(对象的第一层级)创建了一个新的对象，但是对于属性的值是仍是对象的话依然是浅拷贝，只会拷贝一份相同的内存地址</span><br><span class="line">3.Object.assign还有一些注意的点是:</span><br><span class="line">    1).不会拷贝对象继承的属性</span><br><span class="line">    2).不可枚举的属性</span><br><span class="line">    3).属性的数据属性/访问器属性</span><br><span class="line">    4).可以拷贝Symbol类型</span><br><span class="line">可以理解为Object.assign就是使用简单的=来赋值,遍历从右往左遍历源对象(sources)的所有属性用 = 赋值到目标对象(target)上</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//示例1:</span></span><br><span class="line"><span class="keyword">var</span> target = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> source = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(target, source);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(target); <span class="comment">//&#123;a:1&#125;</span></span><br><span class="line">source.<span class="property">a</span> = <span class="number">2</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(source); <span class="comment">//&#123;a:2&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(target); <span class="comment">//&#123;a:1&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例2:</span></span><br><span class="line"><span class="keyword">let</span> target = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> source = &#123;</span><br><span class="line">  <span class="attr">a</span>: &#123;</span><br><span class="line">    <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(target, source);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(target); <span class="comment">//&#123;a:&#123;b:2&#125;&#125;</span></span><br><span class="line">source.<span class="property">a</span>.<span class="property">b</span> = <span class="number">10</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(source); <span class="comment">//&#123;a:&#123;b:10&#125;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(target); <span class="comment">//&#123;a:&#123;b:10&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例3:</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="attr">c</span>: <span class="number">30</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(obj, &#123; <span class="attr">d</span>: <span class="number">40</span> &#125;); <span class="comment">//追加</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj); <span class="comment">//&#123;a:10,b:20,c:30,d:40&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj1 = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, obj, &#123; <span class="attr">e</span>: <span class="number">50</span> &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj); <span class="comment">//&#123;a:10,b:20,c:30,d:40&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1); <span class="comment">//&#123;a:10,b:20,c:30,d:40,e:50&#125;</span></span><br><span class="line"></span><br><span class="line">obj.<span class="property">a</span> = <span class="number">100</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1); <span class="comment">//&#123;a:10,b:20,c:30,d:40,e:50&#125;    不改变</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例4:</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">b</span>: &#123;</span><br><span class="line">    <span class="attr">x</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="attr">y</span>: <span class="number">100</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> obj1 = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, obj, &#123; <span class="attr">c</span>: <span class="number">30</span> &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj); <span class="comment">//&#123;a:10,b:&#123;x:100,y:100&#125;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1); <span class="comment">//&#123;a:10,b:&#123;x:100,y:100&#125;,c:30&#125;</span></span><br><span class="line">obj.<span class="property">b</span>.<span class="property">x</span> = <span class="number">101</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj); <span class="comment">//&#123;a:10,b:&#123;x:101,y:100&#125;,c:30&#125;  会改变</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//示例5:</span></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">a</span>: &#123;</span><br><span class="line">    <span class="attr">b</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">sym</span>: <span class="title class_">Symbol</span>(<span class="number">1</span>),</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj1, <span class="string">&quot;innumerable&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&quot;不可枚举属性&quot;</span>,</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;&#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(obj2, obj1);</span><br><span class="line">obj1.<span class="property">a</span>.<span class="property">b</span> = <span class="number">2</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;obj1&quot;</span>, obj1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;obj2&quot;</span>, obj2);</span><br></pre></td></tr></table></figure>

<p><img src="https://www.daykalif.com/blog_img/object_assign.png" alt="daykalif"></p>
<p>可以看到 Symbol 类型可以正确拷贝，但是不可枚举的属性被忽略了并且改变了 obj1.a.b 的值，obj2.a.b 的值也会跟着改变，说明依旧存在访问的是堆内存中同一个对象的问题</p>
<h5 id="2-扩展运算符"><a href="#2-扩展运算符" class="headerlink" title="2.扩展运算符"></a>2.扩展运算符</h5><blockquote>
<p>语法：var cloneObj &#x3D; { …obj };</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">利用扩展运算符可以在构造字面量对象时,进行克隆或者属性拷贝</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">1</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123; ...obj &#125;;</span><br><span class="line">obj.<span class="property">a</span> = <span class="number">2</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj); <span class="comment">//&#123;a:2,b:&#123;c:1&#125;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj2); <span class="comment">//&#123;a:1,b:&#123;c:1&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">obj.<span class="property">b</span>.<span class="property">c</span> = <span class="number">2</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj); <span class="comment">//&#123;a:2,b:&#123;c:2&#125;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj2); <span class="comment">//&#123;a:1,b:&#123;c:2&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>扩展运算符 Object.assign()有同样的缺陷，对于值是对象的属性无法完全拷贝成 2 个不同对象,但是如果属性都是基本类型的值的话,使用扩展运算符更加方便</p>
<h5 id="3-Array-prototype-slice"><a href="#3-Array-prototype-slice" class="headerlink" title="3.Array.prototype.slice()"></a>3.Array.prototype.slice()</h5><blockquote>
<p>语法: arr.slice(begin, end);</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slice() 方法返回一个新的数组对象，这一对象是一个由 begin和 end（不包括end）决定的原数组的浅拷贝。原始数组不会被改变。</span><br><span class="line">在ES6以前,没有剩余运算符,Array.from的时候可以用 Array.prototype.slice将arguments类数组转为真正的数组,它返回一个浅拷贝后的的新数组</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(&#123; <span class="number">0</span>: <span class="string">&quot;aaa&quot;</span>, <span class="attr">length</span>: <span class="number">1</span> &#125;); <span class="comment">//[&quot;aaa&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">slice</span>() === arr); <span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<h5 id="4-Array-prototype-concat"><a href="#4-Array-prototype-concat" class="headerlink" title="4.Array.prototype.concat()"></a>4.Array.prototype.concat()</h5><blockquote>
<p>语法：var new_array &#x3D; old_array.concat(value1[, value2[, …[, valueN]]])</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对于数组的 concat 方法其实也是浅拷贝,所以连接一个含有引用类型的数组需要注意修改原数组中的元素的属性会反映到连接后的数组</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [&#123; <span class="attr">a</span>: <span class="number">1</span> &#125;, &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;, &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;];</span><br><span class="line"><span class="keyword">let</span> arr2 = [&#123; <span class="attr">b</span>: <span class="number">1</span> &#125;, &#123; <span class="attr">b</span>: <span class="number">1</span> &#125;, &#123; <span class="attr">b</span>: <span class="number">1</span> &#125;];</span><br><span class="line"><span class="keyword">let</span> arr3 = arr.<span class="title function_">concat</span>(arr2);</span><br><span class="line">arr2[<span class="number">0</span>].<span class="property">b</span> = <span class="number">10</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr3); <span class="comment">//[ &#123; a: 1 &#125;, &#123; a: 1 &#125;, &#123; a: 1 &#125;, &#123; b: 10 &#125;, &#123; b: 1 &#125;, &#123; b: 1 &#125; ]</span></span><br></pre></td></tr></table></figure>

<h5 id="5-JQuery-中-extend"><a href="#5-JQuery-中-extend" class="headerlink" title="5.JQuery 中 $.extend()"></a>5.JQuery 中 $.extend()</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">当复制对象内key的value值不为对象时,assign() 和 $.extend() 类似深拷贝.</span><br><span class="line">当复制对象内key的value值为对象时,assign() 和 $.extend() 就是浅拷贝.</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">test</span>: &#123; <span class="attr">math</span>: <span class="number">100</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = $.<span class="title function_">extend</span>(&#123;&#125;, obj1);</span><br><span class="line">obj1.<span class="property">a</span> = <span class="number">0</span>;</span><br><span class="line">obj1.<span class="property">test</span>.<span class="property">math</span> = <span class="number">99</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj2); <span class="comment">// &#123;a:1,b:2,test:&#123;math:99&#125;&#125; //obj1内非对象类型值改变 obj2不变</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2020/01/27/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9114%EF%BC%9A%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/27/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9114%EF%BC%9A%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83/" itemprop="url">运行环境</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-27T20:34:16+08:00">
                2020-01-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/27/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9114%EF%BC%9A%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/01/27/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9114%EF%BC%9A%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/01/27/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9114%EF%BC%9A%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83/" class="leancloud_visitors" data-flag-title="运行环境">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  2.4k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  9
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="运行环境"><a href="#运行环境" class="headerlink" title="运行环境"></a>运行环境</h4><p>运行环境即浏览器（server 端有 nodejs）<br>下载网页源代码，渲染出页面，期间会执行若干 JS<br>要保证代码在浏览器中：稳定且高效</p>
<h5 id="一、网页加载过程"><a href="#一、网页加载过程" class="headerlink" title="一、网页加载过程"></a>一、网页加载过程</h5><blockquote>
<p>1.加载资源的形式</p>
</blockquote>
<p>html 代码<br>媒体文件，如图片、视频等<br>JavaScript css</p>
<blockquote>
<p>2.加载资源的过程</p>
</blockquote>
<p>DNS 解析：域名-&gt;IP 地址<br>浏览器根据 IP 地址向服务器发起 http 请求<br>服务器处理请求 http 请求，并返回给浏览器</p>
<blockquote>
<p>3.渲染页面的过程</p>
</blockquote>
<p>根据 HTML 代码生成 DOM Tree<br>根据 CSS 代码生成 CSSOM<br>将 DOM Tree 和 CSSOM 整合形成 Render Tree<br>根据 Render Tree 渲染页面<br>遇到 script 标签则暂停渲染，优先加载并执行 JS 代码，完成再继续<br>直至把 Render Tree 渲染完成</p>
<blockquote>
<p>问：为何建议把 css 放到 head 中？</p>
</blockquote>
<p>在 DOM 树生成完成之前，就把 css 加载完，将 DOM Tree 和 CSSOM 整合形成 Render Tree</p>
<blockquote>
<p>问：为何建议把 js 放到 body 最后？</p>
</blockquote>
<p>本来渲染一部分，遇到 js 会暂停渲染，优先加载并执行 JS 代码，完成再继续【在 body 里面的最后】</p>
<p>或者利用 window.onload &#x3D; function(){}代码包裹，文档加载之后再执行，或者 readyState 来触发 js，不建议放在 head 中。</p>
<blockquote>
<p>问：从输入 url 到渲染出页面的整个过程</p>
</blockquote>
<p>下载资源：各个资源类型，下载过程<br>渲染页面：结合 html css javascript 图片等</p>
<blockquote>
<p>window.onload 和 DOMContentLoaded 的区别</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;load&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//页面的全部资源加载完才会执行，包括图片、视频等</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//DOM渲染完即可执行，此时图片、视频还可能没有加载完</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>window.onload：资源全部加载完才能执行，包括图片<br>DOMContentLoade ：DOM 渲染完成即可，图片可能尚未下载</p>
<h5 id="二、性能优化（体验优化）"><a href="#二、性能优化（体验优化）" class="headerlink" title="二、性能优化（体验优化）"></a>二、性能优化（体验优化）</h5><p>性能优化原则：<br>多使用内存、缓存或其他方法<br>减少 CPU 计算量，减少网络加载耗时<br>（适用于所有编程的性能优化—空间换时间）</p>
<h6 id="1-让加载更快"><a href="#1-让加载更快" class="headerlink" title="1.让加载更快"></a>1.让加载更快</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">减少资源体积：压缩代码【如webpack】【服务器端gzip压缩，浏览器进行反解析】</span><br><span class="line">减少访问次数：合并代码【如webpack，如雪碧图】，SSR服务端渲染，缓存</span><br><span class="line">   【缓存】：静态资源加<span class="built_in">hash</span>后缀，根据文件内容计算<span class="built_in">hash</span></span><br><span class="line">文件内容不变，则<span class="built_in">hash</span>不变，则url不变</span><br><span class="line">url和文件不变，则会自动触发http缓存机制，返回304</span><br><span class="line">   【SSR】:服务器端渲染：将网页和数据一起加载，一起渲染</span><br><span class="line">          非SSR（前后端分离）：先加载网页，再加载数据，再渲染数据</span><br><span class="line">          早先的JSP ASP PHP，现在的Vue React SSR</span><br><span class="line">使用更快的网络：CDN</span><br></pre></td></tr></table></figure>

<h6 id="2-让渲染更快"><a href="#2-让渲染更快" class="headerlink" title="2.让渲染更快"></a>2.让渲染更快</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CSS放在<span class="built_in">head</span>，JS放在body最下面</span><br><span class="line">尽早开始执行JS，用DOMContentLoaded触发</span><br><span class="line">懒加载（图片懒加载，上滑加载更多）【将图片地址放在自定义属性data-realsrc中，需要加载时再将地址赋值给src】</span><br><span class="line">对DOM查询进行缓存【例：循环时，将所有节点数量保存起来，再循环，而不是在<span class="keyword">for</span>中每次都去计算数量】</span><br><span class="line">频繁DOM操作，合并到一起插入DOM结构【使用文档碎片】</span><br><span class="line">节流throttle  防抖debounce</span><br></pre></td></tr></table></figure>

<blockquote>
<p>防抖 debounce</p>
</blockquote>
<p>监听一个输入框的，文字变化后触发 change 事件<br>直接用 keyup 事件，则会频发触发 change 事件<br>防抖：用户输入结束或暂停时，才会触发 change 事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> input1 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;input1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// let timer = null</span></span><br><span class="line"><span class="comment">// input1.addEvent  Listener(&#x27;keyup&#x27;, function () &#123;</span></span><br><span class="line"><span class="comment">//     if (timer) &#123;</span></span><br><span class="line"><span class="comment">//         clearTimeout(timer)</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     timer = setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//         // 模拟触发 change 事件</span></span><br><span class="line"><span class="comment">//         console.log(input1.value)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//         // 清空定时器</span></span><br><span class="line"><span class="comment">//         timer = null</span></span><br><span class="line"><span class="comment">//     &#125;, 500)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装防抖</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">fn, delay = <span class="number">500</span></span>) &#123;</span><br><span class="line">  <span class="comment">// timer 是闭包中的</span></span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, <span class="number">2</span>); <span class="comment">//指向container</span></span><br><span class="line">    <span class="keyword">if</span> (timer) &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">    &#125;</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, <span class="number">3</span>);</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">      timer = <span class="literal">null</span>;</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">input1.<span class="title function_">addEventListener</span>(</span><br><span class="line">  <span class="string">&quot;keyup&quot;</span>,</span><br><span class="line">  <span class="title function_">debounce</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">target</span>, <span class="string">&quot;b&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(input1.<span class="property">value</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">600</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------详细封装的防抖函数-----------------</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, wait, immediate</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timeout, result;</span><br><span class="line">  <span class="keyword">let</span> debounced = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(this);  //=&gt;从中可以测试出this指向的container</span></span><br><span class="line">    <span class="keyword">let</span> _this = <span class="variable language_">this</span>; <span class="comment">//保存this</span></span><br><span class="line">    <span class="keyword">let</span> args = <span class="variable language_">arguments</span>; <span class="comment">// 获取对应的实参，解决前面的event指向问题</span></span><br><span class="line">    <span class="built_in">clearTimeout</span>(timeout); <span class="comment">// 清空上从定时器</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (immediate) &#123;</span><br><span class="line">      <span class="comment">//表示立即执行</span></span><br><span class="line">      <span class="comment">//第三个问题，解决立即执行防抖函数</span></span><br><span class="line">      <span class="keyword">let</span> callNow = !timeout;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">      &#125;, wait);</span><br><span class="line">      <span class="keyword">if</span> (callNow) result = func.<span class="title function_">apply</span>(_this, args);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//不会立即执行</span></span><br><span class="line">      timeout = <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// console.log(this)  //=&gt;这里面的this指向window，也就是前面的count那的this是指向window</span></span><br><span class="line">        <span class="comment">//但是防抖函数的this应该是指向container</span></span><br><span class="line">        result = func.<span class="title function_">apply</span>(_this, args);</span><br><span class="line">      &#125;, wait);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result; <span class="comment">//第四个问题，增加函数的返回结果</span></span><br><span class="line">  &#125;;</span><br><span class="line">  debounced.<span class="property">cancel</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//增加取消防抖</span></span><br><span class="line">    <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">    timeout = <span class="literal">null</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> debounced;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Container</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#container&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CancelDebounce</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#btn&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">doSomething</span>(<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(e, <span class="string">&quot;第二个问题.由原来的undefined，指向当前鼠标事件对象&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">    <span class="variable language_">this</span>,</span><br><span class="line">    <span class="string">&quot;第一个问题.由原来指向window，改变成指向container【改变执行函数内部的this指向】&quot;</span></span><br><span class="line">  );</span><br><span class="line">  <span class="title class_">Container</span>.<span class="property">innerHTML</span> = count++; <span class="comment">//可能会做回调或者ajax请求</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;想要的结果&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> doSome = <span class="title function_">debounce</span>(doSomething, <span class="number">1000</span>);</span><br><span class="line"><span class="title class_">CancelDebounce</span>.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//取消防抖</span></span><br><span class="line">  doSome.<span class="title function_">cancel</span>();</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//高阶函数 防抖</span></span><br><span class="line"><span class="comment">// Container.onMouseMove = debounce(doSomething,1000,true);</span></span><br><span class="line"><span class="title class_">Container</span>.<span class="property">onMouseMove</span> = doSome;</span><br></pre></td></tr></table></figure>

<p>防抖：事件响应函数在一段时间后才执行，如果在这段时间内再次调用，则重新计算执行时间；当预定的时间内没有再次调用该函数，则执行 doSomething</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">防抖函数常见应用：</span><br><span class="line">    scroll事件的滚动触发</span><br><span class="line">    搜索框输入查询</span><br><span class="line">    表单验证</span><br><span class="line">    按钮提交事件</span><br><span class="line">    浏览器<span class="string">&#x27;窗口缩放,resize事件&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>节流 throttle</p>
</blockquote>
<p>拖拽一个元素时，要随时拿到该元素被拖拽的位置<br>直接用 drag 事件，则会频发触发，很容易导致卡顿<br>节流：无论拖拽速度多快，都会每隔 100ms 触发一次</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> div1 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;div1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// let timer = null</span></span><br><span class="line"><span class="comment">// div1.addEventListener(&#x27;drag&#x27;, function (e) &#123;</span></span><br><span class="line"><span class="comment">//     if (timer) &#123;</span></span><br><span class="line"><span class="comment">//         return</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     timer = setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//         console.log(e.offsetX, e.offsetY)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//         timer = null</span></span><br><span class="line"><span class="comment">//     &#125;, 100)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装节流</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">fn, delay = <span class="number">100</span></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (timer) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">      timer = <span class="literal">null</span>;</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">div1.<span class="title function_">addEventListener</span>(</span><br><span class="line">  <span class="string">&quot;drag&quot;</span>,</span><br><span class="line">  <span class="title function_">throttle</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">offsetX</span>, e.<span class="property">offsetY</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">div1.<span class="title function_">addEventListener</span>(<span class="string">&quot;drag&quot;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//------详细封装的节流函数---------------</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, wait, options</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> _this, args, timeout;</span><br><span class="line">  <span class="keyword">let</span> old = <span class="number">0</span>; <span class="comment">//之前的时间戳</span></span><br><span class="line">  <span class="keyword">if</span> (!options) options = &#123;&#125;; <span class="comment">//如果没有options就将其设置为空对象</span></span><br><span class="line">  <span class="keyword">let</span> later = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    old = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">valueOf</span>(); <span class="comment">//每隔1秒执行之后，需要更新时间</span></span><br><span class="line">    timeout = <span class="literal">null</span>;</span><br><span class="line">    func.<span class="title function_">apply</span>(_this, args);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    _this = <span class="variable language_">this</span>;</span><br><span class="line">    args = <span class="variable language_">arguments</span>;</span><br><span class="line">    <span class="keyword">let</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">valueOf</span>(); <span class="comment">//获取当前时间戳</span></span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">leading</span> === <span class="literal">false</span> &amp;&amp; !old) &#123;</span><br><span class="line">      <span class="comment">//让第一次不进入</span></span><br><span class="line">      old = now;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (now - old &gt; wait) &#123;</span><br><span class="line">      <span class="comment">// 如果走到这里，表示第一次会直接执行</span></span><br><span class="line">      <span class="keyword">if</span> (timeout) &#123;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      func.<span class="title function_">apply</span>(_this, args);</span><br><span class="line">      old = now;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!timeout &amp;&amp; options.<span class="property">trailing</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">      <span class="comment">//每隔1秒会执行</span></span><br><span class="line">      <span class="comment">//最后一次也被执行</span></span><br><span class="line">      timeout = <span class="built_in">setTimeout</span>(later, wait);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">doThrottle</span>(<span class="params">e</span>) &#123;</span><br><span class="line">  container.<span class="property">innerHTML</span> = count++;</span><br><span class="line">&#125;</span><br><span class="line">container.<span class="property">onmousemove</span> = <span class="title function_">throttle</span>(doThrottle, <span class="number">1000</span>, &#123;</span><br><span class="line">  <span class="attr">leading</span>: <span class="literal">false</span>, <span class="comment">//是否立即执行【否】</span></span><br><span class="line">  <span class="attr">trailing</span>: <span class="literal">true</span>, <span class="comment">//最后一次是否执行</span></span><br><span class="line">  <span class="comment">//两者不能同为false,否则就会产生bug,会导致触发事件立即执行一次后就失效了!</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">节流应用场景：</span><br><span class="line">    DOM元素的拖拽功能的实现</span><br><span class="line">    射击游戏中的每隔一段时间射击</span><br><span class="line">    计算鼠标移动的距离</span><br><span class="line">    监听scroll滚动事件</span><br><span class="line">    搜索联想</span><br><span class="line">    高频点击提交,表单重复提交</span><br></pre></td></tr></table></figure>

<blockquote>
<p>防抖节流之间的异同比较</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">相同:</span><br><span class="line">    都可以通过setTimeout实现</span><br><span class="line">    目的都是:降低回调执行频率,节省计算资源</span><br><span class="line">不同:</span><br><span class="line">    函数防抖: 在一段连续操作结束后,处理回调,利用clearTimeout和setTimeout实现.</span><br><span class="line">    函数节流:在一段连续操作中,每一段时间只执行一次,频率较高的时间中使用来提高性能.</span><br><span class="line">    函数防抖关注一定时间连续触发的事件只在最后执行,而函数节流侧重于一段时间内只执行一次!</span><br></pre></td></tr></table></figure>

<h5 id="三、安全"><a href="#三、安全" class="headerlink" title="三、安全"></a>三、安全</h5><blockquote>
<p>问：常见的 web 前端攻击方式有哪些？</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">XSS跨站请求攻击：</span><br><span class="line">    一个博客网站，我发表一篇博客，其中嵌入script脚本</span><br><span class="line">    脚本内容：获取cookie，发送到我的服务器（服务器配合跨域）</span><br><span class="line">    发布这篇博客，有人查看它，我轻松收割访问者的cookie</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">XSS预防：</span><br><span class="line">    替换特殊字符，如&lt;变为&amp;lt;&gt;变为&amp;gt;</span><br><span class="line">    &lt;scrtip&gt;变为&amp;lt;script&amp;gt;，直接显示，而不会作为脚本执行</span><br><span class="line">    前端要替换，后端也要替换，都做总不会有错</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">XSRF跨站请求伪造：</span><br><span class="line">    你正在购物，看中了某个商品，商品<span class="built_in">id</span>是100</span><br><span class="line">    付费接口是xxx.com/pay?<span class="built_in">id</span>=100,但没有任何验证</span><br><span class="line">    我是攻击者，我看中了一个商品，<span class="built_in">id</span>是200</span><br><span class="line">    我向你发送一封电子邮件，邮件标题很吸引人</span><br><span class="line">    但邮件正文隐藏着&lt;img src=xxx.com/pay?<span class="built_in">id</span>=200/&gt;</span><br><span class="line">    你一查看邮件，就帮我购买了<span class="built_in">id</span>是200的商品</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">XSRF预防：</span><br><span class="line">    使用post接口</span><br><span class="line">    增加验证，例如密码、短信验证码、指纹等</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2020/01/27/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9112%EF%BC%9Ahttp%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/27/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9112%EF%BC%9Ahttp%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98/" itemprop="url">http浏览器缓存</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-27T19:37:50+08:00">
                2020-01-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/27/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9112%EF%BC%9Ahttp%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/01/27/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9112%EF%BC%9Ahttp%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/01/27/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9112%EF%BC%9Ahttp%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98/" class="leancloud_visitors" data-flag-title="http浏览器缓存">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  2.2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  8
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="一、http-状态码"><a href="#一、http-状态码" class="headerlink" title="一、http 状态码"></a>一、http 状态码</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">状态码的分类：</span><br><span class="line">    1xx服务器收到请求</span><br><span class="line">    2xx请求成功，如200</span><br><span class="line">    3xx重定向，如302</span><br><span class="line">    4xx客户端错误，如404</span><br><span class="line">    5xx服务端错误，如500</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">常见状态码：</span><br><span class="line">    200成功</span><br><span class="line">    301永久重定向（配合location，浏览器自动处理）</span><br><span class="line">    302临时重定向（配合location，浏览器自动处理）</span><br><span class="line">    304资源未被修改</span><br><span class="line">    404资源未找到</span><br><span class="line">    403没有权限</span><br><span class="line">    500服务器错误</span><br><span class="line">    504网关超时</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">关于协议和规范：</span><br><span class="line">    就是一个约定</span><br><span class="line">    要求大家都跟着执行</span><br><span class="line">    不要违反规范，例如IE浏览器</span><br></pre></td></tr></table></figure>

<h5 id="二、http-methods"><a href="#二、http-methods" class="headerlink" title="二、http methods"></a>二、http methods</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">传统的methods：</span><br><span class="line">    get获取服务器的数据</span><br><span class="line">    post向服务器提交数据</span><br><span class="line">    简单的网页功能，就这两个操作</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">现在的methods：</span><br><span class="line">    get获取数据</span><br><span class="line">    post新建数据</span><br><span class="line">    patch/put更新数据</span><br><span class="line">    delete删除数据</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h5 id="三、Restful-API"><a href="#三、Restful-API" class="headerlink" title="三、Restful API"></a>三、Restful API</h5><blockquote>
<p>问：什么是 Restful API？</p>
</blockquote>
<p>一种新的 API 设计方法（早已推广使用）<br>传统 API 设计：把每个 url 当作一个功能<br>Restfu API 设计：把每个 url 当作一个唯一的资源</p>
<blockquote>
<p>问：如何设计成一个资源？</p>
</blockquote>
<p>尽量不用 url 参数：<br>传统 API 设计： &#x2F;api&#x2F;list?pageIndex&#x3D;2<br>Restfu API 设计： &#x2F;api&#x2F;list&#x2F;2</p>
<p>用 method 表示操作类型（传统 API 设计）：<br>post 请求 &#x2F;api&#x2F;create-blog<br>post 请求 &#x2F;api&#x2F;update-blog?id&#x3D;100<br>get 请求 &#x2F;api&#x2F;get-blog?id&#x3D;100</p>
<p>用 method 表示操作类型（Restful API 设计）：<br>post 请求 &#x2F;api&#x2F;blog<br>patch 请求 &#x2F;api&#x2F;blog&#x2F;100<br>get 请求 &#x2F;api&#x2F;blog&#x2F;100</p>
<h5 id="四、http-headers"><a href="#四、http-headers" class="headerlink" title="四、http headers"></a>四、http headers</h5><blockquote>
<p>问：http 常见的 header 有哪些？</p>
</blockquote>
<p>Accept 浏览器可接收的数据格式<br>Accept-Encoding 浏览器可接收的压缩算法，如 gzip<br>Accept-Language 浏览器可接收的语言，如 zh-CN<br>Connection:keep-alive 一次 TCP 连接重复使用<br>cookie(请求时会带上本地信息)<br>Host<br>User-Agent(简称 UA)浏览器信息<br>Content-type 发送数据的格式，如 application&#x2F;json</p>
<blockquote>
<p>问：常见的 Response Headers</p>
</blockquote>
<p>Content-type 返回数据的格式，如 application&#x2F;json<br>Content-length 返回数据的大小，多少字节<br>Content-Encoding 返回数据的压缩算法，如 gzip<br>Set-Cookie</p>
<blockquote>
<p>问：自定义 header</p>
</blockquote>
<p>axios 中就可以自定义 header：【文档地址：axios-js.com&#x2F;docs&#x2F;#Request-Config】<br>如：headers:{‘X-Requested-With’:’XMLHttpRequest’}</p>
<blockquote>
<p>问：缓存相关的 headers</p>
</blockquote>
<p>Cache-Control Expires（不用了，已经被 Cache-Control 替代了）<br>Last-Modified If-Modified-Since<br>Etag If-None-Match</p>
<h5 id="五、http-缓存策略"><a href="#五、http-缓存策略" class="headerlink" title="五、http 缓存策略"></a>五、http 缓存策略</h5><h6 id="关于缓存的介绍"><a href="#关于缓存的介绍" class="headerlink" title="关于缓存的介绍"></a>关于缓存的介绍</h6><blockquote>
<p>问：什么是缓存？</p>
</blockquote>
<p>简单来说，浏览器缓存就是把一个已经请求过的 Web 资源（如 html 页面，图片，js，数据等）拷贝一份副本储存在浏览器中。缓存会根据进来的请求保存输出内容的副本。当下一个请求来到的时候，如果是相同的 URL，缓存会根据缓存机制决定是直接使用副本响应访问请求，还是向源服务器再次发送请求。比较常见的就是浏览器会缓存访问过网站的网页，当再次访问这个 URL 地址的时候，如果网页没有更新，就不会再次下载网页，而是直接使用本地缓存的网页。只有当网站明确标识资源已经更新，浏览器才会再次下载网页。</p>
<p>概括：在页面请求之后，web 资源都被缓存了，在后面的重复请求中，许多资源都是直接从缓存中读取的（from cache），而不是重新去向服务器请求。</p>
<blockquote>
<p>问：为什么需要缓存？</p>
</blockquote>
<p>1）减少网络带宽消耗</p>
<p>无论对于网站运营者或者用户，带宽都代表着金钱，过多的带宽消耗，只会便宜了网络运营商。当 Web 缓存副本被使用时，只会产生极小的网络流量，可以有效的降低运营成本。</p>
<p>（2）降低服务器压力</p>
<p>给网络资源设定有效期之后，用户可以重复使用本地的缓存，减少对源服务器的请求，间接降低服务器的压力。同时，搜索引擎的爬虫机器人也能根据过期机制降低爬取的频率，也能有效降低服务器的压力。</p>
<p>（3）减少网络延迟，加快页面打开速度</p>
<p>带宽对于个人网站运营者来说是十分重要，而对于大型的互联网公司来说，可能有时因为钱多而真的不在乎。那 Web 缓存还有作用吗？答案是肯定的，对于最终用户，缓存的使用能够明显加快页面打开速度，达到更好的体验。</p>
<p>概括：让页面加载更快。cpu 计算和页面渲染较快，但是网络请求的加载相当较慢。尽量减少网络请求的体积和数量。网络请求是不稳定的。</p>
<blockquote>
<p>问：哪些资源可以被缓存？</p>
</blockquote>
<p>静态资源（js css img）<br>【html 可能会被更新，业务数据会更新（如博客内容），这些都不可缓存】</p>
<h6 id="http-缓存策略（强制缓存-协商缓存）"><a href="#http-缓存策略（强制缓存-协商缓存）" class="headerlink" title="http 缓存策略（强制缓存+协商缓存）"></a>http 缓存策略（强制缓存+协商缓存）</h6><blockquote>
<p>强制缓存：</p>
</blockquote>
<p>Cache-Control：</p>
<ul>
<li>Response Headers 中加入</li>
<li>控制强制缓存的逻辑</li>
<li>例如：Cache-Control:max-age&#x3D;31536000(单位是秒)【1 年】</li>
</ul>
<p>Cache-Control 的值：</p>
<ul>
<li>max-age:过期时间</li>
<li>no-cache:不用强制缓存，由服务端处理</li>
<li>no-store:不用强制缓存，直接服务端拿来就可以了</li>
<li>private:只能允许最终用户做缓存</li>
<li>public：中间路由或中间代理也可以做缓存</li>
</ul>
<p>关于 Expires：</p>
<ul>
<li>同在 Response Headers 中</li>
<li>同为控制缓存过期</li>
<li>已被 Cache-Control 代替</li>
</ul>
<blockquote>
<p>协商缓存（对比缓存）：</p>
</blockquote>
<p>服务器端缓存策略：服务端来判断这个资源是否可以被缓存，而不是缓存在服务端<br>服务器判断客户端资源，是否和服务端资源一样<br>判断资源一样，服务端没有改动过，则一致返回 304，否则返回 200 和最新的资源</p>
<blockquote>
<p>资源标识：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">在Request Headers中，有两种：</span><br><span class="line"></span><br><span class="line">1.Last-Modified（资源的最后修改时间）</span><br><span class="line">浏览器-----------------------初次请求------------------------------------------------&gt;服务器</span><br><span class="line">浏览器&lt;----------------返回资源，和资源标识Last-Modified---------------------------服务器</span><br><span class="line">浏览器-------再次请求，Request Headers带着If-Modified-Since:Last-Modified------&gt;服务器</span><br><span class="line">浏览器&lt;-------返回304，或返回资源和新的资源标识Last-Modified---------------------服务器</span><br><span class="line"></span><br><span class="line">2.Etag资源的唯一标识（一个字符串，类似人类的指纹）</span><br><span class="line">浏览器-----------------------初次请求-----------------------------------&gt;服务器</span><br><span class="line">浏览器&lt;----------------返回资源，和资源标识Etag------------------------服务器</span><br><span class="line">浏览器-------再次请求，Request Headers带着If-None-Match:Etag------&gt;服务器</span><br><span class="line">浏览器&lt;-------返回304，或返回资源和新的资源标识Etag------------------服务器</span><br><span class="line"></span><br><span class="line">Last-Modified和Etag：</span><br><span class="line">这两个可以共存，会优先使用Etag</span><br><span class="line">Last-Modified只能精确到秒级</span><br><span class="line">如果资源被重复生成，而内容不变，则Etag更精确</span><br></pre></td></tr></table></figure>

<blockquote>
<p>问：描述一下 http 的缓存机制【重要】</p>
</blockquote>
<p><img src="https://www.daykalif.com/blog_img/http.jpeg" alt="daykalif"></p>
<blockquote>
<p>一次完整的 http 请求：</p>
</blockquote>
<p>1.域名解析<br>2.tcp3 次握手 3.建立 tcp 链接后，发起 http 请求 4.服务端响应 http 请求，浏览器得到 html 代码 5.浏览器解析 html 代码，并请求 html 代码中的资源 6.浏览器对页面进行渲染，呈现给用户。</p>
<blockquote>
<p>HTTP 和 HTTPS 的区别：</p>
</blockquote>
<p>HTTP 协议通常承载于 TCP 协议之上，在 HTTP 和 TCP 之间添加一个安全协议层（SSL 或 TSL）。这个时候，就成了我们常说的 HTTPS。默认 HTTP 的端口号为 80，HTTPS 的端口号为 443.</p>
<blockquote>
<p>浏览器 HTTP 请求流程：</p>
</blockquote>
<p>第一次请求：<br><img src="https://www.daykalif.com/blog_img/http1.png" alt="daykalif"></p>
<p>再次请求：<br><img src="https://www.daykalif.com/blog_img/http2.png" alt="daykalif"></p>
<blockquote>
<p>刷新操作方式，对缓存的影响：</p>
</blockquote>
<p>三种刷新操作：<br>正常操作：地址栏输入 url,跳转链接，前进后退等<br>手动刷新：F5，command+R,点击刷新按钮，右击菜单刷新<br>强制刷新：ctrl+F5,shift+command+R</p>
<blockquote>
<p>不同刷新操作，不同的缓存策略</p>
</blockquote>
<p>正常刷新：强制缓存有效，协商缓存有效<br>手动刷新：强制缓存失效，协商缓存有效<br>强制刷新：强制缓存失效，协商缓存失效</p>
<blockquote>
<p>不能缓存的请求：</p>
</blockquote>
<p>当然并不是所有请求都能被缓存，无法被浏览器缓存的请求如下：</p>
<ol>
<li>HTTP 信息头中包含 Cache-Control:no-cache，pragma:no-cache（HTTP1.0），或 Cache-Control:max-age&#x3D;0 等告诉浏览器不用缓存的请求</li>
<li>需要根据 Cookie，认证信息等决定输入内容的动态请求是不能被缓存的</li>
<li>经过 HTTPS 安全加密的请求（有人也经过测试发现，ie 其实在头部加入 Cache-Control：max-age 信息，firefox 在头部加入 Cache-Control:Public 之后，能够对 HTTPS 的资源进行缓存，参考《<a href="http://www.ruanyifeng.com/blog/2011/02/seven_myths_about_https.html">HTTPS 的七个误解</a>》）</li>
<li>POST 请求无法被缓存</li>
<li>HTTP 响应头中不包含 Last-Modified&#x2F;Etag，也不包含 Cache-Control&#x2F;Expires 的请求无法被缓存</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2020/01/24/JS/JS%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/24/JS/JS%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%96%B9%E6%B3%95/" itemprop="url">JS本地存储方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-24T15:51:58+08:00">
                2020-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/24/JS/JS%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%96%B9%E6%B3%95/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/01/24/JS/JS%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%96%B9%E6%B3%95/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/01/24/JS/JS%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%96%B9%E6%B3%95/" class="leancloud_visitors" data-flag-title="JS本地存储方法">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  1.8k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  7
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="javaScript-有三种数据存储方式"><a href="#javaScript-有三种数据存储方式" class="headerlink" title="javaScript 有三种数据存储方式"></a>javaScript 有三种数据存储方式</h4><h5 id="一、使用缓存的好处"><a href="#一、使用缓存的好处" class="headerlink" title="一、使用缓存的好处"></a>一、使用缓存的好处</h5><p>(1).当页面渲染的数据过多时，为了减轻对内存的占用，对初次接收且会用到的数据进行本地缓存，是有着大好处的.</p>
<p>(2).受网速等各种因素的影响，当渲染数据过多时，若存在频繁的切换页面，用户体验效果不佳。</p>
<h5 id="二、常见的本地缓存方式"><a href="#二、常见的本地缓存方式" class="headerlink" title="二、常见的本地缓存方式"></a>二、常见的本地缓存方式</h5><p>1、sessionStorage<br>临时的会话存储，只要当前的会话窗口未关闭，存储的信息就不会丢失，即便刷新了页面或者在编辑器中更改了代码，存储的会话信息也不会丢失。</p>
<p>用法:详情可见另一随笔 <code>JSON.parse &amp; JSON.stringify</code></p>
<p>2、localStorage</p>
<p>是一种如果你不主动去清除，会一直将数据存储在客户端的储存方式，即使关闭了浏览器，下次打开的时候仍然可以看到之前存储的未主动清除的数据（即便是杀毒软件或者浏览器自带的清除功能，也不能将 localStorage 存储的数据清除掉）.</p>
<p>用法：和 sessionStorgae 一致</p>
<p>3、cookie</p>
<p>cookie 属于较老且最常见用的最多的技术了，cookie 的优点很多，用起来也比较方便</p>
<ul>
<li>在 js 的脚本中，cookie 实际上是 document 的一个字符属性，当你读取 cookie 的值时，得到的是一个字符串，里面的是当前 web 存放的所有的 cookie 的 name,value,除此之外，</li>
<li>每一个 cookie 除了有 name，value，还有其他四个属性：expires 过期时间,path 路径，domain 域以及 secure 安全等。</li>
<li>cookie 中存储的数据，如果没有设置有效期的话，浏览器关闭的时候就会被清空（并非关系选项卡）</li>
<li>cookie 的区分是以域名的方式。</li>
</ul>
<p>缺点：</p>
<ul>
<li>cookie 兼容所有的浏览器，但其存储的数据是有大小限制的，一般同源是 4kb；</li>
<li>cookie 本地存储的数据会被发送到服务器（所以建议在服务器环境下使用 cookie）；</li>
<li>跨域访问问题；浪费带宽等等；</li>
</ul>
<p>cookie 的用法：以键值对的方式来存储数据（key：value 形式）,一个域名下能存储的 cookie 个数是不同的，具体的看浏览器的支持性了</p>
<p>当一个域名下有多个 cookie 时，输出 document.cookie 时输出的是当前域名下的所有 cookie，cookie 之间以分号加空格的形式隔开</p>
<p>存储格式：<br><code>document.cookie=&quot;name=&lt;value&gt;[;expires=&lt;date&gt;][;domain=&lt;domain&gt;][;secrue]&quot;</code></p>
<p>普通的存储数据如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">&quot;id=18&quot;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">&quot;name=liangye&quot;</span>;</span><br><span class="line"><span class="title function_">alert</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>); <span class="comment">//id=18; name=liangye 由于没有设置有效期expires,浏览器关闭后会自动来清理cookie（并非关闭标签）</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>js 中如果用 cookie 来存储数据的话，建议是自己写封装好的函数来简化美化下代码。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//封装函数的使用  如果不设置时间的话关闭浏览器时所存储的数据就会过期</span></span><br><span class="line"><span class="comment">//存储cookie 修改cookie也可调用次方法，覆盖</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setCookie</span>(<span class="params">name, value, iTime</span>) &#123;</span><br><span class="line">  <span class="comment">//name是cookie中的名，value是其值，iTime来预定过期的时间（以天为单位）</span></span><br><span class="line">  <span class="keyword">var</span> iDate = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  iDate.<span class="title function_">setDate</span>(iDate.<span class="title function_">getDate</span>() + iTime); <span class="comment">//以天为单位,存储是需要将Date对象存储为格林威治时间形式的字符串</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">cookie</span> = name + <span class="string">&quot;=&quot;</span> + value + <span class="string">&quot;;expires=&quot;</span> + iDate.<span class="title function_">toGMTString</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取cookie</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCookie</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="comment">//web中cookie是以分号+空格隔开的</span></span><br><span class="line">  <span class="keyword">var</span> res = <span class="variable language_">document</span>.<span class="property">cookie</span>.<span class="title function_">split</span>(<span class="string">&quot;; &quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; res.<span class="property">length</span>; i++)</span><br><span class="line">    <span class="keyword">if</span> (res[i].<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>)[<span class="number">0</span>] === name) <span class="keyword">return</span> res[i].<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>)[<span class="number">1</span>];</span><br><span class="line">  <span class="comment">//未找到</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//移除cookie 通过设置过期时间 再次打开浏览器会发现过期的cookie已经被清除</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">rmCookie</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="title function_">setCookie</span>(name, <span class="string">&quot;&quot;</span>, -<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="三、cookie、localStorage、sessionStorage-对比"><a href="#三、cookie、localStorage、sessionStorage-对比" class="headerlink" title="三、cookie、localStorage、sessionStorage 对比"></a>三、cookie、localStorage、sessionStorage 对比</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">例: <span class="variable language_">localStorage</span>.<span class="property">a</span> = <span class="number">3</span>; <span class="comment">//设置a为&quot;3&quot;</span></span><br><span class="line"><span class="variable language_">localStorage</span>[<span class="string">&quot;a&quot;</span>] = <span class="string">&quot;sfsf&quot;</span>; <span class="comment">//设置a为&quot;sfsf&quot;，覆盖上面的值</span></span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;isaac&quot;</span>); <span class="comment">//设置b为&quot;isaac&quot;</span></span><br><span class="line"><span class="keyword">var</span> a1 = <span class="variable language_">localStorage</span>[<span class="string">&quot;a&quot;</span>]; <span class="comment">//获取a的值</span></span><br><span class="line"><span class="keyword">var</span> a2 = <span class="variable language_">localStorage</span>.<span class="property">a</span>; <span class="comment">//获取a的值</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;b&quot;</span>); <span class="comment">//获取b的值</span></span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;c&quot;</span>); <span class="comment">//清除c的值</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>相同点：</p>
</blockquote>
<p>都保存在浏览器端</p>
<blockquote>
<p>不同点：</p>
</blockquote>
<p>1.传递方式不同</p>
<ul>
<li><p>cookie 数据始终在同源的 http 请求中携带（即使不需要），即 cookie 在浏览器和服务器间来回传递。</p>
</li>
<li><p>sessionStorage 和 localStorage 不会自动把数据发给服务器，仅在本地保存。</p>
<p>2.数据大小不同</p>
</li>
<li><p>cookie 数据还有路径（path）的概念，可以限制 cookie 只属于某个路径下。</p>
</li>
<li><p>存储大小限制也不同，cookie 数据不能超过 4k，同时因为每次 http 请求都会携带 cookie，所以 cookie 只适合保存很小的数据，如会话标识。</p>
</li>
<li><p>sessionStorage 和 localStorage 虽然也有存储大小的限制，但比 cookie 大得多，可以达到 5M 或更大。</p>
<p>3.数据有效期不同</p>
</li>
<li><p>sessionStorage：仅在当前浏览器窗口关闭前有效，自然也就不可能持久保持；</p>
</li>
<li><p>localStorage：始终有效，窗口或浏览器关闭也一直保存，因此用作持久数据；（如果你不手动去删除的话）</p>
</li>
<li><p>cookie 只在设置的 cookie 过期时间之前一直有效，即使窗口或浏览器关闭。</p>
<p>4.作用域不同</p>
</li>
<li><p>sessionStorage 不在不同的浏览器窗口中共享，即使是同一个页面；</p>
</li>
<li><p>localStorage 在所有同源窗口中都是共享的；</p>
</li>
<li><p>cookie 也是在所有同源窗口中都是共享的。</p>
</li>
<li><p>Web Storage 支持事件通知机制，可以将数据更新的通知发送给监听者。</p>
</li>
<li><p>Web Storage 的 api 接口使用更方便。</p>
<p>5.⚠️ 注意点</p>
</li>
<li><p>一些浏览器处于安全的角度可能会禁用 cookie,但无法禁用 localStorage</p>
</li>
<li><p>cookie 兼容所有的浏览器（本地 cookie 谷歌不支持），storage 不支持 IE6~8;</p>
</li>
</ul>
<p>在使用本地 cookie 缓存时发现 chrome 竟然不支持 js 本地操作 cookie，其他市面上的主流浏览器基本都支持，因此在使用 cookie 前，先确认浏览器支不支持 cookie 先！！！</p>
<blockquote>
<p>检查当前浏览器是否支持或者禁用了 cookie，可用以下 js 代码：</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dt = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">dt.<span class="title function_">setSeconds</span>(dt.<span class="title function_">getSeconds</span>() + <span class="number">60</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">&quot;cookietest=1; expires=&quot;</span> + dt.<span class="title function_">toGMTString</span>();</span><br><span class="line"><span class="keyword">var</span> cookiesEnabled = <span class="variable language_">document</span>.<span class="property">cookie</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;cookietest=&quot;</span>) != -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (!cookiesEnabled) &#123;</span><br><span class="line">  <span class="comment">//没有启用cookie</span></span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;没有启用cookie &quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">//已经启用cookie</span></span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;已经启用cookie &quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>实际项目中本地缓存都能来存储什么？</p>
</blockquote>
<p>cookie：记住用户名密码以便下次自动登录等等：当用户登录成功后，存储用户的部分信息，便可以在项目的任何页面知道当前的用户是谁了。<br>storage：存储一些不容易过期的数据（如从 api 接口中接收的用于渲染页面的数据），在存储时一般加入一个存储时间(time:Date.now()),以便在下次<br>刷新页面的时候判断存储的事件有没有超过预定的时间；也可以用来存储一些页面的源代码，比如 css 样式或者 html 等等（有必要的时候需要来结合前台的数据）；</p>
<p>参考文档：<br><a href="https://www.cnblogs.com/wwmm1996/p/10981958.html">https://www.cnblogs.com/wwmm1996/p/10981958.html</a><br><a href="https://www.cnblogs.com/liangye/p/13437107.html">https://www.cnblogs.com/liangye/p/13437107.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2020/01/24/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9111%EF%BC%9AJS-WEB-API-%E5%AD%98%E5%82%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/24/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9111%EF%BC%9AJS-WEB-API-%E5%AD%98%E5%82%A8/" itemprop="url">JS-WEB-API-存储</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-24T13:32:45+08:00">
                2020-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/24/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9111%EF%BC%9AJS-WEB-API-%E5%AD%98%E5%82%A8/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/01/24/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9111%EF%BC%9AJS-WEB-API-%E5%AD%98%E5%82%A8/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/01/24/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9111%EF%BC%9AJS-WEB-API-%E5%AD%98%E5%82%A8/" class="leancloud_visitors" data-flag-title="JS-WEB-API-存储">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  408
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="五、JS-WEB-API-存储"><a href="#五、JS-WEB-API-存储" class="headerlink" title="五、JS WEB API - 存储"></a>五、JS WEB API - 存储</h4><h5 id="1-cookie"><a href="#1-cookie" class="headerlink" title="1.cookie"></a>1.cookie</h5><p>本身用于浏览器和 server 通讯<br>被“借用”到本地存储来<br>可用 document.cookie &#x3D; ‘…’ 来修改<br>【同一个 key，会进行覆盖；不同的 key，会进行追加】</p>
<p>cookie 的缺点：<br>存储大小限制，最大 4kB<br>http 请求时需要发送到服务器端，增加请求数据量<br>只能用 document.cookie&#x3D;”…”来修改，太过简陋</p>
<p>存：document.cookie &#x3D; ‘a&#x3D;100’<br>取：document.cookie</p>
<h5 id="2-localStorage-和-sessionStorage"><a href="#2-localStorage-和-sessionStorage" class="headerlink" title="2.localStorage 和 sessionStorage"></a>2.localStorage 和 sessionStorage</h5><p>HTML5 专门为存储而设计，最大可存 5M（每个域名最大都可存 5M）<br>API 简单易用 setItem getItem<br>不会随着 http 请求被发送出去</p>
<p>存：localStorage.setItem(‘a’,100)<br>取：localStorage.getItem(‘a’) &#x2F;&#x2F;‘100’【字符串】</p>
<p>localStorage 数据会永久存储，除非代码或手动删除<br>sessionStorage 数据只存在于当前会话，浏览器关闭则清空<br>一般用 localStorage 会更多一些</p>
<p><strong>保存数据到 sessionStorage</strong><br><code>sessionStorage.setItem(&#39;key&#39;,&#39;value&#39;);</code></p>
<p><strong>从 sessionStorage 获取数据</strong><br><code>var data = sessionStorage.getItem(&#39;key&#39;);</code></p>
<p><strong>从 sessionStorage 删除保存的数据</strong><br><code>sessionStorage.removeItem(&#39;key&#39;);</code></p>
<p><strong>从 sessionStorage 删除所有保存的数据</strong><br><code>sessionStorage.clear();</code></p>
<h5 id="描述-cookie-localStorage-sessionStorage-区别"><a href="#描述-cookie-localStorage-sessionStorage-区别" class="headerlink" title="描述 cookie,localStorage,sessionStorage 区别"></a>描述 cookie,localStorage,sessionStorage 区别</h5><p>容量<br>API 易用性<br>是否跟随 http 请求发送出去</p>
<blockquote>
<p>数组，对象 cookie 的存储和访问？</p>
</blockquote>
<p>1.JSON.parse()函数：将 JS 对象表达式（json）字符串转为对象，具有 json 格式检测功能<br>2.JSON.stringify()函数：将 JS 值转换为 js 对象表示法（json）字符串<br>3.eval()函数–性能不及 JSON.parse()，安全性不高。<br>eval() 函数可计算某个字符串，并执行其中的的 JavaScript 代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//例子：</span></span><br><span class="line"><span class="built_in">eval</span>(<span class="string">&quot;&#123;&#125;&quot;</span>);</span><br><span class="line"><span class="built_in">eval</span>(<span class="string">&quot; &#x27;(&#x27; + &#x27;&#123;&#125;&#x27; + &#x27;)&#x27; &quot;</span>);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2020/01/24/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%919%EF%BC%9AJS-WEB-API-%E4%BA%8B%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/24/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%919%EF%BC%9AJS-WEB-API-%E4%BA%8B%E4%BB%B6/" itemprop="url">JS-WEB-API-事件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-24T09:58:56+08:00">
                2020-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/24/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%919%EF%BC%9AJS-WEB-API-%E4%BA%8B%E4%BB%B6/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/01/24/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%919%EF%BC%9AJS-WEB-API-%E4%BA%8B%E4%BB%B6/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/01/24/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%919%EF%BC%9AJS-WEB-API-%E4%BA%8B%E4%BB%B6/" class="leancloud_visitors" data-flag-title="JS-WEB-API-事件">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  736
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  3
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="JS-Web-API-事件"><a href="#JS-Web-API-事件" class="headerlink" title="JS Web API - 事件"></a>JS Web API - 事件</h4><h5 id="三、事件"><a href="#三、事件" class="headerlink" title="三、事件"></a>三、事件</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.事件绑定</span><br><span class="line">2.事件冒泡</span><br><span class="line">3.事件代理</span><br><span class="line">    代码简洁</span><br><span class="line">    减少浏览器内存占用</span><br><span class="line">    但是，不要滥用</span><br></pre></td></tr></table></figure>

<blockquote>
<p>问：编写一个通用的事件监听函数</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通用的事件绑定函数</span></span><br><span class="line"><span class="comment">// function bindEvent(elem, type, fn) &#123;</span></span><br><span class="line"><span class="comment">//     elem.addEventListener(type, fn)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bindEvent</span>(<span class="params">elem, type, selector, fn</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (fn == <span class="literal">null</span>) &#123;</span><br><span class="line">    fn = selector;</span><br><span class="line">    selector = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  elem.<span class="title function_">addEventListener</span>(type, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> target = event.<span class="property">target</span>;</span><br><span class="line">    <span class="keyword">if</span> (selector) &#123;</span><br><span class="line">      <span class="comment">// 代理绑定</span></span><br><span class="line">      <span class="keyword">if</span> (target.<span class="title function_">matches</span>(selector)) &#123;</span><br><span class="line">        <span class="comment">//matches用于判断当前元素是否符合css选择器</span></span><br><span class="line">        fn.<span class="title function_">call</span>(target, event);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 普通绑定</span></span><br><span class="line">      fn.<span class="title function_">call</span>(target, event);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通事件绑定</span></span><br><span class="line"><span class="keyword">const</span> btn1 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;btn1&quot;</span>);</span><br><span class="line"><span class="title function_">bindEvent</span>(btn1, <span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="comment">//注意：这里如果使用箭头函数，里面的this会指向window，不是我们当前想要的点击元素，所以改用成function形式</span></span><br><span class="line">  <span class="comment">// console.log(event.target) // 获取触发的元素</span></span><br><span class="line">  event.<span class="title function_">preventDefault</span>(); <span class="comment">// 阻止默认行为</span></span><br><span class="line">  <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">innerHTML</span>); <span class="comment">//如果上面非要用箭头函数，这里就改写成：alert(btn1.innerHTML)</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理绑定</span></span><br><span class="line"><span class="keyword">const</span> div3 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;div3&quot;</span>);</span><br><span class="line"><span class="comment">// bindEvent(div3, &#x27;click&#x27;, &#x27;a&#x27;, function (event) &#123;</span></span><br><span class="line"><span class="comment">//     event.preventDefault()</span></span><br><span class="line"><span class="comment">//     const target = event.target</span></span><br><span class="line"><span class="comment">//     if(terget.nodeName === &#x27;A&#x27;)&#123;</span></span><br><span class="line"><span class="comment">//         alert(this.innerHTML)</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">bindEvent</span>(div3, <span class="string">&quot;click&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  event.<span class="title function_">preventDefault</span>();</span><br><span class="line">  <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">innerHTML</span>); <span class="comment">//如果上面非要用箭头函数，这里就改写成：alert(event.target.innerHTML)</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件冒泡演示：</span></span><br><span class="line"><span class="keyword">const</span> body = <span class="variable language_">document</span>.<span class="property">body</span>;</span><br><span class="line"><span class="title function_">bindEvent</span>(body, <span class="string">&quot;click&quot;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;取消&quot;</span>);</span><br><span class="line">  <span class="comment">// console.log(event.target)</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> div2 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;div2&quot;</span>);</span><br><span class="line"><span class="title function_">bindEvent</span>(div2, <span class="string">&quot;click&quot;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;div2 clicked&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(event.<span class="property">target</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取消事件冒泡：</span></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;p1&quot;</span>);</span><br><span class="line"><span class="title function_">bindEvent</span>(p1, <span class="string">&quot;click&quot;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  event.<span class="title function_">stopPropagation</span>(); <span class="comment">// 阻止冒泡</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;激活&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>问：描述事件冒泡的流程</p>
</blockquote>
<p>基于 DOM 树形结构<br>事件会顺着触发元素往上冒泡<br>应用场景：代理</p>
<blockquote>
<p>问：无限下拉的图片列表，如何监听每个图片的点击？</p>
</blockquote>
<p>事件代理<br>用 e.target 获取触发元素<br>用 matches 来判断是否是触发元素<br>（代码参照问 1）</p>
<blockquote>
<p>冒泡、监听、默认行为</p>
</blockquote>
<p>IE 下取消冒泡：<br><code>event.cancelBubble = true</code></p>
<p>标准下取消冒泡：<br><code>event.stopPropagation()</code></p>
<p>取消浏览器默认行为：<br><code>event.preventDefault()</code>&#x2F;&#x2F;标准浏览器阻止默认事件。DOM 事件使用此方法取消默认事件。非标准浏览器（IE8）不可以取消默认事件。<br><code>event.return value = false</code> &#x2F;&#x2F;非标准浏览器（IE8）阻止默认事件。该方法标准浏览器也可以阻止默认事件<br><code>return false</code> &#x2F;&#x2F;退出执行，所有触发事件和动作都不会被执行</p>
<p>事件监听：<br><code>target.addEventListener(&quot;事件类型&quot;,函数是否捕获（布尔值）)</code>&#x2F;&#x2F;标准浏览器事件监听<br><code>target.attachEvent(&quot;事件类型&quot;,函数)</code>&#x2F;&#x2F;IE 浏览器事件监听</p>
<p>取消事件监听：<br><code>target.removeEventListener()</code>&#x2F;&#x2F;标准浏览器取消事件监听<br><code>target.detachEvent()</code>&#x2F;&#x2F;&#x2F;IE 浏览器取消事件监听</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2020/01/23/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9110%EF%BC%9AJS-WEB-API-AJAX/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/23/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9110%EF%BC%9AJS-WEB-API-AJAX/" itemprop="url">JS-WEB-API-AJAX</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-23T19:08:28+08:00">
                2020-01-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/23/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9110%EF%BC%9AJS-WEB-API-AJAX/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/01/23/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9110%EF%BC%9AJS-WEB-API-AJAX/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/01/23/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%9110%EF%BC%9AJS-WEB-API-AJAX/" class="leancloud_visitors" data-flag-title="JS-WEB-API-AJAX">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  2.6k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  12
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="JS-Web-API-AJAX"><a href="#JS-Web-API-AJAX" class="headerlink" title="JS Web API - AJAX"></a>JS Web API - AJAX</h4><h5 id="一、XMLHttpRequest"><a href="#一、XMLHttpRequest" class="headerlink" title="一、XMLHttpRequest"></a>一、XMLHttpRequest</h5><h5 id="二、状态码"><a href="#二、状态码" class="headerlink" title="二、状态码"></a>二、状态码</h5><blockquote>
<p>xhr.readyState:</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> -（未初始化）还没有调用<span class="title function_">send</span>()方法</span><br><span class="line"><span class="number">1</span> -（载入）已调用<span class="title function_">send</span>()方法，正在发送请求</span><br><span class="line"><span class="number">2</span> -（载入完成）<span class="title function_">send</span>()方法执行完成，已经接收到全部响应内容</span><br><span class="line"><span class="number">3</span> -（交互）正在解析响应内容</span><br><span class="line"><span class="number">4</span> -（完成）响应内容解析完成，可以在客户端调用</span><br></pre></td></tr></table></figure>

<blockquote>
<p>xhr.status:</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2xx - 表示成功处理请求，如<span class="number">200</span></span><br><span class="line">3xx - 需要重定向，浏览器直接跳转，如<span class="number">301</span>（永久重定向），<span class="number">302</span>（临时重定向），<span class="number">304</span>（资源未改变，浏览器会使用缓存的资源）</span><br><span class="line">4xx - 客户端请求错误，如<span class="number">404</span>（请求地址错误），<span class="number">403</span>（没有权限）</span><br><span class="line">5xx - 服务器端错误</span><br></pre></td></tr></table></figure>

<blockquote>
<p>问：手写一个简易的 ajax【使用 promise】</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GET</span></span><br><span class="line"><span class="comment">// const xhr = new XMLHttpRequest()</span></span><br><span class="line"><span class="comment">// xhr.open(&#x27;GET&#x27;, &#x27;/data/test.json&#x27;, true)</span></span><br><span class="line"><span class="comment">// xhr.onreadystatechange = function () &#123;</span></span><br><span class="line"><span class="comment">//     // 这里的函数异步执行，可参考之前JS基础中的异步模块</span></span><br><span class="line"><span class="comment">//     if (xhr.readyState === 4) &#123;</span></span><br><span class="line"><span class="comment">//         if (xhr.status === 200) &#123;</span></span><br><span class="line"><span class="comment">//             // console.log(</span></span><br><span class="line"><span class="comment">//             //     JSON.parse(xhr.responseText)</span></span><br><span class="line"><span class="comment">//             // )</span></span><br><span class="line"><span class="comment">//             alert(xhr.responseText)</span></span><br><span class="line"><span class="comment">//         &#125; else if (xhr.status === 404) &#123;</span></span><br><span class="line"><span class="comment">//             console.log(&#x27;404 not found&#x27;)</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// xhr.send(null)   //每触发一次send，都会去调用onreadystatechange，并且里面的readyState和status可能会发生变化</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// POST</span></span><br><span class="line"><span class="comment">// var xhr = null</span></span><br><span class="line"><span class="comment">// if(window.XMLHttpRequest)&#123;       //ajax的open方法</span></span><br><span class="line"><span class="comment">//     xhr = new XMLHttpRequest()</span></span><br><span class="line"><span class="comment">// &#125;else&#123;</span></span><br><span class="line"><span class="comment">//     xhr = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// xhr.open(&#x27;POST&#x27;, &#x27;/login&#x27;, true)    //true:异步 false:同步   //创建ajax对象</span></span><br><span class="line"><span class="comment">// xhr.setRequestHeader(&#x27;content-type&#x27;,&#x27;application/x-www-form-urlencoded;charset=utf-8&#x27;)   //设置请求头</span></span><br><span class="line"><span class="comment">// xhr.onreadystatechange = function () &#123;   //回调函数监听状态</span></span><br><span class="line"><span class="comment">//     if (xhr.readyState === 4) &#123;</span></span><br><span class="line"><span class="comment">//         if (xhr.status === 200) &#123;</span></span><br><span class="line"><span class="comment">//             // console.log(</span></span><br><span class="line"><span class="comment">//             //     JSON.parse(xhr.responseText)</span></span><br><span class="line"><span class="comment">//             // )</span></span><br><span class="line"><span class="comment">//             alert(xhr.responseText)</span></span><br><span class="line"><span class="comment">//         &#125; else if (xhr.status === 404) &#123;</span></span><br><span class="line"><span class="comment">//             console.log(&#x27;404 not found&#x27;)</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// const postData = &#123;</span></span><br><span class="line"><span class="comment">//     userName:&#x27;zhangsan&#x27;,</span></span><br><span class="line"><span class="comment">//     password:&#x27;xxx&#x27;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// xhr.send(JSON.stringify(postData)) //发送请求</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装ajax请求</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ajax</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    xhr.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, url, <span class="literal">true</span>);</span><br><span class="line">    xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (xhr.<span class="property">readyState</span> === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (xhr.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="comment">//http协议的状态码</span></span><br><span class="line">          <span class="title function_">resolve</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(xhr.<span class="property">responseText</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (xhr.<span class="property">status</span> === <span class="number">404</span> || xhr.<span class="property">status</span> === <span class="number">500</span>) &#123;</span><br><span class="line">          <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;404 not found&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.<span class="title function_">send</span>(<span class="literal">null</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">&quot;/data/test.json&quot;</span>;</span><br><span class="line"><span class="title function_">ajax</span>(url)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(err));</span><br></pre></td></tr></table></figure>

<h5 id="三、跨域：同源策略，跨域解决方案"><a href="#三、跨域：同源策略，跨域解决方案" class="headerlink" title="三、跨域：同源策略，跨域解决方案"></a>三、跨域：同源策略，跨域解决方案</h5><h6 id="1-什么是跨域（同源策略）"><a href="#1-什么是跨域（同源策略）" class="headerlink" title="1.什么是跨域（同源策略）"></a>1.什么是跨域（同源策略）</h6><blockquote>
<p>同源策略：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ajax请求时，浏览器要求当前网页和server必须同源（安全）</span><br><span class="line">同源：协议、域名、端口，三者必须一致</span><br><span class="line">前端：http://a.com:8080/;   server:https://b.com/api/xxx</span><br></pre></td></tr></table></figure>

<blockquote>
<p>加载图片，css，js 可无视同源策略</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=跨域的图片地址/&gt;   //有的图片地址的服务端设置了防盗链，这个时候就不可访问了，如果没有设置，则图片也可以访问。但是浏览器是没有限制的</span><br><span class="line"></span><br><span class="line">&lt;<span class="built_in">link</span> href=跨域的css地址/&gt;</span><br><span class="line">&lt;script src=跨域的js地址&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;img/&gt;可用于统计打点，可使用第三方统计服务</span><br><span class="line">&lt;<span class="built_in">link</span>/&gt;&lt;script&gt;可使用CDN，CDN一般都是外域</span><br><span class="line">&lt;script&gt;可实现JSONP</span><br></pre></td></tr></table></figure>

<blockquote>
<p>跨域</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">所有的跨域，都必须经过server端允许和配合</span><br><span class="line">未经server端允许就实现跨域，说明浏览器有漏洞，危险信号</span><br></pre></td></tr></table></figure>

<h6 id="2-跨域的常用实现方式"><a href="#2-跨域的常用实现方式" class="headerlink" title="2.跨域的常用实现方式"></a>2.跨域的常用实现方式</h6><blockquote>
<p>1.JSONP</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">访问https://imooc.com/,服务端一定返回一个html文件吗？</span><br><span class="line">服务器可以任意动态拼接数据返回，只要符合html格式要求</span><br><span class="line">同理于&lt;script src=<span class="string">&quot;https://imooc.com/getData.js&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;可绕过跨域限制</span><br><span class="line">服务器可以任意动态拼接数据返回</span><br><span class="line">所以，&lt;script&gt;就可以获得跨域的数据，只要服务端愿意返回</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>jsonp 演示<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>一段文字 1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- jsonp --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">window</span>.<span class="property">abc</span> = <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost:8002/jsonp.js?username=xxx&amp;callback=abc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- JQuery实现jsonp --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">url</span>: <span class="string">&quot;http://localhost:8882/x-origin.json&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">dataType</span>: <span class="string">&quot;jsonp&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">jsonpCallback</span>: <span class="string">&quot;callback&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>2.CORS（服务端支持）-服务器设置 http header</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第二个参数填写允许跨域的域名称，不建议直接写“*”</span></span><br><span class="line">response.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;http://localhost:8081&quot;</span>);</span><br><span class="line">response.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;X-Requested-With&quot;</span>);</span><br><span class="line">response.<span class="title function_">setHeader</span>(</span><br><span class="line">  <span class="string">&quot;Access-Control-Allow-Methods&quot;</span>,</span><br><span class="line">  <span class="string">&quot;PUT,POST,GET,DELETE,OPTIONS&quot;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//接收跨域的cookie</span></span><br><span class="line">response.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="四、ajax-工具"><a href="#四、ajax-工具" class="headerlink" title="四、ajax 工具"></a>四、ajax 工具</h5><blockquote>
<p>1.jQuery 完整 ajax 示例</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> list = &#123;&#125;; <span class="comment">//请求参数</span></span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>, <span class="comment">//请求方式</span></span><br><span class="line">    <span class="attr">contentType</span>: <span class="string">&quot;application/json;charset=UTF-8&quot;</span>, <span class="comment">//请求的媒体类型</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;http://127.0.0.1/admin/list/&quot;</span>, <span class="comment">//请求地址</span></span><br><span class="line">    <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(list), <span class="comment">//数据，json字符串</span></span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">      <span class="comment">//请求成功</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">      <span class="comment">//请求失败，包含具体的错误信息</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">status</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">responseText</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2.使用 fetch</p>
</blockquote>
<p>请注意，fetch 规范与 jQuery.ajax() 主要有三种方式的不同：</p>
<ul>
<li>当接收到一个代表错误的 HTTP 状态码时，从 fetch() 返回的 Promise 不会被标记为 reject，即使响应的 HTTP 状态码是 404 或 500。相反，它会将 Promise 状态标记为 resolve （但是会将 resolve 的返回值的 ok 属性设置为 false ），仅当网络故障时或请求被阻止时，才会标记为 reject。</li>
<li>fetch() 可以接受跨域 cookies；你也可以使用 fetch() 建立起跨域会话。其他网站的 Set-Cookie 头部字段将会被无视。</li>
<li>fetch 不会发送 cookies。除非你使用了 credentials 的初始化选项。（自 2017 年 8 月 25 日以后，默认的 credentials 政策变更为 same-origin。Firefox 也在 61.0b13 版本中进行了修改）</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;http://example.com/movies.json&quot;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> response.<span class="title function_">json</span>();</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">myJson</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(myJson);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>3.使用 axios</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-----get-----</span></span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&quot;axios&quot;</span>);</span><br><span class="line">axios</span><br><span class="line">  .<span class="title function_">get</span>(<span class="string">&quot;/user?ID=12345&quot;</span>) <span class="comment">// Make a request for a user with a given ID</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="comment">// handle success</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="comment">// handle error</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// always executed</span></span><br><span class="line">  &#125;);</span><br><span class="line"><span class="comment">// Optionally the request above could also be done as</span></span><br><span class="line">axios</span><br><span class="line">  .<span class="title function_">get</span>(<span class="string">&quot;/user&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">params</span>: &#123;</span><br><span class="line">      <span class="attr">ID</span>: <span class="number">12345</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// always executed</span></span><br><span class="line">  &#125;);</span><br><span class="line"><span class="comment">// Want to use async/await? Add the `async` keyword to your outer function/method.</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getUser</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&quot;/user?ID=12345&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//-----Performing a POST request-----</span></span><br><span class="line">axios</span><br><span class="line">  .<span class="title function_">post</span>(<span class="string">&quot;/user&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">firstName</span>: <span class="string">&quot;Fred&quot;</span>,</span><br><span class="line">    <span class="attr">lastName</span>: <span class="string">&quot;Flintstone&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="comment">//-----Performing multiple concurrent requests-----</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getUserAccount</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> axios.<span class="title function_">get</span>(<span class="string">&quot;/user/12345&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getUserPermissions</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> axios.<span class="title function_">get</span>(<span class="string">&quot;/user/12345/permissions&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">axios.<span class="title function_">all</span>([<span class="title function_">getUserAccount</span>(), <span class="title function_">getUserPermissions</span>()]).<span class="title function_">then</span>(</span><br><span class="line">  axios.<span class="title function_">spread</span>(<span class="keyword">function</span> (<span class="params">acct, perms</span>) &#123;</span><br><span class="line">    <span class="comment">// Both requests are now complete</span></span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>乱码</p>
</blockquote>
<p>出现乱码是非常常见的。</p>
<p>1.文件 2.页面 3.请求 4.地址 5.设置</p>
<p>1).在文件如果没有正确编码设置时会出现乱码<br>2).在页面没有正确编码设置时会出现乱码<br>3).在与后台进行数据交互时没有进行请求编码设置时会出现乱码<br>4).在地址进行参数传递时没有正确编码设置时会出现乱码<br>5).在数据返回及请求时没有正确编码设置时会出现乱码</p>
<blockquote>
<p>ajax:</p>
</blockquote>
<p>1).先明确 get 和 post 的一点区别</p>
<ul>
<li>get 请求 – 参数都是写在 url 上，参数要做 urlencode, 服务端是不会处理 body 里边的内容的，content-type 是没有用的，也不用设置。</li>
<li>post 请求 – 服务端会处理 body 里边的内容。服务端是根据 content-type 来决定如何处理 body 的，所以要指定 content-type，服务端才能正确处理请求。</li>
</ul>
<p>content-type 是 application&#x2F;json，那么 body 的内容就是一窜 json, 如 {“a”:1} 或者 [1,2,3]<br>x-www-form-urlencoded 那么 body 的内容就和写在 url 上的参数形式是一样的如 a&#x3D;1&amp;b&#x3D;2<br>还有其它各种类型的 content-type</p>
<p>2).为什么会有 urlencoded？<br>因为参数的值可能包含一些关键字如 &#x3D; 、&amp; 这些, 所以形如 name1&#x3D;value1&amp;name2&#x3D;value2 的这种形式中的 name 和 value 就要做 urlencode, 把特殊字符转义</p>
<p>3).为什么在使用 http 框架的时候不要自己在 url 上拼参数？<br>在 url 上拼参数是要做 urlencode 的，如果没有做，请求就可能不是一个正确的请求。<br>一般的框架都会提供分别设置 url 和参数的地方，后面会根据具体情况对参数做 urlencode，get 请求放 url 上，作为 queryString。post 请求放 body。<br>也就是框架已经实现了这部分的操作，那么使用方自己再整一遍就是重复多余的，而且可能引入新的 bug，谁知道你有没有处理正确。</p>
<p>4).下面以 jQuery 提供的 ajax 为例：</p>
<p>jQuery 提供的 ajax，他默认的 content-type 就是 x-www-form-urlencoded。<br>var id&#x3D;1,name&#x3D;’a&#x3D;1&amp;b&#x3D;2’;<br>$.ajax({<br>type: ‘post’,<br>url: ‘&#x2F;api’,<br>data: {<br>id: id,<br>name: name<br>}<br>});<br>这个例子发出去的请求是<br>Request URL: <a href="https://host/api">https://host/api</a><br>Request Method: POST<br>body: id&#x3D;1&amp;name&#x3D;a%3d1%26b%3d2</p>
<hr>
<p>如果指定 content-type 为 application&#x2F;json<br>var id&#x3D;1,name&#x3D;’a&#x3D;1&amp;b&#x3D;2’;<br>$.ajax({<br>type: ‘post’,<br>url: ‘&#x2F;api’,<br>data: JSON.stringify({<br>id: id,<br>name: name<br>}),<br>contentType: ‘application&#x2F;json’<br>});<br>这个例子发出去的请求是<br>Request URL: <a href="https://host/api">https://host/api</a><br>Request Method: POST<br>Content—Type: application&#x2F;json<br>body: {“id”:1,”name”:”a&#x3D;1&amp;b&#x3D;2”}</p>
<p>这里边这个 body 就是 JSON.stringify()返回的字符窜</p>
<hr>
<p>var id&#x3D;1,name&#x3D;’a&#x3D;1&amp;b&#x3D;2’;<br>$.ajax({<br>type: ‘get’,<br>url: ‘&#x2F;api’,<br>data: {<br>id: id,<br>name: name<br>}<br>});<br>这个例子发出去的请求是<br>Request URL: <a href="https://host/api?id=1&name=a=1&b=2">https://host/api?id=1&amp;name=a%3d1%26b%3d2</a><br>Request Method: GET<br>没有 body</p>
<hr>
<p>var id&#x3D;1,name&#x3D;’a&#x3D;1&amp;b&#x3D;2’;<br>$.ajax({<br>type: ‘get’,<br>url: ‘&#x2F;api?id&#x3D;’+id + ‘&amp;name&#x3D;’ + name<br>});<br>这个例子发出去的请求是<br>Request URL: <a href="https://host/api?id=1&name=a=1&b=2">https://host/api?id=1&amp;name=a=1&amp;b=2</a><br>Request Method: GET<br>没有 body<br>这样就出问题了。服务端会认为你传过来的 name 是 a&#x3D;1, 并且还有一个参数 b，值是 2。<br>正确的 url 应该是 ‘&#x2F;api?id&#x3D;’+ encodeURIComponent(id) + ‘&amp;name&#x3D;’ + encodeURIComponent(name)<br>但这样做就是把本来框架会帮你做好的事情自己做，重复多余。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2020/01/23/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%918%EF%BC%9AJS-WEB-API-BOM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/23/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%918%EF%BC%9AJS-WEB-API-BOM/" itemprop="url">JS-WEB-API-BOM</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-23T16:47:31+08:00">
                2020-01-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/23/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%918%EF%BC%9AJS-WEB-API-BOM/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/01/23/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%918%EF%BC%9AJS-WEB-API-BOM/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/01/23/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E4%B8%93%E9%A2%98/%E3%80%90%E4%B8%93%E9%A2%98%E3%80%918%EF%BC%9AJS-WEB-API-BOM/" class="leancloud_visitors" data-flag-title="JS-WEB-API-BOM">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  112
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="JS-Web-API-BOM"><a href="#JS-Web-API-BOM" class="headerlink" title="JS Web API - BOM"></a>JS Web API - BOM</h4><h5 id="二、BOM-操作（Browser-Object-Model，浏览器对象模型）"><a href="#二、BOM-操作（Browser-Object-Model，浏览器对象模型）" class="headerlink" title="二、BOM 操作（Browser Object Model，浏览器对象模型）"></a>二、BOM 操作（Browser Object Model，浏览器对象模型）</h5><p>知识点：</p>
<blockquote>
<p>1.navigator</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如何识别浏览器的类型</span></span><br><span class="line"><span class="keyword">const</span> ua = navigator.<span class="property">userAgent</span>;</span><br><span class="line"><span class="keyword">const</span> isChrome = ua.<span class="title function_">indexOf</span>(<span class="string">&quot;Chrome&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(isChrome);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2.screen</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(screen.<span class="property">width</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(screen.<span class="property">height</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>3.location</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分析拆解url各个部分</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(location.<span class="property">href</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(location.<span class="property">protocal</span>); <span class="comment">//&#x27;http:&#x27; &#x27;https:&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(location.<span class="property">pathname</span>); <span class="comment">// &#x27;/learn/199&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(location.<span class="property">search</span>); <span class="comment">//&#x27;?a=100&amp;b=200&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(location.<span class="property">hash</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>4.history</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">history.<span class="title function_">back</span>();</span><br><span class="line">history.<span class="title function_">forward</span>();</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/10/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">115</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/daykalif" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:r00t_daykalif@aliyun.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.daykalif.com/" title="Daykalif" target="_blank">Daykalif</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-snowflake-o"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">r00t_daykalif</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">290.7k</span>
  
</div>






<div style="width:300px;margin:0 auto; padding:20px 0;">
	<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010902002156" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;">
    <img src="https://www.daykalif.com/beian.png" style="float:left;"/>
    <p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">
    浙公网安备 33010902002156号
    </p>
  </a>
</div>






        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'NXoB8ypSoELq08t7Y4t4Y7Co-gzGzoHsz',
        appKey: 'q00Ulu1a5iQSaM6XV0ba4QeF',
        placeholder: 'ヾﾉ≧∀≦)o来啊，快活啊!',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("NXoB8ypSoELq08t7Y4t4Y7Co-gzGzoHsz", "q00Ulu1a5iQSaM6XV0ba4QeF");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
