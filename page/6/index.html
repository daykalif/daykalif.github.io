<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="stay hungry,stay foolish.">
<meta property="og:type" content="website">
<meta property="og:title" content="Daykalif">
<meta property="og:url" content="https://daykalif.github.io/page/6/index.html">
<meta property="og:site_name" content="Daykalif">
<meta property="og:description" content="stay hungry,stay foolish.">
<meta property="og:locale">
<meta property="article:author" content="r00t_daykalif">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: "",
      labels: ""
    }
  };
</script>



  <link rel="canonical" href="https://daykalif.github.io/page/6/"/>





  <title>Daykalif</title>
  








<meta name="generator" content="Hexo 7.1.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Daykalif</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-文章">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            文章
          </a>
        </li>
      
        
        <li class="menu-item menu-item-分类">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-前端">
          <a href="/categories/web/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            前端
          </a>
        </li>
      
        
        <li class="menu-item menu-item-后端">
          <a href="/categories/server/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-server"></i> <br />
            
            后端
          </a>
        </li>
      
        
        <li class="menu-item menu-item-关于我">
          <a href="/categories/aboutMe/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于我
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2021/03/28/%E8%8B%B1%E8%AF%AD/English%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/28/%E8%8B%B1%E8%AF%AD/English%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/" itemprop="url">English英语语法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-03-28T17:52:35+08:00">
                2021-03-28
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/28/%E8%8B%B1%E8%AF%AD/English%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2021/03/28/%E8%8B%B1%E8%AF%AD/English%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2021/03/28/%E8%8B%B1%E8%AF%AD/English%E8%8B%B1%E8%AF%AD%E8%AF%AD%E6%B3%95/" class="leancloud_visitors" data-flag-title="English英语语法">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  809
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  3
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="第一讲：语序和五种基本句式"><a href="#第一讲：语序和五种基本句式" class="headerlink" title="第一讲：语序和五种基本句式"></a>第一讲：语序和五种基本句式</h2><p>He learns English every day.<br>他每天学习英语。</p>
<p>Nothing is impossible to a willing heart.<br>有志者事竟成。</p>
<h3 id="英语五种基本句式"><a href="#英语五种基本句式" class="headerlink" title="英语五种基本句式"></a>英语五种基本句式</h3><p>主语：动作的主体<br>谓语：主体执行的动作<br>系动词：起到联系作用的动词（连接前面的主语和表语）<br>表语：描述主语的性质、特点、位置的词<br>宾语：动作执行的对象<br>间宾：通常是人<br>直宾：通常是物<br>宾补：当宾语不能完全说明谓语执行的对象，执行的对象结果是什么呢？需要用宾补来进行补充说明宾语</p>
<h4 id="基本句式一：Subject（主语）-Verb（谓语）"><a href="#基本句式一：Subject（主语）-Verb（谓语）" class="headerlink" title="基本句式一：Subject（主语）+ Verb（谓语）"></a>基本句式一：Subject（主语）+ Verb（谓语）</h4><p>1.The universe remains.<br>宇宙长存。</p>
<h4 id="基本句式二：S（主语）-L-V（系动词）-P（表）"><a href="#基本句式二：S（主语）-L-V（系动词）-P（表）" class="headerlink" title="基本句式二：S（主语）+ L.V（系动词）+ P（表）"></a>基本句式二：S（主语）+ L.V（系动词）+ P（表）</h4><p>1.The food is delicious.<br>这个食物很好吃。</p>
<h4 id="基本句式三：Subject（主语）-Verb（谓语）-Object（宾语）"><a href="#基本句式三：Subject（主语）-Verb（谓语）-Object（宾语）" class="headerlink" title="基本句式三：Subject（主语）+ Verb（谓语）+ Object（宾语）"></a>基本句式三：Subject（主语）+ Verb（谓语）+ Object（宾语）</h4><p>1.He took his bag and left.<br>他拿着书包离开了。</p>
<h4 id="基本句式四：Subject（主语）-Verb（谓语）-I-o（间接宾语）-D-o（直接宾语）"><a href="#基本句式四：Subject（主语）-Verb（谓语）-I-o（间接宾语）-D-o（直接宾语）" class="headerlink" title="基本句式四：Subject（主语）+ Verb（谓语）+ I.o（间接宾语）+ D.o（直接宾语）"></a>基本句式四：Subject（主语）+ Verb（谓语）+ I.o（间接宾语）+ D.o（直接宾语）</h4><p>1.Her father bought her a dictionary.<br>她爸爸给她买了一本词典。</p>
<h4 id="基本句式五：Subject（主语）-Verb（谓语）-Object（宾语）-C（宾补）"><a href="#基本句式五：Subject（主语）-Verb（谓语）-Object（宾语）-C（宾补）" class="headerlink" title="基本句式五：Subject（主语）+ Verb（谓语）+ Object（宾语）+ C（宾补）"></a>基本句式五：Subject（主语）+ Verb（谓语）+ Object（宾语）+ C（宾补）</h4><p>1.We made him our monitor.<br>我们选他当班长。</p>
<h2 id="第二讲：be动词的形式和用法"><a href="#第二讲：be动词的形式和用法" class="headerlink" title="第二讲：be动词的形式和用法"></a>第二讲：be动词的形式和用法</h2><h3 id="Be动词的形式：（共8种）"><a href="#Be动词的形式：（共8种）" class="headerlink" title="Be动词的形式：（共8种）"></a>Be动词的形式：（共8种）</h3><p>【动词原型】：be<br>【一般现在时时态的be动词】：am，is（使用在单数主语的后面），are（使用在复数主语的后面）<br>【过去时态的be动词】：was（使用在单数主语的后面），were（使用在复数主语的后面）<br>【be动词的现在分词】：being<br>【be动词的过去分词】：been</p>
<p>1.The man is back.<br>那个男人回来了。</p>
<p>2.They are back.<br>他们回来了。</p>
<p>3.He was back.<br>他过去回来了。</p>
<p>4.They were back.<br>他们过去回来了。</p>
<p>5.They have been back.<br>他们已经回来了。</p>
<h3 id="be动词的用法：【起到联系的作用，联系前面的主语和后面的补足语成分（名词、形容词、地点副词或短语）】"><a href="#be动词的用法：【起到联系的作用，联系前面的主语和后面的补足语成分（名词、形容词、地点副词或短语）】" class="headerlink" title="be动词的用法：【起到联系的作用，联系前面的主语和后面的补足语成分（名词、形容词、地点副词或短语）】"></a>be动词的用法：【起到联系的作用，联系前面的主语和后面的补足语成分（名词、形容词、地点副词或短语）】</h3><p>后面接名词、形容词、地点副词或短语作补足语。</p>
<p>1.The man is a teacher.</p>
<p>2.Mary’s new dresses are colorful.</p>
<p>3.My mother was in the kitchen.</p>
<h3 id="Be动词的练习："><a href="#Be动词的练习：" class="headerlink" title="Be动词的练习："></a>Be动词的练习：</h3><p>1.他们是老师。（they,teachers）【现在时】<br>They are teachers.</p>
<p>2.他以前是一名老师。（he,a teacher,before）【过去时】<br>He was a teacher before.</p>
<p>3.他已经当了3年的老师。（for 3 years）【完成时】<br>He has been a teacher for 3 years.</p>
<h2 id="第三讲：Be动词的否定-提问-回答："><a href="#第三讲：Be动词的否定-提问-回答：" class="headerlink" title="第三讲：Be动词的否定&#x2F;提问&#x2F;回答："></a>第三讲：Be动词的否定&#x2F;提问&#x2F;回答：</h2><h3 id="Be动词的否定"><a href="#Be动词的否定" class="headerlink" title="Be动词的否定"></a>Be动词的否定</h3><p>在am，is，are，was，were后面加not.<br>缩略式 am not，isn’t，aren’t，wasn’t，weren’t</p>
<p>【现在时】：<br>1.The man isn’t back.<br>2.I am not back.<br>3.They aren’t back.</p>
<p>【过去时】：<br>4.He wasn’t back.<br>5.They weren’t back.</p>
<p>【使用be动词提问和回答】</p>
<ul>
<li><p>Is he a teacher?</p>
</li>
<li><p>Yes,he is.&#x2F;No,he isn’t.</p>
</li>
<li><p>Are you a teacher?</p>
</li>
<li><p>Yes,I am.&#x2F;No,I am not.</p>
</li>
<li><p>Were they teachers?</p>
</li>
<li><p>Yes,they were.&#x2F;No,they weren’t.</p>
</li>
</ul>
<h3 id="Be动词的练习：-1"><a href="#Be动词的练习：-1" class="headerlink" title="Be动词的练习："></a>Be动词的练习：</h3><p>1.他是医生吗？（doctor）<br>Is he a doctor?<br>不，他不是。<br>No,he isn’t.</p>
<p>2.他们昨天在教室吗？（yesterday,classroom）<br>Were they in the classroom yesterday?<br>是的，他们在。<br>Yes,they were.<br>不，他们不在。<br>no,they weren’t.</p>
<p>3.他们昨天不在教室。<br>They weren’t in the classroom yesterday.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2021/03/21/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/Git%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%EF%BC%8C%E7%A8%8B%E5%BA%8F%E7%8C%BF%E7%9C%8B%E8%BF%99%E4%B8%AA%E5%B0%B1%E5%A4%9F%E4%BA%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/21/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/Git%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%EF%BC%8C%E7%A8%8B%E5%BA%8F%E7%8C%BF%E7%9C%8B%E8%BF%99%E4%B8%AA%E5%B0%B1%E5%A4%9F%E4%BA%86/" itemprop="url">Git版本控制入门到实战，程序猿看这个就够了</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-03-21T11:49:55+08:00">
                2021-03-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/21/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/Git%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%EF%BC%8C%E7%A8%8B%E5%BA%8F%E7%8C%BF%E7%9C%8B%E8%BF%99%E4%B8%AA%E5%B0%B1%E5%A4%9F%E4%BA%86/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2021/03/21/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/Git%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%EF%BC%8C%E7%A8%8B%E5%BA%8F%E7%8C%BF%E7%9C%8B%E8%BF%99%E4%B8%AA%E5%B0%B1%E5%A4%9F%E4%BA%86/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2021/03/21/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/Git%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98%EF%BC%8C%E7%A8%8B%E5%BA%8F%E7%8C%BF%E7%9C%8B%E8%BF%99%E4%B8%AA%E5%B0%B1%E5%A4%9F%E4%BA%86/" class="leancloud_visitors" data-flag-title="Git版本控制入门到实战，程序猿看这个就够了">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  6.5k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  25
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Git-操作详细步骤"><a href="#Git-操作详细步骤" class="headerlink" title="Git 操作详细步骤"></a>Git 操作详细步骤</h2><h3 id="1-Git-版本控制引言"><a href="#1-Git-版本控制引言" class="headerlink" title="1.Git 版本控制引言"></a>1.Git 版本控制引言</h3><p>自诞生于 2005 年以来，Git 日臻成熟完善，在高度易用的同时，仍然保留着初期设定的目标。它的速度飞快，极其适合管理大项目 。</p>
<p>主要竞争对手：<br>SVN<br>CVS<br>Mercurial</p>
<p>采用 Git 的云服务：<br>github<br>gitee（oschina）</p>
<h3 id="2-Git-版本控制-集中式与分布式实例分析"><a href="#2-Git-版本控制-集中式与分布式实例分析" class="headerlink" title="2.Git 版本控制-集中式与分布式实例分析"></a>2.Git 版本控制-集中式与分布式实例分析</h3><p>集中式：【如以前去医院的门诊挂号，所有人都在窗口等待办理】<br>分布式：【如现如今可以通过 114 挂号，手机公众号挂号，门诊窗口挂号…】</p>
<p>Svn：集中式<br>Git：分布式</p>
<h3 id="3-Git-版本控制-mac-windows-linux-安装-git-软件"><a href="#3-Git-版本控制-mac-windows-linux-安装-git-软件" class="headerlink" title="3.Git 版本控制-mac-windows-linux 安装 git 软件"></a>3.Git 版本控制-mac-windows-linux 安装 git 软件</h3><p>Git 可以在 windows、Mac、Linux 全平台系统使用。登录 <code>https://git-scm.com/downloads</code> 下载你系统的 Git 软件并进行安装。</p>
<blockquote>
<p>windows 用户我更建议安装 git for windows ，下载地址： <a href="https://gitforwindows.org/">https://gitforwindows.org/</a><br>包信 Git Base 、Git Gui<br>mac 用户，下载地址【git 官网】：<a href="https://git-scm.com/">https://git-scm.com/</a></p>
</blockquote>
<p>安装后通过以下命令查看，如果显示版本号那就是安装成功了</p>
<p><code>git --version</code></p>
<p><strong>Gui</strong>：</p>
<p>Gui 指 Git 的图形界面管理软件，<code>https://git-scm.com/downloads/guis</code> 这个网址列出了多个可供基本上所有平台使用的 Gui 软件。如果要使用 Gui 而非命令行操作，我推荐 sourcetree 这也是我多年使用的软件，功能强大、跨平台、免费。</p>
<blockquote>
<p>新人建议直接使用命令行管理 GIT</p>
</blockquote>
<h3 id="4-Git-版本控制-配置作者信息"><a href="#4-Git-版本控制-配置作者信息" class="headerlink" title="4.Git 版本控制 - 配置作者信息"></a>4.Git 版本控制 - 配置作者信息</h3><p><strong>初始配置</strong>：</p>
<p>配置文件为 ~&#x2F;.gitconfig ，执行任何 Git 配置命令后文件将自动创建。</p>
<p>第一个要配置的是你个人的用户名称和电子邮件地址。这两条配置很重要，每次 Git 提交时都会引用这两条信息，说明是谁提交了更新，所以会随更新内容一起被永久纳入历史记录：</p>
<p><code>git config --global user.email &quot;xxxxx@qq.com&quot;</code><br><code>git config --global user.name &quot;daykalif&quot;</code></p>
<p><code>git config --global color.ui true</code></p>
<p>查看当前用户（global）配置:<br><code>git config --global  --list</code></p>
<blockquote>
<p>tips:<br>快捷键【control+l】：清屏</p>
</blockquote>
<p>进入文件夹，初始化新仓库 <code>git init</code> 【此时运行命令：ls -a 可查看到.git 文件，这就是版本仓库；进入.git 文件，运行命令 ls -la，可看到这个仓库的一些配置信息；如果去修改这个文件中的 config 文件，并修改：<code>git config user.name &quot;wjp&quot;</code>，可看到这个项目的昵称改为了 wjp】</p>
<h3 id="5-Git-版本控制-新建仓库与维护旧仓库"><a href="#5-Git-版本控制-新建仓库与维护旧仓库" class="headerlink" title="5.Git 版本控制 - 新建仓库与维护旧仓库"></a>5.Git 版本控制 - 新建仓库与维护旧仓库</h3><p>新建文件夹：GIT<br>进入 GIT 文件夹，新建文件夹：bbs<br>进入 bbs 文件夹，运行 git 初始化命令：git init<br>回退到 GIT 文件夹，克隆代码：<code>git clone https://gitee.com/houdunwang/hdcms.git</code><br>删除 GIT 文件夹下所有的内容：【千万主要当前的位置】<code>rm -rf *</code></p>
<h3 id="6-Git-版本控制-Git-流水线操作分析"><a href="#6-Git-版本控制-Git-流水线操作分析" class="headerlink" title="6.Git 版本控制 - Git 流水线操作分析"></a>6.Git 版本控制 - Git 流水线操作分析</h3><h4 id="Git-工作区、暂存区和版本库"><a href="#Git-工作区、暂存区和版本库" class="headerlink" title="Git 工作区、暂存区和版本库"></a>Git 工作区、暂存区和版本库</h4><p><strong>基本概念</strong><br>我们先来理解下 Git 工作区、暂存区和版本库概念：</p>
<p>工作区：就是你在电脑里能看到的目录。<br>暂存区：英文叫 stage 或 index。一般存放在 .git 目录下的 index 文件（.git&#x2F;index）中，所以我们把暂存区有时也叫作索引（index）。<br>版本库：工作区有一个隐藏目录 .git，这个不算工作区，而是 Git 的版本库。<br>下面这个图展示了工作区、版本库中的暂存区和版本库之间的关系：</p>
<ul>
<li>建立文件（本地工作文件夹）</li>
<li>追加文件（索引区）</li>
<li>提交文件（本地库）</li>
</ul>
<p><img src="https://www.daykalif.com/blog_img/git1.jpg" alt="git"></p>
<ul>
<li><p>图中左侧为工作区，右侧为版本库。在版本库中标记为 “index” 的区域是暂存区（stage&#x2F;index），标记为 “master” 的是 master 分支所代表的目录树。</p>
</li>
<li><p>图中我们可以看出此时 “HEAD” 实际是指向 master 分支的一个”游标”。所以图示的命令中出现 HEAD 的地方可以用 master 来替换。</p>
</li>
<li><p>图中的 objects 标识的区域为 Git 的对象库，实际位于 “.git&#x2F;objects” 目录下，里面包含了创建的各种对象及内容。</p>
</li>
<li><p>当对工作区修改（或新增）的文件执行 git add 命令时，暂存区的目录树被更新，同时工作区修改（或新增）的文件内容被写入到对象库中的一个新的对象中，而该对象的 ID 被记录在暂存区的文件索引中。</p>
</li>
<li><p>当执行提交操作（git commit）时，暂存区的目录树写到版本库（对象库）中，master 分支会做相应的更新。即 master 指向的目录树就是提交时暂存区的目录树。</p>
</li>
<li><p>当执行 <code>git reset HEAD</code> 命令时，暂存区的目录树会被重写，被 master 分支指向的目录树所替换，但是工作区不受影响。</p>
</li>
<li><p>当执行 <code>git rm --cached &lt;file&gt;</code>命令时，会直接从暂存区删除文件，工作区则不做出改变。</p>
</li>
<li><p>当执行 <code>git checkout .</code> 或者 <code>git checkout -- &lt;file&gt;</code> 命令时，会用暂存区全部或指定的文件替换工作区的文件。这个操作很危险，会清除工作区中未添加到暂存区的改动。</p>
</li>
<li><p>当执行 <code>git checkout HEAD .</code> 或者 <code>git checkout HEAD &lt;file&gt;</code> 命令时，会用 HEAD 指向的 master 分支中的全部或者部分文件替换暂存区和以及工作区中的文件。这个命令也是极具危险性的，因为不但会清除工作区中未提交的改动，也会清除暂存区中未提交的改动。</p>
</li>
</ul>
<h3 id="7-Git-版本控制-使用命令完成-Git-流水线操作"><a href="#7-Git-版本控制-使用命令完成-Git-流水线操作" class="headerlink" title="7.Git 版本控制 - 使用命令完成 Git 流水线操作"></a>7.Git 版本控制 - 使用命令完成 Git 流水线操作</h3><h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><p>1.初始化新仓库 <code>git init</code> 2.克隆代码 <code>git clone https://gitee.com/houdunwang/hdcms.git</code> 3.克隆指定分支 <code>git clone -b dev git@gitee.com:houdunwang/hdcms.git</code> 4.查看未 commit 之前的状态(包括 git add 之前和 git add 之后的状态) <code>git status</code> 5.提交单个文件 <code>git add index.php</code> 6.提交所有文件 <code>git add -A</code> 7.使用通配符提交 <code>git add *.js</code> 8.提交到仓库中 <code>git commit -m &#39;提示信息&#39;</code> 9.提交已经跟踪过的文件，不需要执行<code>add git commit -a -m &#39;提交信息&#39;</code> 10.查看 commit 记录 <code>git log</code></p>
<h3 id="8-Git-版本控制-gitignore-详解控制版本库文件管理"><a href="#8-Git-版本控制-gitignore-详解控制版本库文件管理" class="headerlink" title="8.Git 版本控制 - .gitignore 详解控制版本库文件管理"></a>8.Git 版本控制 - .gitignore 详解控制版本库文件管理</h3><p>.gitignore</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*.txt   //不提交所有的txt后缀文件</span><br><span class="line">!a.txt  //除了a.txt</span><br><span class="line"></span><br><span class="line">/vendor/*.php   //不提交vendor文件夹下所有的php后缀文件</span><br><span class="line">/vendor/**/*.php    //不提交vendor文件夹及其子文件夹下所有的php后缀文件</span><br><span class="line"></span><br><span class="line">node_modules/   //不提交整个node_modules文件夹</span><br></pre></td></tr></table></figure>

<h3 id="9-Git-版本控制-从版本库中删除资源的技巧"><a href="#9-Git-版本控制-从版本库中删除资源的技巧" class="headerlink" title="9.Git 版本控制 - 从版本库中删除资源的技巧"></a>9.Git 版本控制 - 从版本库中删除资源的技巧</h3><p>1.（运行 git add 之后）删除版本库与项目目录中的文件 <code>git rm index.php</code> 2.（运行 git add 之后）只删除版本库中文件但保存项目目录中文件 <code>git rm --cached index.php</code></p>
<h3 id="10-Git-版本控制-版本库中修改资料名称"><a href="#10-Git-版本控制-版本库中修改资料名称" class="headerlink" title="10.Git 版本控制 - 版本库中修改资料名称"></a>10.Git 版本控制 - 版本库中修改资料名称</h3><p>重命名：<code>git mv a.php b.php</code> &#x2F;&#x2F;将 a.php 重命名为 b.php</p>
<p><code>git log --name-only</code> &#x2F;&#x2F;查看 log</p>
<h3 id="11-Git-版本控制-使用-log-日志查看历史-commit-操作行为"><a href="#11-Git-版本控制-使用-log-日志查看历史-commit-操作行为" class="headerlink" title="11.Git 版本控制 - 使用 log 日志查看历史 commit 操作行为"></a>11.Git 版本控制 - 使用 log 日志查看历史 commit 操作行为</h3><p>查看日志：<code>git log</code><br>查看每次提交的文件变动信息【详细显示】<code>git log -p</code><br>查看最近 1 次提交日志并显示文件差异<code>git log -p -1</code><br>查看最近 2 次提交日志并显示文件差异<code>git log -p -2</code><br>一行显示并只显示 SHA-1 的前几个字符【查看简要版文件变动(精简显示)】<code>git log --online</code><br>查看简要版文件修改信息<code>git log --online -2</code><br>查看简要版具体文件变动信息<code>git log --online -p</code><br>显示已修改的文件清单(显示名字)<code>git log --name-only</code><br>显示新增、修改、删除的文件清单【查看文件发生的是什么类型变化(增加，修改…)】<code>git log --name-status</code><br>查看 git log 的帮助 <code>git log --help</code></p>
<h3 id="12-Git-版本控制-使用-amend-修改最新一次提交事件"><a href="#12-Git-版本控制-使用-amend-修改最新一次提交事件" class="headerlink" title="12.Git 版本控制 - 使用 amend 修改最新一次提交事件"></a>12.Git 版本控制 - 使用 amend 修改最新一次提交事件</h3><p>修改最后一次提交信息 <code>git commit --amend</code><br>使用 vim 命令对提交信息进行修改，修改完成之后，运行<code>git log</code>可查看到这次修改的信息是修改的原来的提交</p>
<p>如果在提交之后，又对代码进行了操作，然后还想把这个修改也归类到刚刚那次提交，此时<br><code>git add .</code><br><code>git status</code><br><code>git commit --amend</code> 修改提交信息<br><code>git log --name-only</code> 查看最新一次提交修改的所有文件名</p>
<h3 id="13-Git-版本控制-管理暂存区中的文件"><a href="#13-Git-版本控制-管理暂存区中的文件" class="headerlink" title="13.Git 版本控制 - 管理暂存区中的文件"></a>13.Git 版本控制 - 管理暂存区中的文件</h3><p>第一次的后悔修改方式：<br><code>git add a.php</code><br>如果此时觉得放入到暂存区还为时过早，可以执行撤销<br><code>git rm --cached a.php</code></p>
<h4 id="【运行-git-add-之后的后悔修改方式】"><a href="#【运行-git-add-之后的后悔修改方式】" class="headerlink" title="【运行 git add 之后的后悔修改方式】"></a>【运行 git add 之后的后悔修改方式】</h4><p>第二次及以后的后悔修改方式：<br>修改 a.php<br><code>git add a.php</code><br><code>git status</code><br><code>git reset HEAD a.php</code> – （在使用 git add 之后，可以使用这个命令进行撤销）撤销提交到暂存区，修改的文件内容还在<br><code>git checkout -- a.php</code> – (在未使用 git add 命令之前可以使用这个命令；使用 git add 之后该命令无法进行撤销)撤销提交到暂存区，且修改的文件内容也撤销</p>
<h4 id="比较文件内容："><a href="#比较文件内容：" class="headerlink" title="比较文件内容："></a>比较文件内容：</h4><p>git add 之前对工作文件夹比较，可以比较出文件内容变动 <code>git diff</code>；<br>把修改文件追加到索引区 <code>git add index.html</code>，此时运行<code>git diff</code>无法比较工作文件夹的修改文件；<br>如果此时需要对索引区（暂存区）和原先工作区比较，使用 <code>git diff --cached</code>对文件进行比较；</p>
<h4 id="使用-git-commit-之后，返回过去"><a href="#使用-git-commit-之后，返回过去" class="headerlink" title="使用 git commit 之后，返回过去"></a>使用 git commit 之后，返回过去</h4><p>回到数据库中最新的版本 <code>git reset --hard HEAD</code><br>回到上一个版本 <code>git reset --hard HEAD~</code><br>回到前 2 次提交的版本 <code>git reset --hard HEAD~2</code><br>回到某一次指定的版本 <code>git reset --hard xxxxxx</code><br>提交新的记录之后，又回到过去之前的提交记录，此时新的提交记录只是看不见了，记录其实还是在的，查看命令：<code>git reflog</code>；然后<code>git reset --hard xxxxxx</code>又可以回到最新的记录</p>
<h3 id="14-Git-版本控制-alias-命令提高操作效率（使用别名）"><a href="#14-Git-版本控制-alias-命令提高操作效率（使用别名）" class="headerlink" title="14.Git 版本控制 - alias 命令提高操作效率（使用别名）"></a>14.Git 版本控制 - alias 命令提高操作效率（使用别名）</h3><p>设置命令别名：<br><code>git config --global alias.a add</code> &#x2F;&#x2F;git a . 来替换 git add .<br>或者直接修改~&#x2F;.gitconfig 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[user]</span><br><span class="line">    emial = xxxxx@qq.<span class="property">com</span></span><br><span class="line">    name = daykalif</span><br><span class="line">[alias]</span><br><span class="line">    a = add .</span><br><span class="line">    c = commit</span><br><span class="line">    l = log</span><br><span class="line">    s = status</span><br></pre></td></tr></table></figure>

<h3 id="15-Git-版本控制-详解-Git-分支-Branch-存在意义"><a href="#15-Git-版本控制-详解-Git-分支-Branch-存在意义" class="headerlink" title="15.Git 版本控制 - 详解 Git 分支 Branch 存在意义"></a>15.Git 版本控制 - 详解 Git 分支 Branch 存在意义</h3><p>大部分情况下不会直接在 master 分支工作，我们应该保护这个分支是最终开发完成代码健康可交付运行的。</p>
<p>所以功能和缺陷(bug)修复都会新建分支完成，除了这个概念外与基本流程使用是一样的。</p>
<h3 id="16-Git-版本控制-实例讲解分支-branch-基本管理操作"><a href="#16-Git-版本控制-实例讲解分支-branch-基本管理操作" class="headerlink" title="16.Git 版本控制 - 实例讲解分支 branch 基本管理操作"></a>16.Git 版本控制 - 实例讲解分支 branch 基本管理操作</h3><p>新建支付功能开发分支<br><code>git branch pay</code></p>
<p>切换到新分支开始开发，这里的工作内容与上面的基础流程是一样的<br><code>git checkout pay</code></p>
<blockquote>
<p>⚠️ 注：以上两句代码可以合并为：git checkout -b pay</p>
</blockquote>
<p>开发完成执行提交<br><code>git commit -m &#39;H5 支付功能&#39;</code></p>
<p>合并分支到 master</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">切换到master分支</span><br><span class="line">git checkout master</span><br><span class="line"></span><br><span class="line">合并pay分支的代码</span><br><span class="line">git merge pay</span><br></pre></td></tr></table></figure>

<p>提交代码到 master 远程分支<br><code>git push</code></p>
<h3 id="17-Git-版本控制-规范的分支操作流程之分支的合并与删除"><a href="#17-Git-版本控制-规范的分支操作流程之分支的合并与删除" class="headerlink" title="17.Git 版本控制 - 规范的分支操作流程之分支的合并与删除"></a>17.Git 版本控制 - 规范的分支操作流程之分支的合并与删除</h3><p><strong>分支管理</strong><br>分支用于为项目增加新功能或修复 Bug 时使用。</p>
<p>创建分支 <code>git branch dev</code></p>
<p>查看分支 <code>git branch</code></p>
<p>切换分支 <code>git checkout dev</code></p>
<p>创建并切换分支 <code>git checkout -b feature/bbs</code></p>
<p>合并 dev 分支到 master</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout master</span><br><span class="line">git merge dev</span><br></pre></td></tr></table></figure>

<h3 id="18-Git-版本控制-正确处理分支冲突实例讲解"><a href="#18-Git-版本控制-正确处理分支冲突实例讲解" class="headerlink" title="18.Git 版本控制 - 正确处理分支冲突实例讲解"></a>18.Git 版本控制 - 正确处理分支冲突实例讲解</h3><p>不同分支修改同一个文件或不同开发者修改同一个分支文件都可能造成冲突，造成无法提交代码。</p>
<p>使用编辑器修改冲突的文件<br>添加暂存 git add . 表示已经解决冲突<br>git commit 提交完成</p>
<h3 id="19-Git-版本控制-分支管理–merged-与–no-merged-分支强制删除操作"><a href="#19-Git-版本控制-分支管理–merged-与–no-merged-分支强制删除操作" class="headerlink" title="19.Git 版本控制 - 分支管理–merged 与–no-merged 分支强制删除操作"></a>19.Git 版本控制 - 分支管理–merged 与–no-merged 分支强制删除操作</h3><p>如在 master 分支删除已合并的本地 dev 分支 <code>git branch -d dev</code></p>
<p>删除没有合并的分支<code>git branch -D dev</code> &#x2F;&#x2F;-D 表示忽略提醒，强制删除</p>
<p>删除远程分支 <code>git push origin :dev</code></p>
<p>查看未合并的分支(切换到 master) <code>git branch --no-merged</code></p>
<p>查看已经合并的分支(切换到 master) <code>git branch --merged</code></p>
<h3 id="20-Git-版本控制-标准的分支操作工作流"><a href="#20-Git-版本控制-标准的分支操作工作流" class="headerlink" title="20.Git 版本控制 - 标准的分支操作工作流"></a>20.Git 版本控制 - 标准的分支操作工作流</h3><p><strong>Git 工作流是什么</strong><br>其实就是我们使用 git 的时候整个项目的推送克隆修改过程，其实这个过程是随着时间的流动的，每个不同的时间节点发生了不同的事情，所以可以归为流。可能某个时间段弄了新功能弄了分支，然后合并之类其他的。fork 的情况较少也有可能出现。</p>
<p><strong>分支种类</strong> 1.主干分支 master<br>主要负责管理正在运行的生产环境代码。永远保持与正在运行的生产环境完全一致。</p>
<p>2.开发分支 develop<br>主要负责管理正在开发过程中的代码。一般情况下应该是最新的代码。</p>
<p>3.bug 修理分支 hotfix<br>主要负责管理生产环境下出现的紧急修复的代码。 从主干分支分出，修理完毕并测试上线后，并回主干分支。并回后，视情况可以删除该分支。</p>
<p>4.准生产分支（预发布分支） release<br>较大的版本上线前，会从开发分支中分出准生产分支，进行最后阶段的集成测试。该版本上线后，会合并到主干分支。生产环境运行一段阶段较稳定后可以视情况删除。</p>
<p>5.功能分支 feature<br>为了不影响较短周期的开发工作，一般把中长期开发模块，会从开发分支中独立出来。 开发完成后会合并到开发分支。</p>
<p><img src="https://www.daykalif.com/blog_img/git2.png" alt="git"></p>
<h3 id="21-Git-版本控制-stash-临时暂存区"><a href="#21-Git-版本控制-stash-临时暂存区" class="headerlink" title="21.Git 版本控制 - stash 临时暂存区"></a>21.Git 版本控制 - stash 临时暂存区</h3><p><strong>Stashing</strong><br>当你正在进行项目中某一部分的工作，里面的东西处于一个比较杂乱的状态，而你想转到其他分支上进行一些工作。问题是，你不想提交进行了一半的工作，否则以后你无法回到这个工作点。</p>
<p>“暂存” 可以获取你工作目录的中间状态——也就是你修改过的被追踪的文件和暂存的变更——并将它保存到一个未完结变更的堆栈中，随时可以重新应用。</p>
<p><code>git add .</code>，这个时候切换分支会报错；</p>
<p>储藏工作 <code>git stash</code> &#x2F;&#x2F;只有经过 git add&#x2F;commit 之后的文件才可以进行 stash【只能 stash 提交到暂存区中的文件】<br>查看储藏列表 <code>git stash list</code><br>应用【恢复】最近的储藏 <code>git stash apply</code><br>应用更早的储藏 <code>git stash apply stash@&#123;2&#125;</code><br>删除储藏<code>git stash drop stash@&#123;0&#125;</code><br>应用并删除储藏 <code>git stash pop</code></p>
<h3 id="22-Git-版本控制-使用-TAG-标签声明项目阶段版本"><a href="#22-Git-版本控制-使用-TAG-标签声明项目阶段版本" class="headerlink" title="22.Git 版本控制 - 使用 TAG 标签声明项目阶段版本"></a>22.Git 版本控制 - 使用 TAG 标签声明项目阶段版本</h3><p>Git 也可以对某一时间点上的版本打上标签 ，用于发布软件版本如 v1.0<br>【git commit 之后，进行打标签】<br>添加标签 <code>git tag v1.0</code><br>列出标签列表 <code>git tag</code><br>推送标签 <code>git push --tags</code><br>删除标签 <code>git tag -d v1.0.1</code><br>删除远程标签 <code>git push origin :v1.0.1</code><br>查看标签修改内容 <code>git show v1.0.1</code></p>
<h3 id="23-Git-版本控制-生产-zip-代码发布压缩包"><a href="#23-Git-版本控制-生产-zip-代码发布压缩包" class="headerlink" title="23.Git 版本控制 - 生产 zip 代码发布压缩包"></a>23.Git 版本控制 - 生产 zip 代码发布压缩包</h3><p>对 mster 分支代码生成压缩包供使用者下载使用，–prefix 指定目录名</p>
<p><code>git archive master --prefix=&#39;dist/&#39; --format=zip &gt; dist.zip</code><br>master：需要进行压缩的分支名<br>dist：压缩之后的文件夹名称<br>dist.zip：压缩之后的文件压缩包名称</p>
<h3 id="24-Git-版本控制-使用系统别名定义-git-全局指令"><a href="#24-Git-版本控制-使用系统别名定义-git-全局指令" class="headerlink" title="24.Git 版本控制 - 使用系统别名定义 git 全局指令"></a>24.Git 版本控制 - 使用系统别名定义 git 全局指令</h3><p><code>cd ~</code><br><code>ls -la</code><br><code>vim .bash_profile</code></p>
<p>系统配置定义:<br>window 用户可以修改~&#x2F;.bashrc 或 ~&#x2F;.bash_profile 文件。<br>mac&#x2F;linux 修改 ~&#x2F;.zshrc 文件中定义常用的别名指令，需要首先安装 zsh 命令行扩展</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">alias gs=&quot;git status&quot;</span><br><span class="line">alias gc=&quot;git commit -m &quot;</span><br><span class="line">alias gl=&quot;git log --graph --pretty=format:&#x27;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset&#x27; --abbrev-commit  &quot;</span><br><span class="line">alias gb=&quot;git branch&quot;</span><br><span class="line">alias ga=&quot;git add .&quot;</span><br><span class="line">alias go=&quot;git checkout&quot;</span><br></pre></td></tr></table></figure>

<p>命令行直接使用 <code>gs</code> 即可以实现 <code>git status</code> 一样的效果了。</p>
<p>设置 alias 的另一种方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 将checkout命令简化co</span><br><span class="line">git config --global alias.co checkout</span><br><span class="line"></span><br><span class="line"># 将branch命令简化为br</span><br><span class="line">git config --global alias.br branch</span><br><span class="line"></span><br><span class="line"># 将commit命令简化为cm</span><br><span class="line">git config --global alias.cm commit</span><br><span class="line"></span><br><span class="line"># 将status命令简化为st</span><br><span class="line">git config --global alias.st status</span><br></pre></td></tr></table></figure>

<p>查看全局变量：<br><code>git config -l</code></p>
<blockquote>
<p>window 系统需要使用 git for window 中的 Git Base 软件</p>
</blockquote>
<h3 id="25-Git-版本控制-合并分支产生的实际问题"><a href="#25-Git-版本控制-合并分支产生的实际问题" class="headerlink" title="25.Git 版本控制 - 合并分支产生的实际问题"></a>25.Git 版本控制 - 合并分支产生的实际问题</h3><p>master 分支–&gt;新建文件–&gt;主分支第一次 commit<br>之后再从 master 拉出子分支–&gt;ask<br>在子分支–&gt;新建文件–&gt;子分支第一次 commit<br>切换到 master 主分支–&gt;新建文件–&gt;主分支第二次 commit<br>此时 merge 子分支，会产生分叉的路线</p>
<h3 id="26-Git-版本控制-rebase-合理优化分支并合并"><a href="#26-Git-版本控制-rebase-合理优化分支并合并" class="headerlink" title="26.Git 版本控制 - rebase 合理优化分支并合并"></a>26.Git 版本控制 - rebase 合理优化分支并合并</h3><p>使用 rebase（可以理解为 replace base）解决合并分支分叉的问题，将子分支的提交记录先存起来，将子分支的提交点移到主分支的最新提交点（改变子分支的基础点）。</p>
<p>在 ask 子分支：<code>git rebase master</code><br>此时切换到 master,<code>git merge ask</code></p>
<h3 id="27-Git-版本控制-国内与国外项目托管平台介绍与在-Github-中创建项目"><a href="#27-Git-版本控制-国内与国外项目托管平台介绍与在-Github-中创建项目" class="headerlink" title="27.Git 版本控制 - 国内与国外项目托管平台介绍与在 Github 中创建项目"></a>27.Git 版本控制 - 国内与国外项目托管平台介绍与在 Github 中创建项目</h3><p>国外的速度较慢<br>有些国内项目托管平台私有库免费</p>
<h3 id="28-Git-版本控制-使用-SSH-与-GITHUB-远程服务器进行无密码连接"><a href="#28-Git-版本控制-使用-SSH-与-GITHUB-远程服务器进行无密码连接" class="headerlink" title="28.Git 版本控制 - 使用 SSH 与 GITHUB 远程服务器进行无密码连接"></a>28.Git 版本控制 - 使用 SSH 与 GITHUB 远程服务器进行无密码连接</h3><h4 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h4><p>生成秘钥</p>
<p>使用 ssh 连接 Github 发送指令更加安全可靠，也可以免掉每次输入密码的困扰。</p>
<p>在命令行中输入以下代码（windows 用户使用 Git Bash）</p>
<p><code>ssh-keygen -t rsa</code><br>一直按回车键直到结束。系统会在~&#x2F;.ssh 目录中生成 id_rsa 和 id_rsa.pub，即密钥 id_rsa 和公钥 id_rsa.pub。</p>
<p>向 GitHub 添加秘钥</p>
<p><img src="https://www.daykalif.com/blog_img/git3.png" alt="git"></p>
<p>如果连接失败：删除~&#x2F;.ssh&#x2F;known_hosts 文件中的内容【这是缓存的内容】</p>
<h3 id="29-Git-版本控制-本地版本库主动使用-remote-与远程-GITHUB-进行关联"><a href="#29-Git-版本控制-本地版本库主动使用-remote-与远程-GITHUB-进行关联" class="headerlink" title="29.Git 版本控制 - 本地版本库主动使用 remote 与远程 GITHUB 进行关联"></a>29.Git 版本控制 - 本地版本库主动使用 remote 与远程 GITHUB 进行关联</h3><p><strong>关联远程</strong> 1.创建本地库并完成初始提交</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;# hd-xj&quot; &gt;&gt; README.md</span><br><span class="line">git init</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m &quot;first commit&quot;</span><br></pre></td></tr></table></figure>

<p>2.添加远程仓库<br><code>git remote add origin git@github.com:10xxxxxx595/xxxxx.git</code></p>
<blockquote>
<p>通过 clone 克隆的仓库，本地与远程已经自动关联，上面几步都可以省略。</p>
</blockquote>
<h3 id="30-Git-版本控制-本地分支与-GITHBUB-远程分支同步"><a href="#30-Git-版本控制-本地分支与-GITHBUB-远程分支同步" class="headerlink" title="30.Git 版本控制 - 本地分支与 GITHBUB 远程分支同步"></a>30.Git 版本控制 - 本地分支与 GITHBUB 远程分支同步</h3><p>查看本地分支<br><code>git branch</code></p>
<p>查看远程分支<br><code>git branch -a</code></p>
<p>查看远程库<br><code>git remote -v</code></p>
<p>推送数据到远程仓库<br><code>git push -u origin master</code></p>
<h3 id="31-Git-版本控制-新入职员工参与项目开发时分支使用"><a href="#31-Git-版本控制-新入职员工参与项目开发时分支使用" class="headerlink" title="31.Git 版本控制 - 新入职员工参与项目开发时分支使用"></a>31.Git 版本控制 - 新入职员工参与项目开发时分支使用</h3><p><strong>pull</strong><br>拉取远程主机某个分支的更新，再与本地的指定分支合并。</p>
<p>拉取 origin 主机的 ask 分支与本地的 master 分支合并 <code>git pull origin ask:ask</code><br>拉取 origin 主机的 ask 分支与当前分支合并 <code>git pull origin ask</code><br>如果远程分支与当前本地分支同名直接执行 <code>git pull</code></p>
<p><strong>push</strong><br>git push 命令用于将本地分支的更新，推送到远程主机。它的格式与 git pull 命令相似。</p>
<p>1.将当前分支推送到 origin 主机的对应分支(如果当前分支只有一个追踪分支 ，可省略主机名)<br><code>git push origin</code></p>
<p>2.使用-u 选项指定一个默认主机 ,这样以后就可以不加任何参数直播使用 git push。<br><code>$ git push -u origin master</code></p>
<p>3.本地 ask 分支关联远程分支并推送 <code>git push --set-upstream origin ask</code></p>
<h3 id="32-Git-版本控制-Github-远程分支的合并"><a href="#32-Git-版本控制-Github-远程分支的合并" class="headerlink" title="32.Git 版本控制 - Github 远程分支的合并"></a>32.Git 版本控制 - Github 远程分支的合并</h3><p><code>git merge xxx</code></p>
<h3 id="33-Git-版本控制-远程分支删除操作–delete"><a href="#33-Git-版本控制-远程分支删除操作–delete" class="headerlink" title="33.Git 版本控制 - 远程分支删除操作–delete"></a>33.Git 版本控制 - 远程分支删除操作–delete</h3><p>1.删除远程 ask 分支 <code>git push origin --delete ask</code></p>
<p>2.删除远程仓库关联<code>git remote rm origin</code></p>
<h3 id="34-Git-版本控制-自动部署之流程分析与创建-WEB-站点"><a href="#34-Git-版本控制-自动部署之流程分析与创建-WEB-站点" class="headerlink" title="34.Git 版本控制 - 自动部署之流程分析与创建 WEB 站点"></a>34.Git 版本控制 - 自动部署之流程分析与创建 WEB 站点</h3><p>GitHub 项目设置 WebHook</p>
<p><img src="https://www.daykalif.com/blog_img/git4.png" alt="git"></p>
<p>使用<strong>宝塔 linux</strong>创建一个 web 服务器</p>
<h3 id="35-Git-版本控制-自动部署之-GITHUB-代码自动推送事件到-WEB-服务器部署完成"><a href="#35-Git-版本控制-自动部署之-GITHUB-代码自动推送事件到-WEB-服务器部署完成" class="headerlink" title="35.Git 版本控制 - 自动部署之 GITHUB 代码自动推送事件到 WEB 服务器部署完成"></a>35.Git 版本控制 - 自动部署之 GITHUB 代码自动推送事件到 WEB 服务器部署完成</h3><p><strong>同步脚本</strong><br>本地工作区拉取 github 项目，项目中添加处理 webhook 的 webhook.php 文件内容如下，并提交到版本库。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// GitHub Webhook Secret.</span></span><br><span class="line"><span class="comment">// GitHub项目 Settings/Webhooks 中的 Secret</span></span><br><span class="line"><span class="variable">$secret</span> = <span class="string">&quot;houdunren&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Path to your respostory on your server.</span></span><br><span class="line"><span class="comment">// e.g. &quot;/var/www/respostory&quot;</span></span><br><span class="line"><span class="comment">// 项目地址</span></span><br><span class="line"><span class="variable">$path</span> = <span class="string">&quot;/www/wwwroot/xj.houdunren.com&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Headers deliveried from GitHub</span></span><br><span class="line"><span class="variable">$signature</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_HUB_SIGNATURE&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$signature</span>) &#123;</span><br><span class="line">  <span class="variable">$hash</span> = <span class="string">&quot;sha1=&quot;</span>.<span class="title function_ invoke__">hash_hmac</span>(<span class="string">&#x27;sha1&#x27;</span>, <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;php://input&quot;</span>), <span class="variable">$secret</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_ invoke__">strcmp</span>(<span class="variable">$signature</span>, <span class="variable">$hash</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;cd <span class="subst">&#123;$path&#125;</span> &amp;&amp; /usr/bin/git reset --hard origin/master &amp;&amp; /usr/bin/git clean -f &amp;&amp; /usr/bin/git pull 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">http_response_code</span>(<span class="number">404</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>站点配置</strong><br>创建站点：<br>下面示例我使用的是<strong>宝塔</strong>主机面板。</p>
<p><img src="https://www.daykalif.com/blog_img/git5.png" alt="git"></p>
<p>现在服务器上生成了站点目录 <code>/www/wwwroot/xj.houdunren.com</code> ，因为目录中存在 .user.ini 文件（定义站点可以访问的目录权限），造成不能 clone 代码，将目录随意改名。</p>
<p><strong>shell_exec</strong><br>执行 git pull 指令需要使用 shell_exec 函数，删除 shell_exec 禁用函数后重启 PHP。</p>
<p><img src="https://www.daykalif.com/blog_img/git6.png" alt="git"></p>
<p>clone<br>登录服务器并使用 https 协议 clone 项目代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh root@xj.houdunren.com -p 22</span><br><span class="line">git clone https://github.com/houdunwang/xj.git xj.houdunren.com</span><br></pre></td></tr></table></figure>

<p>修改远程服务器权限，进入&#x2F;www&#x2F;wwwroot&#x2F;xj.houdunren.com 文件夹：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chown -R www .</span><br><span class="line">chmod -R g+s .</span><br><span class="line">sudo -u www git pull</span><br></pre></td></tr></table></figure>

<p>现在向 GitHub 推送代码后，服务器将自动执行代码拉取，自动部署功能设置完成了。</p>
<hr>
<p><strong>https 操作</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">复制https地址 例如（https://github.com/xxxxxx/-.git）</span><br><span class="line">命令行  : git clone https://github.com/xxxxxx/-.git //克隆项目文件</span><br><span class="line">git status查看当前文件状态（是否有更改的文件）</span><br><span class="line">git add index.html            从工作区提交新的单独的文件到暂存区</span><br><span class="line">git add .                     提交被修改的和新建的文件，但不包括被删除的文件             </span><br><span class="line">git add -u     --update       update tracked files    更新所有改变的文件，即提交所有变化的文件</span><br><span class="line">git add -A    --all           add changes from all tracked and untracked files   提交已被修改和已                               被删除文件，但是不包括新的文件</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git commit -m &quot;daykalif最新提交&quot; //将暂存区代码存入本地服务器</span><br><span class="line">git push origin master //提交代码到远程服务器（需要输入用户名和密码）</span><br><span class="line">如果仅仅是文件修改了，一次性到服务器 git commit -a -m &#x27;提交的注释&#x27;</span><br></pre></td></tr></table></figure>

<p><strong>ssh 操作</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">1.配置用户信息和电子邮箱地址 git config --global user.name &#x27;用户名&#x27;</span><br><span class="line">                           git config --global user.email &#x27;邮箱&#x27;</span><br><span class="line">2.查看你的信息              git config --list</span><br><span class="line">3.ssh-keygen -t rsa -C &#x27;xxxxxx@qq.com&#x27;之后会在你的c盘用户里面出现.ssh文件夹（里面的id——rsa是私钥，id_rsa.pub是公钥）</span><br><span class="line">4.查看 cd ~/.ssh  ls</span><br><span class="line">5.查看公钥文件（会出现一堆乱码文件，复制他们） cat ~/.ssh/id_rsa.pub</span><br><span class="line">6.进入github网站 右上角图标找到settings（设置）后左侧菜单SSH and GPG keys点击进入</span><br><span class="line">7.SSH keys创建newkey 把那一堆乱码放进去（title随你取名字 一般用邮箱就行）确认即可</span><br><span class="line"></span><br><span class="line">------上面这些做好之后才能提交代码和其他操作，下面我们就正式开始-----------</span><br><span class="line">获取远程仓库的名称 git remote</span><br><span class="line">获取远程仓库的地址 git remote -v</span><br><span class="line">复制ssh地址 例如（git@github.com:xxxxxx/-.git）</span><br><span class="line">命令行  : git clone git@github.com:xxxxxx/-.git //克隆项目文件</span><br><span class="line">git status查看当前文件状态（是否有更改的文件）</span><br><span class="line"> git commit -am &#x27;提交注释&#x27;  这个比较简便</span><br><span class="line">git add .       提交被修改的和新建的文件，但不包括被删除的文件</span><br><span class="line">git commit -m &quot;daykalif最新提交&quot; //将暂存区代码存入本地服务器</span><br><span class="line">git push origin master //提交代码到远程服务器（需要输入用户名和密码）</span><br><span class="line">如果仅仅是文件修改了，一次性到服务器 git commit -a -m &#x27;提交的注释&#x27;</span><br><span class="line">查看当前项目提交的记录  git log</span><br><span class="line">项目恢复到哪次提交 git checkout &#x27;提交的id&#x27;（git log后的commit加密字符）</span><br><span class="line">返回主分支  git checkout master</span><br><span class="line"></span><br><span class="line">创建分支 git branch new1</span><br><span class="line">查看分支 git branch</span><br><span class="line">提交创建的分支 git push origin new1</span><br><span class="line"></span><br><span class="line">切换到new1分支  git checkout new1</span><br><span class="line">之后再执行上面的提交操作</span><br><span class="line">（如果git checkout master 代码就是master的代码，就相当于存了两种状态的代码）</span><br><span class="line"></span><br><span class="line">拉取master（主分支下面）的代码（可能会失败）  git pull origin master</span><br><span class="line"></span><br><span class="line">如果失败 git checkout master到主分支下面 git merge new1 这时进行代码合并的操作</span><br><span class="line">你会发现子分支把主分支代码替换了 变成了子分支的代码</span><br><span class="line">此时修改子分支代码提交 修改主分支代码后也提交（master） 在进行合并 git merge new1 你会发现代码的文件出现箭头之类的东西 这就是冲突了 把这些箭头删掉在提交一次</span><br><span class="line">之后去子分支new1 git pull origin master 这时子和主分支的代码就一样了</span><br><span class="line"></span><br><span class="line">项目做好了之后要设置版本</span><br><span class="line">git tag v1.0 (假如是1.0版本)</span><br><span class="line">git push origin v1.0（进行提交就可以了）</span><br></pre></td></tr></table></figure>

<p>参考视频：<br><a href="https://www.bilibili.com/video/BV154411g7Wm?p=34">https://www.bilibili.com/video/BV154411g7Wm?p=34</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2021/03/20/%20Typescript/TypeScript-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/20/%20Typescript/TypeScript-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" itemprop="url">TypeScript && 面向对象</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-03-20T20:20:54+08:00">
                2021-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/20/%20Typescript/TypeScript-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2021/03/20/%20Typescript/TypeScript-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2021/03/20/%20Typescript/TypeScript-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" class="leancloud_visitors" data-flag-title="TypeScript && 面向对象">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  2.9k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  14
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="揭开-TypeScript-的面纱"><a href="#揭开-TypeScript-的面纱" class="headerlink" title="揭开 TypeScript 的面纱"></a>揭开 TypeScript 的面纱</h2><h3 id="什么是-TypeScript"><a href="#什么是-TypeScript" class="headerlink" title="什么是 TypeScript"></a>什么是 TypeScript</h3><p>Typescript 是 JavaScript 的、带有类型的超集，并且能够编译为普通的 JavaScript</p>
<h3 id="为什么用-TypeScript"><a href="#为什么用-TypeScript" class="headerlink" title="为什么用 TypeScript"></a>为什么用 TypeScript</h3><ul>
<li>01.类型检查</li>
<li>02.代码补全</li>
<li>03.易于维护</li>
<li>04.入门简单</li>
</ul>
<h3 id="编写并运行-Typescript"><a href="#编写并运行-Typescript" class="headerlink" title="编写并运行 Typescript"></a>编写并运行 Typescript</h3><h4 id="安装编译器"><a href="#安装编译器" class="headerlink" title="安装编译器"></a>安装编译器</h4><h5 id="1-nodejs-环境：npm-install-g-typescript"><a href="#1-nodejs-环境：npm-install-g-typescript" class="headerlink" title="1.nodejs 环境：npm install -g typescript"></a>1.nodejs 环境：npm install -g typescript</h5><p>新建文件：index.ts 文件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">number</span> = <span class="number">10</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br></pre></td></tr></table></figure>

<p>运行命令：<br><code>tsc index.ts</code> 会自动生成一个 index.js 文件<br><code>npde index.js</code></p>
<h5 id="2-使用-deno"><a href="#2-使用-deno" class="headerlink" title="2.使用 deno"></a>2.使用 deno</h5><p>官方提供了 denoland&#x2F;deno_install 安装脚本，可以通过运行一个命令完成 Deno 的下载和安装：</p>
<p>macOS 和 Linux 系统上使用 shell:<br><code>curl -fsSL https://deno.land/x/install/install.sh | sh</code></p>
<p>Windows 系统上使用 PowerShell:<br><code>wr https://deno.land/x/install/install.ps1 -useb | iex</code></p>
<p>此时可以运行文件：<br><code>deno run index.ts</code></p>
<hr>
<h5 id="ts-默认编译成-ES3-的版本"><a href="#ts-默认编译成-ES3-的版本" class="headerlink" title="ts 默认编译成 ES3 的版本"></a>ts 默认编译成 ES3 的版本</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">params: <span class="built_in">string</span></span>) &#123;&#125;</span><br></pre></td></tr></table></figure>

<p><code>tsc index.ts</code>编译之后会生成 ES3 的 index.js 文件代码:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> __awaiter =</span><br><span class="line">  (<span class="variable language_">this</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">__awaiter</span>) ||</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">thisArg, _arguments, P, generator</span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">adopt</span>(<span class="params">value</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> value <span class="keyword">instanceof</span> P</span><br><span class="line">        ? value</span><br><span class="line">        : <span class="keyword">new</span> <span class="title function_">P</span>(<span class="keyword">function</span> (<span class="params">resolve</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(value);</span><br><span class="line">          &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> (P || (P = <span class="title class_">Promise</span>))(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">fulfilled</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="title function_">step</span>(generator.<span class="title function_">next</span>(value));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          <span class="title function_">reject</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">rejected</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="title function_">step</span>(generator[<span class="string">&quot;throw&quot;</span>](value));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          <span class="title function_">reject</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">step</span>(<span class="params">result</span>) &#123;</span><br><span class="line">        result.<span class="property">done</span></span><br><span class="line">          ? <span class="title function_">resolve</span>(result.<span class="property">value</span>)</span><br><span class="line">          : <span class="title function_">adopt</span>(result.<span class="property">value</span>).<span class="title function_">then</span>(fulfilled, rejected);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">step</span>((generator = generator.<span class="title function_">apply</span>(thisArg, _arguments || [])).<span class="title function_">next</span>());</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="keyword">var</span> __generator =</span><br><span class="line">  (<span class="variable language_">this</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">__generator</span>) ||</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">thisArg, body</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> _ = &#123;</span><br><span class="line">        <span class="attr">label</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">sent</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (t[<span class="number">0</span>] &amp; <span class="number">1</span>) <span class="keyword">throw</span> t[<span class="number">1</span>];</span><br><span class="line">          <span class="keyword">return</span> t[<span class="number">1</span>];</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">trys</span>: [],</span><br><span class="line">        <span class="attr">ops</span>: [],</span><br><span class="line">      &#125;,</span><br><span class="line">      f,</span><br><span class="line">      y,</span><br><span class="line">      t,</span><br><span class="line">      g;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      (g = &#123; <span class="attr">next</span>: <span class="title function_">verb</span>(<span class="number">0</span>), <span class="attr">throw</span>: <span class="title function_">verb</span>(<span class="number">1</span>), <span class="attr">return</span>: <span class="title function_">verb</span>(<span class="number">2</span>) &#125;),</span><br><span class="line">      <span class="keyword">typeof</span> <span class="title class_">Symbol</span> === <span class="string">&quot;function&quot;</span> &amp;&amp;</span><br><span class="line">        (g[<span class="title class_">Symbol</span>.<span class="property">iterator</span>] = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">        &#125;),</span><br><span class="line">      g</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">verb</span>(<span class="params">n</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">v</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">step</span>([n, v]);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">step</span>(<span class="params">op</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (f) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Generator is already executing.&quot;</span>);</span><br><span class="line">      <span class="keyword">while</span> (_)</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (</span><br><span class="line">            ((f = <span class="number">1</span>),</span><br><span class="line">            y &amp;&amp;</span><br><span class="line">              (t =</span><br><span class="line">                op[<span class="number">0</span>] &amp; <span class="number">2</span></span><br><span class="line">                  ? y[<span class="string">&quot;return&quot;</span>]</span><br><span class="line">                  : op[<span class="number">0</span>]</span><br><span class="line">                  ? y[<span class="string">&quot;throw&quot;</span>] || ((t = y[<span class="string">&quot;return&quot;</span>]) &amp;&amp; t.<span class="title function_">call</span>(y), <span class="number">0</span>)</span><br><span class="line">                  : y.<span class="property">next</span>) &amp;&amp;</span><br><span class="line">              !(t = t.<span class="title function_">call</span>(y, op[<span class="number">1</span>])).<span class="property">done</span>)</span><br><span class="line">          )</span><br><span class="line">            <span class="keyword">return</span> t;</span><br><span class="line">          <span class="keyword">if</span> (((y = <span class="number">0</span>), t)) op = [op[<span class="number">0</span>] &amp; <span class="number">2</span>, t.<span class="property">value</span>];</span><br><span class="line">          <span class="keyword">switch</span> (op[<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">              t = op;</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">              _.<span class="property">label</span>++;</span><br><span class="line">              <span class="keyword">return</span> &#123; <span class="attr">value</span>: op[<span class="number">1</span>], <span class="attr">done</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">              _.<span class="property">label</span>++;</span><br><span class="line">              y = op[<span class="number">1</span>];</span><br><span class="line">              op = [<span class="number">0</span>];</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">              op = _.<span class="property">ops</span>.<span class="title function_">pop</span>();</span><br><span class="line">              _.<span class="property">trys</span>.<span class="title function_">pop</span>();</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">              <span class="keyword">if</span> (</span><br><span class="line">                !((t = _.<span class="property">trys</span>), (t = t.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; t[t.<span class="property">length</span> - <span class="number">1</span>])) &amp;&amp;</span><br><span class="line">                (op[<span class="number">0</span>] === <span class="number">6</span> || op[<span class="number">0</span>] === <span class="number">2</span>)</span><br><span class="line">              ) &#123;</span><br><span class="line">                _ = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> (op[<span class="number">0</span>] === <span class="number">3</span> &amp;&amp; (!t || (op[<span class="number">1</span>] &gt; t[<span class="number">0</span>] &amp;&amp; op[<span class="number">1</span>] &lt; t[<span class="number">3</span>]))) &#123;</span><br><span class="line">                _.<span class="property">label</span> = op[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> (op[<span class="number">0</span>] === <span class="number">6</span> &amp;&amp; _.<span class="property">label</span> &lt; t[<span class="number">1</span>]) &#123;</span><br><span class="line">                _.<span class="property">label</span> = t[<span class="number">1</span>];</span><br><span class="line">                t = op;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> (t &amp;&amp; _.<span class="property">label</span> &lt; t[<span class="number">2</span>]) &#123;</span><br><span class="line">                _.<span class="property">label</span> = t[<span class="number">2</span>];</span><br><span class="line">                _.<span class="property">ops</span>.<span class="title function_">push</span>(op);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> (t[<span class="number">2</span>]) _.<span class="property">ops</span>.<span class="title function_">pop</span>();</span><br><span class="line">              _.<span class="property">trys</span>.<span class="title function_">pop</span>();</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          op = body.<span class="title function_">call</span>(thisArg, _);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          op = [<span class="number">6</span>, e];</span><br><span class="line">          y = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          f = t = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="keyword">if</span> (op[<span class="number">0</span>] &amp; <span class="number">5</span>) <span class="keyword">throw</span> op[<span class="number">1</span>];</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">value</span>: op[<span class="number">0</span>] ? op[<span class="number">1</span>] : <span class="keyword">void</span> <span class="number">0</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">__awaiter</span>(<span class="variable language_">this</span>, <span class="keyword">void</span> <span class="number">0</span>, <span class="keyword">void</span> <span class="number">0</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">__generator</span>(<span class="variable language_">this</span>, <span class="keyword">function</span> (<span class="params">_a</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> [<span class="number">2</span> <span class="comment">/*return*/</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果要生成 ES2017 版本，需要在项目根目录下新建：tsconfig.json 文件</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ES2017&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>此时编译运行命令<code>tsc</code>,则会按照文件配置进行编译，如果编译时指定文件名，则会忽略这个配置文件</p>
<p>编译过后的 index.js 文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">params</span>) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Typescript-基本语法"><a href="#Typescript-基本语法" class="headerlink" title="Typescript 基本语法"></a>Typescript 基本语法</h3><h4 id="1-基本类型"><a href="#1-基本类型" class="headerlink" title="1.基本类型"></a>1.基本类型</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// boolean, number, string, undefined, null</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">10</span>;</span><br><span class="line">a = <span class="string">&quot;hello&quot;</span>; <span class="comment">//不能将类型“string”分配给类型“number”。ts(2322)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: <span class="built_in">boolean</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">c</span>: <span class="built_in">any</span> = <span class="number">10</span>;</span><br><span class="line">c = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="comment">//add函数需要两个参数，传入参数a为number类型，传入参数b为number类型，返回值为number类型</span></span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> res1 = <span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="attr">res2</span>: <span class="built_in">string</span> = <span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">//不能将类型“number”分配给类型“string”。ts(2322)</span></span><br><span class="line"><span class="title function_">add</span>(<span class="string">&quot;1&quot;</span>, <span class="number">2</span>); <span class="comment">//类型“string”的参数不能赋给类型“number”的参数。ts(2345)</span></span><br><span class="line"><span class="title function_">add</span>(<span class="number">1</span>); <span class="comment">//index.ts(11, 25): 未提供 &quot;b&quot; 的自变量。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">minus</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="comment">//没有返回值类型</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a - b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-组合类型"><a href="#2-组合类型" class="headerlink" title="2.组合类型"></a>2.组合类型</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">number</span> | <span class="built_in">string</span> = <span class="number">10</span>;</span><br><span class="line">a = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">NumStr</span> = <span class="built_in">number</span> | <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: <span class="title class_">NumStr</span> = <span class="number">10</span>;</span><br><span class="line">b = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">c</span>: <span class="title class_">NumStr</span> = <span class="string">&quot;world&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">d</span>: <span class="string">&quot;on&quot;</span> | <span class="string">&quot;off&quot;</span> = <span class="string">&quot;on&quot;</span>; <span class="comment">//只能取值on或者off</span></span><br><span class="line">d = <span class="string">&quot;off&quot;</span>;</span><br><span class="line">d = <span class="string">&quot;other&quot;</span>; <span class="comment">//不能将类型“&quot;other&quot;”分配给类型“&quot;on&quot; | &quot;off&quot;”。ts(2322)</span></span><br></pre></td></tr></table></figure>

<h4 id="3-对象类型"><a href="#3-对象类型" class="headerlink" title="3.对象类型"></a>3.对象类型</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Post</span> &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">author</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">post</span>: <span class="title class_">Post</span> = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;标题&quot;</span>,</span><br><span class="line">  <span class="attr">author</span>: <span class="string">&quot;daykalif&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">post1</span>: <span class="title class_">Post</span> = &#123;</span><br><span class="line">  <span class="comment">//类型 &quot;&#123; title: string; &#125;&quot; 中缺少属性 &quot;author&quot;，但类型 &quot;Post&quot; 中需要该属性。ts(2741)</span></span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;标题&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">post2</span>: <span class="title class_">Post</span> = &#123;</span><br><span class="line">  <span class="comment">//不能将类型“&#123; title: string; author: string; other: string; &#125;”分配给类型“Post”。对象文字可以只指定已知属性，并且“other”不在类型“Post”中。ts(2322)</span></span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;标题&quot;</span>,</span><br><span class="line">  <span class="attr">author</span>: <span class="string">&quot;daykalif&quot;</span>,</span><br><span class="line">  <span class="attr">other</span>: <span class="string">&quot;other&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>函数中的使用：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Post</span> &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">author</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getTitle</span>(<span class="params">post: Post</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(post.<span class="property">title</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> post = &#123;</span><br><span class="line">  <span class="comment">//如果想要严格检查，则let post:Post = &#123;...&#125;定义为接口类型</span></span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;标题&quot;</span>,</span><br><span class="line">  <span class="attr">author</span>: <span class="string">&quot;daykalif&quot;</span>,</span><br><span class="line">  <span class="attr">publishDate</span>: <span class="string">&quot;2021-03-20&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">getTitle</span>(post); <span class="comment">//如果传递进来的参数没有定义类型的话，那么只要这个参数包括接口中定义的参数类型，就可以通过检查，哪怕它有额外的属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者直接给函数传递对象字面值，这样就会出错</span></span><br><span class="line"><span class="title function_">getTitle</span>(&#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;标题&quot;</span>,</span><br><span class="line">  <span class="attr">author</span>: <span class="string">&quot;daykalif&quot;</span>,</span><br><span class="line">  <span class="attr">publishDate</span>: <span class="string">&quot;2021-03-20&quot;</span>, <span class="comment">//类型“&#123; title: string; author: string; publishDate: string; &#125;”的参数不能赋给类型“Post”的参数。对象文字可以只指定已知属性，并且“publishDate”不在类型“Post”中。ts(2345)</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="4-数组类型"><a href="#4-数组类型" class="headerlink" title="4.数组类型"></a>4.数组类型</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用泛型</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">new_arr</span>: <span class="title class_">Array</span>&lt;<span class="built_in">number</span>&gt; = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 元祖（tuple）</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">tup</span>: [<span class="built_in">number</span>, <span class="built_in">string</span>, <span class="built_in">boolean</span>] = [<span class="number">1</span>, <span class="string">&quot;daykalif&quot;</span>, <span class="literal">true</span>];</span><br></pre></td></tr></table></figure>

<h3 id="面向对象编程基础：Typescript-实现"><a href="#面向对象编程基础：Typescript-实现" class="headerlink" title="面向对象编程基础：Typescript 实现"></a>面向对象编程基础：Typescript 实现</h3><p>定义:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Employee</span></span><br><span class="line">----------------</span><br><span class="line"><span class="attr">name</span>:string</span><br><span class="line"><span class="attr">age</span>:number</span><br><span class="line"><span class="attr">empNo</span>:number</span><br><span class="line">----------------</span><br><span class="line"><span class="title function_">signIn</span>():<span class="keyword">void</span></span><br><span class="line"><span class="title function_">askLeave</span>():<span class="keyword">void</span></span><br></pre></td></tr></table></figure>

<p>调用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> emp = <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">22</span>, <span class="number">999</span>);</span><br><span class="line">emp.<span class="title function_">signIn</span>();</span><br><span class="line">emp.<span class="title function_">askLeave</span>();</span><br></pre></td></tr></table></figure>

<p>描述对象的两种形式:<br>class:【员工类】<br>Object:【员工对象】 （”张三”, 22, 999）</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">  <span class="comment">// 实例变量（它们的值在每个对象中都是独立的，互不影响）</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">empNo</span>: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 构造方法</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span>, empNo: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">empNo</span> = empNo;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 实例方法</span></span><br><span class="line">  <span class="title function_">signIn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;上班打卡&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">askLeave</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;请假&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> emp = <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">22</span>, <span class="number">999</span>);</span><br><span class="line">emp.<span class="title function_">signIn</span>(); <span class="comment">//张三上班打卡</span></span><br><span class="line">emp.<span class="title function_">askLeave</span>(); <span class="comment">//张三请假</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> emp2 = <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">25</span>, <span class="number">888</span>);</span><br><span class="line">emp2.<span class="title function_">signIn</span>(); <span class="comment">//李四上班打卡</span></span><br><span class="line">emp2.<span class="title function_">askLeave</span>(); <span class="comment">//李四请假</span></span><br></pre></td></tr></table></figure>

<h3 id="封装与抽象"><a href="#封装与抽象" class="headerlink" title="封装与抽象"></a>封装与抽象</h3><p>封装：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- 私有</span><br><span class="line">+ 公开</span><br><span class="line"></span><br><span class="line"><span class="title class_">Car</span></span><br><span class="line">----------------</span><br><span class="line">- <span class="title class_">Speed</span>:number</span><br><span class="line">- <span class="attr">make</span>:string</span><br><span class="line">----------------</span><br><span class="line">+ <span class="title function_">accelerate</span>():<span class="keyword">void</span></span><br><span class="line">+ <span class="title function_">decelerate</span>():<span class="keyword">void</span></span><br></pre></td></tr></table></figure>

<p>抽象：<br>对象方法的具体实现细节，外界是看不到的；外界只需要调用对象中的方法来查看或修改数据。</p>
<p>默认公开:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">  <span class="attr">speed</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">make</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">make: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">speed</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">make</span> = make;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以随意修改:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">car</span>: <span class="title class_">Car</span> = <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="string">&quot;Toyota&quot;</span>);</span><br><span class="line">car.<span class="property">make</span> = <span class="string">&quot;Honda&quot;</span>;</span><br><span class="line">car.<span class="property">speed</span> = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(car.<span class="property">make</span>); <span class="comment">//Honda</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(car.<span class="property">speed</span>); <span class="comment">//200</span></span><br></pre></td></tr></table></figure>

<p>private 私有属性:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">speed</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">make</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">make: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">speed</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">make</span> = make;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不可以访问和修改:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">car</span>: <span class="title class_">Car</span> = <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="string">&quot;Toyota&quot;</span>);</span><br><span class="line">car.<span class="property">make</span> = <span class="string">&quot;Honda&quot;</span>; <span class="comment">//属性“make”为私有属性，只能在类“Car”中访问。ts(2341)</span></span><br><span class="line">car.<span class="property">speed</span> = <span class="number">200</span>; <span class="comment">//属性“speed”为私有属性，只能在类“Car”中访问。ts(2341)</span></span><br></pre></td></tr></table></figure>

<p>修改车速：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">speed</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">make</span>: <span class="built_in">string</span>; <span class="comment">//品牌只读属性</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">make: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">speed</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">make</span> = make;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取当前车速</span></span><br><span class="line">  <span class="title function_">getCurrentSpeed</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;当前车速是：&quot;</span> + <span class="variable language_">this</span>.<span class="property">speed</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用Getters &amp;&amp; Setters</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">currentSpeed</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;当前车速是：&quot;</span> + <span class="variable language_">this</span>.<span class="property">speed</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 修改车速</span></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">setSpeed</span>(<span class="params">delta: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (delta &gt; -<span class="number">100</span> &amp;&amp; delta &lt; <span class="number">100</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">speed</span> += delta;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;delta只能取-100到100之间的数字&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加速</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">accelerate</span>(<span class="params">delta: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="comment">//方法默认公开</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setSpeed</span>(delta);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 减速</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">decelerate</span>(<span class="params">delta: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setSpeed</span>(-delta);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">car</span>: <span class="title class_">Car</span> = <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="string">&quot;Toyota&quot;</span>); <span class="comment">//make属性只能在定义的时候，或者构造函数中赋值，后面就不能修改了，但是可以访问</span></span><br><span class="line">car.<span class="title function_">accelerate</span>(<span class="number">10</span>);</span><br><span class="line">car.<span class="title function_">accelerate</span>(<span class="number">10</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(car.<span class="title function_">getCurrentSpeed</span>()); <span class="comment">//当前车速是：20</span></span><br><span class="line">car.<span class="title function_">accelerate</span>(<span class="number">200</span>); <span class="comment">//error delta只能取-100到100之间的数字</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取车速的另外方式：</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(car.<span class="title function_">currentSpeed</span>());</span><br></pre></td></tr></table></figure>

<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通按钮</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="attr">name</span>: <span class="built_in">string</span>; <span class="comment">//可以被外部的任何代码访问</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">shape</span>: <span class="built_in">string</span> = <span class="string">&quot;rectanglar&quot;</span>; <span class="comment">//私有的属性和方法 --  不能在子类中访问</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="attr">other</span>: <span class="built_in">string</span> = <span class="string">&quot;other&quot;</span>; <span class="comment">//受保护的属性和方法   --  可以在子类中访问，不能被外部代码访问</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">onClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;处理点击事件...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`&lt;Button&gt;<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>&lt;/Button&gt;`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链接按钮</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Link</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Button</span> &#123;</span><br><span class="line">  <span class="comment">//子类可以访问所有父类的公开属性和方法，包括构造函数</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">href</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, href: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name); <span class="comment">//调用父类的构造函数【必须放在第一行】</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">href</span> = href;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//在子类中可以定义同名的方法来覆盖父类的方法</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`&lt;a href=&quot;<span class="subst">$&#123;<span class="variable language_">this</span>.href&#125;</span>&quot;&gt;<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>&lt;/a&gt;`</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">      <span class="string">`&lt;a href=&quot;<span class="subst">$&#123;<span class="variable language_">this</span>.href&#125;</span>&quot; shape=<span class="subst">$&#123;<span class="variable language_">this</span>.shape&#125;</span> other=<span class="subst">$&#123;<span class="variable language_">this</span>.other&#125;</span>&gt;<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>&lt;/a&gt;`</span></span><br><span class="line">    ); <span class="comment">//属性“shape”为私有属性，只能在类“Button”中访问。ts(2341)</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">onClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>.<span class="title function_">onClick</span>(); <span class="comment">//调用父类的方法</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;事件处理完毕，开始跳转...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> button = <span class="keyword">new</span> <span class="title class_">Button</span>(<span class="string">&quot;按钮&quot;</span>);</span><br><span class="line">button.<span class="property">shape</span>; <span class="comment">//属性“shape”为私有属性，只能在类“Button”中访问。ts(2341)</span></span><br><span class="line">button.<span class="property">other</span>; <span class="comment">//属性“other”受保护，只能在类“Button”及其子类中访问。ts(2445)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> link = <span class="keyword">new</span> <span class="title class_">Link</span>(<span class="string">&quot;点击跳转&quot;</span>, <span class="string">&quot;https://www.daykalif.com&quot;</span>); <span class="comment">//构造函数可以继承，因此可以设置name属性的值</span></span><br><span class="line"><span class="comment">// 处理点击事件...</span></span><br><span class="line">link.<span class="title function_">onClick</span>(); <span class="comment">//调用父类的onClick</span></span><br><span class="line"><span class="comment">// &lt;a href=&quot;https://www.daykalif.com&quot;&gt;点击跳转&lt;/a&gt;</span></span><br><span class="line">link.<span class="title function_">render</span>(); <span class="comment">//调用子类自身的render</span></span><br></pre></td></tr></table></figure>

<h3 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h3><p>继承方式实现多态:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通按钮</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">  <span class="keyword">protected</span> <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`&lt;Button&gt;<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>&lt;/Button&gt;`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链接按钮</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LinkButton</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Button</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`&lt;a&gt;<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>&lt;/a&gt;`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">comps</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Button</span>&gt; = [<span class="keyword">new</span> <span class="title class_">Button</span>(<span class="string">&quot;普通按钮&quot;</span>), <span class="keyword">new</span> <span class="title class_">LinkButton</span>(<span class="string">&quot;链接按钮&quot;</span>)]; <span class="comment">//具有继承关系，会有一个转型机制，所有Button子类对象，都会自动转型Button父类对象</span></span><br><span class="line"><span class="comment">// &lt;Button&gt;普通按钮&lt;/Button&gt;</span></span><br><span class="line"><span class="comment">// &lt;a&gt;链接按钮&lt;/a&gt;</span></span><br><span class="line">comps.<span class="title function_">forEach</span>(<span class="function">(<span class="params">comp</span>) =&gt;</span> comp.<span class="title function_">render</span>()); <span class="comment">//渲染时因为知道子类会继承父类的方法，所以直接调用render方法渲染组件</span></span><br></pre></td></tr></table></figure>

<p>渲染没有继承关系的组件则会出错:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Image组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Img</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`&lt;img /&gt;`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 类型 &quot;Img&quot; 中缺少属性 &quot;name&quot;，但类型 &quot;Button&quot; 中需要该属性。ts(2741) index.ts(5, 15): 在此处声明了 &quot;name&quot;。</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">comps</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Button</span>&gt; = [</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Button</span>(<span class="string">&quot;普通按钮&quot;</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">LinkButton</span>(<span class="string">&quot;链接按钮&quot;</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Img</span>(),</span><br><span class="line">]; <span class="comment">//要渲染没有继承关系的组件则会出错</span></span><br></pre></td></tr></table></figure>

<p>接口方式实现多态:【接口形式适合没有继承关系的类，且需要统一调用某个方法的情况】</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// renderable接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Renderable</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通按钮</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span> <span class="keyword">implements</span> <span class="title class_">Renderable</span> &#123;</span><br><span class="line">  <span class="keyword">protected</span> <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`&lt;Button&gt;<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>&lt;/Button&gt;`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链接按钮</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LinkButton</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Button</span> <span class="keyword">implements</span> <span class="title class_">Renderable</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`&lt;a&gt;<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>&lt;/a&gt;`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Image组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Img</span> <span class="keyword">implements</span> <span class="title class_">Renderable</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`&lt;img /&gt;`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">comps</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Renderable</span>&gt; = [</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Button</span>(<span class="string">&quot;普通按钮&quot;</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">LinkButton</span>(<span class="string">&quot;链接按钮&quot;</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Img</span>(),</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// &lt;Button&gt;普通按钮&lt;/Button&gt;</span></span><br><span class="line"><span class="comment">// &lt;a&gt;链接按钮&lt;/a&gt;</span></span><br><span class="line"><span class="comment">// &lt;img /&gt;</span></span><br><span class="line">comps.<span class="title function_">forEach</span>(<span class="function">(<span class="params">comp</span>) =&gt;</span> comp.<span class="title function_">render</span>());</span><br></pre></td></tr></table></figure>

<p>参考视频：<br><a href="https://www.bilibili.com/video/BV1xp4y1D7ux">https://www.bilibili.com/video/BV1xp4y1D7ux</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2021/03/13/React/react-hooks%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9A%E8%85%BE%E8%AE%AFNext%E5%AD%A6%E9%99%A2%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/13/React/react-hooks%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9A%E8%85%BE%E8%AE%AFNext%E5%AD%A6%E9%99%A2%EF%BC%89/" itemprop="url">react hooks实战指南--腾讯NEXT学院视频</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-03-13T11:51:19+08:00">
                2021-03-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/13/React/react-hooks%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9A%E8%85%BE%E8%AE%AFNext%E5%AD%A6%E9%99%A2%EF%BC%89/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2021/03/13/React/react-hooks%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9A%E8%85%BE%E8%AE%AFNext%E5%AD%A6%E9%99%A2%EF%BC%89/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2021/03/13/React/react-hooks%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9A%E8%85%BE%E8%AE%AFNext%E5%AD%A6%E9%99%A2%EF%BC%89/" class="leancloud_visitors" data-flag-title="react hooks实战指南--腾讯NEXT学院视频">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  3.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  17
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="React-Hooks-实战"><a href="#React-Hooks-实战" class="headerlink" title="React Hooks 实战"></a>React Hooks 实战</h2><h3 id="核心主旨-–-什么是-UI？"><a href="#核心主旨-–-什么是-UI？" class="headerlink" title="核心主旨 – 什么是 UI？"></a>核心主旨 – 什么是 UI？</h3><ul>
<li>如果这样思考：UI &#x3D; f(data),准确吗？</li>
<li>如何理解：函数 f 将数据(data)<strong>映射</strong>到<strong>用户界面</strong>(UI) 【MVVM 思想】</li>
<li>例如：[商品 1,商品 2,商品 3…] -&gt; 商品列表</li>
</ul>
<h3 id="状态是数据吗？"><a href="#状态是数据吗？" class="headerlink" title="状态是数据吗？"></a>状态是数据吗？</h3><ul>
<li>状态有一个隐含的意思，就是存在改变状态的行为(behavior).</li>
<li>例如：点赞数（like-状态）隐含了增加一个赞（addLike-行为）；而这个行为（点赞）只有在某中上下文（context）中才会存在。</li>
</ul>
<h3 id="React-Hooks-的基本概念"><a href="#React-Hooks-的基本概念" class="headerlink" title="React Hooks 的基本概念"></a>React Hooks 的基本概念</h3><h4 id="什么是-React-Hooks"><a href="#什么是-React-Hooks" class="headerlink" title="什么是 React Hooks"></a>什么是 React Hooks</h4><ul>
<li>React16.8 的新增特性，可以让你在不屑 class 的情况下使用 state 等 react 特性。</li>
<li>hooks 是对函数式组件的极大加强</li>
</ul>
<p><strong>数据拆分：不变的是属性，变化的是状态</strong></p>
<p>状态影射了行为，因此行为可以封装在状态内…</p>
<p>v &#x3D; f(props,state){…}</p>
<p>状态–&gt;视图<br>作用–&gt;视图<br>上下文–&gt;视图</p>
<p>属性–&gt;视图</p>
<h4 id="什么是-Hooks？"><a href="#什么是-Hooks？" class="headerlink" title="什么是 Hooks？"></a>什么是 Hooks？</h4><ul>
<li>重新定义 UI 界面是什么，有哪些要素：</li>
<li>state hook</li>
<li>effect hook</li>
<li>context hook</li>
<li>函数 V &#x3D; f(props,state) , UI &#x3D; V usehook1() usehook2() …</li>
</ul>
<h4 id="一、3-个基础的-hook：状态、作用和上下文"><a href="#一、3-个基础的-hook：状态、作用和上下文" class="headerlink" title="一、3 个基础的 hook：状态、作用和上下文"></a>一、3 个基础的 hook：状态、作用和上下文</h4><h5 id="1-状态"><a href="#1-状态" class="headerlink" title="1).状态"></a>1).状态</h5><ul>
<li>在某个上下文中（用户界面）数据和改变数据的行为</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//计数器例子</span></span><br><span class="line"><span class="keyword">const</span> [count,setCount] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">        状态    行为       hooks <span class="variable constant_">API</span></span><br></pre></td></tr></table></figure>

<p>React hooks 帮助大家将数据和行为绑定。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      your count : &#123;count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setCount(count + 1);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        Add</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>改版：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useCount</span>(<span class="params">initialValue</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(initialValue);</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    count,</span><br><span class="line">    <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setCount</span>(count + <span class="number">1</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, addCount] = <span class="title function_">useCount</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      your count : &#123;count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> addCount()&#125;&gt;Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="2-作用（Effect）"><a href="#2-作用（Effect）" class="headerlink" title="2).作用（Effect）"></a>2).作用（Effect）</h5><ul>
<li>UI 如果这样实现，它不仅仅是一个将数据映射到视图的函数。</li>
<li>客观世界存在输入和输出之外的东西（改变 URL，改变环境…）</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">UI</span> = data -&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;xxx&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`you clicked count <span class="subst">$&#123;count&#125;</span> times`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      your count : &#123;count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setCount(count + 1);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        Add</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>解读 useEffect：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">log</span>(<span class="params">count</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`you clicked count <span class="subst">$&#123;count&#125;</span> times`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 读作：依赖xx变化的作用   useEffect(log.bind(null,count),deps);</span></span><br><span class="line">  <span class="title function_">useEffect</span>(log.<span class="title function_">bind</span>(<span class="literal">null</span>, count), []); <span class="comment">//依赖空变化的作用，但是空本身不会变化，因此只会执行1次；</span></span><br><span class="line">  <span class="title function_">useEffect</span>(log.<span class="title function_">bind</span>(<span class="literal">null</span>, count), [<span class="number">1</span>, <span class="number">2</span>]); <span class="comment">//依赖1,2变化的作用，但是1,2是常数，本身不会变化，因此也只会执行1次；</span></span><br><span class="line">  <span class="title function_">useEffect</span>(log.<span class="title function_">bind</span>(<span class="literal">null</span>, count), [count]); <span class="comment">//依赖count变化的作用，则count一旦变化就会触发；</span></span><br><span class="line">  <span class="title function_">useEffect</span>(log.<span class="title function_">bind</span>(<span class="literal">null</span>, count)); <span class="comment">//依赖 变化 变化的作用，则这个function有任何状态发生变化就会触发；</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      your count : &#123;count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setCount(count + 1);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        Add</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>定时器：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(count); <span class="comment">//每秒输出一个0</span></span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;, []); <span class="comment">//整个effect只会执行一次；因此count只会保存第一次的count值；</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(count); <span class="comment">//输出当前值</span></span><br><span class="line">  &#125;, [count]);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">5</span>) &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;https://www.baidu.com&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [count]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      your count : &#123;count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setCount(count + 1);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        Add</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h6 id="React-Hooks-如何描述作用（Effect）"><a href="#React-Hooks-如何描述作用（Effect）" class="headerlink" title="React Hooks 如何描述作用（Effect）"></a>React Hooks 如何描述作用（Effect）</h6><ul>
<li>客观世界有 url、计时器、logger…我们做不到完美而纯净（pure functuinal）的视图渲染。</li>
<li>相同（或类似）的作用如何进行复用，React 团队提出了这个方案。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(someEffect)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">someEffect</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>深入定时器：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useInterval</span>(<span class="params">callback, time</span>) &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> I = <span class="built_in">setInterval</span>(callback, time);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(I);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []); <span class="comment">//构造一个定时器，这个构造只要产生一次就行了，所以它的依赖为空;</span></span><br><span class="line">  <span class="comment">// 方式1的时候使用的就是最初版本的callback，用了最初版本的count：0</span></span><br><span class="line">  <span class="comment">// 方式2的时候react会帮助我们取最新的count值</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方式1:</span></span><br><span class="line">  <span class="title function_">useInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(count); <span class="comment">//计时器在一直执行，但是值是没有变的。</span></span><br><span class="line">    <span class="title function_">setCount</span>(count + <span class="number">1</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方式2:</span></span><br><span class="line">  <span class="title function_">useInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setCount</span>(<span class="function">(<span class="params">count</span>) =&gt;</span> count + <span class="number">1</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      your count : &#123;count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setCount(count + 1);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        Add</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="3-上下文"><a href="#3-上下文" class="headerlink" title="3).上下文"></a>3).上下文</h5><h6 id="React-Hooks-解决方案"><a href="#React-Hooks-解决方案" class="headerlink" title="React Hooks 解决方案"></a>React Hooks 解决方案</h6><ul>
<li>UI 产生的过程中，能够从 context 中获取信息（知识）。</li>
<li>UI 更像一个人而不是机械的结构。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">UI</span> =&gt; <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; userType &#125; = <span class="title function_">useContext</span>(<span class="title class_">UserTypeContext</span>)</span><br><span class="line">    <span class="keyword">switch</span>(userType)&#123;</span><br><span class="line">        ...不同的渲染逻辑</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 useContext：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> themes = &#123;</span><br><span class="line">  <span class="attr">light</span>: &#123;</span><br><span class="line">    <span class="attr">foreground</span>: <span class="string">&quot;#000000&quot;</span>,</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&quot;#eeeeee&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">dark</span>: &#123;</span><br><span class="line">    <span class="attr">foreground</span>: <span class="string">&quot;#ffffff&quot;</span>,</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&quot;#222222&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ThemeContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>(&#123;</span><br><span class="line">  <span class="attr">theme</span>: themes.<span class="property">light</span>,</span><br><span class="line">  <span class="attr">toogle</span>: <span class="function">() =&gt;</span> &#123;&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [theme, setTheme] = <span class="title function_">useState</span>(themes.<span class="property">light</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeContext.Provider</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">value</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">theme</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">toogle:</span> () =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setTheme(theme === themes.light ? themes.dark : themes.light);</span></span><br><span class="line"><span class="language-xml">        &#125;,</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Toolbar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ThemeContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Toolbar</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeButton</span> /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ThemeButton</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> context = <span class="title function_">useContext</span>(<span class="title class_">ThemeContext</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">fontSize:</span> &quot;<span class="attr">32px</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">color:</span> <span class="attr">context.theme.foreground</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">backgroundColor:</span> <span class="attr">context.theme.background</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        context.toogle();</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      Click Me!</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="4-reducer"><a href="#4-reducer" class="headerlink" title="4).reducer"></a>4).reducer</h5><ul>
<li>（设计模式）提供一种抽象状态行为的通用封装（action），以及计算过程的抽象方案（reducer）</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(state, action);</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;add&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;sub&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">count</span>: state.<span class="property">count</span> - <span class="number">1</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [counter, dispatch] = <span class="title function_">useReducer</span>(reducer, &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      your counter is: &#123;counter.count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;add&quot; &#125;)&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;sub&quot; &#125;)&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-引用行为（reference）"><a href="#5-引用行为（reference）" class="headerlink" title="5).引用行为（reference）"></a>5).引用行为（reference）</h5><ul>
<li>引用 React 管理以外的对象</li>
<li>需要在 React 之外做一些事情：例如：focus、媒体对象操作等</li>
<li>通常搭配 useEffect</li>
<li>附带作用：方便地保存值</li>
</ul>
<p>useRef:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useRefExample</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> refInput = <span class="title function_">useRef</span>();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;refInput&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          refInput.current.focus();</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        Focus</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>保存值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useRefExample</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [counter, setCounter] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> prev = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>当前值：&#123;counter&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>前一个值：&#123;prev.current&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          prev.current = counter;</span></span><br><span class="line"><span class="language-xml">          setCounter((x) =&gt; x + 1);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        Click me to add</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          prev.current = counter;</span></span><br><span class="line"><span class="language-xml">          setCounter((x) =&gt; x - 1);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        Click me to sub</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="二、缓存"><a href="#二、缓存" class="headerlink" title="二、缓存"></a>二、缓存</h5><ul>
<li><p>为什么要缓存？</p>
</li>
<li><p>V &#x3D; f(state,props) useHooks…</p>
</li>
<li><p>想在 f 中 new Object();只创建一次</p>
</li>
<li><p>一些复杂的计算只有在状态改变后才做</p>
</li>
<li><p>缓存一个函数（useCallback）</p>
</li>
<li><p>缓存一个值（useMemo）</p>
</li>
</ul>
<p>缓存值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">UseMemoExample</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [counter, setCounter] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> memorizedText = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;run useMemo function,每点击10次才会+1&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`this is a memorized text <span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>`</span>;</span><br><span class="line">  &#125;, [<span class="title class_">Math</span>.<span class="title function_">floor</span>(counter / <span class="number">10</span>)]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;memorizedText&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>you clicked &#123;counter&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCounter(counter + 1)&#125;&gt;Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">UseMemoExample</span>;</span><br></pre></td></tr></table></figure>

<p>缓存函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useMemo, useCallback &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s1 = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line"><span class="keyword">const</span> s2 = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">UseMemoExample</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [counter, setCounter] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">addCount1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">setCounter</span>(counter + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  s1.<span class="title function_">add</span>(addCount1);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(s1.<span class="property">size</span>); <span class="comment">//累加</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> addCount2 = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setCounter</span>(counter + <span class="number">1</span>);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  s2.<span class="title function_">add</span>(addCount2);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(s2.<span class="property">size</span>); <span class="comment">//1</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>you clicked &#123;counter&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;addCount1&#125;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;addCount2&#125;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">UseMemoExample</span>;</span><br></pre></td></tr></table></figure>

<h5 id="三、使用建议"><a href="#三、使用建议" class="headerlink" title="三、使用建议"></a>三、使用建议</h5><h6 id="Tips1-使用-React-mome-减少重绘次数"><a href="#Tips1-使用-React-mome-减少重绘次数" class="headerlink" title="Tips1:使用 React.mome 减少重绘次数"></a>Tips1:使用 React.mome 减少重绘次数</h6><h6 id="Tips2-hooks-同步问题"><a href="#Tips2-hooks-同步问题" class="headerlink" title="Tips2:hooks 同步问题"></a>Tips2:hooks 同步问题</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">myEffect</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> i = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(count); <span class="comment">//count一直为0</span></span><br><span class="line">      <span class="title function_">setCount</span>(<span class="function">(<span class="params">count</span>) =&gt;</span> count + <span class="number">1</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(i);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// useEffect(myEffect, []);//效果的依赖为空，因此效果被使用了一次；每次进入这个大的Test函数，导致myEffect函数只有第一次生效【这个就是同步问题】，这个count是在第一个myEffect函数的闭包中被创建出来的，count拿的都是最早的count</span></span><br><span class="line">  <span class="title function_">useEffect</span>(myEffect, [count]); <span class="comment">//确保每一次的count都是最新的，但这样会导致每次都需要执行setInterval，会创建很多个setInterval；因此需要进行回收；此时这个setInterval就相当于setTimeout；</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h6 id="Tips3-可以创造自己的-hooks-封装行为"><a href="#Tips3-可以创造自己的-hooks-封装行为" class="headerlink" title="Tips3:可以创造自己的 hooks 封装行为"></a>Tips3:可以创造自己的 hooks 封装行为</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sleep</span>(<span class="params">time</span>) &#123;</span><br><span class="line">  <span class="comment">//3</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;, time);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getPerson</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//1</span></span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">200</span>); <span class="comment">//2</span></span><br><span class="line">  <span class="keyword">return</span> [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>]; <span class="comment">//4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">usePerson</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [list, setList] = <span class="title function_">useState</span>(<span class="literal">null</span>); <span class="comment">//8</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">request</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//6</span></span><br><span class="line">    <span class="keyword">const</span> list = <span class="keyword">await</span> <span class="title function_">getPerson</span>(); <span class="comment">//7</span></span><br><span class="line">    <span class="title function_">setList</span>(list); <span class="comment">//9</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(request, []); <span class="comment">//5</span></span><br><span class="line">  <span class="keyword">return</span> list; <span class="comment">//10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> list = <span class="title function_">usePerson</span>(); <span class="comment">//11</span></span><br><span class="line">  <span class="keyword">if</span> (list === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">//12</span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loding...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;list.map((name, i) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h6 id="Tips4-每种行为一个-Hook"><a href="#Tips4-每种行为一个-Hook" class="headerlink" title="Tips4:每种行为一个 Hook"></a>Tips4:每种行为一个 Hook</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 这种是一个概念下的东西，所以可以进行一个hooks的整体使用，但是建议进行封装</span></span><br><span class="line">  <span class="keyword">const</span> [personList, setPersonList] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">isError</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">loading</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">data</span>: [],</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这是不同概念下的东西，不建议在一个hooks中进行整体使用，应当拆分成多个hooks进行调用</span></span><br><span class="line">  <span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">company</span>: <span class="string">&quot;Apple&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;state.count&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;state.company&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setState((prev) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">            return &#123;</span></span><br><span class="line"><span class="language-xml">              company: prev.company,</span></span><br><span class="line"><span class="language-xml">              count: prev.count + 1,</span></span><br><span class="line"><span class="language-xml">            &#125;;</span></span><br><span class="line"><span class="language-xml">          &#125;);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        btn</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h6 id="Tips5-不要再思考生命周期"><a href="#Tips5-不要再思考生命周期" class="headerlink" title="Tips5:不要再思考生命周期"></a>Tips5:不要再思考生命周期</h6><h5 id="四、拖拽列表实战"><a href="#四、拖拽列表实战" class="headerlink" title="四、拖拽列表实战"></a>四、拖拽列表实战</h5><p>App.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./styles.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> useDraggable <span class="keyword">from</span> <span class="string">&quot;./useDraggable&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> list = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">src</span>: <span class="string">&quot;https://www.daykalif.com/blog_img/vuex.jpg&quot;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;万事屋找我&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;吃吃吃……&quot;</span>,</span><br><span class="line">    <span class="attr">src</span>: <span class="string">&quot;https://www.daykalif.com/blog_img/promise1.png&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;汪汪&quot;</span>,</span><br><span class="line">    <span class="attr">src</span>: <span class="string">&quot;https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=968093909,4033932240&amp;fm=26&amp;gp=0.jpg&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cls</span>(<span class="params">def, ...conditions</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> list = [def];</span><br><span class="line">  conditions.<span class="title function_">forEach</span>(<span class="function">(<span class="params">cond</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (cond[<span class="number">0</span>]) &#123;</span><br><span class="line">      list.<span class="title function_">push</span>(cond[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> list.<span class="title function_">join</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">DraggableList</span> <span class="attr">list</span>=<span class="string">&#123;list&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">DraggableList</span>(<span class="params">&#123; list &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; dragList, createDraggerProps, createDropperProps &#125; =</span><br><span class="line">    <span class="title function_">useDraggable</span>(list);</span><br><span class="line">  <span class="keyword">return</span> dragList.<span class="title function_">map</span>(<span class="function">(<span class="params">item, i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (item.<span class="property">type</span> === <span class="string">&quot;BAR&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Bar</span> <span class="attr">id</span>=<span class="string">&#123;i&#125;</span> &#123;<span class="attr">...createDropperProps</span>(<span class="attr">i</span>)&#125; <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> /&gt;</span></span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Draggable</span> &#123;<span class="attr">...createDraggerProps</span>(<span class="attr">i</span>, <span class="attr">item.id</span>)&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Card</span> &#123;<span class="attr">...item.data</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Draggable</span>&gt;</span></span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//List</span></span><br><span class="line"><span class="comment">// Draggable</span></span><br><span class="line"><span class="comment">// Bar</span></span><br><span class="line"><span class="comment">// Draggable</span></span><br><span class="line"><span class="comment">// Bar</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Draggable</span>(<span class="params">&#123; children, eventHandlers, dragging, id &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#123;<span class="attr">...eventHandlers</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">draggable</span>=<span class="string">&#123;true&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">className</span>=<span class="string">&#123;cls(</span>&quot;<span class="attr">draggable</span>&quot;, [<span class="attr">dragging</span> === <span class="string">id,</span> &quot;<span class="attr">dragging</span>&quot;])&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Bar</span>(<span class="params">&#123; id, dragging, dragOver, eventHandlers &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (id === dragging + <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#123;<span class="attr">...eventHandlers</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">className</span>=<span class="string">&#123;cls(</span>&quot;<span class="attr">draggable--bar</span>&quot;, [<span class="attr">dragOver</span> === <span class="string">id,</span> &quot;<span class="attr">dragover</span>&quot;])&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">className</span>=<span class="string">&quot;inner&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">height:</span> <span class="attr">id</span> === <span class="string">dragOver</span> ? &quot;<span class="attr">80px</span>&quot; <span class="attr">:</span> &quot;<span class="attr">0px</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Card</span>(<span class="params">&#123; src, title &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;src&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>useDraggable.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DRAGGABLE</span> = <span class="string">&quot;DRAGGABLE&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">BAR</span> = <span class="string">&quot;BAR&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">draggable</span>(<span class="params">item, id</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="variable constant_">DRAGGABLE</span>,</span><br><span class="line">    id,</span><br><span class="line">    <span class="attr">data</span>: item,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">insertBars</span>(<span class="params">list</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">0</span>; <span class="comment">// ID</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">newBar</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">BAR</span>,</span><br><span class="line">      <span class="attr">id</span>: i++,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// |A|B|C|</span></span><br><span class="line">  <span class="keyword">return</span> [<span class="title function_">newBar</span>()].<span class="title function_">concat</span>(</span><br><span class="line">    ...list.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> [<span class="title function_">draggable</span>(item, i++), <span class="title function_">newBar</span>()];</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clacChanging</span>(<span class="params">list, drag, drop</span>) &#123;</span><br><span class="line">  list = list.<span class="title function_">slice</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> dragItem = list[drag];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// dir &gt; 0从下往上 &lt;0 从上往下</span></span><br><span class="line">  <span class="keyword">const</span> dir = drag &gt; drop ? -<span class="number">2</span> : <span class="number">2</span>;</span><br><span class="line">  <span class="comment">// drop的地方是bar</span></span><br><span class="line">  <span class="keyword">const</span> end = dir &gt; <span class="number">0</span> ? drop - <span class="number">1</span> : drop + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = drag; i != end; i += dir) &#123;</span><br><span class="line">    list[i] = list[i + dir];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  list[end] = dragItem;</span><br><span class="line">  <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useDraggable</span>(<span class="params">list</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [dragList, setDragList] = <span class="title function_">useState</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">insertBars</span>(list);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> [dragOver, setDragOver] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [dragging, setDragging] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    dragList,</span><br><span class="line">    <span class="attr">createDropperProps</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        dragging,</span><br><span class="line">        dragOver,</span><br><span class="line">        <span class="attr">eventHandlers</span>: &#123;</span><br><span class="line">          <span class="attr">onDragOver</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">            e.<span class="title function_">preventDefault</span>();</span><br><span class="line">            <span class="title function_">setDragOver</span>(id);</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">onDragLeave</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">            e.<span class="title function_">preventDefault</span>();</span><br><span class="line">            <span class="title function_">setDragOver</span>(<span class="literal">null</span>);</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">onDrop</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">            e.<span class="title function_">preventDefault</span>();</span><br><span class="line">            <span class="title function_">setDragOver</span>(<span class="literal">null</span>);</span><br><span class="line">            <span class="title function_">setDragList</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="title function_">clacChanging</span>(list, dragging, id);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">createDraggerProps</span>: <span class="function">(<span class="params">id, key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        id,</span><br><span class="line">        key,</span><br><span class="line">        dragging,</span><br><span class="line">        <span class="attr">eventHandlers</span>: &#123;</span><br><span class="line">          <span class="attr">onDragStart</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">setDragging</span>(id);</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">onDragEnd</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">setDragging</span>(<span class="literal">null</span>);</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> serviceWorker <span class="keyword">from</span> <span class="string">&quot;./serviceWorker&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// If you want your app to work offline and load faster, you can change</span></span><br><span class="line"><span class="comment">// unregister() to register() below. Note this comes with some pitfalls.</span></span><br><span class="line"><span class="comment">// Learn more about service workers: https://bit.ly/CRA-PWA</span></span><br><span class="line">serviceWorker.<span class="title function_">unregister</span>();</span><br></pre></td></tr></table></figure>

<p>styles.css</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.App</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: sans-serif;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.draggable--bar</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: background-color <span class="number">1s</span> ease-out;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.draggable--bar</span><span class="selector-class">.dragover</span> <span class="selector-class">.inner</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: height <span class="number">0.3s</span> ease;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: grey <span class="number">1px</span> <span class="number">2px</span> <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  user-select: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">36px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">72px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">72px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.draggable</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: white;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.3s</span> ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.draggable</span><span class="selector-class">.dragging</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>学习一下 Haskell type class</p>
</blockquote>
<p>参考视频：<br><a href="https://www.bilibili.com/video/BV1Ge411W7Ra">https://www.bilibili.com/video/BV1Ge411W7Ra</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2021/02/28/JS/this%E6%8C%87%E5%90%91%E4%B8%93%E9%A2%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%E5%B0%B1%E5%A4%9F%E4%BA%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/28/JS/this%E6%8C%87%E5%90%91%E4%B8%93%E9%A2%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%E5%B0%B1%E5%A4%9F%E4%BA%86/" itemprop="url">this指向专题-看这篇文章就够了</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-02-28T19:34:02+08:00">
                2021-02-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/02/28/JS/this%E6%8C%87%E5%90%91%E4%B8%93%E9%A2%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%E5%B0%B1%E5%A4%9F%E4%BA%86/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2021/02/28/JS/this%E6%8C%87%E5%90%91%E4%B8%93%E9%A2%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%E5%B0%B1%E5%A4%9F%E4%BA%86/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2021/02/28/JS/this%E6%8C%87%E5%90%91%E4%B8%93%E9%A2%98-%E7%9C%8B%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%E5%B0%B1%E5%A4%9F%E4%BA%86/" class="leancloud_visitors" data-flag-title="this指向专题-看这篇文章就够了">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  1.2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  5
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="this-指向专题"><a href="#this-指向专题" class="headerlink" title="this 指向专题"></a>this 指向专题</h4><p>函数里面 this 的值，在执行时才知道。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一、函数中的this：</span></span><br><span class="line"><span class="comment">// 纯粹函数调用。</span></span><br><span class="line"><span class="comment">// 函数中的this表示的是window对象，无论函数中嵌套多少层，内部函数的this同样也指的window对象</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>); <span class="comment">//window</span></span><br><span class="line">  <span class="keyword">var</span> ff = <span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, <span class="number">1</span>); <span class="comment">//window</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, <span class="number">2</span>); <span class="comment">//window</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">fn2</span>();</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">ff</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>();</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">x</span> = <span class="number">1</span>;</span><br><span class="line">  <span class="title function_">alert</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">test</span>(); <span class="comment">//其实这里的this就是全局变量。看下面的例子就能很好的理解其实this就是全局对象Global。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 二、构造函数中的this：</span></span><br><span class="line"><span class="comment">// 作为构造函数调用。所谓构造函数，就是生成一个新的对象。这时，这个this就是指这个对象</span></span><br><span class="line"><span class="comment">// 在构造函数中，this对象表示的是该构造函数创建的实例对象。</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;window name&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;constructor&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> thisFn = <span class="keyword">new</span> <span class="title class_">Fn</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(thisFn.<span class="property">name</span>); <span class="comment">//&#x27;constructor&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">x</span> = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> o = <span class="keyword">new</span> <span class="title function_">test</span>();</span><br><span class="line"><span class="title function_">alert</span>(o.<span class="property">x</span>); <span class="comment">//1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 三、匿名函数中的this：</span></span><br><span class="line"><span class="comment">// 匿名函数的执行环境是全局作用域，所以其this对象指向的是window对象</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;window name&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;constructor&quot;</span>; <span class="comment">//会修改window.name的值为&#x27;constructor&#x27;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>); <span class="comment">//输出window.name --&gt;  &#x27;constructor&#x27;</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Fn</span>()();</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 四、对象中的this</span></span><br><span class="line">在对象方法中，<span class="variable language_">this</span>的值就是该方法所在对象，此时<span class="variable language_">this</span>可以访问到该方法所在对象下的任意属性</span><br><span class="line">当然如果该对象的方法赋值给一个变量，然后通过变量调用，那么这个时候的<span class="variable language_">this</span>就不是该对象了。</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;window name&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> objThis = &#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&#x27;objThis name&#x27;</span>,</span><br><span class="line">    <span class="attr">sayName</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 通过对象调用</span></span><br><span class="line">objThis.<span class="title function_">sayName</span>();<span class="comment">//log:&#x27;objThis name&#x27;,objThis对象</span></span><br><span class="line"><span class="comment">// 将方法赋值给变量，再调用</span></span><br><span class="line"><span class="keyword">const</span> fn = objThis.<span class="property">sayName</span></span><br><span class="line"><span class="title function_">fn</span>()<span class="comment">//log:&#x27;window name&#x27;,window</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 五、在html元素事件属性中使用</span></span><br><span class="line">&lt;input type=”button” onclick=”<span class="title function_">showInfo</span>(<span class="variable language_">this</span>);” value=”点击一下”/&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 六、回调函数中的this</span></span><br><span class="line"><span class="comment">// 1).dom事件中的this</span></span><br><span class="line"><span class="comment">// 在事件中使用this，它表示的是这个事件绑定的那个元素的DOM</span></span><br><span class="line">&lt;div id=<span class="string">&quot;box&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;this-box&quot;</span>&gt;这是事件dom&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;box&quot;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)<span class="comment">//指向这个div节点</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span> <span class="attr">class</span>=<span class="string">&quot;this-box&quot;</span>&gt;</span>这是事件dom<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;box&quot;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)<span class="comment">//指向window</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">input type=<span class="string">&quot;button&quot;</span> id=<span class="string">&quot;text&quot;</span> value=<span class="string">&quot;点击一下&quot;</span> /&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;text&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    btn.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">value</span>);    <span class="comment">//此处的this是按钮元素</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2).jquery事件中的this：</span></span><br><span class="line"><span class="comment">// 此处的this表示，dom对象</span></span><br><span class="line">$(<span class="string">&#x27;.item&#x27;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);<span class="comment">//点击的dom对象</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//3).普通函数的this</span></span><br><span class="line">此处的<span class="variable language_">this</span>与调用回到的执行环境有关，一般为<span class="variable language_">window</span></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">arr.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">item,index</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)<span class="comment">//window</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 七、apply与call中的this</span></span><br><span class="line"><span class="comment">// apply()和call()方法都有改变this的指向，扩充函数执行作用域的功能，这两个方法中的this可以被指定引用到任何对象.this指向的是apply中的第一个参数。</span></span><br><span class="line"><span class="keyword">var</span> changeObj = &#123;</span><br><span class="line">    name;<span class="string">&#x27;changeObj nmae&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sayName</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> ask1 = sayName.<span class="title function_">apply</span>(changeObj);</span><br><span class="line"><span class="keyword">var</span> ask2 = sayName.<span class="title function_">call</span>(changeObj);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;apply&quot;</span>,ask1);<span class="comment">//changeObj nmae</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;call&quot;</span>,ask2);<span class="comment">//changeObj nmae</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 八、箭头函数中的this</span></span><br><span class="line"><span class="comment">// 箭头函数本身是没有this的，它的this是来自其外层代码块中的this，无论箭头函数嵌套多少层，也只有一个this的存在，</span></span><br><span class="line"><span class="comment">// 这个this就是它们外层代码块中的this。在ES5中的this对象指的是其执行环境对象，而箭头函数的this对象不是，它指的是其定义时所在的对象，而非执行时所在的对象，因此它的this是固定不可变的。</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">name</span>: <span class="string">&quot;fn name&quot;</span> &#125;;</span><br><span class="line"><span class="comment">// 箭头函数情况</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;window name&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = fn.<span class="title function_">call</span>(obj);</span><br><span class="line"><span class="title function_">a</span>(); <span class="comment">//fn name</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通函数情况</span></span><br><span class="line"><span class="keyword">var</span> name2 = <span class="string">&quot;window name&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a2 = fn2.<span class="title function_">call</span>(obj);</span><br><span class="line"><span class="title function_">a2</span>(); <span class="comment">//window name</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 九、严格模式下函数的this</span></span><br><span class="line">严格模式下函数的<span class="variable language_">this</span>是未定义的，因此调用<span class="variable language_">this</span>对象的时候会报未定义，因此如果直接执行函数，会报错</span><br><span class="line">把函数当作构造函数来用，则不会报错</span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&#x27;li&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="title function_">fn</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj)<span class="comment">//正常执行</span></span><br><span class="line"><span class="title function_">fn</span>()<span class="comment">//报错 Uncaught TypeError: Cannot set property &#x27;name&#x27; of undefined</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2021/02/19/React/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E8%AF%A6%E8%A7%A3react-hooks%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%90%AB%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/19/React/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E8%AF%A6%E8%A7%A3react-hooks%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%90%AB%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/" itemprop="url">详解react hooks面试题(含高阶组件)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-02-19T14:10:22+08:00">
                2021-02-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/02/19/React/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E8%AF%A6%E8%A7%A3react-hooks%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%90%AB%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2021/02/19/React/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E8%AF%A6%E8%A7%A3react-hooks%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%90%AB%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2021/02/19/React/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E8%AF%A6%E8%A7%A3react-hooks%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%90%AB%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/" class="leancloud_visitors" data-flag-title="详解react hooks面试题(含高阶组件)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  4.2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  17
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="为什么使用-Hooks？"><a href="#为什么使用-Hooks？" class="headerlink" title="为什么使用 Hooks？"></a>为什么使用 Hooks？</h4><p>1.React Hooks 就是让你不必写 class 组件就可以用 state 和其他的 React 特性； 2.你也可以编写自己的 hooks 在不同的组件之间复用； 3.由于业务变动，函数组件不得不改为类组件等等。</p>
<h5 id="React-hooks-优势"><a href="#React-hooks-优势" class="headerlink" title="React hooks 优势"></a>React hooks 优势</h5><p>1.没有破坏性改动<br>完全可选的。 你无需重写任何已有代码就可以在一些组件中尝试 Hook。<br>100% 向后兼容的。 Hook 不包含任何破坏性改动。 2.更容易复用代码:它通过自定义 hooks 来复用状态，从而解决了类组件有些时候难以复用逻辑的问题 3.函数式编程风格:函数式组件、状态保存在运行环境、每个功能都包裹在函数中，整体风格更清爽，更优雅 4.代码量更少 5.更容易拆分组件</p>
<h5 id="React-hooks-缺点"><a href="#React-hooks-缺点" class="headerlink" title="React hooks 缺点"></a>React hooks 缺点</h5><p>hooks 是 React 16.8 的新增特性、以前版本的就别想了 1.部分代码从主动式变成响应式 2.状态不同步:函数的运行是独立的，每个函数都有一份独立的作用域。当我们处理复杂逻辑的时候，经常会碰到“引用不是最新”的问题</p>
<h4 id="一-面试中出现的关于-hooks-的题目"><a href="#一-面试中出现的关于-hooks-的题目" class="headerlink" title="一. 面试中出现的关于 hooks 的题目"></a>一. 面试中出现的关于 hooks 的题目</h4><h5 id="1-简单介绍下什么是-hooks，hooks-产生的背景？hooks-的优点？"><a href="#1-简单介绍下什么是-hooks，hooks-产生的背景？hooks-的优点？" class="headerlink" title="1.简单介绍下什么是 hooks，hooks 产生的背景？hooks 的优点？"></a>1.简单介绍下什么是 hooks，hooks 产生的背景？hooks 的优点？</h5><p>hooks 是针对在使用 react 时存在以下问题而产生的：</p>
<ul>
<li>组件之间复用状态逻辑很难，在 hooks 之前，实现组件复用，一般采用高阶组件和 Render Props，它们本质是将复用逻辑提升到父组件中，很容易产生很多包装组件，带来嵌套地域。</li>
<li>组件逻辑变得越来越复杂，尤其是生命周期函数中常常包含一些不相关的逻辑，完全不相关的代码却在同一个方法中组合在一起。如此很容易产生 bug，并且导致逻辑不一致。</li>
<li>复杂的 class 组件，使用 class 组件，需要理解 JavaScript 中 this 的工作方式，不能忘记绑定事件处理器等操作，代码复杂且冗余。除此之外，class 组件也会让一些 react 优化措施失效。</li>
</ul>
<p>针对上面提到的问题，react 团队研发了 hooks，它主要有两方面作用：</p>
<ul>
<li>用于在函数组件中引入状态管理和生命周期方法</li>
<li>取代高阶组件和 render props 来实现抽象和可重用性</li>
</ul>
<p>优点也很明显：</p>
<ul>
<li>避免在被广泛使用的函数组件在后期迭代过程中，需要承担一些副作用，而必须重构成类组件，它帮助函数组件引入状态管理和生命周期方法。</li>
<li>Hooks 出现之后，我们将复用逻辑提取到组件顶层，而不是强行提升到父组件中。这样就能够避免 HOC 和 Render Props 带来的「嵌套地域」</li>
<li>避免上面陈述的 class 组件带来的那些问题</li>
</ul>
<h5 id="2-知道-hoc-和-render-props-吗，它们有什么作用？有什么弊端？"><a href="#2-知道-hoc-和-render-props-吗，它们有什么作用？有什么弊端？" class="headerlink" title="2.知道 hoc 和 render props 吗，它们有什么作用？有什么弊端？"></a>2.知道 hoc 和 render props 吗，它们有什么作用？有什么弊端？</h5><p>Render Props 组件和高阶组件主要用来实现抽象和可重用性。<br>弊端就是高阶组件和 Render Props 本质上都是将复用逻辑提升到父组件中，很容易产生很多包装组件，带来的「嵌套地域」。由于所有抽象逻辑都被其他 React 组件所隐藏，应用变成了一棵没有可读性的组件树。而那些可见的组件也很难在浏览器的 DOM 中进行跟踪。</p>
<h6 id="2-1-Render-Props"><a href="#2-1-Render-Props" class="headerlink" title="2.1 Render Props"></a>2.1 Render Props</h6><blockquote>
<p>什么是 Render Props？</p>
</blockquote>
<p>render props 模式是一种非常灵活复用性非常高的模式，它可以把特定行为或功能封装成一个组件，提供给其他组件使用让其他组件拥有这样的能力。他把组件可以动态渲染的地方暴露给外部，你不用再关注组件的内部实现，只要把数据通过函数传出去就好。</p>
<p><strong>使用场景：</strong></p>
<ul>
<li>通用业务逻辑的抽取</li>
<li>当两个平级组件之间需要单向依赖的时候，比如两个同级组件 A、B，A 组件需要跟随 B 组件的内部状态来改变自己的内部状态，我们就说 A 依赖 B；或者 B 依赖 A</li>
</ul>
<p>render props demo 参考:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    Mouse组件提供“可变数据源”：鼠标位置不断变化 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据源可变基础组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mouse</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">handleMouseMove</span> = <span class="variable language_">this</span>.<span class="property">handleMouseMove</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123; <span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">handleMouseMove</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">x</span>: event.<span class="property">clientX</span>,</span><br><span class="line">      <span class="attr">y</span>: event.<span class="property">clientY</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">height:</span> &quot;<span class="attr">100</span>%&quot; &#125;&#125; <span class="attr">onMouseMove</span>=<span class="string">&#123;this.handleMouseMove&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          The current mouse position is (&#123;this.state.x&#125;, &#123;this.state.y&#125;)</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;this.props.render(this.state)&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UI 组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> mouse = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">mouse</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">src</span>=<span class="string">&quot;https://dimg04.c-ctrip.com/images/300d0f0000007du6f6DC5_C_230_320.jpg&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">position:</span> &quot;<span class="attr">absolute</span>&quot;, <span class="attr">left:</span> <span class="attr">mouse.x</span>, <span class="attr">top:</span> <span class="attr">mouse.y</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在通用的基础数据源组件里面使用UI组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MouseTracker</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Move the mouse around!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Mouse</span> <span class="attr">render</span>=<span class="string">&#123;(mouse)</span> =&gt;</span> <span class="tag">&lt;<span class="name">Cat</span> <span class="attr">mouse</span>=<span class="string">&#123;mouse&#125;</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="2-2-Hoc"><a href="#2-2-Hoc" class="headerlink" title="2.2 Hoc"></a>2.2 Hoc</h6><p>hoc 的应用 demo:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 高阶组件的应用</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">preMountHoc</span> = doSomething =&gt; <span class="function"><span class="params">ContentComponent</span> =&gt;</span> <span class="keyword">class</span> <span class="title class_">PreMountComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">            <span class="attr">loading</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">result</span>: &#123;&#125;,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> doList = <span class="title function_">get</span>(doSomething, <span class="string">&#x27;doList&#x27;</span>, []);</span><br><span class="line">        <span class="keyword">const</span> doListLength = <span class="title function_">get</span>(doList, <span class="string">&#x27;length&#x27;</span>) || <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">const</span> keyList = <span class="title function_">get</span>(doSomething, <span class="string">&#x27;keyList&#x27;</span>, []);</span><br><span class="line">        <span class="keyword">const</span> keyListLength = <span class="title function_">get</span>(keyList, <span class="string">&#x27;length&#x27;</span>) || <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (doListLength == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">loading</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Promise</span>.<span class="title function_">all</span>(doList).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> result = &#123;&#125;;</span><br><span class="line">            <span class="keyword">if</span> (doListLength == keyListLength) &#123;</span><br><span class="line">                keyList.<span class="title function_">forEach</span>(<span class="function">(<span class="params">el, index</span>) =&gt;</span> &#123;</span><br><span class="line">                    result[el] = res[index];</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                doList.<span class="title function_">forEach</span>(<span class="function">(<span class="params">el, index</span>) =&gt;</span> &#123;</span><br><span class="line">                    result[<span class="string">`pre_<span class="subst">$&#123;index&#125;</span>`</span>] = res[index];</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; result, <span class="attr">loading</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; loading, result &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">        <span class="keyword">if</span> (loading) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">BlockLoading</span> <span class="attr">loading</span> /&gt;</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">ContentComponent</span> &#123;<span class="attr">...result</span>&#125; &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> preMountHoc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实际应用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ScrmList</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">preMountHoc</span>(&#123;</span><br><span class="line">    <span class="attr">doList</span>: [settingApi.<span class="title function_">getPower</span>(), settingApi.<span class="title function_">hasMemberThreshold</span>()],</span><br><span class="line">    <span class="attr">keyList</span>: [<span class="string">&#x27;memberStoreSetting&#x27;</span>, <span class="string">&#x27;scrmConditionType&#x27;</span>],</span><br><span class="line">&#125;)(<span class="title class_">ScrmList</span>)</span><br></pre></td></tr></table></figure>

<p>hoc 是 React 中用于重用组件逻辑的高级技术，它是一个函数，能够接受一个组件并返回一个新的组件。<br>实现高阶组件的两种方式：</p>
<ul>
<li>属性代理。高阶组件通过包裹的 React 组件来操作 props</li>
<li>反向继承。高阶组件继承于被包裹的 React 组件</li>
</ul>
<p><strong>2.2.1 属性代理</strong><br>a. 什么是属性代理<br>属性代理组件继承自 React.Component，通过传递给被包装的组件 props 得名</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 属性代理，把高阶组件接收到的属性传递给传进来的组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">HOC</span>(<span class="params">WrappedComponent</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">PP</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>b. 属性代理的用途</p>
<ul>
<li>更改 props，可以对传递的包裹组件的 WrappedComponent 的 props 进行控制</li>
<li>通过 refs 获取组件实例</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">可以通过 ref 获取关键词 this（WrappedComponent 的实例）</span></span><br><span class="line"><span class="comment">当 WrappedComponent 被渲染后，ref 上的回调函数 proc 将会执行，此时就有了这个 WrappedComponent 的实例的引用</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">refsHOC</span>(<span class="params">WrappedComponent</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">RefsHOC</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">proc</span>(<span class="params">wrappedComponentInstance</span>) &#123;</span><br><span class="line">      wrappedComponentInstance.<span class="title function_">method</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> props = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, <span class="variable language_">this</span>.<span class="property">props</span>, &#123;</span><br><span class="line">        <span class="attr">ref</span>: <span class="variable language_">this</span>.<span class="property">proc</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>),</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>把 WrappedComponent 与其它 elements 包装在一起</li>
</ul>
<p><strong>2.1.2 反向继承</strong><br>反向继承是继承自传递过来的组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">iiHOC</span>(<span class="params">WrappedComponent</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">Enhancer</span> <span class="keyword">extends</span> <span class="title class_ inherited__">WrappedComponent</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">super</span>.<span class="title function_">render</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反向继承允许高阶组件通过 this 关键词获取 WrappedComponent，意味着它可以获取到 state，props，组件生命周期（component lifecycle）钩子，以及渲染方法（render），所以我们主要用它来做渲染劫持，比如在渲染方法中读取或更改 React Elements tree，或者有条件的渲染等。<br><strong>2.1.3 高阶组件相关的面试题</strong></p>
<ol>
<li><p>这怎么在高阶组件里面访问组件实例<br>答案见上面</p>
</li>
<li><p>你的项目中怎么使用的高阶组件<br>a. 项目中经常存在在配置系统中配置开关&#x2F;全局常量，然后在页面需要请求配置来做控制，如果在每个需要调用全局设置的地方都去请求一下接口，就会有一种不优雅的感觉，这个时候我就想到利用高阶组件抽象一下。<br>b. 项目开发过程中，经常也会遇到需要对当前页面的一些事件的默认执行做阻止，我们也可以写一个高阶组件等。</p>
</li>
</ol>
<h5 id="3-hooks-和-hoc-和-render-props-有什么不同？"><a href="#3-hooks-和-hoc-和-render-props-有什么不同？" class="headerlink" title="3. hooks 和 hoc 和 render props 有什么不同？"></a>3. hooks 和 hoc 和 render props 有什么不同？</h5><p>它们之间最大的不同在于，后两者仅仅是一种开发模式，而自定义的 hooks 是 react 提供的 API 模式，它既能更加自然的融入到 react 的渲染过程也更加符合 react 的函数编程理念。</p>
<h5 id="4-介绍下常用的-hooks？"><a href="#4-介绍下常用的-hooks？" class="headerlink" title="4. 介绍下常用的 hooks？"></a>4. 介绍下常用的 hooks？</h5><ul>
<li>useState()，状态钩子。为函数组建提供内部状态</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 我们实现一个简易版的useState</span></span><br><span class="line"><span class="keyword">let</span> memoizedStates = []; <span class="comment">// 多个useState 时需要使用数组来存</span></span><br><span class="line"><span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useState</span>(<span class="params">initialState</span>) &#123;</span><br><span class="line">  memoizedStates[index] = memoizedStates[index] || initialState;</span><br><span class="line">  <span class="keyword">let</span> currentIndex = index;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">setState</span>(<span class="params">newState</span>) &#123;</span><br><span class="line">    memoizedStates[currentIndex] = newState;</span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [memoizedStates[index++], setState];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>useContext()，共享钩子。该钩子的作用是，在组件之间共享状态。 可以解决 react 逐层通过 Porps 传递数据，它接受 React.createContext()的返回结果作为参数，使用 useContext 将不再需要 Provider 和 Consumer。</li>
<li>useReducer()，Action 钩子。useReducer() 提供了状态管理，其基本原理是通过用户在页面中发起 action, 从而通过 reducer 方法来改变 state, 从而实现页面和状态的通信。使用很像 redux</li>
<li>useEffect()，副作用钩子。它接收两个参数， 第一个是进行的异步操作， 第二个是数组，用来给出 Effect 的依赖项</li>
<li>useRef()，获取组件的实例；渲染周期之间共享数据的存储(state 不能存储跨渲染周期的数据，因为 state 的保存会触发组件重渲染）.useRef 传入一个参数 initValue，并创建一个对象{ current: initValue }给函数组件使用，在整个生命周期中该对象保持不变。</li>
<li>useMemo 和 useCallback：可缓存函数的引用或值，useMemo 用在计算值的缓存，注意不用滥用。经常用在下面两种场景（要保持引用相等；对于组件内部用到的 object、array、函数等，如果用在了其他 Hook 的依赖数组中，或者作为 props 传递给了下游组件，应该使用 useMemo&#x2F;useCallback）</li>
<li>useLayoutEffect：会在所有的 DOM 变更之后同步调用 effect，可以使用它来读取 DOM 布局并同步触发重渲染</li>
</ul>
<h5 id="5-描述下-hooks-下怎么模拟生命周期函数，模拟的生命周期和-class-中的生命周期有什么区别吗？"><a href="#5-描述下-hooks-下怎么模拟生命周期函数，模拟的生命周期和-class-中的生命周期有什么区别吗？" class="headerlink" title="5. 描述下 hooks 下怎么模拟生命周期函数，模拟的生命周期和 class 中的生命周期有什么区别吗？"></a>5. 描述下 hooks 下怎么模拟生命周期函数，模拟的生命周期和 class 中的生命周期有什么区别吗？</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// componentDidMount，必须加[],不然会默认每次渲染都执行</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="comment">// componentDidUpdate</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">title</span> = <span class="string">`You clicked <span class="subst">$&#123;count&#125;</span> times`</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 以及 componentWillUnmount 执行的内容</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, [count]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  shouldComponentUpdate, 只有 Parent 组件中的 count state 更新了，Child 才会重新渲染，否则不会。</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> child = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Child</span> <span class="attr">count</span>=<span class="string">&#123;count&#125;</span> /&gt;</span></span>, [count]);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;count&#125;<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Count:&#123;props.count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里有一个点需要注意，就是默认的 useEffect（不带[]）中 return 的清理函数，它和 componentWillUnmount 有本质区别的，默认情况下 return，在每次 useEffect 执行前都会执行，并不是只有组件卸载的时候执行。<br>useEffect 在副作用结束之后，会延迟一段时间执行，并非同步执行，和 compontDidMount 有本质区别。遇到 dom 操作，最好使用 useLayoutEffect。</p>
<h5 id="6-hooks-中的坑，以及为什么？"><a href="#6-hooks-中的坑，以及为什么？" class="headerlink" title="6. hooks 中的坑，以及为什么？"></a>6. hooks 中的坑，以及为什么？</h5><ul>
<li>不要在循环，条件或嵌套函数中调用 Hook，必须始终在 React 函数的顶层使用 Hook。这是因为 React 需要利用调用顺序来正确更新相应的状态，以及调用相应的钩子函数。一旦在循环或条件分支语句中调用 Hook，就容易导致调用顺序的不一致性，从而产生难以预料到的后果。<br><a href="https://codepen.io/kellywang/pen/GRjvbEQ">useState 实现原理</a></li>
<li>使用 useState 时候，使用 push，pop，splice 等直接更改数组对象的坑，demo 中使用 push 直接更改数组无法获取到新值，应该采用析构方式，但是在 class 里面不会有这个问题。(这个的原因是 push，pop，splice 是直接修改原数组，react 会认为 state 并没有发生变化，无法更新)<br>这里的坑很多的，经常出现的就是每次修改数组的时候：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [firstData, setFirstData]: any = <span class="title function_">useState</span>([]);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleFirstAdd</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// let temp = firstData // 不要这么写，直接修改原数组相当于没有更新</span></span><br><span class="line">  <span class="keyword">let</span> temp = [...firstData]; <span class="comment">// 必须这么写，多层数组也要这么写</span></span><br><span class="line">  temp.<span class="title function_">push</span>(&#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">setFirstData</span>(temp);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Indicatorfilter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> [num, setNums] = <span class="title function_">useState</span>([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">test</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 这里坑是直接采用push去更新num，setNums(num)是无法更新num的，必须使用num = [...num ,1]</span></span><br><span class="line">    num.<span class="title function_">push</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// num = [...num ,1]</span></span><br><span class="line">    <span class="title function_">setNums</span>(num);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;filter&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;test&#125;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;num.map((item, index) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Indicatorfilter</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&lt;any, any&gt; &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props: any</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">nums</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">test</span> = <span class="variable language_">this</span>.<span class="property">test</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// class采用同样的方式是没有问题的</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">nums</span>.<span class="title function_">push</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">nums</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">nums</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; nums &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;this.test&#125;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;nums.map((item: any, index: number) =&gt; (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          ))&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>useState 设置状态的时候，只有第一次生效，后期需要更新状态，必须通过 useEffect</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TableDeail是一个公共组件，在调用它的父组件里面，我们通过set改变columns的值，以为传递给TableDeail的columns是最新的值，所以tabColumn每次也是最新的值，但是实际tabColumn是最开始的值，不会随着columns的更新而更新</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">TableDeail</span> = (<span class="params">&#123; columns &#125;: TableData</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [tabColumn, setTabColumn] = <span class="title function_">useState</span>(columns);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确的做法是通过useEffect改变这个值</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">TableDeail</span> = (<span class="params">&#123; columns &#125;: TableData</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [tabColumn, setTabColumn] = <span class="title function_">useState</span>(columns);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setTabColumn</span>(columns);</span><br><span class="line">  &#125;, [columns]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>必包带来的坑，参考 demo 里面的 state 变量<br>因为每次 render 都有一份新的状态，因此上述代码中的 setTimeout 使用产生了一个闭包，捕获了每次 render 后的 state，也就导致了输出了 0、1、2。如果你希望输出的内容是最新的 state 的话，可以通过 useRef 来保存 state。前文讲过 ref 在组件中只存在一份，无论何时使用它的引用都不会产生变化，因此可以来解决闭包引发的问题。</li>
<li>滥用 useContent</li>
</ul>
<h5 id="7-useState-中的第二个参数更新状态和-class-中的-this-setState-区别？"><a href="#7-useState-中的第二个参数更新状态和-class-中的-this-setState-区别？" class="headerlink" title="7. useState 中的第二个参数更新状态和 class 中的 this.setState 区别？"></a>7. useState 中的第二个参数更新状态和 class 中的 this.setState 区别？</h5><h5 id="8-useEffect-和-useLayoutEffect-区别？"><a href="#8-useEffect-和-useLayoutEffect-区别？" class="headerlink" title="8. useEffect 和 useLayoutEffect 区别？"></a>8. useEffect 和 useLayoutEffect 区别？</h5><p>useEffect 是 render 结束后，callback 函数执行，但是不会阻断浏览器的渲染，算是某种异步的方式吧。但是 class 的 componentDidMount 和 componentDidUpdate 是同步的,在 render 结束后就运行,useEffect 在大部分场景下都比 class 的方式性能更好.</p>
<p>useLayoutEffect 里面的 callback 函数会在 DOM 更新完成后立即执行,但是会在浏览器进行任何绘制之前运行完成,阻塞了浏览器的绘制.</p>
<h5 id="9-使用-hooks-实现一个计时器？（demo）"><a href="#9-使用-hooks-实现一个计时器？（demo）" class="headerlink" title="9. 使用 hooks 实现一个计时器？（demo）"></a>9. 使用 hooks 实现一个计时器？（demo）</h5><p>计时器 demo:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useState, useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误的写法</span></span><br><span class="line"><span class="comment">// const CountTimer = () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     let [count, setCount] = useState(0)</span></span><br><span class="line"><span class="comment">//     let CountTimer</span></span><br><span class="line"><span class="comment">//     useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//         setInterval(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//             setCount(count+1)</span></span><br><span class="line"><span class="comment">//         &#125;)</span></span><br><span class="line"><span class="comment">//         return () =&gt; window.clearInterval(CountTimer)</span></span><br><span class="line"><span class="comment">//     &#125;, [count])</span></span><br><span class="line"><span class="comment">//     return (</span></span><br><span class="line"><span class="comment">//         &lt;React.Fragment&gt;</span></span><br><span class="line"><span class="comment">//             &lt;div&gt; &#123;count&#125; &lt;/div&gt;</span></span><br><span class="line"><span class="comment">//         &lt;/React.Fragment&gt;</span></span><br><span class="line"><span class="comment">//     )</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//正确的写法</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">CountTimer</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">let</span> intervalCb = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">let</span> <span class="title class_">CountTimer</span>;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    intervalCb.<span class="property">current</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setCount</span>(count + <span class="number">1</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [count]);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">itvFn</span>(<span class="params"></span>) &#123;</span><br><span class="line">      intervalCb.<span class="title function_">current</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">CountTimer</span> = <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(itvFn, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="built_in">clearInterval</span>(<span class="title class_">CountTimer</span>);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleStop</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="built_in">clearInterval</span>(<span class="title class_">CountTimer</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          handleStop();</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        停止计时</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">CountTimer</span>;</span><br></pre></td></tr></table></figure>

<p>注意第一个计时器错误的写法，在 useEffect 里面重复定义 setInterval，正确写法是 setInterval 只定义一次，它的回调函数保存状态的更新，重点是把 count 更新和 setInterval 定义分开。</p>
<h5 id="10-使用-hooks-实现自定义-hooks-一个计算组件从挂载到卸载的时间？（demo，hooks-抽取公共逻辑的应用）"><a href="#10-使用-hooks-实现自定义-hooks-一个计算组件从挂载到卸载的时间？（demo，hooks-抽取公共逻辑的应用）" class="headerlink" title="10. 使用 hooks 实现自定义 hooks, 一个计算组件从挂载到卸载的时间？（demo，hooks 抽取公共逻辑的应用）"></a>10. 使用 hooks 实现自定义 hooks, 一个计算组件从挂载到卸载的时间？（demo，hooks 抽取公共逻辑的应用）</h5><p>转载文档：<br><a href="https://blog.csdn.net/kellywong/article/details/106430977">https://blog.csdn.net/kellywong/article/details/106430977</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2021/02/19/React/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91React-Hooks-%E5%8A%A0%E6%8C%81%E4%B8%8B%E7%9A%84%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E8%AE%BE%E8%AE%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/19/React/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91React-Hooks-%E5%8A%A0%E6%8C%81%E4%B8%8B%E7%9A%84%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E8%AE%BE%E8%AE%A1/" itemprop="url">React Hooks 加持下的函数组件设计</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-02-19T10:39:03+08:00">
                2021-02-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/02/19/React/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91React-Hooks-%E5%8A%A0%E6%8C%81%E4%B8%8B%E7%9A%84%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E8%AE%BE%E8%AE%A1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2021/02/19/React/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91React-Hooks-%E5%8A%A0%E6%8C%81%E4%B8%8B%E7%9A%84%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E8%AE%BE%E8%AE%A1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2021/02/19/React/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91React-Hooks-%E5%8A%A0%E6%8C%81%E4%B8%8B%E7%9A%84%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E8%AE%BE%E8%AE%A1/" class="leancloud_visitors" data-flag-title="React Hooks 加持下的函数组件设计">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  2.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  8
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="React-Hooks-加持下的函数组件设计"><a href="#React-Hooks-加持下的函数组件设计" class="headerlink" title="React Hooks 加持下的函数组件设计"></a>React Hooks 加持下的函数组件设计</h4><h5 id="有了-React-Hooks-的加持，妈妈再也不用担心函数组件记不住状态"><a href="#有了-React-Hooks-的加持，妈妈再也不用担心函数组件记不住状态" class="headerlink" title="有了 React Hooks 的加持，妈妈再也不用担心函数组件记不住状态"></a>有了 React Hooks 的加持，妈妈再也不用担心函数组件记不住状态</h5><p>过去，React 中的函数组件都被称为无状态函数式组件(stateless functional component)，这是因为函数组件没有办法拥有自己的状态，只能根据 Props 来渲染 UI ，其性质就相当于是类组件中的 render 函数，虽然结构简单明了，但是作用有限。</p>
<p>但自从 React Hooks 横空出世，函数组件也拥有了保存状态的能力，而且也逐渐能够覆盖到类组件的应用场景，因此可以说 React Hooks 就是未来 React 发展的方向。</p>
<h5 id="React-Hooks-解决了什么问题"><a href="#React-Hooks-解决了什么问题" class="headerlink" title="React Hooks 解决了什么问题"></a>React Hooks 解决了什么问题</h5><h6 id="复杂的组件难以分拆"><a href="#复杂的组件难以分拆" class="headerlink" title="复杂的组件难以分拆"></a>复杂的组件难以分拆</h6><p>我们知道组件化的思想就是将一个复杂的页面&#x2F;大组件，按照不同层次，逐渐抽象并拆分成功能更纯粹的小组件，这样一方面可以减少代码耦合，另外一方面也可以更好地复用代码；但实际上，在使用 React 的类组件时，往往难以进一步分拆复杂的组件，这是因为逻辑是有状态的，如果强行分拆，会令代码复杂性急剧上升；如使用 HOC 和 Render Props 等设计模式，这会形成“嵌套地狱”，使我们的代码变得晦涩难懂。</p>
<h6 id="状态逻辑复杂，给单元测试造成障碍"><a href="#状态逻辑复杂，给单元测试造成障碍" class="headerlink" title="状态逻辑复杂，给单元测试造成障碍"></a>状态逻辑复杂，给单元测试造成障碍</h6><p>这其实也是上一点的延续：要给一个拥有众多状态逻辑的组件写单元测试，无疑是一件令人崩溃的事情，因为需要编写大量的测试用例来覆盖代码执行路径。</p>
<h6 id="组件生命周期繁复"><a href="#组件生命周期繁复" class="headerlink" title="组件生命周期繁复"></a>组件生命周期繁复</h6><p>对于类组件，我们需要在组件提供的生命周期钩子中处理状态的初始化、数据获取、数据更新等操作，处理起来本身逻辑就比较复杂，而且各种“副作用”混在一起也使人头晕目眩，另外还很可能忘记在组件状态变更&#x2F;组件销毁时消除副作用。</p>
<h6 id="React-Hooks-就是来解决以上这些问题的"><a href="#React-Hooks-就是来解决以上这些问题的" class="headerlink" title="React Hooks 就是来解决以上这些问题的"></a>React Hooks 就是来解决以上这些问题的</h6><ul>
<li>针对状态逻辑分拆复用难的问题：其实并不是 React Hooks 解决的，函数这一形式本身就具有逻辑简单、易复用等特性。</li>
<li>针对组件生命周期繁复的问题：React Hooks 屏蔽了生命周期这一概念，一切的逻辑都是由状态驱动，或者说由数据驱动的，那么理解、处理起来就简单多了。</li>
</ul>
<h5 id="利用自定义-Hooks-捆绑封装逻辑与相关-state"><a href="#利用自定义-Hooks-捆绑封装逻辑与相关-state" class="headerlink" title="利用自定义 Hooks 捆绑封装逻辑与相关 state"></a>利用自定义 Hooks 捆绑封装逻辑与相关 state</h5><p>我认为 React Hooks 的亮点不在于 React 官方提供的那些 API ，那些 API 只是一些基础的能力；其亮点还是在于<strong>自定义 Hooks</strong> —— 一种封装复用的设计模式。</p>
<p>例如，一个页面上往往有很多状态，这些状态分别有各自的处理逻辑，如果用类组件的话，这些状态和逻辑都会混在一起，不够直观：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Com</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">c</span>: <span class="number">3</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">handleA</span>();</span><br><span class="line">    <span class="title function_">handleB</span>();</span><br><span class="line">    <span class="title function_">handleC</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而使用 React Hooks 后，我们可以把状态和逻辑关联起来，分拆成多个自定义 Hooks ，代码结构就会更清晰：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useA</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [a, setA] = <span class="title function_">useState</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">handleA</span>();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useB</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [b, setB] = <span class="title function_">useState</span>(<span class="number">2</span>);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">handleB</span>();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useC</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [c, setC] = <span class="title function_">useState</span>(<span class="number">3</span>);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">handleC</span>();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Com</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> a = <span class="title function_">useA</span>();</span><br><span class="line">  <span class="keyword">const</span> b = <span class="title function_">useB</span>();</span><br><span class="line">  <span class="keyword">const</span> c = <span class="title function_">useC</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们除了可以利用自定义 Hooks 来拆分业务逻辑外，还可以拆分成复用价值更高的通用逻辑，比如说目前比较流行的 Hooks 库：<a href="https://github.com/daykalif/react-use-chinese">react-use</a>；另外，React 生态中原来的很多库，也开始提供 Hooks API ，如 <a href="https://reactrouter.com/web/api/Hooks">react-router</a>。</p>
<h5 id="忘记组件生命周期吧"><a href="#忘记组件生命周期吧" class="headerlink" title="忘记组件生命周期吧"></a>忘记组件生命周期吧</h5><p>React 提供了大量的组件生命周期钩子，虽然在日常业务开发中，用到的不多，但光是 componentDidUpdate 和 componentWillUnmount 就让人很头痛了，一不留神就忘记处理 <strong>props 更新</strong> 和 <strong>组件销毁需要处理副作用</strong> 的场景，这不仅会留下肉眼可见的 bug ，还会留下一些内存泄露的隐患。</p>
<p>类 MVVM 框架讲究的是 <strong>数据驱动</strong>，而生命周期这种设计模式，就明显更偏向于传统的事件驱动模型；当我们引入 React Hooks 后，数据驱动的特性能够变得更纯粹。</p>
<h6 id="处理-props-更新"><a href="#处理-props-更新" class="headerlink" title="处理 props 更新"></a>处理 props 更新</h6><p>下面我们以一个非常典型的列表页面来举个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">List</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">data</span>: [],</span><br><span class="line">  &#125;;</span><br><span class="line">  fetchData = <span class="function">(<span class="params">id, authorId</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 请求接口</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">fetchData</span>(<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">id</span>, <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">authorId</span>);</span><br><span class="line">    <span class="comment">// ...其它不相关的初始化逻辑</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">componentDidUpdate</span>(<span class="params">prevProps</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">id</span> !== prevProps.<span class="property">id</span> ||</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">authorId</span> !== prevProps.<span class="property">authorId</span> <span class="comment">// 别漏了！</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">fetchData</span>(<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">id</span>, <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">authorId</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...其它不相关的更新逻辑</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上面这段代码有 3 个问题：</p>
</blockquote>
<ul>
<li>需要同时在两个生命周期里执行几乎相同的逻辑。</li>
<li>在判断是否需要更新数据的时候，容易漏掉依赖的条件。</li>
<li>每个生命周期钩子里，会散落大量不相关的逻辑代码，违反了高内聚的原则，影响阅读代码的连贯性。</li>
</ul>
<p>如果改成用 React Hooks 来实现，问题就能得到很大程度上的解决了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">List</span>(<span class="params">&#123; id, authorId &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [data, <span class="title class_">SetData</span>] = <span class="title function_">useState</span>([]);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">fetchData</span> = (<span class="params">id, authorId</span>) =&gt; &#123;&#125;;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">fetchData</span>(id, authorId);</span><br><span class="line">  &#125;, [id, authorId]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>改用 React Hooks 后：</p>
<ul>
<li>我们不需要考虑生命周期，我们只需要把逻辑依赖的状态都丢进依赖列表里， React 会帮我们判断什么时候该执行的。</li>
<li>React 官方提供了 eslint 的插件来检查依赖项列表是否完整。</li>
<li>我们可以使用多个 useEffect ，或者多个自定义 Hooks 来区分开多个无关联的逻辑代码段，保障高内聚特性。</li>
</ul>
<h5 id="处理副作用"><a href="#处理副作用" class="headerlink" title="处理副作用"></a>处理副作用</h5><p>最常见的副作用莫过于绑定 DOM 事件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">List</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  handleFunc = <span class="function">() =&gt;</span> &#123;&#125;;</span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;scroll&quot;</span>, <span class="variable language_">this</span>.<span class="property">handleFunc</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;scroll&quot;</span>, <span class="variable language_">this</span>.<span class="property">handleFunc</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这块也还是会有上述说的，影响高内聚的问题，改成 React Hooks ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">List</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;scroll&quot;</span>, <span class="variable language_">this</span>.<span class="property">handleFunc</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;scroll&quot;</span>, <span class="variable language_">this</span>.<span class="property">handleFunc</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而且比较绝的是，除了在组件销毁的时候会触发外，在依赖项变化的时候，也会执行清除上一轮的副作用。</p>
<h5 id="利用-useMemo-做局部性能优化"><a href="#利用-useMemo-做局部性能优化" class="headerlink" title="利用 useMemo 做局部性能优化"></a>利用 useMemo 做局部性能优化</h5><p>在使用类组件的时候，我们需要利用 componentShouldUpdate 这个生命周期钩子来判断当前是否需要重新渲染，而改用 React Hooks 后，我们可以利用 useMemo 来判断是否需要重新渲染，达到局部性能优化的效果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">List</span>(<span class="params">props</span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">fetchData</span>(props.<span class="property">id</span>)</span><br><span class="line">  &#125;, [props.<span class="property">id</span>])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> (</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  ), [props.<span class="property">id</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面这段代码中，我们看到最终渲染的内容是依赖于 props. id，那么只要 props.id 不变，即便其它 props 再怎么办，该组件也不会重新渲染。</p>
<h5 id="依靠-useRef-摆脱闭包"><a href="#依靠-useRef-摆脱闭包" class="headerlink" title="依靠 useRef 摆脱闭包"></a>依靠 useRef 摆脱闭包</h5><p>在我们刚开始使用 React Hooks 的时候，经常会遇到这样的场景：在某个事件回调中，需要根据当前状态值来决定下一步执行什么操作；但我们发现事件回调中拿到的总是旧的状态值，而不是最新状态值，这是怎么回事呢？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">log</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setCount</span>(count + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(count);</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;log&#125;</span>&gt;</span>报数<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    如果我们在三秒内连续点击三次，那么count的值最终会变成 3，而随之而来的输出结果是？</span></span><br><span class="line"><span class="comment">    0</span></span><br><span class="line"><span class="comment">    1</span></span><br><span class="line"><span class="comment">    2</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<p>“这是 feature 不是 bug ”，哈哈哈，说是 feature 可能也不太准确，因为这不正是 javascript 闭包的特性吗？当我们每次往 setTimeout 里传入回调函数时，这个回调函数都会引用下当前函数作用域（此时 count 的值还未被更新），所以在执行的时候打印出来的就会是旧的状态值。</p>
<h5 id="类组件是怎么实现的？"><a href="#类组件是怎么实现的？" class="headerlink" title="类组件是怎么实现的？"></a>类组件是怎么实现的？</h5><p>那为啥类组件中，每次都能取到最新的状态值呢？这是因为我们在类组件中取状态值都是从 this.state 里取的，这相当于是类组件的一个执行上下文，永远都是保持最新的。</p>
<h5 id="借助-useRef-共享修改"><a href="#借助-useRef-共享修改" class="headerlink" title="借助 useRef 共享修改"></a>借助 useRef 共享修改</h5><blockquote>
<p>通过 useRef 创建的对象，其值只有一份，而且在所有 Rerender 之间共享。</p>
</blockquote>
<p>听上去，这 useRef 其实跟 this.state 很相似嘛，都是一个可以一直维持的值，那我们就可以用它来维护我们的状态了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">useRef</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">log</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    count.<span class="property">current</span>++;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">current</span>);</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;log&#125;</span>&gt;</span>报数<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    3</span></span><br><span class="line"><span class="comment">    3</span></span><br><span class="line"><span class="comment">    3</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<p>转载文档：<br><a href="https://segmentfault.com/a/1190000022992165">https://segmentfault.com/a/1190000022992165</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2021/02/19/React/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91React-Hooks%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/19/React/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91React-Hooks%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90/" itemprop="url">React Hooks 原理剖析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-02-19T10:35:17+08:00">
                2021-02-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/02/19/React/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91React-Hooks%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2021/02/19/React/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91React-Hooks%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2021/02/19/React/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91React-Hooks%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90/" class="leancloud_visitors" data-flag-title="React Hooks 原理剖析">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  1.5k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  5
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="React-Hooks-原理剖析"><a href="#React-Hooks-原理剖析" class="headerlink" title="React Hooks 原理剖析"></a>React Hooks 原理剖析</h4><h5 id="为什么要学习-React-Hooks-原理"><a href="#为什么要学习-React-Hooks-原理" class="headerlink" title="为什么要学习 React Hooks 原理"></a>为什么要学习 React Hooks 原理</h5><p>首先，功利点来说：目前前端框架三分天下：React、Vue、Angular，而 React 自从 v16.8.0 版本正式推出 React Hooks 概念后，风势已经从原来的类组件猛地转向函数组件，这是一个在设计模式、心智模型层次，且非常近期的革新，因此只要是你谈到自己会 React ，就一定会在面试中被问到 React Hooks 的原理。</p>
<p>再者，从实际角度出发，了解 React Hooks 原理对我们日常开发调试都有莫大的好处；我们可以认识到 React Hooks 其实也并不是什么黑魔法，我们在开发中碰到的奇奇怪怪的问题，只不过是我们还没有掌握 React Hooks 导致的，也不需要用一些 tricky 的方法来解决。</p>
<h5 id="useState-useReducer"><a href="#useState-useReducer" class="headerlink" title="useState &#x2F; useReducer"></a>useState &#x2F; useReducer</h5><p>useState 和 useReducer 都是关于状态值的提取和更新，从本质上来说没有区别，从实现上，可以说 useState 是 useReducer 的一个简化版，其背后用的都是同一套逻辑。</p>
<h5 id="React-Hooks-如何保存状态"><a href="#React-Hooks-如何保存状态" class="headerlink" title="React Hooks 如何保存状态"></a>React Hooks 如何保存状态</h5><p>React 官方文档中有提到，React Hooks 保存状态的位置其实与类组件的一致；翻看源码后，我发现这样的说法没错，但又不全面：</p>
<ul>
<li>两者的状态值都被挂载在组件实例对象 FiberNode 的 memoizedState 属性中。</li>
<li>两者保存状态值的数据结构完全不同；类组件是直接把 state 属性中挂载的这个开发者自定义的对象给保存到 memoizedState 属性中；而 React Hooks 是用链表来保存状态的，memoizedState 属性保存的实际上是这个链表的头指针。</li>
</ul>
<p>下面我们来看看这个链表的节点是什么样的 —— Hook 对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// react-reconciler/src/ReactFiberHooks.js</span></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">Hook</span> = &#123;</span><br><span class="line">  <span class="attr">memoizedState</span>: any, <span class="comment">// 最新的状态值</span></span><br><span class="line">  <span class="attr">baseState</span>: any, <span class="comment">// 初始状态值，如`useState(0)`，则初始值为0</span></span><br><span class="line">  <span class="attr">baseUpdate</span>: <span class="title class_">Update</span>&lt;any, any&gt; | <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">queue</span>: <span class="title class_">UpdateQueue</span>&lt;any, any&gt; | <span class="literal">null</span>, <span class="comment">// 临时保存对状态值的操作，更准确来说是一个链表数据结构中的一个指针</span></span><br><span class="line">  <span class="attr">next</span>: <span class="title class_">Hook</span> | <span class="literal">null</span>, <span class="comment">// 指向下一个链表节点</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>官方文档一直强调 React Hooks 的调用只能放在函数组件&#x2F;自定义 Hooks 函数体的顶层，这是因为我们只能通过 Hooks 调用的顺序来与实际保存的数据结构来关联：</p>
<p><img src="https://www.daykalif.com/blog_img/useState.png" alt="useState"></p>
<p>PS：虽然上面一致都是以 useState 和 useReducer 来作为例子说明，但实际上所有 React Hooks 都是用这种链表的方式来保存的。</p>
<h5 id="React-Hooks-如何更新状态"><a href="#React-Hooks-如何更新状态" class="headerlink" title="React Hooks 如何更新状态"></a>React Hooks 如何更新状态</h5><p>熟悉 useState API 的话，我们都知道怎么去更新状态：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [name, setName] = <span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="title function_">setName</span>(<span class="string">&quot;张三&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>那么，由 useState 返回的这个用来更新状态的函数（下文称为 dispatcher），运行的原理是怎么样的呢？</p>
<p>当我们在每次调用 dispatcher 时，并不会立刻对状态值进行修改（对的，状态值的更新是异步的），而是创建一条修改操作——在对应 Hook 对象的 queue 属性挂载的链表上加一个新节点：</p>
<p><img src="https://www.daykalif.com/blog_img/stateUpdate.png" alt="useState"></p>
<p>在下次执行函数组件，再次调用 useState 时， React 才会根据每个 Hook 上挂载的更新操作链表来计算最新的状态值。你也许会好奇，为什么要把更新操作都保存起来呢，只保存最新的一次更新操作不就行了吗？你会这样想，大概是忘了 useState 支持这样的语法了吧：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [name, setName] = <span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="title function_">setName</span>(<span class="function">(<span class="params">name</span>) =&gt;</span> name + <span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="title function_">setName</span>(<span class="function">(<span class="params">name</span>) =&gt;</span> name + <span class="string">&quot;b&quot;</span>);</span><br><span class="line"><span class="title function_">setName</span>(<span class="function">(<span class="params">name</span>) =&gt;</span> name + <span class="string">&quot;c&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下次执行时就可以得到 name 的最新状态值为&#x27;abc&#x27;啦</span></span><br></pre></td></tr></table></figure>

<h5 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h5><p>useEffect 的保存方式与 useState &#x2F; useReducer 类似，也是以链表的形式挂载在 FiberNode.updateQueue 中。</p>
<p>下面我们按 mount 和 update 这两个组件生命周期来阐述 useEffect 的执行原理：</p>
<h5 id="mount-阶段：mountEffect"><a href="#mount-阶段：mountEffect" class="headerlink" title="mount 阶段：mountEffect"></a>mount 阶段：mountEffect</h5><p>根据函数组件函数体中依次调用的 useEffect 语句，构建成一个链表并挂载在 FiberNode.updateQueue 中，链表节点的数据结构为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">effect</span>: <span class="title class_">Effect</span> = &#123;</span><br><span class="line">  tag, <span class="comment">// 用来标识依赖项有没有变动</span></span><br><span class="line">  create, <span class="comment">// 用户使用useEffect传入的函数体</span></span><br><span class="line">  destroy, <span class="comment">// 上述函数体执行后生成的用来清除副作用的函数</span></span><br><span class="line">  deps, <span class="comment">// 依赖项列表</span></span><br><span class="line">  <span class="attr">next</span>: (<span class="attr">null</span>: any),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>组件完成渲染后，遍历链表执行。</p>
<h5 id="update-阶段：updateEffect"><a href="#update-阶段：updateEffect" class="headerlink" title="update 阶段：updateEffect"></a>update 阶段：updateEffect</h5><p>同样在依次调用 useEffect 语句时，判断此时传入的依赖列表，与链表节点 Effect.deps 中保存的是否一致（基本数据类型的值是否相同；对象的引用是否相同），如果一致，则在 Effect.tag 标记上 NoHookEffect。</p>
<h5 id="执行阶段"><a href="#执行阶段" class="headerlink" title="执行阶段"></a>执行阶段</h5><p>在每次组件渲染完成后，就会进入 useEffect 的执行阶段：function commitHookEffectList()：</p>
<p>1.遍历链表 2.如果遇到 Effect.tag 被标记上 NoHookEffect 的节点则跳过。 3.如果 Effect.destroy 为函数类型，则需要执行该清除副作用的函数（至于这 Effect.destroy 是从哪里来的，下面马上说到） 4.执行 Effect.create，并将执行结果保存到 Effect.destroy（如果开发者没有配置 return，那得到的自然是 undefined 了，也就是说，开发者认为对于当前 useEffect 代码段，不存在需要清除的副作用）；注意由于闭包的缘故，Effect.destroy 实际上可以访问到本次 Effect.create 函数作用域内的变量。</p>
<p>我们重点请注意到：<strong>是先清除上一轮的副作用，然后再执行本轮的 effect 的。</strong></p>
<h5 id="其它-React-Hooks-Api"><a href="#其它-React-Hooks-Api" class="headerlink" title="其它 React Hooks Api"></a>其它 React Hooks Api</h5><p>其它的的 React Hooks Api ，其实也差不多是这样的原理：用链表数据结构来做全局状态保持；判断依赖项决定是否要更新状态等等，这里不再累述。</p>
<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>本文用比较精炼的语言来阐述了 React Hooks 的原理，目的是让读者有一个感性的认识，也便于应付面试；但实际上 React Hooks 还有非常多的实现细节，有兴趣请阅读源码，入口<a href="https://github.com/facebook/react/blob/master/packages/react/src/ReactHooks.js">在此</a>。</p>
<p>转载文档：<br><a href="https://segmentfault.com/a/1190000023041842">https://segmentfault.com/a/1190000023041842</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2021/02/07/React/React-Hooks%E4%BD%BF%E7%94%A8%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9A%E6%8A%80%E6%9C%AF%E8%83%96%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/07/React/React-Hooks%E4%BD%BF%E7%94%A8%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9A%E6%8A%80%E6%9C%AF%E8%83%96%EF%BC%89/" itemprop="url">【技术胖】React Hooks使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-02-07T20:05:36+08:00">
                2021-02-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/02/07/React/React-Hooks%E4%BD%BF%E7%94%A8%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9A%E6%8A%80%E6%9C%AF%E8%83%96%EF%BC%89/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2021/02/07/React/React-Hooks%E4%BD%BF%E7%94%A8%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9A%E6%8A%80%E6%9C%AF%E8%83%96%EF%BC%89/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2021/02/07/React/React-Hooks%E4%BD%BF%E7%94%A8%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9A%E6%8A%80%E6%9C%AF%E8%83%96%EF%BC%89/" class="leancloud_visitors" data-flag-title="【技术胖】React Hooks使用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  9.5k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  41
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="React-Hooks-简介"><a href="#React-Hooks-简介" class="headerlink" title="React Hooks 简介"></a>React Hooks 简介</h4><p>2018 年底 FaceBook 的 React 小组推出 Hooks 以来，所有的 React 的开发者都对它大为赞赏。React Hooks 就是用函数的形式代替原来的继承类的形式，并且使用预函数的形式管理 state，有 Hooks 可以不再使用类的形式定义组件了。这时候你的认知也要发生变化了，原来把组件分为有状态组件和无状态组件，有状态组件用类的形式声明，无状态组件用函数的形式声明。那现在所有的组件都可以用函数来声明了。</p>
<h5 id="1-使用-create-react-app-创建项目"><a href="#1-使用-create-react-app-创建项目" class="headerlink" title="1.使用 create-react-app 创建项目"></a>1.使用 create-react-app 创建项目</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ReactHooksDemo</span><br><span class="line"><span class="built_in">cd</span> ReactHooksDemo</span><br><span class="line">create-react-app demo01</span><br></pre></td></tr></table></figure>

<blockquote>
<p>原始写法</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Example</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;this.state.count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.addCount.bind(this)&#125;</span>&gt;</span>Chlick me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">addCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">count</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">count</span> + <span class="number">1</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Example</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>React Hooks 写法：【⚠️ 注：React 版本 16.8 以上才有 React Hooks 新特性】</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Example</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setCount(count + 1);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        click me</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Example</span>;</span><br></pre></td></tr></table></figure>

<p>从这两个程序的对比上可以看出 Hooks 本质上就是一类特殊的函数，他们可以为你的函数型组件（function component）注入一些特殊的功能。这听起来有点像以前 React 中的 Mixins 差不多哦。其实是由很多不同，hooks 的目的就是让你不再写 class，让 function 一统江湖。</p>
<h5 id="2-useState-的介绍和多状态声明"><a href="#2-useState-的介绍和多状态声明" class="headerlink" title="2.useState 的介绍和多状态声明"></a>2.useState 的介绍和多状态声明</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useState介绍：</span><br><span class="line">useState是react自带的一个hook函数，它的作用是用来声明状态变量。</span><br><span class="line">我们从三个方面来看useState的用法，分别是声明、读取、使用（修改）。</span><br></pre></td></tr></table></figure>

<blockquote>
<p>声明:</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>); <span class="comment">// 这种方法是ES6语法中的数组解构，这样看起来代码变的简单易懂。</span></span><br><span class="line"><span class="comment">// 如果不写成数组解构，上边的语法要写成下面的三行:</span></span><br><span class="line"><span class="keyword">let</span> _useState = <span class="title function_">userState</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">let</span> count = _useState[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">let</span> setCount = _useState[<span class="number">1</span>];</span><br></pre></td></tr></table></figure>

<p>useState 这个函数接收的参数是状态的初始值(Initial state)，它返回一个数组，这个数组的第 0 位是当前的状态值，第 1 位是可以改变状态值的方法函数。 所以上面的代码的意思就是声明了一个状态变量为 count，并把它的初始值设为 0，同时提供了一个可以改变 count 的状态值的方法函数。</p>
<blockquote>
<p>读取状态中的值:</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;<span class="title class_">You</span> clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line"><span class="comment">// 你可以发现，我们读取是很简单的。只要使用&#123;count&#125;就可以，因为这时候的count就是JS里的一个变量，想在JSX中使用，值用加上&#123;&#125;就可以。</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>改变 State 中的值:</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;button</span><br><span class="line">  onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setCount</span>(count + <span class="number">1</span>);</span><br><span class="line">  &#125;&#125;</span><br><span class="line">&gt;</span><br><span class="line">  click me</span><br><span class="line">&lt;/button&gt;</span><br></pre></td></tr></table></figure>

<p>直接调用 setCount 函数，这个函数接收的参数是修改过的新状态值。接下来的事情就交给 React,他会重新渲染组件。React 自动帮助我们记忆了组件的上一次状态值，但是这种记忆也给我们带来了一点小麻烦，但是这种麻烦你可以看成规则，只要准守规则，就可以愉快的进行编码。</p>
<blockquote>
<p>多状态声明的注意事项</p>
</blockquote>
<p>比如现在我们要声明多个状态，有年龄（age）、性别(sex)和工作(work)。代码可以这么写.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Example2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [age, setAge] = <span class="title function_">useState</span>(<span class="number">18</span>);</span><br><span class="line">  <span class="comment">//useState这个函数接收的参数是状态的初始值(Initial state)，它返回一个数组，这个数组的第0位是当前的状态值，第1位是可以改变状态值的方法函数。</span></span><br><span class="line">  <span class="comment">// 声明了一个状态变量为age，并把它的初始值设为18，同时提供了一个可以改变age的状态值的方法函数setAge。</span></span><br><span class="line">  <span class="keyword">const</span> [sex, setSex] = <span class="title function_">useState</span>(<span class="string">&quot;男&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> [work, setWork] = <span class="title function_">useState</span>(<span class="string">&quot;前端程序员&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>JSPang 今年:&#123;age&#125;岁<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>性别:&#123;sex&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>工作是:&#123;work&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Example2</span>;</span><br></pre></td></tr></table></figure>

<p>在使用 useState 的时候只赋了初始值，并没有绑定任何的 key,那 React 是怎么保证这三个 useState 找到它自己对应的 state 呢？<br><strong>答案是：React 是根据 useState 出现的顺序来确定的</strong></p>
<p>比如我们把代码改成下面的样子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> showSex = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Example2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [age, setAge] = <span class="title function_">useState</span>(<span class="number">18</span>);</span><br><span class="line">  <span class="keyword">if</span> (showSex) &#123;</span><br><span class="line">    <span class="keyword">const</span> [sex, setSex] = <span class="title function_">useState</span>(<span class="string">&quot;男&quot;</span>);</span><br><span class="line">    showSex = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [work, setWork] = <span class="title function_">useState</span>(<span class="string">&quot;前端程序员&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>JSPang 今年:&#123;age&#125;岁<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>性别:&#123;sex&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>工作是:&#123;work&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Example2</span>;</span><br></pre></td></tr></table></figure>

<p>这时候控制台就会直接给我们报错，错误如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="title class_">React</span> <span class="title class_">Hook</span> <span class="string">&quot;useState&quot;</span> is called conditionally. <span class="title class_">React</span> <span class="title class_">Hooks</span> must be called <span class="keyword">in</span> the exact same order <span class="keyword">in</span> every component render</span><br><span class="line"></span><br><span class="line"><span class="comment">//  意思就是useState不能在if...else...这样的条件语句中进行调用，必须要按照相同的顺序进行渲染。如果不理解，记住这样一句话就可以了：就是React Hooks不能出现在条件判断语句中，因为它必须有完全一样的渲染顺序。</span></span><br></pre></td></tr></table></figure>

<h5 id="3-useEffect-代替常用生命周期函数"><a href="#3-useEffect-代替常用生命周期函数" class="headerlink" title="3.useEffect 代替常用生命周期函数"></a>3.useEffect 代替常用生命周期函数</h5><p>在用 Class 制作组件时，经常会用生命周期函数，来处理一些额外的事情（副作用：和函数业务主逻辑关联不大，特定时间或事件中执行的动作，比如 Ajax 请求后端数据，添加登录监听和取消登录，手动修改 DOM 等等）。在 React Hooks 中也需要这样类似的生命周期函数，比如在每次状态（State）更新时执行，它为我们准备了 useEffect。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(effect: React.EffectCallback, deps?: ReadonlyArray&lt;any&gt; | undefined)</span><br><span class="line"></span><br><span class="line">作用：处理函数组件中的副作用，如异步操作、延迟操作等，可以替代Class Component的componentDidMount、componentDidUpdate、componentWillUnmount等生命周期。</span><br></pre></td></tr></table></figure>

<p>与 useState 传入的是具体 state 不同，useEffect 传入的是一个 callback 函数，与 useState 最大的不同是执行时机，useEffect callback 是在组件被渲染为真实 DOM 后执行（所以可以用于 DOM 操作）</p>
<blockquote>
<p>用 Class 的方式为计数器增加生命周期函数</p>
</blockquote>
<p>为了更好的理解 useEffect 的使用，先用原始的方式把计数器的 Demo 增加两个生命周期函数 componentDidMount 和 componentDidUpdate。分别在组件第一次渲染后在浏览器控制台打印出计数器结果和在每次计数器状态发生变化后打印出结果。代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Example3</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ComponentDidMount=&gt;You clicked <span class="subst">$&#123;<span class="variable language_">this</span>.state.count&#125;</span> times`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">componentDidUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`componentDidUpdate=&gt;You clicked <span class="subst">$&#123;<span class="variable language_">this</span>.state.count&#125;</span> times`</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;this.state.count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.addCount.bind(this)&#125;</span>&gt;</span>Chlick me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">addCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">count</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">count</span> + <span class="number">1</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Example3</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>用 useEffect 函数来代替生命周期函数</p>
</blockquote>
<p>在使用 React Hooks 的情况下，可以使用下面的代码来完成上边代码的生命周期效果，代码如下（修改了以前的 diamond）： 记得要先引入 useEffect 后，才可以正常使用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Example</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//---关键代码---------start-------</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//异步的，不会阻断视图更新</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`useEffect=&gt;You clicked <span class="subst">$&#123;count&#125;</span> times`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//---关键代码---------end-------</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setCount(count + 1);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        click me</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Example</span>;</span><br></pre></td></tr></table></figure>

<p>写完后，可以到浏览器中进行预览一下，可以看出跟 class 形式的生命周期函数是完全一样的，这代表第一次组件渲染和每次组件更新都会执行这个函数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">梳理一下:首先，我们声明了一个状态变量count,将它的初始值设为0，然后我们告诉react，我们的这个组件有一个副作用。</span><br><span class="line">给useEffecthook传了一个匿名函数，这个匿名函数就是我们的副作用。</span><br><span class="line">在这里我们打印了一句话，当然也可以手动的去修改一个DOM元素。</span><br><span class="line">当React要渲染组件时，它会记住用到的副作用，然后执行一次。</span><br><span class="line">等Reat更新了State状态时，它再一次执行定义的副作用函数。</span><br></pre></td></tr></table></figure>

<blockquote>
<p>useEffect 两个注意点</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.React首次渲染和之后的每次渲染都会调用一遍useEffect函数，而之前我们要用两个生命周期函数分别表示首次渲染(componentDidMonut)和更新导致的重新渲染(componentDidUpdate)。</span><br><span class="line"></span><br><span class="line">2.useEffect中定义的函数的执行不会阻碍浏览器更新视图，也就是说这些函数时异步执行的，而componentDidMonut和componentDidUpdate中的代码都是同步执行的。个人认为这个有好处也有坏处吧，比如我们要根据页面的大小，然后绘制当前弹出窗口的大小，如果时异步的就不好操作了。</span><br></pre></td></tr></table></figure>

<h5 id="4-useEffect-实现-componentWillUnmount-生命周期函数"><a href="#4-useEffect-实现-componentWillUnmount-生命周期函数" class="headerlink" title="4:useEffect 实现 componentWillUnmount 生命周期函数"></a>4:useEffect 实现 componentWillUnmount 生命周期函数</h5><p>在写 React 应用的时候，在组件中经常用到 componentWillUnmount 生命周期函数（组件将要被卸载时执行）。比如我们的定时器要清空，避免发生内存泄漏;比如登录状态要取消掉，避免下次进入信息出错。所以这个生命周期函数也是必不可少的，故来用 useEffect 来实现这个生命周期函数。</p>
<blockquote>
<p>useEffect 解绑副作用</p>
</blockquote>
<p>学习 React Hooks 时，我们要改掉生命周期函数的概念（人往往有先入为主的毛病，所以很难改掉），因为 Hooks 叫它副作用，所以 componentWillUnmount 也可以理解成解绑副作用。为了演示用 useEffect 来实现类似 componentWillUnmount 效果，先安装 React-Router 路由,进入项目根本录，使用 npm 进行安装。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save react-router-dom</span><br></pre></td></tr></table></figure>

<p>然后打开 Example.js 文件，进行改写代码，先引入对应的 React-Router 组件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> <span class="keyword">as</span> <span class="title class_">Router</span>, <span class="title class_">Route</span>, <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>在文件中编写两个新组件，因为这两个组件都非常的简单，所以就不单独建立一个新的文件来写了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Index</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>www.daykalif.com<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">List</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>List-Page<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有了这两个组件后，接下来可以编写路由配置，在以前的计数器代码中直接增加就可以了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setCount(count + 1);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      click me</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span>&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/list/&quot;</span>&gt;</span>列表<span class="tag">&lt;/<span class="name">Link</span>&gt;</span>&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Index&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/list/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;List&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>然后到浏览器中查看一下，看看组件和路由是否可用。如果可用，我们现在可以调整 useEffect 了。在两个新组件中分别加入 useEffect()函数:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Index</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;useEffect=&gt;老弟，你来了！Index页面&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>JSPang.com<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">List</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;useEffect=&gt;老弟，你来了！List页面&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>List-Page<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时候我们点击 Link 进入任何一个组件，在浏览器中都会打印出对应的一段话。这时候可以用返回一个函数的形式进行解绑，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Index</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;useEffect=&gt;老弟你来了！Index页面&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//解绑</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;老弟，你走了!Index页面&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>www.daykalif.com<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时候你在浏览器中预览，我们仿佛实现了 componentWillUnmount 方法。但这只是好像实现了，当点击计数器按钮时，你会发现老弟，你走了!Index 页面，也出现了。这到底是怎么回事呢？其实每次状态发生变化，useEffect 都进行了解绑。</p>
<blockquote>
<p>useEffect 的第二个参数</p>
</blockquote>
<p>那到底要如何实现类似 componentWillUnmount 的效果那?这就需要请出 useEffect 的第二个参数，它是一个数组，数组中可以写入很多状态对应的变量，意思是当状态值发生变化时，我们才进行解绑。但是当传空数组[]时，就是当组件将被销毁时才进行解绑，这也就实现了 componentWillUnmount 的生命周期函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Index</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;useEffect=&gt;老弟你来了！Index页面&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;老弟，你走了!Index页面&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>JSPang.com<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了更加深入了解第二个参数的作用，把计数器的代码也加上 useEffect 和解绑方法，并加入第二个参数为空数组。代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Example</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`useEffect=&gt;You clicked <span class="subst">$&#123;count&#125;</span> times`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;====================&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setCount(count + 1);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        click me</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span>&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/list/&quot;</span>&gt;</span>列表<span class="tag">&lt;/<span class="name">Link</span>&gt;</span>&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Index&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/list/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;List&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时候的代码是不能执行解绑副作用函数的。但是如果我们想每次 count 发生变化，我们都进行解绑，只需要在第二个参数的数组里加入 count 变量就可以了。代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Example</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`useEffect=&gt;You clicked <span class="subst">$&#123;count&#125;</span> times`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//解绑的副作用函数</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;====================&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [count]); <span class="comment">//只有count的状态变化时，才会执行return解绑的副作用函数</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setCount(count + 1);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        click me</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span>&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/list/&quot;</span>&gt;</span>列表<span class="tag">&lt;/<span class="name">Link</span>&gt;</span>&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Index&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/list/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;List&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时候只要 count 状态发生变化，都会执行解绑副作用函数，浏览器的控制台也就打印出了一串&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;。</p>
<h5 id="5-useContext-让父子组件传值更简单"><a href="#5-useContext-让父子组件传值更简单" class="headerlink" title="5:useContext 让父子组件传值更简单"></a>5:useContext 让父子组件传值更简单</h5><p>有了 useState 和 useEffect 已经可以实现大部分的业务逻辑了，但是 React Hooks 中还是有很多好用的 Hooks 函数的，比如 useContext 和 useReducer。</p>
<p>在用类声明组件时，父子组件的传值是通过组件属性和 props 进行的，那现在使用方法(Function)来声明组件，已经没有了 constructor 构造函数也就没有了 props 的接收，那父子组件的传值就成了一个问题。React Hooks 为我们准备了 useContext。</p>
<p>useContext 可以帮助我们跨越组件层级直接传递变量，实现共享。需要注意的是 useContext 和 redux 的作用是不同的，一个解决的是组件之间值传递的问题，一个是应用中统一管理状态的问题，但通过和 useReducer 的配合使用，可以实现类似 Redux 的作用。</p>
<h6 id="Context-的作用就是对它所包含的组件树提供全局共享数据的一种技术。"><a href="#Context-的作用就是对它所包含的组件树提供全局共享数据的一种技术。" class="headerlink" title="Context 的作用就是对它所包含的组件树提供全局共享数据的一种技术。"></a>Context 的作用就是对它所包含的组件树提供全局共享数据的一种技术。</h6><blockquote>
<p>createContext 函数创建 context</p>
</blockquote>
<p>直接在 src 目录下新建一个文件 Example4.js,然后拷贝 Example.js 里的代码，并进行修改，删除路由部分和副作用的代码，只留计数器的核心代码就可以了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Example4</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setCount(count + 1);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        click me</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Example4</span>;</span><br></pre></td></tr></table></figure>

<p>然后修改一下 index.js 让它渲染这个 Example4.js 组件，修改的代码如下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Example</span> <span class="keyword">from</span> <span class="string">&quot;./Example4&quot;</span>;</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Example</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>之后在 Example4.js 中引入 createContext 函数，并使用得到一个组件，然后在 return 方法中进行使用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, createContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">//===关键代码</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CountContext</span> = <span class="title function_">createContext</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Example4</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setCount(count + 1);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        click me</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/*======关键代码 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">CountContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;count&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">CountContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Example4</span>;</span><br></pre></td></tr></table></figure>

<p>这段代码就相当于把 count 变量允许跨层级实现传递和使用了（也就是实现了上下文），当父组件的 count 变量发生变化时，子组件也会发生变化。接下来就看一个 React Hooks 的子组件如何接收到这个变量。</p>
<blockquote>
<p>useContext 接收上下文变量</p>
</blockquote>
<p>已经有了上下文变量，剩下的就时如何接收了，接收这个直接使用 useContext 就可以，但是在使用前需要新进行引入 useContext（不引入是没办法使用的）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, createContext, useContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>引入后写一个 Counter 组件（子组件），只是显示上下文中的 count 变量代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">useContext</span>(<span class="title class_">CountContext</span>); <span class="comment">//一句话就可以得到count</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>得到后就可以显示出来了，但是要记得在&lt;CountContext.Provider&gt;的闭合标签中,代码如下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">CountContext</span>.<span class="property">Provider</span> value=&#123;count&#125;&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Counter</span> /&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">CountContext</span>.<span class="property">Provider</span>&gt;</span><br></pre></td></tr></table></figure>

<h5 id="6-useReducer-介绍和简单使用"><a href="#6-useReducer-介绍和简单使用" class="headerlink" title="6:useReducer 介绍和简单使用"></a>6:useReducer 介绍和简单使用</h5><p>useContext 函数和 useReducer 函数，因为他们两个很像，并且合作可以完成类似的 Redux 库的操作。在开发中使用 useReducer 可以让代码具有更好的可读性和可维护性，并且会给测试提供方便。</p>
<blockquote>
<p>reducer 到底是什么？</p>
</blockquote>
<p>为了更好的理解 useReducer，所以先要了解 JavaScript 里的 Redcuer 是什么。它的兴起是从 Redux 广泛使用开始的，但不仅仅存在 Redux 中，可以使用 JavaScript 来完成 Reducer 操作。那 reducer 其实就是一个函数，这个函数接收两个参数，一个是状态，一个用来控制业务逻辑的判断参数。举一个最简单的例子。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">countReducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;add&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;sub&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> state - <span class="number">1</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码就是 Reducer，主要理解的就是这种形式和两个参数的作用，一个参数是状态，一个参数是如何控制状态。</p>
<blockquote>
<p>useReducer 的使用</p>
</blockquote>
<p>了解 reducer 的含义后，就可以讲 useReducer 了，它也是 React hooks 提供的函数，可以增强我们的 Reducer，实现类似 Redux 的功能。新建一个 Example5.js 的文件，然后用 useReducer 实现计数器的加减双向操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ReducerDemo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, dispatch] = <span class="title function_">useReducer</span>(<span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (action) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;add&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;sub&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> state - <span class="number">1</span>;</span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">0</span>); <span class="comment">//useReducer的第二个参数表示state初始值</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>现在的分数是&#123;count&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&quot;add&quot;)&#125;&gt;Increment<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&quot;sub&quot;)&#125;&gt;Decrement<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ReducerDemo</span>;</span><br></pre></td></tr></table></figure>

<p>这段代码是 useReducer 的最简单实现了，这时候可以在浏览器中实现了计数器的增加减少。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Example</span> <span class="keyword">from</span> <span class="string">&quot;./Example5&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Example</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<h5 id="7-useReducer-代替-Redux-小案例-1"><a href="#7-useReducer-代替-Redux-小案例-1" class="headerlink" title="7:useReducer 代替 Redux 小案例-1"></a>7:useReducer 代替 Redux 小案例-1</h5><p>使用 useContext 和 useReducer 是可以实现类似 Redux 的效果，并且一些简单的个人项目，完全可以用下面的方案代替 Redux，这种做法要比 Redux 简单一些。</p>
<blockquote>
<p>理论上的可行性</p>
</blockquote>
<p>先从理论层面看看替代 Redux 的可能性，只要巧妙的结合两个函数，这种替代方案是完全可行的。</p>
<p><strong>useContext</strong>：可访问全局状态，避免一层层的传递状态。这符合 Redux 其中的一项规则，就是状态全局化，并能统一管理。</p>
<p><strong>useReducer</strong>：通过 action 的传递，更新复杂逻辑的状态，主要是可以实现类似 Redux 中的 Reducer 部分，实现业务逻辑的可行性。</p>
<blockquote>
<p>编写基本 UI 组件</p>
</blockquote>
<p>在&#x2F;src 目录下新建一个文件夹 Example6，有了文件夹后，在文件夹下面建立一个 showArea.js 文件。代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ShowArea</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> &quot;<span class="attr">blue</span>&quot; &#125;&#125;&gt;</span>字体颜色为blue<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ShowArea</span>;</span><br></pre></td></tr></table></figure>

<p>显示区域写完后，新建一个 Buttons.js 文件，用来编写按钮，这个是两个按钮，一个红色一个黄色。先不写其他任何业务逻辑。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Buttons</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span>&gt;</span>红色<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span>&gt;</span>黄色<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Buttons</span>;</span><br></pre></td></tr></table></figure>

<p>然后再编写一个组合他们的 Example6.js 组件，引入两个新编写的组件 ShowArea 和 Buttons，并用 div 标签给包裹起来。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ShowArea</span> <span class="keyword">from</span> <span class="string">&quot;./ShowArea&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Buttons</span> <span class="keyword">from</span> <span class="string">&quot;./Buttons&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Example6</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ShowArea</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Buttons</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Example6</span>;</span><br></pre></td></tr></table></figure>

<p>这步做完，需要到&#x2F;src 目录下的 index.js 中引入一下 Example6.js 文件，引入后 React 才能正确渲染出刚写的 UI 组件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Example</span> <span class="keyword">from</span> <span class="string">&quot;./Example6/Example6&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Example</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>编写颜色共享组件 color.js</p>
</blockquote>
<p>有了 UI 组件后，就可以写一些业务逻辑了，实现状态共享，这个就是利用 useContext。建立一个 color.js 文件，然后写入下面的代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; createContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ColorContext</span> = <span class="title function_">createContext</span>(&#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">Color</span> = (<span class="params">props</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ColorContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> &quot;<span class="attr">blue</span>&quot; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;props.children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ColorContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>代码中引入了 createContext 用来创建共享上下文 ColorContext 组件，然后我们要用{props.children}来显示对应的子组件。</p>
<p>有了这个组件后，我们就可以把 Example6.js 进行改写，让她可以共享状态。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ShowArea</span> <span class="keyword">from</span> <span class="string">&quot;./ShowArea&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Buttons</span> <span class="keyword">from</span> <span class="string">&quot;./Buttons&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Color</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./color&quot;</span>; <span class="comment">//引入Color组件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Example6</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Color</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ShowArea</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Buttons</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Color</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Example6</span>;</span><br></pre></td></tr></table></figure>

<p>然后再改写 showArea.js 文件，引入 useContext 和在 color.js 中声明的 ColorContext，让组件可以接收全局变量。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ColorContext</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./color&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ShowArea</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; color &#125; = <span class="title function_">useContext</span>(<span class="title class_">ColorContext</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> <span class="attr">color</span> &#125;&#125;&gt;</span>字体颜色为&#123;color&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ShowArea</span>;</span><br></pre></td></tr></table></figure>

<p>这时候就通过 useContext 实现了状态的共享，可以到浏览器中看一下效果。</p>
<h5 id="8-useReducer-代替-Redux-小案例-2"><a href="#8-useReducer-代替-Redux-小案例-2" class="headerlink" title="8:useReducer 代替 Redux 小案例-2"></a>8:useReducer 代替 Redux 小案例-2</h5><p>用 useContext 实现了 Redux 状态共享的能力，这节课看一下如何使用 useReducer 来实现业务逻辑的控制。</p>
<blockquote>
<p>在 color.js 中添加 Reducer</p>
</blockquote>
<p>颜色（state）管理的代码我们都放在了 color.js 中，所以在文件里添加一个 reducer，用于处理颜色更新的逻辑。先声明一个 reducer 的函数，它就是 JavaScript 中的普通函数，在讲 useReducer 的时候已经详细讲过了。有了 reducer 后，在 Color 组件里使用 useReducer,这样 Color 组件就有了那个共享状态和处理业务逻辑的能力，跟以前使用的 Redux 几乎一样了。之后修改一下共享状态。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; createContext, useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">ColorContext</span> = <span class="title function_">createContext</span>(&#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">UPDATE_COLOR</span> = <span class="string">&quot;UPDATE_COLOR&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reducer</span> = (<span class="params">state, action</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="attr">UPDATE_COLOR</span>:</span><br><span class="line">      <span class="keyword">return</span> action.<span class="property">color</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">Color</span> = (<span class="params">props</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [color, dispatch] = <span class="title function_">useReducer</span>(reducer, <span class="string">&quot;blue&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ColorContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;</span> <span class="attr">color</span>, <span class="attr">dispatch</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;props.children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ColorContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>注意，这时候我们共享出去的状态变成了 color 和 dispatch,如果不共享出去 dispatch，是没办法完成按钮的相应事件的。</p>
<blockquote>
<p>通过 dispatch 修改状态</p>
</blockquote>
<p>目前程序已经有了处理共享状态的业务逻辑能力，接下来就可以在 buttons.js 使用 dispatch 来完成按钮的相应操作了。先引入 useContext、ColorContext 和 UPDATE_COLOR，然后写 onClick 事件就可以了。代码如下:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ColorContext</span>, <span class="variable constant_">UPDATE_COLOR</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./color&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Buttons</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; dispatch &#125; = <span class="title function_">useContext</span>(<span class="title class_">ColorContext</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          dispatch(&#123; type: UPDATE_COLOR, color: &quot;red&quot; &#125;);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        红色</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          dispatch(&#123; type: UPDATE_COLOR, color: &quot;yellow&quot; &#125;);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        黄色</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Buttons</span>;</span><br></pre></td></tr></table></figure>

<p>这样代码就编写完成了，用 useContext 和 useReducer 实现了 Redux 的效果，这个代码编写过程比 Redux 要简单，但是也是有一定难度的。</p>
<h5 id="9-useMemo-优化-React-Hooks-程序性能"><a href="#9-useMemo-优化-React-Hooks-程序性能" class="headerlink" title="9:useMemo 优化 React Hooks 程序性能"></a>9:useMemo 优化 React Hooks 程序性能</h5><p>useMemo 主要用来解决使用 React hooks 产生的无用渲染的性能问题。使用 function 的形式来声明组件，失去了 shouldCompnentUpdate（在组件更新之前）这个生命周期，也就是说我们没有办法通过组件更新前条件来决定组件是否更新。而且在函数组件中，也不再区分 mount 和 update 两个状态，这意味着函数组件的每一次调用都会执行内部的所有逻辑，就带来了非常大的性能损耗。useMemo 和 useCallback 都是解决上述性能问题的。</p>
<blockquote>
<p>性能问题展示案例</p>
</blockquote>
<p>先编写一下刚才所说的性能问题，建立两个组件,一个父组件一个子组件，组件上由两个按钮，一个是小红，一个是志玲，点击哪个，那个就像我们走来了。在&#x2F;src 文件夹下，新建立一个 Example7 的文件夹，在文件夹下建立一个 Example7.js 文件.然后先写第一个父组件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Example7</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [xiaohong, setXiaohong] = <span class="title function_">useState</span>(<span class="string">&quot;小红待客状态&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> [zhiling, setZhiling] = <span class="title function_">useState</span>(<span class="string">&quot;志玲待客状态&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setXiaohong(new Date().getTime());</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        小红</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setZhiling(new Date().getTime() + &quot;,志玲向我们走来了&quot;);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        志玲</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">name</span>=<span class="string">&#123;xiaohong&#125;</span>&gt;</span>&#123;zhiling&#125;<span class="tag">&lt;/<span class="name">ChildComponent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>父组件调用了子组件，子组件我们输出两个姑娘的状态，显示在界面上。代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ChildComponent</span>(<span class="params">&#123; name, children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">changeXiaohong</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;她来了，她来了。小红向我们走来了&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> name + <span class="string">&quot;,小红向我们走来了&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> actionXiaohong = <span class="title function_">changeXiaohong</span>(name); <span class="comment">//每次父组件发生变化，子组件也会每次触发，代码都会重新渲染一遍，性能严重消耗</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;actionXiaohong&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再导出父组件，让 index.js 可以渲染。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Example7</span>;</span><br></pre></td></tr></table></figure>

<p>这时候你会发现在浏览器中点击志玲按钮，小红对应的方法都会执行，结果虽然没变，但是每次都执行，这就是性能的损耗。目前只有子组件，业务逻辑也非常简单，如果是一个后台查询，这将产生严重的后果。所以这个问题必须解决。当我们点击志玲按钮时，小红对应的 changeXiaohong 方法不能执行，只有在点击小红按钮时才能执行。</p>
<blockquote>
<p>useMemo 优化性能</p>
</blockquote>
<p>其实只要使用 useMemo，然后给她传递第二个参数，参数匹配成功，才会执行。代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ChildComponent</span>(<span class="params">&#123; name, children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">changeXiaohong</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;她来了，她来了。小红向我们走来了&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> name + <span class="string">&quot;,小红向我们走来了&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> actionXiaohong = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="title function_">changeXiaohong</span>(name), [name]); <span class="comment">//第二个参数表示：只有name发生变化的时候才触发changeXiaohong</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;actionXiaohong&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时在浏览器中点击一下志玲按钮，changeXiaohong 就不再执行了。也节省了性能的消耗。</p>
<h5 id="10-useRef-获取-DOM-元素和保存变量"><a href="#10-useRef-获取-DOM-元素和保存变量" class="headerlink" title="10:useRef 获取 DOM 元素和保存变量"></a>10:useRef 获取 DOM 元素和保存变量</h5><p>useRef 在工作中虽然用的不多，但是也不能缺少。它有两个主要的作用:</p>
<ul>
<li><p>用 useRef 获取 React JSX 中的 DOM 元素，获取后你就可以控制 DOM 的任何东西了。但是一般不建议这样来作，React 界面的变化可以通过状态来控制。</p>
</li>
<li><p>用 useRef 来保存变量，这个在工作中也很少能用到，我们有了 useContext 这样的保存其实意义不大，但是这是学习，也要把这个特性讲一下。</p>
</li>
</ul>
<blockquote>
<p>1.useRef 获取 DOM 元素</p>
</blockquote>
<p>界面上有一个文本框，在文本框的旁边有一个按钮，当我们点击按钮时，在控制台打印出 input 的 DOM 元素，并进行复制到 DOM 中的 value 上。这一切都是通过 useRef 来实现。</p>
<p>在&#x2F;src 文件夹下新建一个 Example8.js 文件，然后先引入 useRef，编写业务逻辑代码如下:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Example8</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputEl = <span class="title function_">useRef</span>(<span class="literal">null</span>); <span class="comment">//获取DOM</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onButtonClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    inputEl.<span class="property">current</span>.<span class="property">value</span> = <span class="string">&quot;Hello,Daykalif&quot;</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(inputEl); <span class="comment">//输出获取到的DOM节点</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/*保存input的ref到inputEl */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputEl&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onButtonClick&#125;</span>&gt;</span>在input上展示文字<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Example8</span>;</span><br></pre></td></tr></table></figure>

<p>当点击按钮时，你可以看到在浏览器中的控制台完整的打印出了 DOM 的所有东西，并且界面上的 input 框的 value 值也输出了我们写好的 Hello,Daykalif。这一切说明我们可以使用 useRef 获取 DOM 元素，并且可以通过 useRefu 控制 DOM 的属性和值。</p>
<blockquote>
<p>2.useRef 保存普通变量</p>
</blockquote>
<p>这个操作在实际开发中用的并不多,就是 useRef 可以保存 React 中的变量。这里就写一个文本框，文本框用来改变 text 状态。又用 useRef 把 text 状态进行保存，最后打印在控制台上。写这段代码会觉的很绕，其实显示开发中没必要这样写，用一个 state 状态就可以搞定，这里只是为了展示知识点。</p>
<p>接着上面的代码来写，就没必要重新写一个文件了。先用 useState 声明了一个 text 状态和 setText 函数。然后编写界面，界面就是一个文本框。然后输入的时候不断变化。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useRef, useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Example8</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputEl = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onButtonClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    inputEl.<span class="property">current</span>.<span class="property">value</span> = <span class="string">&quot;Hello ,useRef&quot;</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(inputEl);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> [text, setText] = <span class="title function_">useState</span>(<span class="string">&quot;daykalif&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/*保存input的ref到inputEl */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputEl&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onButtonClick&#125;</span>&gt;</span>在input上展示文字<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;text&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setText(e.target.value);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Example8</span>;</span><br></pre></td></tr></table></figure>

<p>这时想每次 text 发生状态改变，保存到一个变量中或者说是 useRef 中，这时候就可以使用 useRef 了。先声明一个 textRef 变量，他其实就是 useRef 函数。然后使用 useEffect 函数实现每次状态变化都进行变量修改，并打印。最后的全部代码如下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useRef, useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Example8</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputEl = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onButtonClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    inputEl.<span class="property">current</span>.<span class="property">value</span> = <span class="string">&quot;Hello ,useRef&quot;</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(inputEl);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//-----------关键代码--------start</span></span><br><span class="line">  <span class="keyword">const</span> [text, setText] = <span class="title function_">useState</span>(<span class="string">&quot;daykalif&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> textRef = <span class="title function_">useRef</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    textRef.<span class="property">current</span> = text;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;textRef.current:&quot;</span>, textRef.<span class="property">current</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//----------关键代码--------------end</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/*保存input的ref到inputEl */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputEl&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onButtonClick&#125;</span>&gt;</span>在input上展示文字<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;text&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setText(e.target.value);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Example8</span>;</span><br></pre></td></tr></table></figure>

<p>这时候就可以实现每次状态修改，同时保存到 useRef 中了。也就是我们说的保存变量的功能。那 useRef 的主要功能就是获得 DOM 和变量保存。</p>
<h5 id="11-自定义-Hooks-函数获取窗口大小"><a href="#11-自定义-Hooks-函数获取窗口大小" class="headerlink" title="11: 自定义 Hooks 函数获取窗口大小"></a>11: 自定义 Hooks 函数获取窗口大小</h5><p>其实自定义 Hooks 函数和用 Hooks 创建组件很相似，跟我们平时用 JavaScript 写函数几乎一模一样，可能就是多了些 React Hooks 的特性，自定义 Hooks 函数偏向于功能，而组件偏向于界面和业务逻辑。由于差别不大，所以使用起来也是很随意的。如果是小型项目是可以的，但是如果项目足够复杂，这会让项目结构不够清晰。</p>
<blockquote>
<p>编写自定义函数</p>
</blockquote>
<p>在实际开发中，为了界面更加美观。获取浏览器窗口的尺寸是一个经常使用的功能，这样经常使用的功能，就可以封装成一个自定义 Hooks 函数，记住一定要用 use 开头，这样才能区分出什么是组件，什么是自定义函数。</p>
<p>新建一个文件 Example9.js,然后编写一个 useWinSize,编写时我们会用到 useState、useEffect 和 useCallback 所以先用 import 进行引入。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect, useCallback &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>然后编写函数，函数中先用 useState 设置 size 状态，然后编写一个每次修改状态的方法 onResize，这个方法使用 useCallback，目的是为了缓存方法(useMemo 是为了缓存变量)。 然后在第一次进入方法时用 useEffect 来注册 resize 监听时间。为了防止一直监听所以在方法移除时，使用 return 的方式移除监听。最后返回 size 变量就可以了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useWinSize</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//自定义hooks函数名，以use开头</span></span><br><span class="line">  <span class="keyword">const</span> [size, setSize] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onResize = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//useCallback会缓存方法；useMemo是为了缓存变量</span></span><br><span class="line">    <span class="title function_">setSize</span>(&#123;</span><br><span class="line">      <span class="attr">width</span>: <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span>,</span><br><span class="line">      <span class="attr">height</span>: <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;resize&quot;</span>, onResize);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//销毁时执行</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;resize&quot;</span>, onResize);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这就是一个自定义函数，方法名默认 use 开头，其实和以前写的 JS 函数没什么区别。</p>
<blockquote>
<p>编写组件并使用自定义函数</p>
</blockquote>
<p>自定义 Hooks 函数已经写好了，可以直接进行使用，用法和 JavaScript 的普通函数用起来是一样的。直接在 Example9 组件使用 useWinSize 并把结果实时展示在页面上。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Example9</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> size = <span class="title function_">useWinSize</span>();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      页面Size:&#123;size.width&#125;x&#123;size.height&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Example9</span>;</span><br></pre></td></tr></table></figure>

<p>之后就可以在浏览器中预览一下结果，可以看到当放大缩小浏览器窗口时，页面上的结果都会跟着进行变化。说明自定义的函数起到了作用。</p>
<h3 id="useReducer-的简单应用"><a href="#useReducer-的简单应用" class="headerlink" title="useReducer 的简单应用"></a>useReducer 的简单应用</h3><p>1.counter 计数器示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.引入 useReducer</span></span><br><span class="line"><span class="comment">// import &#123; useReducer &#125; from &quot;react&quot;;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;./fakeReducer&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.编写处理函数，传入两个参数【纯函数：如数变量确定的话，输出是不变的】</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reducer</span> = (<span class="params">state, action</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;ADD&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;DECREASE&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> state - <span class="number">1</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Counter</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 2.调用 useReducer，传入两个参数，第一个参数是处理函数，第二个参数是初始值</span></span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      第 4 步：展示计数器&#123;state&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;/_ 第 5 步：点击派发动作 _/&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;ADD&quot; &#125;)&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;DECREASE&quot; &#125;)&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Counter</span>;</span><br></pre></td></tr></table></figure>

<p>2.手写 useReducer</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/\*\*</span><br><span class="line"></span><br><span class="line">- 手写 reducer</span><br><span class="line">  \*/</span><br><span class="line">  <span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">useReducer</span> = (<span class="params">reducer, initialState = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">const</span> [state, updateState] = <span class="title function_">useState</span>(initialState);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">dispatch</span> = (<span class="params">action</span>) =&gt; &#123;</span><br><span class="line"><span class="title function_">updateState</span>(<span class="title function_">reducer</span>(state, action))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> [state, dispatch];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.复杂应用 demo，购物车实现<br>购物车 jsx：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; shoppingCartReducer &#125; <span class="keyword">from</span> <span class="string">&quot;./shoppingCartReducer&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  <span class="attr">products</span>: [</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;太阳眼镜&quot;</span>, <span class="attr">num</span>: <span class="number">1</span>, <span class="attr">price</span>: <span class="number">200</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;充电宝&quot;</span>, <span class="attr">num</span>: <span class="number">1</span>, <span class="attr">price</span>: <span class="number">96</span> &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">total</span>: <span class="number">296</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ShoppingCart</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(shoppingCartReducer, initialState);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>购物车<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;state.products.map((product) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">          return (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;product.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              &#123;product.name&#125; &#123;product.num&#125; &#123;product.price&#125;</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;ADD&quot;, payload: product.id &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">              &gt;</span></span><br><span class="line"><span class="language-xml">                +</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span></span></span><br><span class="line"><span class="language-xml">                  dispatch(&#123; type: &quot;DECREASE&quot;, payload: product.id &#125;)</span></span><br><span class="line"><span class="language-xml">                &#125;</span></span><br><span class="line"><span class="language-xml">              &gt;</span></span><br><span class="line"><span class="language-xml">                -</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          );</span></span><br><span class="line"><span class="language-xml">        &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;CLEAR&quot; &#125;)&#125;&gt;清空<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      总计：&#123;state.total&#125;元</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ShoppingCart</span>;</span><br></pre></td></tr></table></figure>

<p>reduer 实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">shoppingCartReducer</span> = (<span class="params">state, action</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> newState = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(state));</span><br><span class="line">  <span class="keyword">const</span> id = action.<span class="property">payload</span>;</span><br><span class="line">  <span class="keyword">const</span> index = state.<span class="property">products</span>.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">product</span>) =&gt;</span> product.<span class="property">id</span> === id);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;ADD&quot;</span>:</span><br><span class="line">      newState.<span class="property">products</span>[index].<span class="property">num</span>++;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;DECREASE&quot;</span>:</span><br><span class="line">      <span class="keyword">if</span> (state.<span class="property">products</span>[index].<span class="property">num</span> &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        newState.<span class="property">products</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        newState.<span class="property">products</span>[index].<span class="property">num</span>--;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;CLEAR&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">products</span>: [], <span class="attr">total</span>: <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  newState.<span class="property">total</span> = newState.<span class="property">products</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">total, product</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> total + product.<span class="property">num</span> * product.<span class="property">price</span>;</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> newState;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>参考视频：<br><a href="https://www.bilibili.com/video/BV1y4411Q7yH">https://www.bilibili.com/video/BV1y4411Q7yH</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2021/01/28/JS/JS%E7%BB%A7%E6%89%BF%E7%9A%84%E5%85%AD%E7%A7%8D%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/01/28/JS/JS%E7%BB%A7%E6%89%BF%E7%9A%84%E5%85%AD%E7%A7%8D%E6%96%B9%E6%B3%95/" itemprop="url">JS继承的六种方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-01-28T09:25:34+08:00">
                2021-01-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/01/28/JS/JS%E7%BB%A7%E6%89%BF%E7%9A%84%E5%85%AD%E7%A7%8D%E6%96%B9%E6%B3%95/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2021/01/28/JS/JS%E7%BB%A7%E6%89%BF%E7%9A%84%E5%85%AD%E7%A7%8D%E6%96%B9%E6%B3%95/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2021/01/28/JS/JS%E7%BB%A7%E6%89%BF%E7%9A%84%E5%85%AD%E7%A7%8D%E6%96%B9%E6%B3%95/" class="leancloud_visitors" data-flag-title="JS继承的六种方法">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  3.6k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  15
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="类的三大特性"><a href="#类的三大特性" class="headerlink" title="类的三大特性"></a>类的三大特性</h2><p>封装：低耦合高内聚<br>继承：子类继承父类中的属性和方法<br>多态：重载和重写</p>
<ul>
<li>重载：方法名相同，形参个数或者类型不一样（JS 中不存在真正意义上的重载，JS 中重载指的是同一个方法，根据传参不同，实现出不同的效果）</li>
<li>重写：在类的继承当中，子类可以重写父类中的方法</li>
</ul>
<!--
什么是面向对象？
    面向对象是一种编程思想，JS本身就是基于面向对象构建出来的（例如：JS中有很多内置类，像Promise就是ES6中新增的内置类，我们可以基于new Promise来创建一个实例，来管理异步编程，我在项目中，Promise也经常用，自己也研究过它的源码...），我之前看过一点框架源码，我们平时用到vue，react，jquery也是基于面向对象构建出来的，它们都是类，平时开发的时候，都是创建它们的实例来操作的；当然我自己在真实项目中，也封装过一些组件插件(例如：DIALOG、拖拽、轮播图)，也是基于面向对象开发的，这样可以创造不同的实例，来管理私有的属性和公有的方法，很方便...

JS中的面向对象，和其他编程语言还是略微不同的，JS中类和实例是基于原型和原型链机制来处理的；而且JS中关于类的重载、重写、继承也和其他语言不太一样...

-->

<h3 id="js-继承"><a href="#js-继承" class="headerlink" title="js 继承"></a>js 继承</h3><p>$\color{red}{平台1:}$</p>
<h4 id="视频详解："><a href="#视频详解：" class="headerlink" title="视频详解："></a>视频详解：</h4><p>继承：子类继承父类中的属性和方法（目的是让子类的实例能够调取父类中的属性和方法）</p>
<h4 id="SE5-中的继承方式："><a href="#SE5-中的继承方式：" class="headerlink" title="SE5 中的继承方式："></a>SE5 中的继承方式：</h4><h5 id="方案一：原型继承"><a href="#方案一：原型继承" class="headerlink" title="方案一：原型继承"></a>方案一：原型继承</h5><p><img src="https://www.daykalif.com/blog_img/yuanxinglian1.png" alt="原型继承"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 让父类中的属性和方法在子类实例的原型链上 </span></span><br><span class="line"><span class="comment"> CHILD.prototype = new PARENT();</span></span><br><span class="line"><span class="comment"> CHILD.prototype.constructor = CHILD;//保证原型重定向后的完整性</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> 特点：</span></span><br><span class="line"><span class="comment"> 1.不像其他语言中的继承一样（其他语言继承一般是拷贝继承，也就是子类继承父类，会把父类中的属性和方法拷贝一份到子类中，供子类的实例调取使用）,</span></span><br><span class="line"><span class="comment"> 它是把父类的原型放到子类实例的原型链上。实例想调取这些方法，是基于__proto__原型链查找机制完成的。</span></span><br><span class="line"><span class="comment"> 2.子类可以重写父类上的方法（这样会导致父类其它的实例也受到影响）</span></span><br><span class="line"><span class="comment"> 3.父类中私有或者公有的属性方法最后都会变为子类中公有的属性和方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">x</span> = x;</span><br><span class="line">&#125;</span><br><span class="line">A.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getX</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">x</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">B</span>(<span class="params">y</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">y</span> = y;</span><br><span class="line">&#125;</span><br><span class="line">B.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title function_">A</span>(<span class="number">200</span>);</span><br><span class="line">B.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = B;</span><br><span class="line">B.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getY</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">y</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b1 = <span class="keyword">new</span> <span class="title function_">B</span>(<span class="number">100</span>);</span><br><span class="line"><span class="comment">// 当前可执行：</span></span><br><span class="line">b1.<span class="property">y</span>;</span><br><span class="line">b1.<span class="title function_">getY</span>();</span><br><span class="line"><span class="comment">// 继承之后可使用</span></span><br><span class="line">b1.<span class="title function_">getX</span>();</span><br></pre></td></tr></table></figure>

<h5 id="方案二：call-继承"><a href="#方案二：call-继承" class="headerlink" title="方案二：call 继承"></a>方案二：call 继承</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CALL继承的特点：</span></span><br><span class="line"><span class="comment"> * 在CHILD方法当中，把PARENT当作普通函数执行，让PARENT中的THIS指向CHILD的实例，相当于给CHILD的实例设置了很多私有的属性或者方法</span></span><br><span class="line"><span class="comment"> * 1.只能继承父类私有的属性或者方法（因为是把PARENT当作普通函数执行，和其原型上的属性和方法没有关系）</span></span><br><span class="line"><span class="comment"> * 2.父类私有的变为子类私有的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">x</span> = x;</span><br><span class="line">&#125;</span><br><span class="line">A.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getX</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">x</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">B</span>(<span class="params">y</span>) &#123;</span><br><span class="line">  <span class="comment">// A(200);//=&gt;相当于 window.x=200</span></span><br><span class="line">  A.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="number">200</span>); <span class="comment">//this属于B的实例b1 //=&gt; b1.x = 200;</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">y</span> = y;</span><br><span class="line">&#125;</span><br><span class="line">B.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getY</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">y</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> b1 = <span class="keyword">new</span> <span class="title function_">B</span>(<span class="number">100</span>);</span><br><span class="line">b1.<span class="property">x</span>;</span><br><span class="line">b1.<span class="property">y</span>;</span><br></pre></td></tr></table></figure>

<h5 id="方案三：寄生组合继承（推荐）"><a href="#方案三：寄生组合继承（推荐）" class="headerlink" title="方案三：寄生组合继承（推荐）"></a>方案三：寄生组合继承（推荐）</h5><p><img src="https://www.daykalif.com/blog_img/jishengzuhejicheng1.png" alt="寄生组合继承"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 寄生组合继承：CALL继承+类似于原型继承</span></span><br><span class="line"><span class="comment"> * 特点：父类私有和公有的分别是子类实例的私有和公有属性和方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">x</span> = x;</span><br><span class="line">&#125;</span><br><span class="line">A.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getX</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">x</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">B</span>(<span class="params">y</span>) &#123;</span><br><span class="line">  A.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="number">200</span>); <span class="comment">//this属于B的实例b1 //=&gt; b1.x = 200;</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">y</span> = y;</span><br><span class="line">&#125;</span><br><span class="line">B.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(A.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">//Object.create(OBJ);创建一个空对象，让空对象的__proto__指向OBJ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模拟Object.create：</span></span><br><span class="line"><span class="comment"> * Object.create = function(obj)&#123;</span></span><br><span class="line"><span class="comment"> *      //let oo = &#123;&#125;;</span></span><br><span class="line"><span class="comment"> *      //oo.__proto__ = obj;     //IE6不可使用__proto__,所以可以改写从下述方式</span></span><br><span class="line"><span class="comment"> *      //return oo;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      function Fn()&#123;&#125;</span></span><br><span class="line"><span class="comment"> *      Fn.prototype = obj;</span></span><br><span class="line"><span class="comment"> *      return new Fn();//创建一个空实例，其原型指向obj</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">B.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = B;</span><br><span class="line">B.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getY</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">y</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> b1 = <span class="keyword">new</span> <span class="title function_">B</span>(<span class="number">100</span>);</span><br><span class="line">b1.<span class="property">x</span>;</span><br><span class="line">b1.<span class="property">y</span>;</span><br></pre></td></tr></table></figure>

<h4 id="SE6-中的继承方式："><a href="#SE6-中的继承方式：" class="headerlink" title="SE6 中的继承方式："></a>SE6 中的继承方式：</h4><h5 id="方案四：extends-继承"><a href="#方案四：extends-继承" class="headerlink" title="方案四：extends 继承"></a>方案四：extends 继承</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ES6中基于CLASS创造出来的类不能当作普通函数执行（因此CALL继承的方式在ES6中就不能这么写了）</span></span><br><span class="line"><span class="comment"> * ES6也不允许重定向原型的指向</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">x</span> = x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getX</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">x</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">A.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">type</span> = <span class="number">100</span>; <span class="comment">//添加原型上公有属性</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">y</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">y</span> = y;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getY</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">y</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// B.prototype = Object.create(A.prototype);    //ES6不允许重定向原型的指向</span></span><br><span class="line"><span class="keyword">let</span> b1 = <span class="keyword">new</span> <span class="title function_">B</span>(<span class="number">200</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b1);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//=&gt;ES6中的继承  ==&gt; 原理就是寄生组合方式</span></span><br><span class="line"><span class="comment">// CLASS CHILD extends PARENT&#123;&#125;  ==&gt;相当于  B.prototype.__proto__ = A.prototype</span></span><br><span class="line"><span class="comment">// 实现父类原型上公有的变为子类公有的，父类私有的变为子类私有的</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">x</span> = x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getX</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">x</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_ inherited__">A</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">y</span>) &#123;</span><br><span class="line">    <span class="comment">//如果不写CONSTRUCTOR，浏览器会自己默认创建CONSTRUCTOR(...args)&#123; super(...args) &#125;，如果我们写了，就以我们写的代码为主</span></span><br><span class="line">    <span class="comment">// 子类只要继承父类，可以不写CONSTRUCTOR，一旦写了，则在CONSTRUCTOR中的第一句话必须是SUPER();</span></span><br><span class="line">    <span class="variable language_">super</span>(<span class="number">200</span>); <span class="comment">//super =&gt; 相当于A.call(this,200)  把父类当作普通方法执行，给方法传递参数，让方法中的THIS是子类的实例</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">y</span> = y;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getY</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">y</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> b1 = <span class="keyword">new</span> <span class="title function_">B</span>(<span class="number">100</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b1);</span><br></pre></td></tr></table></figure>

<h5 id="extends-应用"><a href="#extends-应用" class="headerlink" title="extends 应用"></a>extends 应用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Login</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">componentWillMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(); <span class="comment">//React.Component.prototype.setState=...    //this.setState() 是写在React.Component 的公共方法；</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Promise.prototype:then catch finally...</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dialog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Promise</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">show</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">then</span>().<span class="title function_">then</span>(); <span class="comment">//this是Dialog的实例</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Utils</span> &#123;</span><br><span class="line">  <span class="title function_">query</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 方式1:</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dialog</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Utils</span>().<span class="title function_">query</span>(); <span class="comment">//调用query</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 方式2:</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dialog1</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Utils</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">query</span>(); <span class="comment">//调用query</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>$\color{red}{平台2:}$</p>
<h4 id="父类"><a href="#父类" class="headerlink" title="父类"></a>父类</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="comment">//给构造函数添加了参数</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sum</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">num</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">age</span> = <span class="number">10</span>; <span class="comment">//给构造函数添加了原型属性</span></span><br></pre></td></tr></table></figure>

<h5 id="1-原型链继承"><a href="#1-原型链继承" class="headerlink" title="1.原型链继承"></a>1.原型链继承</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Per</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;haha&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Per</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Per</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">age</span>); <span class="comment">//10</span></span><br><span class="line"><span class="comment">// instanceof判断元素是否在另一个元素的原型链上</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1 <span class="keyword">instanceof</span> <span class="title class_">Person</span>); <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">重点：让新实例的原型等于父类的实例。</span></span><br><span class="line"><span class="comment">特点：1、实例可继承的属性有：实例的构造函数的属性，父类构造函数属性，父类原型的属性。（新实例不会继承父类实例的属性！）</span></span><br><span class="line"><span class="comment">缺点：1、新实例无法向父类构造函数传参。</span></span><br><span class="line"><span class="comment">　　　2、继承单一。</span></span><br><span class="line"><span class="comment">　　　3、所有新实例都会共享父类实例的属性。（原型上的属性是共享的，一个实例修改了原型属性，另一个实例的原型属性也会被修改！）</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h5 id="2-构造函数继承"><a href="#2-构造函数继承" class="headerlink" title="2.构造函数继承"></a>2.构造函数继承</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Con</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="string">&quot;hehe&quot;</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = <span class="number">12</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> c1 = <span class="keyword">new</span> <span class="title class_">Con</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1.<span class="property">name</span>); <span class="comment">//hehe</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1.<span class="property">age</span>); <span class="comment">//12</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1 <span class="keyword">instanceof</span> <span class="title class_">Person</span>); <span class="comment">//false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">重点：用.call()和.apply()将父类构造函数引入子类函数（在子类函数中做了父类函数的自执行（复制））</span></span><br><span class="line"><span class="comment">　　　　特点：1、只继承了父类构造函数的属性，没有继承父类原型的属性。</span></span><br><span class="line"><span class="comment">　　　　　　　2、解决了原型链继承缺点1、2、3。</span></span><br><span class="line"><span class="comment">　　　　　　　3、可以继承多个构造函数属性（call多个）。</span></span><br><span class="line"><span class="comment">　　　　　　　4、在子实例中可向父实例传参。</span></span><br><span class="line"><span class="comment">　　　　缺点：1、只能继承父类构造函数的属性。</span></span><br><span class="line"><span class="comment">　　　　　　　2、无法实现构造函数的复用。（每次用每次都要重新调用）</span></span><br><span class="line"><span class="comment">　　　　　　　3、每个新实例都有父类构造函数的副本，臃肿。</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h5 id="3-组合继承（组合原型链继承和借用构造函数继承）（常用）"><a href="#3-组合继承（组合原型链继承和借用构造函数继承）（常用）" class="headerlink" title="3.组合继承（组合原型链继承和借用构造函数继承）（常用）"></a>3.组合继承（组合原型链继承和借用构造函数继承）（常用）</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">SubType</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name); <span class="comment">//借用构造函数模式</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">SubType</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Person</span>(); <span class="comment">//原型链继承</span></span><br><span class="line"><span class="keyword">var</span> sub = <span class="keyword">new</span> <span class="title class_">SubType</span>(<span class="string">&quot;xixi&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sub.<span class="property">name</span>); <span class="comment">//xixi</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sub.<span class="property">age</span>); <span class="comment">//10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">重点：结合了两种模式的优点，传参和复用</span></span><br><span class="line"><span class="comment">　　　　特点：1、可以继承父类原型上的属性，可以传参，可复用。</span></span><br><span class="line"><span class="comment">　　　　　　　2、每个新实例引入的构造函数属性是私有的。</span></span><br><span class="line"><span class="comment">　　　　缺点：调用了两次父类构造函数（耗内存），子类的构造函数会代替原型上的那个父类构造函数。</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h5 id="4-原型式继承"><a href="#4-原型式继承" class="headerlink" title="4.原型式继承"></a>4.原型式继承</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先封装一个函数容器，用来输出对象和承载继承的原型</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">content</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  F.<span class="property"><span class="keyword">prototype</span></span> = obj; <span class="comment">//继承了传入的参数</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>(); <span class="comment">//返回函数对象</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> sup = <span class="keyword">new</span> <span class="title class_">Person</span>(); <span class="comment">//拿到父类的实例</span></span><br><span class="line"><span class="keyword">var</span> sup1 = <span class="title function_">content</span>(sup);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sup1.<span class="property">age</span>); <span class="comment">//10 继承了父类函数的属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">重点：用一个函数包装一个对象，然后返回这个函数的调用，这个函数就变成了个可以随意增添属性的实例或对象。object.create()就是这个原理。</span></span><br><span class="line"><span class="comment">　　　　特点：类似于复制一个对象，用函数来包装。</span></span><br><span class="line"><span class="comment">　　　　缺点：1、所有实例都会继承原型上的属性。</span></span><br><span class="line"><span class="comment">　　　　　　　2、无法实现复用。（新实例属性都是后面添加的）</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h5 id="5-寄生式继承"><a href="#5-寄生式继承" class="headerlink" title="5.寄生式继承"></a>5.寄生式继承</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">content</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  F.<span class="property"><span class="keyword">prototype</span></span> = obj;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> sup = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="comment">//以上是原型式继承，给原型式继承再套个壳子传递参数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">subobject</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> sub = <span class="title function_">content</span>(obj);</span><br><span class="line">  sub.<span class="property">name</span> = <span class="string">&quot;lala&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> sub;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> sup2 = <span class="title function_">subobject</span>(sup);</span><br><span class="line"><span class="comment">// 这个函数经过声明之后就成了可增添属性的对象</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> subobject); <span class="comment">//function</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> sup2); <span class="comment">//object</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sup2.<span class="property">name</span>); <span class="comment">//lala  返回了个sub对象，继承了sub的属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">重点：就是给原型式继承外面套了个壳子。</span></span><br><span class="line"><span class="comment">　　　　优点：没有创建自定义类型，因为只是套了个壳子返回对象（这个），这个函数顺理成章就成了创建的新对象。</span></span><br><span class="line"><span class="comment">　　　　缺点：没用到原型，无法复用。</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h5 id="6-寄生组合继承（常用）"><a href="#6-寄生组合继承（常用）" class="headerlink" title="6.寄生组合继承（常用）"></a>6.寄生组合继承（常用）</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 寄生</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">content</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  F.<span class="property"><span class="keyword">prototype</span></span> = obj;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// content就是F实例的另一种表示法</span></span><br><span class="line"><span class="keyword">var</span> con = <span class="title function_">content</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="comment">// con实例（F实例）的原型继承了父类函数的原型</span></span><br><span class="line"><span class="comment">// 上述更像是原型链继承，只不过只继承了原型的属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Sub</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>); <span class="comment">//这个继承了父类构造函数的属性</span></span><br><span class="line">&#125; <span class="comment">//解决了组合式两次调用构造函数属性的缺点</span></span><br><span class="line"><span class="title class_">Sub</span>.<span class="property"><span class="keyword">prototype</span></span> = con; <span class="comment">//继承了con实例</span></span><br><span class="line">con.<span class="property">constructor</span> = <span class="title class_">Sub</span>(); <span class="comment">//一定要修复实例</span></span><br><span class="line"><span class="keyword">var</span> sub1 = <span class="keyword">new</span> <span class="title class_">Sub</span>();</span><br><span class="line"><span class="comment">// Sub的实例就是继承了构造函数属性，父类实例，con的函数属性</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sub1.<span class="property">age</span>); <span class="comment">//10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">寄生：在函数内返回对象然后调用</span></span><br><span class="line"><span class="comment">组合：1、函数的原型等于另一个实例。2、在函数中用apply或者call引入另一个构造函数，可传参　</span></span><br><span class="line"><span class="comment">重点：修复了组合继承的问题</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<hr>
<p>$\color{red}{平台3:}$</p>
<p>要想实现继承，需要有子类和父类</p>
<h4 id="父类-1"><a href="#父类-1" class="headerlink" title="父类"></a>父类</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="comment">// 属性</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name || <span class="string">&quot;Animal&quot;</span>;</span><br><span class="line">  <span class="comment">// 方法</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">eat</span> = <span class="keyword">function</span> (<span class="params">food</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;在吃&quot;</span> + food);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 原型方法</span></span><br><span class="line"><span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sleep</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;正在睡觉！&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="1-原型链继承-1"><a href="#1-原型链继承-1" class="headerlink" title="1.原型链继承"></a>1.原型链继承</h5><p><strong>核心：</strong><br>让新实例的原型等于父类的实例</p>
<p><strong>特点：</strong><br>直接的继承关系<br>父类新增的方法或属性包括原型方法和原型属性，子类都可以访问</p>
<p><strong>缺点：</strong> 1.子类新增属性方法 2.创建子类实例时，无法向父类构造器函数传参</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Dog</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">type</span> = <span class="string">&quot;犬科&quot;</span>; <span class="comment">//2).子类新增属性方法</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Dog.prototype.age = 5;//不存在</span></span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Animal</span>();</span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">name</span> = <span class="string">&quot;菠太郎&quot;</span>;</span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sex</span> = <span class="string">&quot;公&quot;</span>; <span class="comment">//1).子类新增属性方法，需要在new之后</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化对象</span></span><br><span class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog.<span class="property">name</span>); <span class="comment">//菠太郎</span></span><br><span class="line">dog.<span class="title function_">eat</span>(<span class="string">&quot;米饭！&quot;</span>); <span class="comment">//菠太郎在吃米饭！</span></span><br><span class="line">dog.<span class="title function_">sleep</span>(); <span class="comment">//菠太郎正在睡觉！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类的实例既是父类的实例，也是自身</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog <span class="keyword">instanceof</span> <span class="title class_">Animal</span>); <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog <span class="keyword">instanceof</span> <span class="title class_">Dog</span>); <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog); <span class="comment">//Dog&#123;type:&quot;犬科&quot;,__proto__:Animal&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-构造函数继承-1"><a href="#2-构造函数继承-1" class="headerlink" title="2.构造函数继承"></a>2.构造函数继承</h5><p><strong>核心：</strong><br>使用父类的构造函数来增强子类的实例</p>
<p><strong>特点：</strong><br>可以实现多继承<br>创建子类的实例可以向父类传递参数</p>
<p><strong>缺点：</strong><br>子类的实例是自身而不是父类的实例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Typeanimal</span>(<span class="params">type</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">type</span> = type;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Cat</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Animal</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="string">&quot;猫&quot;</span>); <span class="comment">//call 对象的指针替换，第一个参数this，第二个参数以列表的形式传递参数</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 实现多继承</span></span><br><span class="line">  <span class="title class_">Typeanimal</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, [<span class="string">&quot;猫科&quot;</span>]); <span class="comment">//apply 对象的指针替换，第一个参数this，第二个参数开始以集合的形式传递参数</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat); <span class="comment">//Cat&#123;type:&quot;猫科&quot;,name:&quot;猫&quot;,eat:f(food),__proto__:Cat&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat <span class="keyword">instanceof</span> <span class="title class_">Cat</span>); <span class="comment">//true   //子类的实例是自身</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat <span class="keyword">instanceof</span> <span class="title class_">Animal</span>); <span class="comment">//false -- //子类的实例不是父类的实例 -- 所以也没有父类的原型方法（sleep方法）了</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat <span class="keyword">instanceof</span> <span class="title class_">Typeanimal</span>); <span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<h5 id="3-实例继承"><a href="#3-实例继承" class="headerlink" title="3.实例继承"></a>3.实例继承</h5><p><strong>核心：</strong><br>父类实例作为子类实例返回</p>
<p><strong>特点：</strong><br>实例继承可以 new 对象，也可以直接调用</p>
<p><strong>缺点：</strong><br>子类的实例是父类的实例，不是子类的实例（也就是本身）<br>不支持多继承</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Mouse</span>(<span class="params"></span>) &#123;</span><br><span class="line">  anim = <span class="keyword">new</span> <span class="title class_">Animal</span>();</span><br><span class="line">  anim.<span class="property">name</span> = <span class="string">&quot;老鼠&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> anim;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Mouse</span>()); <span class="comment">//2).直接调用方法  //Animal&#123;name:&quot;老鼠&quot;,eat:f(food),__proto__:Animal&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mouse1 = <span class="keyword">new</span> <span class="title class_">Mouse</span>(); <span class="comment">//1).实例继承可以new对象</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mouse1); <span class="comment">//Animal&#123;name:&quot;老鼠&quot;,eat:f(food),__proto__:Animal&#125;  //子类的实例是父类的实例，不是子类的实例（也就是本身）</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mouse1 <span class="keyword">instanceof</span> <span class="title class_">Mouse</span>); <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mouse1 <span class="keyword">instanceof</span> <span class="title class_">Animal</span>); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<h5 id="4-拷贝继承"><a href="#4-拷贝继承" class="headerlink" title="4.拷贝继承"></a>4.拷贝继承</h5><p><strong>特点：</strong><br>支持多继承</p>
<p><strong>缺点：</strong><br>效率比较低<br>占的内存较多<br>子类的实例是自身而不是父类</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Fish</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> anim = <span class="keyword">new</span> <span class="title class_">Animal</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> anim) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key); <span class="comment">// name eat sleep</span></span><br><span class="line">    <span class="title class_">Fish</span>.<span class="property"><span class="keyword">prototype</span></span>[key] = anim[key];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title class_">Fish</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">name</span> = <span class="string">&quot;金枪鱼&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fish = <span class="keyword">new</span> <span class="title class_">Fish</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fish); <span class="comment">//Fish&#123;__proto__:Fish&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fish <span class="keyword">instanceof</span> <span class="title class_">Fish</span>); <span class="comment">//true  //子类的实例是自身而不是父类</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fish <span class="keyword">instanceof</span> <span class="title class_">Animal</span>); <span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<h5 id="5-组合继承"><a href="#5-组合继承" class="headerlink" title="5.组合继承"></a>5.组合继承</h5><p><strong>特点：</strong><br>构造继承+原型继承</p>
<p><strong>优点：</strong><br>调用两次类的构造函数，生成了两次类的对象</p>
<p><strong>缺点：</strong></p>
<p>调用了两次父类构造函数（耗内存），子类的构造函数会代替原型上的那个父类构造函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Rabbit</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Animal</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="string">&quot;兔子&quot;</span>); <span class="comment">//构造继承</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Rabbit</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Animal</span>(); <span class="comment">//原型继承</span></span><br><span class="line"><span class="title class_">Rabbit</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Rabbit</span>; <span class="comment">//修改原型构造方法</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rabbit = <span class="keyword">new</span> <span class="title class_">Rabbit</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rabbit); <span class="comment">//Rabbit&#123;eat:f(food),name:&quot;兔子&quot;,__proto__:Animal&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rabbit <span class="keyword">instanceof</span> <span class="title class_">Rabbit</span>); <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rabbit <span class="keyword">instanceof</span> <span class="title class_">Animal</span>); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<h5 id="6-寄生继承（也叫包装继承）"><a href="#6-寄生继承（也叫包装继承）" class="headerlink" title="6.寄生继承（也叫包装继承）"></a>6.寄生继承（也叫包装继承）</h5><p><strong>特点：</strong><br>拥有以上优点</p>
<p><strong>缺点：</strong><br>复杂</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Pig</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Animal</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, [<span class="string">&quot;猪猪&quot;</span>]);</span><br><span class="line">&#125;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 创建一个新的实例</span></span><br><span class="line">  <span class="keyword">var</span> porcupine = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;;</span><br><span class="line">  porcupine.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">  <span class="title class_">Pig</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title function_">porcupine</span>();</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="keyword">var</span> pig = <span class="keyword">new</span> <span class="title class_">Pig</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(pig); <span class="comment">//Pig&#123;eat:f(food),name:&quot;猪猪&quot;,__proto__:Animal&#125;</span></span><br><span class="line">pig.<span class="title function_">eat</span>(<span class="string">&quot;rice&quot;</span>); <span class="comment">//猪猪在吃rice</span></span><br><span class="line">pig.<span class="title function_">sleep</span>(); <span class="comment">//猪猪正在睡觉！</span></span><br></pre></td></tr></table></figure>

<p>更多文档：<br><a href="https://www.cnblogs.com/ranyonsue/p/11201730.html">https://www.cnblogs.com/ranyonsue/p/11201730.html</a></p>
<p>参考视频：<br><a href="https://www.bilibili.com/video/BV1BK41177hb?p=1">https://www.bilibili.com/video/BV1BK41177hb?p=1</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/7/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">115</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/daykalif" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:r00t_daykalif@aliyun.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.daykalif.com/" title="Daykalif" target="_blank">Daykalif</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-snowflake-o"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">r00t_daykalif</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">290.7k</span>
  
</div>






<div style="width:300px;margin:0 auto; padding:20px 0;">
	<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010902002156" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;">
    <img src="https://www.daykalif.com/beian.png" style="float:left;"/>
    <p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">
    浙公网安备 33010902002156号
    </p>
  </a>
</div>






        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'NXoB8ypSoELq08t7Y4t4Y7Co-gzGzoHsz',
        appKey: 'q00Ulu1a5iQSaM6XV0ba4QeF',
        placeholder: 'ヾﾉ≧∀≦)o来啊，快活啊!',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("NXoB8ypSoELq08t7Y4t4Y7Co-gzGzoHsz", "q00Ulu1a5iQSaM6XV0ba4QeF");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
