<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="stay hungry,stay foolish.">
<meta property="og:type" content="website">
<meta property="og:title" content="Daykalif">
<meta property="og:url" content="https://daykalif.github.io/index.html">
<meta property="og:site_name" content="Daykalif">
<meta property="og:description" content="stay hungry,stay foolish.">
<meta property="og:locale">
<meta property="article:author" content="r00t_daykalif">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: "",
      labels: ""
    }
  };
</script>



  <link rel="canonical" href="https://daykalif.github.io/"/>





  <title>Daykalif</title>
  








<meta name="generator" content="Hexo 7.1.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Daykalif</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-文章">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            文章
          </a>
        </li>
      
        
        <li class="menu-item menu-item-分类">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-前端">
          <a href="/categories/web/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            前端
          </a>
        </li>
      
        
        <li class="menu-item menu-item-后端">
          <a href="/categories/server/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-server"></i> <br />
            
            后端
          </a>
        </li>
      
        
        <li class="menu-item menu-item-关于我">
          <a href="/categories/aboutMe/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于我
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2023/04/15/JS/%E3%80%90%E5%8E%9F%E5%88%9B%E3%80%91for-in-for-of%E7%9A%84%E6%9C%AC%E8%B4%A8%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/04/15/JS/%E3%80%90%E5%8E%9F%E5%88%9B%E3%80%91for-in-for-of%E7%9A%84%E6%9C%AC%E8%B4%A8%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/" itemprop="url">【原创】for in/for of的本质区别是什么？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-04-15T12:20:41+08:00">
                2023-04-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2023/04/15/JS/%E3%80%90%E5%8E%9F%E5%88%9B%E3%80%91for-in-for-of%E7%9A%84%E6%9C%AC%E8%B4%A8%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2023/04/15/JS/%E3%80%90%E5%8E%9F%E5%88%9B%E3%80%91for-in-for-of%E7%9A%84%E6%9C%AC%E8%B4%A8%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2023/04/15/JS/%E3%80%90%E5%8E%9F%E5%88%9B%E3%80%91for-in-for-of%E7%9A%84%E6%9C%AC%E8%B4%A8%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/" class="leancloud_visitors" data-flag-title="【原创】for in/for of的本质区别是什么？">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  737
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  3
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="for-in-for-of-的本质区别是什么？"><a href="#for-in-for-of-的本质区别是什么？" class="headerlink" title="for in&#x2F;for of 的本质区别是什么？"></a>for in&#x2F;for of 的本质区别是什么？</h2><h3 id="一、适用的目标不一样"><a href="#一、适用的目标不一样" class="headerlink" title="一、适用的目标不一样"></a>一、适用的目标不一样</h3><h4 id="1-for-in"><a href="#1-for-in" class="headerlink" title="1.for in"></a>1.for in</h4><p>for in 适用于 <strong>可枚举数据</strong>，例如对象、数组、字符串<br>🧒 什么是可枚举呢？<br>属性的 enumerate 值为 true，咱就称为是可枚举的，通过<code>Object.getOwnPropertyDescriptors()</code>验证&#x2F;查看。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对象</span></span><br><span class="line"><span class="keyword">const</span> o = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="number">477</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">188</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(o));</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   name: &#123; value: 477, writable: true, enumerable: true, configurable: true &#125;,</span></span><br><span class="line"><span class="comment">//   age: &#123; value: 188, writable: true, enumerable: true, configurable: true &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(a));</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(b));</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   &#x27;0&#x27;: &#123; value: &#x27;a&#x27;, writable: true, enumerable: true, configurable: true &#125;,</span></span><br><span class="line"><span class="comment">//   &#x27;1&#x27;: &#123; value: &#x27;b&#x27;, writable: true, enumerable: true, configurable: true &#125;,</span></span><br><span class="line"><span class="comment">//   length: &#123; value: 2, writable: true, enumerable: false, configurable: false &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-for-of"><a href="#2-for-of" class="headerlink" title="2.for of"></a>2.for of</h4><p>for of 适用于<strong>可迭代数据</strong>，例如 Array、String、Map、Set、TypedArray、函数的 arguments 对象、NodeList 对象</p>
<p>🧒 什么是可迭代？<br>ES6 中，具有 symbol.iterator 属性，它对应的值是一个函数，调用这个函数后可以得到一个对象，每次调用对象的 next 方法能得到目标的每一项，只要符合这个特点就是可迭代的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Array</span></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> it = arr[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(it.<span class="title function_">next</span>()); <span class="comment">// &#123; value: &#x27;a&#x27;, done: false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(it.<span class="title function_">next</span>()); <span class="comment">// &#123; value: &#x27;b&#x27;, done: false &#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// string</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> it = str[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(it.<span class="title function_">next</span>()); <span class="comment">// &#123; value: &#x27;a&#x27;, done: false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(it.<span class="title function_">next</span>()); <span class="comment">// &#123; value: &#x27;b&#x27;, done: false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(it.<span class="title function_">next</span>()); <span class="comment">// &#123; value: &#x27;c&#x27;, done: false &#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>]);</span><br><span class="line"><span class="keyword">const</span> it = str[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(it.<span class="title function_">next</span>()); <span class="comment">// &#123; value: &#x27;a&#x27;, done: false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(it.<span class="title function_">next</span>()); <span class="comment">// &#123; value: &#x27;b&#x27;, done: false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(it.<span class="title function_">next</span>()); <span class="comment">// &#123; value: &#x27;c&#x27;, done: false &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="二、遍历的范围不一样"><a href="#二、遍历的范围不一样" class="headerlink" title="二、遍历的范围不一样"></a>二、遍历的范围不一样</h3><h4 id="1-for-in-1"><a href="#1-for-in-1" class="headerlink" title="1.for in"></a>1.for in</h4><p>for in 原型上的可枚举的属性也能被遍历到。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">foo</span> = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> attr <span class="keyword">in</span> arr) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(arr[attr]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 7</span></span><br><span class="line"><span class="comment">// 4</span></span><br></pre></td></tr></table></figure>

<h4 id="2-for-of-1"><a href="#2-for-of-1" class="headerlink" title="2.for of"></a>2.for of</h4><p>for of 一般只能遍历自身的（具体和迭代器的内部实现有关）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">foo</span> = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> arr) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 7</span></span><br></pre></td></tr></table></figure>

<p>改造迭代器：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">foo</span> = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line">arr[<span class="title class_">Symbol</span>.<span class="property">iterator</span>] = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> _this = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">__proto__</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">__proto__</span>[item])</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">i</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">i</span> &lt; _this.<span class="property">length</span></span><br><span class="line">        ? &#123;</span><br><span class="line">            <span class="attr">value</span>: _this[<span class="variable language_">this</span>.<span class="property">i</span>++],</span><br><span class="line">            <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">          &#125;</span><br><span class="line">        : &#123;</span><br><span class="line">            <span class="attr">value</span>: <span class="literal">undefined</span>,</span><br><span class="line">            <span class="attr">done</span>: <span class="literal">true</span>,</span><br><span class="line">          &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> arr) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 7</span></span><br><span class="line"><span class="comment">// 4</span></span><br></pre></td></tr></table></figure>

<h3 id="三、得到的结果不一样"><a href="#三、得到的结果不一样" class="headerlink" title="三、得到的结果不一样"></a>三、得到的结果不一样</h3><h4 id="1-for-in-2"><a href="#1-for-in-2" class="headerlink" title="1.for in"></a>1.for in</h4><p>for in 得到的是 key（并且不保证顺序）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> arr) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

<h4 id="2-for-of-2"><a href="#2-for-of-2" class="headerlink" title="2.for of"></a>2.for of</h4><p>for of 一般得到的是 value（具体和迭代器的内部实现有关）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> val <span class="keyword">of</span> arr) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(val);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 7</span></span><br></pre></td></tr></table></figure>

<p>改造迭代器：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line">arr[<span class="title class_">Symbol</span>.<span class="property">iterator</span>] = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> _this = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">__proto__</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">__proto__</span>[item])</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">i</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">i</span> &lt; _this.<span class="property">length</span></span><br><span class="line">        ? &#123;</span><br><span class="line">            <span class="attr">value</span>: <span class="variable language_">this</span>.<span class="property">i</span>++,</span><br><span class="line">            <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">          &#125;</span><br><span class="line">        : &#123;</span><br><span class="line">            <span class="attr">value</span>: <span class="literal">undefined</span>,</span><br><span class="line">            <span class="attr">done</span>: <span class="literal">true</span>,</span><br><span class="line">          &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> val <span class="keyword">of</span> arr) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(val);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2023/01/31/React/%E3%80%90%E6%90%AC%E3%80%91React-event%E6%80%BB%E7%BA%BF%EF%BC%88%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/01/31/React/%E3%80%90%E6%90%AC%E3%80%91React-event%E6%80%BB%E7%BA%BF%EF%BC%88%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F%EF%BC%89/" itemprop="url">【搬】React event总线（发布订阅模式）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-01-31T22:36:42+08:00">
                2023-01-31
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2023/01/31/React/%E3%80%90%E6%90%AC%E3%80%91React-event%E6%80%BB%E7%BA%BF%EF%BC%88%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F%EF%BC%89/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2023/01/31/React/%E3%80%90%E6%90%AC%E3%80%91React-event%E6%80%BB%E7%BA%BF%EF%BC%88%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F%EF%BC%89/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2023/01/31/React/%E3%80%90%E6%90%AC%E3%80%91React-event%E6%80%BB%E7%BA%BF%EF%BC%88%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F%EF%BC%89/" class="leancloud_visitors" data-flag-title="【搬】React event总线（发布订阅模式）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  199
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1）.新建文件夹 Emitter：<br>创建 index.tsx 文件:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EventEmitter</span> &#125; <span class="keyword">from</span> <span class="string">&quot;events&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">emitter</span>: <span class="title class_">EventEmitter</span> = <span class="keyword">new</span> <span class="title class_">EventEmitter</span>();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> emitter;</span><br></pre></td></tr></table></figure>

<p>2).<br>子组件 1：<br>引入 emit 文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> emitter <span class="keyword">from</span> <span class="string">&quot;../../Emitter&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>设置值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [emmitSwitch, setEmmitSwitch] = useState &lt; boolean &gt; <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<p>创建 switch 元素:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;section&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;t-mt&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">marginLeft:</span> &quot;<span class="attr">-8px</span>&quot;, <span class="attr">fontWeight:</span> <span class="attr">600</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">    使用 emmit</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;t-mt&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Switch</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">checked</span>=<span class="string">&#123;emmitSwitch&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setEmmitSwitch(!emmitSwitch);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      size=&quot;small&quot;</span></span><br><span class="line"><span class="language-xml">    /&gt;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/section&gt;</span><br></pre></td></tr></table></figure>

<p>监听该属性值变更，触发 emit：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  emitter.<span class="title function_">emit</span>(<span class="string">&quot;onSwitch&quot;</span>, emmitSwitch);</span><br><span class="line">&#125;, [emmitSwitch]);</span><br></pre></td></tr></table></figure>

<p>3.子组件 2：<br>引入 emit 文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> emitter <span class="keyword">from</span> <span class="string">&quot;../Emitter&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>监听 emitter 中属性值变化：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleSwitch</span> = (<span class="params">...args</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(...args);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  emitter.<span class="title function_">on</span>(<span class="string">&quot;onSwitch&quot;</span>, handleSwitch);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    emitter.<span class="title function_">removeListener</span>(<span class="string">&quot;onSwitch&quot;</span>, handleSwitch);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2023/01/31/React/%E3%80%90%E6%90%AC%E3%80%91%E6%B5%85%E8%B0%88React%E6%95%B0%E6%8D%AE%E6%B5%81%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/01/31/React/%E3%80%90%E6%90%AC%E3%80%91%E6%B5%85%E8%B0%88React%E6%95%B0%E6%8D%AE%E6%B5%81%E7%AE%A1%E7%90%86/" itemprop="url">【搬】浅谈React数据流管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-01-31T21:57:32+08:00">
                2023-01-31
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2023/01/31/React/%E3%80%90%E6%90%AC%E3%80%91%E6%B5%85%E8%B0%88React%E6%95%B0%E6%8D%AE%E6%B5%81%E7%AE%A1%E7%90%86/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2023/01/31/React/%E3%80%90%E6%90%AC%E3%80%91%E6%B5%85%E8%B0%88React%E6%95%B0%E6%8D%AE%E6%B5%81%E7%AE%A1%E7%90%86/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2023/01/31/React/%E3%80%90%E6%90%AC%E3%80%91%E6%B5%85%E8%B0%88React%E6%95%B0%E6%8D%AE%E6%B5%81%E7%AE%A1%E7%90%86/" class="leancloud_visitors" data-flag-title="【搬】浅谈React数据流管理">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  5.6k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  19
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>为什么数据流管理如此重要？<br>react 的核心思想就是：UI&#x3D;render(data)，data 就是我们说的数据，render 是 react 提供的纯函数，所以用户界面的展示完全取决于数据层。</p>
<p><strong>这篇文章希望能用最浅显易懂的话，将 react 中的数据流管理，从自身到借助第三方库，将这些概念理清楚。</strong><br>我会列举几个当下最热的库，包括它们的思想以及优缺点，适用于哪些业务场景。</p>
<p>这篇文章不是教程，不会讲如何去使用它们，更不会一言不合就搬源码，正如文章标题所说，只是浅谈，希望读者在读完以后就算原先没有使用过这些库，也能大致有个思路，知道该如何选择性地深入学习。</p>
<p>在本文正式开始之前，我先试图讲清楚两个概念，<strong>状态和数据：</strong></p>
<p>我们都知道，react 是利用可复用的组件来构建界面的，组件本质上是一个有限状态机，它能够记住当前所处的状态，并且能够根据不同的状态变化做出相应的操作。在 react 中，把这种状态定义为 state，用来描述该组件对应的当前交互界面，表示当前界面展示的一种状况，react 正是通过管理状态来实现对组件的管理，当 state 发生变更时，react 会自动去执行相应的操作：绘制界面。</p>
<p>所以我们接下来提到的状态是针对 react component 这种有限状态机。而数据就广泛了，它不光是指 server 层返回给前端的数据，react 中的状态也是一种数据。当我们改变数据的同时，就要通过改变状态去引发界面的变更。</p>
<p>我们真正要关心的是数据层的管理，我们今天所讨论的数据流管理方案，特别是后面介绍的几种第三方库，不光是配合 react，也可以配合其他的 View 框架（Vue、Angular 等等），就好比开头提到的那个公式，引申一下：UI &#x3D;X(data)，但今天主要是围绕 react 来讲的，因此我们在说 react 的状态管理其实和数据流管理是一样的，包括我们会借助第三方库来帮助 react 管理状态，希望不要有小伙伴太纠结于此。</p>
<h3 id="一、react-自身的数据流管理方案"><a href="#一、react-自身的数据流管理方案" class="headerlink" title="一、react 自身的数据流管理方案"></a>一、react 自身的数据流管理方案</h3><p>我们先来回顾一下，react 自身是如何管理数据流的（也可以理解为如何管理应用状态）：</p>
<p>react 是自上而下的单向组件数据流，容器组件&amp;展示组件（也叫傻瓜组件&amp;聪明组件）是最常用的 react 组件设计方案，容器组件负责处理复杂的业务逻辑以及数据，展示组件负责处理 UI 层，通常我们会将展示组件抽出来进行复用或者组件库的封装，容器组件自身通过 state 来管理状态，setState 更新状态，从而更新 UI，通过 props 将自身的 state 传递给展示组件实现通信。</p>
<p>这是当业务需求不复杂，页面较简单时我们常用的数据流处理方式，仅用 react 自身提供的 props 和 state 来管理足矣，但是如果稍微增加一点复杂度呢，比如当我们项目中遇到这些问题：</p>
<ul>
<li>1）如何实现跨组件通信、状态同步以及状态共享？</li>
</ul>
<p>react V16.3 以前，通过状态提升至最近的共同父组件来实现。（虽然有官方提供的 contextAPI，但是旧版本存在一个问题：看似跨组件，实则还是逐级传递，如果中间组件使用了 ShouldComponentUpdate 检测到当前 state 和 props 没有变化，returnfalse，那么 context 就会无法透传，因此 context 没有被官方推荐使用）。</p>
<p><img src="https://www.daykalif.com/blog_img/context.jpeg" alt="daykalif"></p>
<p>react V16.3 版本以后，新版本 context 解决了之前的问题，可以轻松实现，但依然存在一个问题，context 也是将底部子组件的状态控制交给到了顶级组件，但是顶级组件状态更新的时候一定会触发所有子组件的 re-render，那么也会带来损耗。（虽然我们可以通过一些手段来减少重绘，比如在中间组件的 SCU 里进行一些判断，但是当项目较大时，我们需要花太多的精力去做这件事）<br><img src="https://www.daykalif.com/blog_img/context2.jpeg" alt="daykalif"></p>
<ul>
<li>2）如何避免组件臃肿？</li>
</ul>
<p>当某个组件的业务逻辑非常复杂时，我们会发现代码越写越多，因为我们只能在组件内部去控制数据流，没办法抽离，Model 和 View 都放在了 View 层，整个组件显得臃肿不堪，业务逻辑统统堆在一块，难以维护。</p>
<ul>
<li>3）如何让状态变得可预知，甚至可回溯？</li>
</ul>
<p>当数据流混乱时，我们一个执行动作可能会触发一系列的 setState，我们如何能够让整个数据流变得可“监控”，甚至可以更细致地去控制每一步数据或状态的变更？</p>
<ul>
<li>4）如何处理异步数据流？</li>
</ul>
<p>react 自身并未提供多种处理异步数据流管理的方案，仅用一个 setState 已经很难满足一些复杂的异步流场景；</p>
<h4 id="如何改进？"><a href="#如何改进？" class="headerlink" title="如何改进？"></a>如何改进？</h4><p>这个时候，我们可能需要一个真正的数据流管理工具来帮助 react 了，我们希望它是真正脱离 react 组件的概念的，从 UI 层完全抽离出来，只负责管理数据，让 react 只专注于 View 层的绘制。</p>
<p>那这也是为什么我们需要使用那些第三方数据流管理工具的原因，接下来我们就来了解一些当前社区比较热门的数据流管理工具。</p>
<h3 id="二、redux"><a href="#二、redux" class="headerlink" title="二、redux"></a>二、redux</h3><p>我直接跳过了 flux 来说 redux，主要是因为 redux 是由 flux 演变而来，可以说是 flux 的升级加强版，flux 具备的优势 redux 也做到了。</p>
<h4 id="redux-提供了哪些？"><a href="#redux-提供了哪些？" class="headerlink" title="redux 提供了哪些？"></a>redux 提供了哪些？</h4><p><img src="https://www.daykalif.com/blog_img/redux.jpeg" alt="daykalif"></p>
<ul>
<li>1）store：提供了一个全局的 store 变量，用来存储我们希望从组件内部抽离出去的那些公用的状态；</li>
<li>2）action：提供了一个普通对象，用来记录我们每一次的状态变更，可日志打印与调试回溯，并且这是唯一的途径；</li>
<li>3）reducer：提供了一个纯函数，用来计算状态的变更；</li>
</ul>
<h4 id="为什么需要-redux？"><a href="#为什么需要-redux？" class="headerlink" title="为什么需要 redux？"></a>为什么需要 redux？</h4><p>很多人在用了一段时间的 redux 之后，最大的感想就是，redux 要写大量的模板代码，很麻烦，还不如只用 react 来管理。特别是在 react 的新 context 推出以后，许多人更是直接弃用了 redux，甚至觉得 redux 已死。如果说旧版的 context 的弊端，我们通过 redux 配合 react-redux 来实现跨组件的状态通信同步等问题，那确实新版本的 context 可以替换掉这个功能点，但如果你的项目中仅仅是用 redux 做这些，那思考一下，你是否真的需要 redux？也许从一开始你就不需要它。</p>
<p>（虽然新版的 context 功能强大，但是依然是通过一个新的容器组件来替我们管理状态，那么通过组件管理状态的问题依旧会存在，Consumer 是和 Provider 一一对应的，在项目复杂度较高时，可能会出现多个 Provider，更多个 Consumer，甚至会一个 Consumer 需要对应多个 Provider 的传值等一系列复杂的情况，所以我们依然要谨慎使用）</p>
<h4 id="redux-的核心竞争力"><a href="#redux-的核心竞争力" class="headerlink" title="redux 的核心竞争力"></a>redux 的核心竞争力</h4><p>1）状态持久化：globalstore 可以保证组件就算销毁了也依然保留之前状态；<br>2）状态可回溯：每个 action 都会被序列化，Reducer 不会修改原有状态，总是返回新状态，方便做状态回溯；<br>3）Functional Programming：使用纯函数，输出完全依赖输入，没有任何副作用；<br>4）中间件：针对异步数据流，提供了类 express 中间件的模式，社区也出现了一大批优秀的第三方插件，能够更精细地控制数据的流动，对复杂的业务场景起到了缓冲地作用；<br><img src="https://www.daykalif.com/blog_img/redux3.jpeg" alt="daykalif"></p>
<p>与其说是 redux 来帮助 react 管理状态，不如说是将 react 的部分状态移交至 redux 那里。redux 彻头彻尾的纯函数理念就表明了它不会参与任何状态变化，完全是由 react 自己来完成。只不过 redux 会提供一套工具，react 照着说明书来操作罢了。</p>
<p>所以这注定了想要接受 redux，就必须按照它的规矩来做，除非你不愿意接受这种 FP 的模式。这种模式有利有弊，有利就是在一个大型的多人团队中，这种开发模式反而容易形成一种规约，让整个状态流程变得清晰，弊端就是对于小规模团队，尤其是着急发布上线的，这种繁重的代码模板无疑是一种负担。</p>
<h4 id="redux-的缺点："><a href="#redux-的缺点：" class="headerlink" title="redux 的缺点："></a>redux 的缺点：</h4><p>1）繁重的代码模板：修改一个 state 可能要动四五个文件，可谓牵一发而动全身；<br>2）store 里状态残留：多组件共用 store 里某个状态时要注意初始化清空问题；<br>3）无脑的发布订阅：每次 dispatch 一个 action 都会遍历所有的 reducer，重新计算 connect，这无疑是一种损耗；<br>4）交互频繁时会有卡顿：如果 store 较大时，且频繁地修改 store，会明显看到页面卡顿；<br>5）不支持 typescript；</p>
<p>关于如何优化，网上有很多优秀的案例，redux 官方也提供了很多方法，这里不再赘述。redux 未来不会有太大的变化，那些弊端还是会继续保留，但是这依然不会妨碍忠爱它的用户去使用它。</p>
<p>如果说 redux 那种强硬的函数式编程模式让很多人难以接受，那么当他们开始 mobx 的使用的时候，无疑是一种解脱。</p>
<h3 id="三、mobx"><a href="#三、mobx" class="headerlink" title="三、mobx"></a>三、mobx</h3><p>最开始接触 mobx 也是因为 redux 作者 DanAbramov 的那句：Unhappywith redux？try mobx，我相信很多人也是因为这句话而开始了解学习并使用它的。</p>
<p>下面列举一些 mobx 的优势（和 redux 进行一个对比）</p>
<p>1）redux 不允许直接修改 state，而 mobx 可随意修改；<br>2）redux 修改状态必须走一套指定的流程较麻烦，而 mobx 可以在任何地方直接修改（非严格模式下）；<br>3）redux 模板代码文件多，而 mobx 非常简洁，就一个文件；<br>4）redux 只有一个 store，state orstore 难以取舍，而 mobx 多 store，你可以把所有的 state 都放入 store 中，完全交给 mobx 来管理，减少顾虑；<br>5）redux 需要对监听的组件做 SCU 优化，减少重复 render；而 mobx 都是 SmartComponent，不用我们手动做 SCU；</p>
<p>mobx 的设计思想：<br><img src="https://www.daykalif.com/blog_img/redux4.jpeg" alt="daykalif"></p>
<p>说了这么多，如果你是第一次了解 mobx，是不是听着就感觉很爽！没错，这就是 mobx 的魅力，那它是如何实现这些功能的呢？</p>
<p>这里以 mobx 5 版本为例，实际上它是利用了 ES6 的 proxy 来追踪属性（旧版本是用 Object.defineProperty 来实现的）通过隐式订阅，自动追踪被监听的对象变化，然后触发组件的 UI 更新。</p>
<p>如果说 redux 是把要做的事情都交给了用户，来保证自己的纯净，那么 mobx 就是把最简易的操作给了用户，其它的交给 mobx 内部去实现。用户不必关心这个过程，Model 和 View 完全分离，我们完全可以将业务逻辑写在 action 里，用户只需要操作 Observabledata 就行了。</p>
<p>Observerview 会自动做出响应，这就是 mobx 主打的响应式设计，但是编程风格依然是传统的面向对象的 OO 范式。（熟悉 Vue 的朋友一定对这种响应式设计不陌生，Vue 就是利用了数据劫持来实现双向绑定，其实 React +Mobx 就是一个复杂点的 Vue，Vue 3 版本一个重大改变也是将代理交给了 proxy）</p>
<p>刚刚 mobx 的优势说得比较多了，这边再总结一下：</p>
<p>1）代码量少；<br>2）基于数据劫持来实现精准定位（真正意义上的局部更新）；<br>3）多 store 抽离业务逻辑（Model View 分离）；<br>4）响应式性能良好（频繁的交互依然可以胜任）；<br>5）完全可以替代 react 自身的状态管理；<br>6）支持 typescript；</p>
<p>但是 mobx 真的这么完美吗，当然也有缺陷：</p>
<p>1）没有状态回溯能力：mobx 是直接修改对象引用，所以很难去做状态回溯；（这点 redux 的优势就瞬间体现出来了）<br>2）没有中间件：和 redux 一样，mobx 也没有很好地办法处理异步数据流，没办法更精细地去控制数据流动；（redux 虽然自己不做，但是它提供了 applyMiddleware！）<br>3）store 太多：随着 store 数的增多，维护成本也会增加，而且多 store 之间的数据共享以及相互引用也会容易出错<br>4）副作用：mobx 直接修改数据，和函数式编程模式强调的纯函数相反，这也导致了数据的很多未知性</p>
<p>其实现在主流的数据流管理分为两大派，一类是以 redux 为首的函数式库，还有一类是以 mobx 为首的响应式库，其实通过刚刚的介绍，我们会发现，redux 和 mobx 有一个共同的短板，那就是在处理异步数据流的时候，没有一个很好的解决方案，至少仅仅依靠自身比较吃力，那么接下来给大家介绍一个处理异步数据流的高手：rxjs。</p>
<h3 id="四、rxjs"><a href="#四、rxjs" class="headerlink" title="四、rxjs"></a>四、rxjs</h3><p>我相信很多人听说过 rxjs 学习曲线异常陡峭，是的，除了眼花缭乱的各类操作符（目前 rxjs V6 版本有 120+个），关键是它要求我们在处理事务的时候要贯彻“一切皆为流”的理念，更是让初学者难以理解。</p>
<p>这一小节并不能让读者达到能够上手使用的程度，正如文章开头所说，希望读者（新手）能对 rxjs 有一个新的认知，知道它是做什么的，它是如何实现的，它有哪些优势，我们如何选择它，如果感兴趣还需要私下花大量时间去学习掌握各种操作符，但我也会尝试尽可能地相对于前两个说得更细致一些。</p>
<p>在开始介绍 rxjs 之前，我们先来简单地聊聊什么是响应式编程？我以一个很简单的小例子来看：a + b &#x3D; c。</p>
<p>如果站在传统的命令式编程的角度来看这段公式：c 的值完全依赖于 a 和 b，这时候我们去改变 a 的值，那我们就需要再去手动计算 a + b 的值，a、b 和 c 是相互依赖的。</p>
<p>那么如果站在响应式编程的角度来看，这个公式又会变成这样：c :&#x3D; a + b，a 和 b 完全不关心 c 的值，c 也完全不关心等式那边是 a 或者 b，或者还有什么 d，e，f。。。等式右边改变值了，左边会自动更改数值，这就是响应式编程的思维方式。</p>
<p>我们再来看前端的框架历史，传统命令式编程的代表：jQuery，在过去我们是如何绘制一个页面的？我们会用 jQuery 提供的一套 API，然后手动操作 Dom 来进行绘制，很精准，但是很累，因为完全靠手动操作，且改动时性能损耗较大，开发者的注意力完全在“如何去绘制”上面了。</p>
<p>那我们再来看响应式编程的 react，它是如何来实现的？</p>
<p>开发者根本不用关心界面如何绘制，只要告诉 react 我们希望页面长什么样子，就可以了，剩下的交给 react，react 就会自动帮我们绘制界面，还记得开头时的那个核心思想吗：UI &#x3D;render(data)，我们只要操作 data 就可以了，页面 UI 会自动作出响应，而且我们一切的操作都是基于内存之中，不会有较大的性能损耗，这就是 react 响应式编程的精髓，也是为何它叫作 react。</p>
<p>回到我们的 rxjs 上，rxjs 是如何做到响应式的呢？多亏了它两种强大的设计模式：观察者模式和迭代器模式；简单地介绍一下：</p>
<ul>
<li>1）观察者模式：</li>
</ul>
<p><img src="https://www.daykalif.com/blog_img/rxjs.jpeg" alt="daykalif"></p>
<p>在观察者模式中，有两个重要的角色：Observable 和 Observer，熟悉 mobx 的同学对这个一定不陌生（所以我建议想要学习 rxjs 的同学，如果对 mobx 不熟悉，可以先学习一下 mobx，然后再学习 rxjs，这样会更容易理解一些）。</p>
<p>就是可观察对象和观察者，可观察对象（Observable）也就是事件发布者，负责产生事件，而观察者（Observer）也就是事件响应者，负责对发布的事件作出响应，但是如何连接一个发布者和响应者呢？</p>
<p>通过订阅的形式，也就是 subscribe 方法（这也类似于 redux 的 store.subscribe），而在订阅之前，他们两者是毫无关联的，无论 Observable 发出多少事件，Observer 也不会做出任何响应，同样，当这种订阅关系中断时也不会。</p>
<ul>
<li>2）迭代器模式：</li>
</ul>
<p>在这里要先引出一个新的概念：拉取（pull）和推送（push），rxjs 官方这两种协议有更详细的解释，我这里就直接引用一下：<br><img src="https://www.daykalif.com/blog_img/rxjs2.jpeg" alt="daykalif"></p>
<p>拉取和推送实际上对于观察者来说就是一个主动与被动的区别，是主动去获取还是被动地接收。在 rxjs 中，作为事件响应者（消费者）的 Observer 对象也有一个 next 属性（回调函数），用来接收从发布者那里“推”过来的数据。</p>
<p>（站在开发者的角度，我们一定是希望消息是被动地接收，因为我们倡导的就是通过操作 data 数据层，让 View 层进行一个响应，那么这里 data 数据层一定是事件发布者，而 View 层就是事件响应者，每当 data 数据层发生变化时，都会主动推送一个值给 View 层，这才符合真正意义上的响应式编程，而 rxjs 做到了！）</p>
<p>如何配合 react？</p>
<p>如果说 redux 和 mobx 的出现或多或少是因为 react 的存在，那么不同的是 rxjs 和 react 并没有什么关联，关于 rxjs 的历史这里不多说，感兴趣的可以了解一下 ReactiveExtension，rxjs 只是响应式编程在 JavaScript 中的应用。</p>
<p>那么如何帮助 react 实现状态管理呢，我们只需要将组件作为事件响应者，然后在 next 回调里定义好更新组件状态的动作 setState，当接收到数据推送时，就会自动触发 setState，完成界面更新，这其实有点类似于 mobx 做的事情。（很多人在 react 项目中并没有完全只使用 rxjs，而是用了这个 redux-observable 中间件，利用 rxjs 的操作符来处理异步 action）</p>
<p>除了响应式编程的魅力，rxjs 还有什么优势呢？</p>
<p>1）纯函数：rxjs 中数据流动的过程中，不会改变已经存在的 Observable 实例，会返回一个新的 Observable，没有任何副作用；<br>2）强大的操作符：rxjs 又被称为 lodash forasync，和 lodash 一样，拥有众多强大的操作符来操作数据流，不光是同步数据，特别是针对各种复杂的异步数据流，甚至可以多种事件流组合搭配，汇总到一起处理；<br>3）更独立：rxjs 并不依赖于任何一个框架，它可以任意搭配，因为它的关注点完全就是在于数据流的处理上，而且它更偏底层一些</p>
<p>那 rxjs 有哪些缺点呢？</p>
<p>1）学习曲线陡峭：光是这一点就已经让大多数人止步于此；<br>2）事件流高度抽象：用 rxjs 的用户反馈一般都是两种极端情况，用得好的都觉得这个太厉害了，用得不好的都觉得感觉有点麻烦，增加了项目复杂度。</p>
<h3 id="五、结语"><a href="#五、结语" class="headerlink" title="五、结语"></a>五、结语</h3><p>最后，总结一下各类的适用场景：</p>
<p>1）当我们项目中复杂程度较低时，建议只用 react 就可以了；<br>2）当我们项目中跨组件通信、数据流同步等情况较多时，建议搭配 react 的新 context api；<br>3）当项目复杂度一般时，小规模团队或开发周期较短、要求快速上线时，建议使用 mobx；<br>4）当项目复杂度较高时，团队规模较大或要求对事件分发处理可监控可回溯时，建议使用 redux；<br>5）当项目复杂度较高，且数据流（尤其是异步数据）混杂时，建议使用 rxjs；</p>
<p>其实回顾全篇，我没有提到一个关键点是，各个库的性能对比如何。其实它们之间一定是有差异的，但是这点性能差异，相对于 react 自身组件设计不当而导致的性能损耗来说，是可以忽略的。</p>
<p>如果你现在的项目觉得性能较差或者页面卡顿，建议先从 react 层面去考虑如何进行优化，然后再去考虑如何优化数据管理层。关于上面提到的三个数据流管理工具，有利有弊，针对弊端，网上也有一大批优秀的解决方案和改进，感兴趣的读者可自行查阅。</p>
<p>【推荐阅读】</p>
<ul>
<li>OCR 技术在携程业务中的应用</li>
<li>基于 tendermint 实现 Hyperledger Fabric 的拜占庭容错排序</li>
<li>携程混合云之 kubernetes@AWS 揭秘</li>
<li>携程技术演进之路</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2023/01/31/Dva/%E3%80%90%E6%90%AC%E3%80%91Dva%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/01/31/Dva/%E3%80%90%E6%90%AC%E3%80%91Dva%E5%85%A5%E9%97%A8/" itemprop="url">【搬】Dva入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-01-31T21:34:06+08:00">
                2023-01-31
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2023/01/31/Dva/%E3%80%90%E6%90%AC%E3%80%91Dva%E5%85%A5%E9%97%A8/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2023/01/31/Dva/%E3%80%90%E6%90%AC%E3%80%91Dva%E5%85%A5%E9%97%A8/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2023/01/31/Dva/%E3%80%90%E6%90%AC%E3%80%91Dva%E5%85%A5%E9%97%A8/" class="leancloud_visitors" data-flag-title="【搬】Dva入门">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  9
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="React-没有解决的问题"><a href="#React-没有解决的问题" class="headerlink" title="React 没有解决的问题"></a>React 没有解决的问题</h3><p>React 本身只是一个 DOM 的抽象层，在虚拟 DOM 的基础上开发组件。</p>
<p>如果开发复杂的大型应用，还需要解决两个问题。</p>
<h3 id="架构问题"><a href="#架构问题" class="headerlink" title="架构问题"></a>架构问题</h3><p>React 没有规定大型应用的架构。</p>
<p>到底哪一种架构最合适 React ？</p>
<ul>
<li>MVC</li>
<li>MVVM</li>
<li>Observer</li>
<li>Reactive</li>
<li>…</li>
</ul>
<p>通信问题</p>
<ul>
<li>通信：组件之间如何通信？</li>
<li>数据流：数据如何和视图串联起来？路由和数据如何绑定？如何编写异步逻辑？等等</li>
</ul>
<p>怎么解决下面三种通信？</p>
<ul>
<li>向子组件发消息</li>
<li>向父组件发消息</li>
<li>向其他组件发消息<br>React 只提供了一种组件之间的通信手段：传参。对于大应用，很不方便。</li>
</ul>
<p>组件通信的示例 1：想一想父组件如何拿到子组件的值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Son</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Father</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Son</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>这里显示 Son 组件的内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Father</span> /&gt;</span></span>, mountNode);</span><br></pre></td></tr></table></figure>

<p>组件通信的示例 2：看懂以下代码，理解子组件如何通过父组件传入的函数，将自己的值再传回父组件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Son</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">onChange</span>=<span class="string">&#123;this.props.onChange&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Father</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">son</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">changeHandler</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">son</span>: e.<span class="property">target</span>.<span class="property">value</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Son</span> <span class="attr">onChange</span>=<span class="string">&#123;this.changeHandler.bind(this)&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>这里显示 Son 组件的内容：&#123;this.state.son&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Father</span> /&gt;</span></span>, mountNode);</span><br></pre></td></tr></table></figure>

<h3 id="数据流问题"><a href="#数据流问题" class="headerlink" title="数据流问题"></a>数据流问题</h3><p>目前流行的数据流方案有：</p>
<ul>
<li>Flux，单项数据流方案，以 Redux 为代表</li>
<li>Reactive，响应式数据流方案，以 Mobx 为代表</li>
<li>其他，比如 rxjs 等</li>
</ul>
<p>到底哪一种架构最合适 React ？</p>
<h3 id="目前最流行的数据流方案"><a href="#目前最流行的数据流方案" class="headerlink" title="目前最流行的数据流方案"></a>目前最流行的数据流方案</h3><p>截止 2017.1，最流行的社区 React 应用架构方案如下。</p>
<ul>
<li>路由： React-Router</li>
<li>架构： Redux</li>
<li>异步操作： Redux-saga</li>
</ul>
<p>缺点：要引入多个库，项目结构复杂。</p>
<h3 id="dva-是什么"><a href="#dva-是什么" class="headerlink" title="dva 是什么"></a>dva 是什么</h3><p>dva 是体验技术部开发的 React 应用框架，将上面三个 React 工具库包装在一起，简化了 API，让开发 React 应用更加方便和快捷。<br>dva &#x3D; React-Router + Redux + Redux-saga</p>
<p>React 应用的架构<br><img src="https://www.daykalif.com/blog_img/jiagou.jpeg" alt="daykalif"></p>
<h4 id="dva-的设计思想"><a href="#dva-的设计思想" class="headerlink" title="dva 的设计思想"></a>dva 的设计思想</h4><p>应用的拆分：</p>
<ul>
<li>视图（view）</li>
<li>逻辑（logic）</li>
<li>状态（state）</li>
</ul>
<p>以上三者完全分离。</p>
<p>运行过程如下。</p>
<ol>
<li>初始状态 &#x3D;&gt; 初始视图</li>
<li>用户浏览视图 &#x3D;&gt; 业务逻辑生效</li>
<li>业务逻辑 &#x3D;&gt; 状态变化</li>
<li>状态变化 &#x3D;&gt; 视图变化</li>
</ol>
<h4 id="dva-的运行模型"><a href="#dva-的运行模型" class="headerlink" title="dva 的运行模型"></a>dva 的运行模型</h4><ol>
<li>dva 提供一个 Model 层，保存全局状态</li>
<li>组件发送消息给 Model</li>
<li>Model 调用业务逻辑，导致 state 发生变化，触发 UI 层重新渲染</li>
</ol>
<p>核心概念如下。</p>
<ul>
<li>Action：一个对象，描述 UI 事件</li>
<li>dispatch: 一个函数，发送 Action 到 State</li>
<li>State：一个对象，保存整个应用状态</li>
<li>View：React 组件构成的视图层</li>
</ul>
<p>最大特点：数据单向流动。<br><img src="https://www.daykalif.com/blog_img/shujuliu.jpeg" alt="daykalif"></p>
<h3 id="dva-应用的最简结构"><a href="#dva-应用的最简结构" class="headerlink" title="dva 应用的最简结构"></a>dva 应用的最简结构</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dva <span class="keyword">from</span> <span class="string">&quot;dva&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello dva<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建应用</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">dva</span>();</span><br><span class="line"><span class="comment">// 注册视图</span></span><br><span class="line">app.<span class="title function_">router</span>(<span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>);</span><br><span class="line"><span class="comment">// 启动应用</span></span><br><span class="line">app.<span class="title function_">start</span>(<span class="string">&quot;#root&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="数据流图"><a href="#数据流图" class="headerlink" title="数据流图"></a>数据流图</h4><p><img src="https://www.daykalif.com/blog_img/shujuliu2.jpeg" alt="daykalif"></p>
<h4 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h4><ul>
<li>State：一个对象，保存整个应用状态</li>
<li>View：React 组件构成的视图层</li>
<li>Action：一个对象，描述事件</li>
<li>connect 方法：一个函数，绑定 State 到 View</li>
<li>dispatch 方法：一个函数，发送 Action 到 State</li>
</ul>
<p>State 和 View</p>
<p>State 是储存数据的地方，收到 Action 以后，会更新数据。</p>
<p>View 就是 React 组件构成的 UI 层，从 State 取数据后，渲染成 HTML 代码。只要 State 有变化，View 就会自动更新。</p>
<p>Action</p>
<p>Action 是用来描述 UI 层事件的一个对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;click-submit-button&#x27;</span>,</span><br><span class="line">  <span class="attr">payload</span>: <span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">data</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>connect 方法</p>
<p>connect 是一个函数，绑定 State 到 View。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;dva&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mapStateToProps</span>(<span class="params">state</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">todos</span>: state.<span class="property">todos</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">connect</span>(mapStateToProps)(<span class="title class_">App</span>);</span><br></pre></td></tr></table></figure>

<p>connect 方 法返回的也是一个 React 组件，通常称为容器组件。因为它是原始 UI 组件的容器，即在外面包了一层 State。</p>
<p>connect 方法传入的第一个参数是 mapStateToProps 函数，mapStateToProps 函数会返回一个对象，用于建立 State 到 Props 的映射关系。</p>
<h4 id="dispatch-方法"><a href="#dispatch-方法" class="headerlink" title="dispatch 方法"></a>dispatch 方法</h4><p>dispatch 是一个函数方法，用来将 Action 发送给 State。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">dispatch</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;click-submit-button&quot;</span>,</span><br><span class="line">  <span class="attr">payload</span>: <span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">data</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>dispatch 方法从哪里来？被 connect 的 Component 会自动在 props 中拥有 dispatch 方法。</p>
<blockquote>
<p>connect 的数据从哪里来?</p>
</blockquote>
<p>dva 应用的最简结构（带 model)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建应用</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">dva</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册 Model</span></span><br><span class="line">app.<span class="title function_">model</span>(&#123;</span><br><span class="line">  <span class="attr">namespace</span>: <span class="string">&quot;count&quot;</span>,</span><br><span class="line">  <span class="attr">state</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="title function_">add</span>(<span class="params">state</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">effects</span>: &#123;</span><br><span class="line">    *<span class="title function_">addAfter1Second</span>(<span class="params">action, &#123; call, put &#125;</span>) &#123;</span><br><span class="line">      <span class="keyword">yield</span> <span class="title function_">call</span>(delay, <span class="number">1000</span>);</span><br><span class="line">      <span class="keyword">yield</span> <span class="title function_">put</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;add&quot;</span> &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册视图</span></span><br><span class="line">app.<span class="title function_">router</span>(<span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ConnectedApp</span> /&gt;</span></span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动应用</span></span><br><span class="line">app.<span class="title function_">start</span>(<span class="string">&quot;#root&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="数据流图-1-数据流图-2"><a href="#数据流图-1-数据流图-2" class="headerlink" title="数据流图 1 &amp; 数据流图 2"></a>数据流图 1 &amp; 数据流图 2</h4><p><img src="https://www.daykalif.com/blog_img/shujuliu3.jpeg" alt="daykalif"></p>
<p>app.model</p>
<p>dva 提供 app.model 这个对象，所有的应用逻辑都定义在它上面。具有消息中心、状态保存、定义应用逻辑等功能。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="title function_">dva</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增这一行</span></span><br><span class="line">app.<span class="title function_">model</span>(&#123; <span class="regexp">/\*\*/</span> &#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">router</span>(<span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>);</span><br><span class="line">app.<span class="title function_">start</span>(<span class="string">&#x27;#root&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>Model 对象的例子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">namespace</span>: <span class="string">&#x27;count&#x27;</span>,</span><br><span class="line">  <span class="attr">state</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">  <span class="title function_">add</span>(<span class="params">state</span>) &#123; <span class="keyword">return</span> state + <span class="number">1</span> &#125;,</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">effects</span>: &#123;</span><br><span class="line">  *<span class="title function_">addAfter1Second</span>(<span class="params">action, &#123; call, put &#125;</span>) &#123;</span><br><span class="line">      <span class="keyword">yield</span> <span class="title function_">call</span>(delay, <span class="number">1000</span>);</span><br><span class="line">      <span class="keyword">yield</span> <span class="title function_">put</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;add&#x27;</span> &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Model-对象的属性"><a href="#Model-对象的属性" class="headerlink" title="Model 对象的属性"></a>Model 对象的属性</h3><ul>
<li>namespace: 当前 Model 的名称。整个应用的 State，由多个小的 Model 的 State 以 namespace 为 key 合成</li>
<li>state: 该 Model 当前的状态。数据保存在这里，直接决定了视图层的输出</li>
<li>reducer: Action 处理器，处理同步动作，用来算出最新的 State</li>
<li>effects：Action 处理器，处理异步动作</li>
</ul>
<h4 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h4><p>Reducer 是 Action 处理器，用来处理同步操作，可以看做是 state 的计算器。它的作用是根据 Action，从上一个 State 算出当前 State。</p>
<p>一些例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// count +1</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">state</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 往 [] 里添加一个新 todo</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addTodo</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> [...state, action.<span class="property">payload</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 往 &#123; todos: [], loading: true &#125; 里添加一个新 todo，并标记 loading 为 false</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addTodo</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...state,</span><br><span class="line">    <span class="attr">todos</span>: state.<span class="property">todos</span>.<span class="title function_">concat</span>(action.<span class="property">payload</span>),</span><br><span class="line">    <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Effect"><a href="#Effect" class="headerlink" title="Effect"></a>Effect</h4><p>Action 处理器，处理异步动作，基于 Redux-saga 实现。Effect 指的是副作用。根据函数式编程，计算以外的操作都属于 Effect，典型的就是 I&#x2F;O 操作、数据库读写。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> \*<span class="title function_">addAfter1Second</span>(<span class="params">action, &#123; put, call &#125;</span>) &#123;</span><br><span class="line"><span class="keyword">yield</span> <span class="title function_">call</span>(delay, <span class="number">1000</span>);</span><br><span class="line"><span class="keyword">yield</span> <span class="title function_">put</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;add&#x27;</span> &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Generator-函数"><a href="#Generator-函数" class="headerlink" title="Generator 函数"></a>Generator 函数</h4><p>Effect 是一个 Generator 函数，内部使用 yield 关键字，标识每一步的操作（不管是异步或同步）。</p>
<h4 id="call-和-put"><a href="#call-和-put" class="headerlink" title="call 和 put"></a>call 和 put</h4><p>dva 提供多个 effect 函数内部的处理函数，比较常用的是 call 和 put。</p>
<ul>
<li>call：执行异步函数</li>
<li>put：发出一个 Action，类似于 dispatch</li>
</ul>
<h3 id="dva-最小示例-count-count-–"><a href="#dva-最小示例-count-count-–" class="headerlink" title="dva 最小示例:count ++,count –"></a>dva 最小示例:count ++,count –</h3><blockquote>
<p><a href="https://riddle.alibaba-inc.com/riddles/c7c1afab">https://riddle.alibaba-inc.com/riddles/c7c1afab</a></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dva, &#123; connect &#125; <span class="keyword">from</span> <span class="string">&#x27;dva&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Router</span>, <span class="title class_">Route</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;dva/router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 应用初始化</span></span><br><span class="line"><span class="comment">// app 就代表前端应用</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">dva</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建立 Model</span></span><br><span class="line">app.<span class="title function_">model</span>(&#123;</span><br><span class="line"><span class="comment">// 一个应用只有一个总的 Model，但可以分成多个子 Model</span></span><br><span class="line"><span class="comment">// namespace 是子 Model 的名字</span></span><br><span class="line"><span class="attr">namespace</span>: <span class="string">&#x27;counter&#x27;</span>,</span><br><span class="line"><span class="comment">// 应用的内部状态</span></span><br><span class="line"><span class="attr">state</span>: &#123;<span class="attr">num</span>: <span class="number">0</span>&#125;,</span><br><span class="line"><span class="comment">// 同步 action 处理器</span></span><br><span class="line"><span class="comment">// 方法名就是 action 的名字</span></span><br><span class="line"><span class="attr">reducers</span>: &#123;</span><br><span class="line"><span class="title function_">add</span>(<span class="params">counterState</span>) &#123; <span class="keyword">return</span> &#123;<span class="attr">num</span>: (counterState.<span class="property">num</span> + <span class="number">1</span>)&#125;; &#125;,</span><br><span class="line"><span class="title function_">minus</span>(<span class="params">counterState</span>) &#123; <span class="keyword">return</span> &#123;<span class="attr">num</span>: (counterState.<span class="property">num</span> - <span class="number">1</span>)&#125;; &#125;,</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 异步 action 处理器</span></span><br><span class="line"><span class="comment">// 所有方法都是 Generator 函数</span></span><br><span class="line"><span class="comment">// 本例没有用到</span></span><br><span class="line"><span class="attr">effects</span>: &#123;</span><br><span class="line"> \*<span class="title function_">add</span>(<span class="params">action, &#123; put, call &#125;</span>) &#123;</span><br><span class="line"><span class="keyword">yield</span> <span class="title function_">call</span>(delay, <span class="number">1000</span>);</span><br><span class="line"><span class="keyword">yield</span> <span class="title function_">put</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;minus&#x27;</span> &#125;);</span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 Model 的 state 绑定到 View</span></span><br><span class="line"><span class="comment">// connect(state =&gt; props)(view)</span></span><br><span class="line"><span class="keyword">const</span> view = <span class="title function_">connect</span>(</span><br><span class="line"><span class="function">(<span class="params">state</span>) =&gt;</span> (&#123; <span class="attr">num</span>: state.<span class="property">counter</span>.<span class="property">num</span> &#125;)</span><br><span class="line">)(<span class="keyword">function</span> (<span class="params">props</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123; props.num &#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">key</span>=<span class="string">&quot;add&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">() =&gt;</span> &#123; props.dispatch(&#123; type: &#x27;counter/add&#x27; &#125;); &#125;&#125; &gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">key</span>=<span class="string">&quot;minus&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">() =&gt;</span> &#123; props.dispatch(&#123; type: &#x27;counter/minus&#x27; &#125;); &#125;&#125; &gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由</span></span><br><span class="line"><span class="comment">// URL 不带有参数时，加载 view 组件</span></span><br><span class="line">app.<span class="title function_">router</span>(<span class="function">(<span class="params">&#123; history &#125;</span>) =&gt;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">history</span>=<span class="string">&#123;history&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;view&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动应用</span></span><br><span class="line">app.<span class="title function_">start</span>(<span class="string">&#x27;#mountNode&#x27;</span>);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2023/01/31/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E3%80%90%E6%90%AC%E3%80%91setTimeout%E8%BD%ACsetInterval/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/01/31/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E3%80%90%E6%90%AC%E3%80%91setTimeout%E8%BD%ACsetInterval/" itemprop="url">【搬】setTimeout转setInterval</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-01-31T21:26:36+08:00">
                2023-01-31
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2023/01/31/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E3%80%90%E6%90%AC%E3%80%91setTimeout%E8%BD%ACsetInterval/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2023/01/31/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E3%80%90%E6%90%AC%E3%80%91setTimeout%E8%BD%ACsetInterval/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2023/01/31/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E3%80%90%E6%90%AC%E3%80%91setTimeout%E8%BD%ACsetInterval/" class="leancloud_visitors" data-flag-title="【搬】setTimeout转setInterval">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  27
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fun</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(i++);</span><br><span class="line">  <span class="title function_">func</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">setTimeout</span>(fun, <span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fun</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(i++);</span><br><span class="line">  <span class="built_in">setTimeout</span>(fun, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">func</span>();</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2023/01/31/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E3%80%90%E8%88%AC%E3%80%91%E9%98%B2%E6%8A%96%E5%92%8C%E8%8A%82%E6%B5%81%E7%9A%84%E5%8C%BA%E5%88%AB%E5%8F%8A%E4%BD%9C%E7%94%A8%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/01/31/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E3%80%90%E8%88%AC%E3%80%91%E9%98%B2%E6%8A%96%E5%92%8C%E8%8A%82%E6%B5%81%E7%9A%84%E5%8C%BA%E5%88%AB%E5%8F%8A%E4%BD%9C%E7%94%A8%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" itemprop="url">【般】防抖和节流的区别及作用，实现原理与应用场景</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-01-31T21:12:26+08:00">
                2023-01-31
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2023/01/31/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E3%80%90%E8%88%AC%E3%80%91%E9%98%B2%E6%8A%96%E5%92%8C%E8%8A%82%E6%B5%81%E7%9A%84%E5%8C%BA%E5%88%AB%E5%8F%8A%E4%BD%9C%E7%94%A8%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2023/01/31/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E3%80%90%E8%88%AC%E3%80%91%E9%98%B2%E6%8A%96%E5%92%8C%E8%8A%82%E6%B5%81%E7%9A%84%E5%8C%BA%E5%88%AB%E5%8F%8A%E4%BD%9C%E7%94%A8%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2023/01/31/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E3%80%90%E8%88%AC%E3%80%91%E9%98%B2%E6%8A%96%E5%92%8C%E8%8A%82%E6%B5%81%E7%9A%84%E5%8C%BA%E5%88%AB%E5%8F%8A%E4%BD%9C%E7%94%A8%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" class="leancloud_visitors" data-flag-title="【般】防抖和节流的区别及作用，实现原理与应用场景">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  1.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="防抖和节流有什么用？"><a href="#防抖和节流有什么用？" class="headerlink" title="防抖和节流有什么用？"></a>防抖和节流有什么用？</h2><p>简单来说，防抖和节流都是用来减少函数执行的频率，以达到优化项目性能或者实现特定功能的效果</p>
<h3 id="一、防抖"><a href="#一、防抖" class="headerlink" title="一、防抖"></a>一、防抖</h3><p>定义：事件被触发一定时间后再执行回调。如果在这段时间内又被触发了，则重新开始计算时间</p>
<h4 id="常用场景"><a href="#常用场景" class="headerlink" title="常用场景"></a>常用场景</h4><ul>
<li>输入框远程查询事件</li>
<li>在线文档自动保存</li>
<li>浏览器视口大小改变<br>例子<br>张三在某平台搜索一本书籍，发现搜索建议并不是瞬间就出现的，而是自己输入词组结束后出现的。那么该平台在此搜索框可能做了什么操作？<br>代码实现</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;searchElement&quot;</span> /&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> searchElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;searchElement&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> <span class="title function_">debounce</span> = (<span class="params">fn, initial</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> timer = <span class="literal">null</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="built_in">clearTimeout</span>(timer);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      timer = <span class="built_in">setTimeout</span>(fn, initial);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">searchElement.<span class="property">oninput</span> = <span class="title function_">debounce</span>(<span class="keyword">function</span> (<span class="params">event</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> value = searchElement.<span class="property">value</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">if</span> (value) <span class="variable language_">console</span>.<span class="title function_">log</span>(value, <span class="string">&#x27;请求值&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;, <span class="number">1000</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">timer = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">clearTimeout</span>;</span><br><span class="line">timer = 1s 后执行函数;</span><br><span class="line"></span><br><span class="line"><span class="number">0.</span>5s 后手动触发 input 事件</span><br><span class="line"></span><br><span class="line">timer !== <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">clearTimeout</span>;</span><br><span class="line">timer = 重新计算时间，过 1s 后执行函数;</span><br></pre></td></tr></table></figure>

<h3 id="二、节流"><a href="#二、节流" class="headerlink" title="二、节流"></a>二、节流</h3><p>定义：在单位时间内只触发一次函数，若单位时间内多次触发只有一次生效<br>常用场景</p>
<ul>
<li>按钮提交事件（当然也可做成点击后就 loading）</li>
<li>页面滚动事件的触发</li>
<li>累计计算鼠标移动距离</li>
</ul>
<p><strong>例子</strong><br>张三参加某平台周年庆活动，他选购了某热门饮品并一直点击抢购按钮，却发现并不是每次点击都会有响应的。那么该平台前端可能做了什么限制？<br>代码实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">id</span>=<span class="string">&quot;buttonElement&quot;</span>&gt;</span>抢购<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">fn, interval</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> timer;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">if</span> (timer) <span class="keyword">return</span> <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="built_in">clearTimeout</span>(timer);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        timer = <span class="literal">null</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">fn</span>(event);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, interval);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> btnClick = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;buttonElement&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">btnClick.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="title function_">throttle</span>(<span class="keyword">function</span> (<span class="params">event</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">console</span>.<span class="title function_">log</span>(event, <span class="string">&#x27;点击了&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;, <span class="number">1000</span>));</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>可以看到，张三疯狂点击抢购，但还是每秒只响应 1 次<br>节流(立即执行)<br>上面这个代码有个弊端，那就是在张三第一次点击的时候也隔了 1 秒才响应，这不免也太坑了。正常来说第一次应该直接响应的，并且在连续点击结束后的第一次也应该立即触发，其实想实现这样的效果也不难</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">id</span>=<span class="string">&quot;buttonElement&quot;</span>&gt;</span>抢购<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">function</span> <span class="title function_">throttle2</span>(<span class="params">fn, interval</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">let</span> init = <span class="literal">false</span>; <span class="comment">// 引入一个参数记录状态</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">let</span> timer;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">return</span> <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">if</span> (init) <span class="keyword">return</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          init = <span class="literal">true</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="built_in">clearTimeout</span>(timer);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              init = <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;, interval);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title function_">fn</span>(event);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> btnClick = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;buttonElement&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">btnClick.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="title function_">throttle2</span>(<span class="keyword">function</span> (<span class="params">event</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">console</span>.<span class="title function_">log</span>(event, <span class="string">&#x27;点击了&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;, <span class="number">2000</span>));</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>可以看到第一次点击直接打印，第二次疯狂点击只打印一次，最后一次点击也是直接打印</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">coloring</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> r = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">255</span>);</span><br><span class="line">      <span class="keyword">let</span> g = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">255</span>);</span><br><span class="line">      <span class="keyword">let</span> b = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">255</span>);</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">background</span> = <span class="string">`rgb(<span class="subst">$&#123;r&#125;</span>,<span class="subst">$&#123;g&#125;</span>,<span class="subst">$&#123;b&#125;</span>)`</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, delay</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> timer;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> context = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="keyword">let</span> args = <span class="variable language_">arguments</span>;</span><br><span class="line">        <span class="keyword">if</span> (timer) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">          timer = <span class="literal">null</span>;</span><br><span class="line">        &#125;, delay);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;resize&quot;</span>, <span class="title function_">throttle</span>(coloring, <span class="number">2000</span>));</span><br><span class="line">  &lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">coloring</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> r = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">255</span>);</span><br><span class="line">    <span class="keyword">let</span> g = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">255</span>);</span><br><span class="line">    <span class="keyword">let</span> b = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">255</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">background</span> = <span class="string">`rgb(<span class="subst">$&#123;r&#125;</span>,<span class="subst">$&#123;g&#125;</span>,<span class="subst">$&#123;b&#125;</span>)`</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, delay</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> pre = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> context = <span class="variable language_">this</span>;</span><br><span class="line">      <span class="keyword">let</span> args = <span class="variable language_">arguments</span>;</span><br><span class="line">      <span class="keyword">let</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">      <span class="keyword">if</span> (now - pre &gt; delay) &#123;</span><br><span class="line">        func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">        pre = now;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;resize&quot;</span>, <span class="title function_">throttle</span>(coloring, <span class="number">2000</span>));</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>⚠️ 注意：<br>在设定防抖函数的时候，没有出现预期中的限制函数执行次数的效果。<br>防抖函数一开始定义如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">debounce</span>(<span class="params"> fn,delay</span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    timer = <span class="literal">null</span></span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(fn,delay)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原因出在闭包里清除 timer 的时候用的是 timer&#x3D;null，而不是 clearTimeout(timer)函数。<br>因为在用 timer&#x3D;null 的时候，只是改变了 timer 的指向，并没有清除掉定时器，此时定时器在内存中虽然没有变量指向它，但它仍存在内存中，待 delay 时间一到，就执行 fn 函数。所以当 fn 经过防抖函数限制后，在 delay 时间内调用多少次 fn 函数，就会有多少次的定时器存在内存中，就会执行多少此 fn 函数，并不能实现预期中的在 delay 时间内只执行一次 fn 函数。<br>clearTimeout(timer)是在内存中清除掉定时器，所以在 delay 时间内，无论执行 fn 多少次，都只会有一个定时器存在<br>防抖函数正确定义如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">debounce</span>(<span class="params"> fn,delay</span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(timer) <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(fn,delay)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>三、引入 Lodash 实现<br>官方文档：<a href="https://www.lodashjs.com/">https://www.lodashjs.com/</a></p>
<p>防抖</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&quot;lodash&quot;</span>;</span><br><span class="line"><span class="attr">debounceHandle</span>: _.<span class="title function_">debounce</span>(</span><br><span class="line">  <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;业务代码&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="number">2000</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 在 n 毫秒内触发</span></span><br><span class="line">    <span class="attr">leading</span>: <span class="literal">true</span>, <span class="comment">// 第一次点击立刻执行，默认为 true</span></span><br><span class="line">    <span class="attr">trailing</span>: <span class="literal">true</span>, <span class="comment">// 节流结束后立刻执行，默认为 true</span></span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>节流</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&quot;lodash&quot;</span>;</span><br><span class="line"><span class="attr">throttleHandle</span>: _.<span class="title function_">throttle</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;业务代码&quot;</span>);</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2023/01/31/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/%E3%80%90%E6%90%AC%E3%80%91%E4%BA%94%E7%AC%94%E8%BE%93%E5%85%A5%E6%B3%95-%E5%85%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/01/31/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/%E3%80%90%E6%90%AC%E3%80%91%E4%BA%94%E7%AC%94%E8%BE%93%E5%85%A5%E6%B3%95-%E5%85%A8/" itemprop="url">五笔输入法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-01-31T20:46:42+08:00">
                2023-01-31
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2023/01/31/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/%E3%80%90%E6%90%AC%E3%80%91%E4%BA%94%E7%AC%94%E8%BE%93%E5%85%A5%E6%B3%95-%E5%85%A8/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2023/01/31/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/%E3%80%90%E6%90%AC%E3%80%91%E4%BA%94%E7%AC%94%E8%BE%93%E5%85%A5%E6%B3%95-%E5%85%A8/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2023/01/31/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/%E3%80%90%E6%90%AC%E3%80%91%E4%BA%94%E7%AC%94%E8%BE%93%E5%85%A5%E6%B3%95-%E5%85%A8/" class="leancloud_visitors" data-flag-title="五笔输入法">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  5k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  18
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>汉子有五种基本结构：</p>
<ul>
<li>一、左右型：羽 汉 独 体 树</li>
<li>二、上下型：泉 字 全 品 复</li>
<li>三、独体字：本 五 子 已 王</li>
<li>四、半包围：这 包 同 区 凶</li>
<li>五、全包围：围 因 困 回 圆</li>
</ul>
<p>五笔中只有三种结构，其中“左右型”和“上下型”同上，<br>而 3，4，5 均属于“杂合型”。</p>
<p>笔画（笔划）：</p>
<ul>
<li>定义：一次不间断连续写成的一个线条称为笔画。</li>
<li>攵 vs 夂</li>
</ul>
<p>汉子有五种基本笔画：</p>
<ul>
<li>横 竖 撇 捺 折</li>
<li>一 丨 丿 丶 乙乚𠃌乛⺄</li>
</ul>
<p>注意：</p>
<ul>
<li>提，属于横；点，属于捺。 （土&#x2F;地 文）</li>
<li>左竖钩，属于竖。 （木&#x2F;条&#x2F;杀）</li>
<li>除左竖钩外任何带拐弯的笔画都属于折。 （已&#x2F;九&#x2F;刀&#x2F;匕&#x2F;己）</li>
<li>有的点的方向是朝左的，不要误认为是撇。（宀&#x2F;刃&#x2F;心）</li>
</ul>
<p>字根：<br>定义：由几个笔画 交叉连接组成的相对不变的结构。</p>
<ul>
<li>字根是组成汉子的基本单元。</li>
<li>多数偏旁部首都属于字根，如：<br>亻（wth），扌（rghg），氵（iyyg），口（kkkk），辶（pyny），艹（aghh），阝（bnh）</li>
<li>但是有些偏旁部首需要两个以上字根组成，如：<br>饣（qnb），犭（qte），衤（pui），礻（pyi），龹（ud），气（rnb），穴（pwu）</li>
</ul>
<p>五笔 拼音<br>灬 oyyy biao1 huo3<br>冫 uyg bing1<br>艹 aghh ao3<br>屮 bhk che4<br>辶 pyny chuo4<br>刂 jhh dao1<br>匚 agn fang1<br>阝 bnh fu3<br>廾 agth gong3<br>勹 qtn bao1<br>丶 yyll zhu3<br>尢 dnv you2<br>饣 qnb shi2<br>囗 lhng wei2<br>钅 qtgn jin1<br>礻 pyi shi4<br>氵 iyyg shui3<br>讠 yyn yan2<br>纟 xxxx jiao3 si1<br>疒 uygg ne4<br>亻 wth ren2<br>彡 ettt shan1 xian3<br>丨 hhll gun3<br>扌 rghg shou3<br>卩 bnh jie2<br>冂 mhn jiong1<br>冖 pyn mi4<br>宀 pyyn mian2<br>肀 vhk yu4<br>丿 ttll pie3 yi4<br>攵 ttgy pu1<br>廴 pny yin3 yin4<br>衤 pui yi1<br>忄 nyhy xin1<br>彐 vngg xue3<br>亠 yyg tou2<br>虍 hav hu1<br>犭 qte quan3<br>凵 bnh qian3 kan3<br>夂 ttny dong1 zhe2 zhi3<br>丬 uygh pan2</p>
<p>86 五笔的字根有 130 个，如果算上某些个字根的变体，（字根图上）约有 200 个，不要惧怕字根的数量，要有“麻烦一时，方便一世”的观念。</p>
<p>1、键名汉子（共 25 个）：<br>金（Q） 人（W） 月（E） 白（R） 禾（T） 言（Y） 立（U） 水（I） 火（O） 之（P）<br>工（A） 木（S） 大（D） 土（F） 王（G） 目（H） 日（J） 口（K） 田（L）<br>纟（X） 又（C） 女（V） 子（B） 已（N） 山（M）</p>
<ul>
<li>他们是字根图上每个键左上角的黑体字；也是每句口诀的第一个字（X 键除外）</li>
<li>打法：连续打四次所在的键位。简便打发：QQ 五笔默认词库也可打一次所在键位，然后选第二项（A&#x2F;W&#x2F;X 键除外）</li>
</ul>
<p>2、一级简码（一简，共 25 个）<br>我（Q） 人（W） 有（E） 的（R） 和（T） 主（Y） 产（U） 不（I） 为（O） 这（P）<br>工（A） 要（S） 在（D） 地（F） 一（G） 上（H） 是（J） 中（K） 国（L）<br>经（X） 以（C） 发（V） 了（B） 民（N） 同（M）</p>
<ul>
<li>他们是使用频率极高的字，必须记住。“经发同和我以为，在人民中国这一主要工地上，有的是产不了”。</li>
<li>打法：打一次所在键位，然后按空格键。</li>
</ul>
<p>3、单笔画（共五个）：</p>
<ul>
<li><p>丿（TTLL），丶（YYLL）</p>
</li>
<li><p>一（GGLL），丨（HHLL）</p>
</li>
<li><p>乙（NNLL）</p>
</li>
<li><p>这五个键很重要，是每个区的第一个键，也称单笔画键，在打成字字根时需要用到。</p>
</li>
<li><p>打法：所在键位*2 + LL，让后按空格键。</p>
<p>4.成字字根（约 90 个）：</p>
</li>
<li><p>有相当一部分字根本身就可以被用来作为常用的简单汉字（或偏旁），他们被称为“成字字根”。</p>
</li>
<li><p>打法：所在键位+第一笔+第二笔（+最后一笔）</p>
</li>
<li><p>例：犬（DGTY） 手（RTGH） 心（NYNY） 五（GGHG） 刀（VNT） 【日（JJJJ）曰（JHNG）、子（BBBB）孑（BNHG）】</p>
</li>
<li><p>特例：力（LTN） 乃（ETN） 戈（AGNT）</p>
<p>5.二级简码、三级简码、全码：<br>为了提高录入速度，有些字的编码可以简化。如果一个字用两个字母键就可以打出（立 UU&#x2F;水 II&#x2F;五 GG），那么它叫做二级简码；</p>
</li>
</ul>
<p>如果一个字用三个字母键就可以打出（斤 RTT&#x2F;竹 TTG&#x2F;皿 LHN），那么它叫做三级简码;</p>
<p>汉字的全部编码叫做全码，全码最多四码，最少三码。</p>
<p>什么样的全码只有三码？</p>
<ul>
<li>只有两个笔画的成字字根如“十（FGH）&#x2F;厂（DGT）&#x2F;九（VTN）&#x2F;二（FGG）”；</li>
<li>只能拆成两部分的字。</li>
<li>只有一个笔画？那叫做单笔画，全码四码！</li>
</ul>
<p>6、重码：即“重复的编码”</p>
<ul>
<li>有的重码需要进行选择：<ul>
<li>FGHY：雨、寸</li>
<li>FCU：云、去、支</li>
</ul>
</li>
<li>有的重码可以被简码分流：<ul>
<li>FKUK：嘉、喜</li>
<li>FKU：喜</li>
</ul>
</li>
</ul>
<h3 id="字根"><a href="#字根" class="headerlink" title="字根"></a>字根</h3><ul>
<li>字根顺序按照 横区&#x2F;竖区&#x2F;撇区&#x2F;捺区&#x2F;折区 的顺序，每个区的键位按位号的顺序来讲解。</li>
<li>撇区 QWERT</li>
<li>捺区 YUIOP</li>
<li>横区 ASDFG</li>
<li>竖区 HJKLM</li>
<li>折区 XCVBN</li>
<li>万能键 Z</li>
</ul>
<h3 id="横区"><a href="#横区" class="headerlink" title="横区"></a>横区</h3><p>11 G 王旁青头戋五一</p>
<ul>
<li>1.王——国 现 理 全 程</li>
<li>2.——表 青 责 麦 毒 【勤】</li>
<li>3.戋——线 钱 残 践 盏</li>
<li>4.五——伍 吾（语 悟 捂）</li>
<li>5.一——不 来 到 于 旦</li>
</ul>
<p>12 F 土士二干十寸雨</p>
<ul>
<li>1.土——地 里 等 场 社</li>
<li>2.士——结 志 喜 款 壮</li>
<li>3.二——些 无 元 毛 击</li>
<li>4.干——赶 刊 汗 岸 竿</li>
<li>5.十——科 计 德 南 卖</li>
<li>6.寸——时 对 过 得 导</li>
<li>7.雨——需 露 雷 雪 零</li>
<li>8.革（革字旁，键盘打不出来）——革（勒 鞋 鞭 靶）【注意 ⚠️：勤 不是这个偏旁】</li>
</ul>
<p>13 D 大犬三羊古石厂</p>
<ul>
<li>1.大——美 太 达 类 天【夫】</li>
<li>2.犬——然 突 壮 哭 厌</li>
<li>3.三——丰 害 非 承 拜<br>-4.羊字底——羊（样 洋 鲜 详 痒）【善】【注意 ⚠️：美 不是这个偏旁】</li>
<li>5.古——克 故 苦 居 固</li>
<li>6.石——破 磨 拓 岩 泵</li>
<li>7.厂——成 原 历 压 顾</li>
<li>8.镸——套 肆 髟 biao （鬓 bin 髻 ji）</li>
<li>9.丆——万【方】面 百 夏 页</li>
<li>10.在字头（键盘打不出来）——在 有 友 左 丈【尴尬】（上下结构）</li>
<li>11.尤字边（键盘打不出来）——龙（崇 龚）尤（优 扰）</li>
<li>12.——着 差 羞 养 羌【注意 ⚠️：看 不是这个偏旁】</li>
</ul>
<p>14 S 木丁西</p>
<ul>
<li>1.木——末【注意 ⚠️：末 不是这个偏旁】本【注意 ⚠️：夲 不是这个偏旁】条 机 果 术</li>
<li>2.丁——可 打 奇 停 宁 【注意 ⚠️：行 不是这个偏旁】</li>
<li>3.西覀——要 配 酒 洒 尊</li>
</ul>
<p>15 A 工戈草头右框七</p>
<ul>
<li>1.工——经 式 空 功 红 【注意 ⚠️：候 不是这个偏旁】</li>
<li>2.戈——战 找 划 戏 戛</li>
<li>3.艹——英 花 节 满 药（扁 垂）</li>
<li>4.匸（右框）——区 医 巨 汇 匹（牙 既 舛 瞬 舞）</li>
<li>5.七——东 切 练 托 皂 （尧 晓 翘）</li>
<li>6.弋——代 袋 贷 岱 鸢 yuan</li>
<li>7.共字头（键盘打不出来）——展 共 错 黄 港【曲 典 曹】</li>
<li>8.廾——开 并 升 异 戒</li>
<li>9.廿 nian——度 世 席 燕 遮</li>
</ul>
<h3 id="竖区"><a href="#竖区" class="headerlink" title="竖区"></a>竖区</h3><p>21 H 目具上止卜虎皮</p>
<ul>
<li>1.目——自（首道）看 着 相 算</li>
<li>2.具字头——具（俱 惧 真 ） 直【注意 ⚠️：且 不是这个偏旁】</li>
<li>3.上——让 卡 寂 叔 忐</li>
<li>4.止——正 步 扯 歧 卸 疏【延】</li>
<li>5.卜——下 外 占 卢 丐</li>
<li>6.虎子头——虑 虚 虎 虐 彪</li>
<li>7.皮字头——皮（被 波 破 疲）</li>
<li>8.足字底——走 足 疋 pi（楚 蛋 凝）</li>
<li>9.｜——旧 引 巾 中 申</li>
</ul>
<p>22 J 日早两竖与虫依</p>
<ul>
<li>1.日曰——是 时 得 单 里 【冒 冕】</li>
<li>2.早——章 草 覃 （潭）卓（掉 罩）</li>
<li>3.临字旁——临 紧 坚 览 竖</li>
<li>4.虫——虽 独 虹 蛮 蛇</li>
<li>5.师字旁——师 归 帅 狮 筛【 注意 ⚠️：班 辨 不是这个偏旁】</li>
<li>6.临字底——临 象 （像 橡 蟓）【注意 ⚠️：免 不是这个偏旁】</li>
<li>7.刂——到 前 制 利 别</li>
<li>8.井字底——井 界 养 弗 肃【注意 ⚠️：渊 不是这个偏旁】</li>
</ul>
<p>23 k 口与川，字根稀</p>
<ul>
<li>1.口——中 说 后 如 事</li>
<li>2.川——训 圳 驯 钏 chuan 卅 sa</li>
<li>3.三竖——带 滞</li>
</ul>
<p>24 L 田甲方框四车力</p>
<ul>
<li>1.田——思 男 备 留 细 【界】</li>
<li>2.甲——鸭 押 闸 钾 匣</li>
<li>3.口——国 因 回 图 烟【面】</li>
<li>4.四——泗 德 罗 置 曼</li>
<li>5.车——军 转 连 载 库</li>
<li>6.力——为 动 加 务 厉</li>
<li>7.皿——血 益 温 盘 盖</li>
<li>8.曾字头——黑 默 熏 曾 增【柬】</li>
<li>9.四竖——舞</li>
</ul>
<p>25 M 山由贝，下框几</p>
<ul>
<li>1.山——岁 密 端 岛 峰</li>
<li>2.由——油 演 迪 届 邮【黄 笛】</li>
<li>3.贝——则 资 员 页 质</li>
<li>4.下框——同 高 内 制 央 【再 丹 刺 市 沛】</li>
<li>5.几——机 风 微 沉 凡</li>
<li>6.骨字头——滑 猾 髓 骷 髅</li>
</ul>
<h3 id="撇区"><a href="#撇区" class="headerlink" title="撇区"></a>撇区</h3><p>31 T 禾竹一撇双人立，反文条头共三一</p>
<ul>
<li>1.禾——和 科 香 乘 秦【注意 ⚠️：秉 不是这个偏旁】</li>
<li>2.竹字头——第 管 算 答 笔</li>
<li>3.丿——长 么 丢 千 升</li>
<li>4.双人旁——得 行 很 德 往</li>
<li>5.反文旁——教 做 政 数 收</li>
<li>6.条头——各 处 条 复 图 【夜】</li>
<li>7.每字头——每 旅 游 吃览</li>
</ul>
<p>32 R 白手看头三二斤</p>
<ul>
<li>1.白——的 原 激 怕 皆 【卑（牌 啤）】</li>
<li>2.手——拿 掰 摩 拳 掌</li>
<li>3.看头——看 拜 湃 掰 搿 【注意 ⚠️：着 不是这个偏旁】</li>
<li>4.斤——所 新 近 兵 丘</li>
<li>5.提手旁——把 提 抱 接 指 【牛】【注意 ⚠️：牛字旁 不是这个偏旁】</li>
<li>6.年字头——年 牛 气 制 舞</li>
<li>7.两撇——勿 匆 忽 杨 汤</li>
<li>8.后字头——后 派 殷 爪 瓜</li>
</ul>
<p>33 E 月彡乃用家衣底，爱头豹脚舟底部</p>
<ul>
<li>1.月——明 期 服 脑 望</li>
<li>2.曰——有 且 青 能 甫</li>
<li>3.彡——形 影 参 须 修</li>
<li>4.乃——及 仍 秀 孕 盈</li>
<li>5.用——通 拥 痛 勇 涌</li>
<li>6.家字底——家 啄 蒙 缘 遂 【象】【注意 ⚠️ 聚 不是这个偏旁】</li>
<li>7.衣字底——衣 农 裁 袭 袅</li>
<li>8.辰字底——展 良 辰 派 旅</li>
<li>9.爱字头——爱 受 摇 缓 浮</li>
<li>10.豹脚——貌 豹 霾 豺</li>
<li>11.舟底部——舟 搬 航 盘 船【注意 ⚠️ 丹 不是这个偏旁】</li>
</ul>
<p>34 W 人和八，祭登头</p>
<ul>
<li>1.人——会 内 论 欠 该</li>
<li>2.单人旁——他 们 作 体【段 追 舆 】【注意 ⚠️ 币 不是这个偏旁】</li>
<li>3.八——分 共 办 赛 商</li>
<li>4.登字头——登 瞪 凳 橙 癸【注意 ⚠️ 僚 不是这个偏旁】</li>
<li>5.祭字头——祭 察 蔡 擦 嚓</li>
</ul>
<p>35 Q 金勺缺点无尾鱼，犬旁留叉儿一点夕，氏无七</p>
<ul>
<li>1.金——鉴 鑫 鏖 銮 淦【注意 ⚠️ 釜 不是这个偏旁】</li>
<li>2.金字旁——销 钱 错 钟 针</li>
<li>3.勺字头——勺 包 勾 黎 【敖】【注意 ⚠️ 万 不是这个偏旁】</li>
<li>4.鱼字头——鱼 鲁 鲜 酥 蓟</li>
<li>5.犬旁——独 获 犯 狂 狱</li>
<li>6.叉缺点——义 更 史 区 交 【爽】</li>
<li>7.特殊一级简码：我</li>
<li>8.儿——无 元 见 说 先</li>
<li>9.夕——多 外 名 罗 梦</li>
<li>10.氏无七——氏 留 印 低 仰 【乐 卵 孵】</li>
<li>11.欠字头——久 欠 色 急 傲</li>
<li>12.炙字头——然 燃 炙【注意 ⚠️ 蔡 不是这个偏旁】</li>
<li>13.荒字底——荒 慌 流 硫 侃 【注意 ⚠️ 川 不是这个偏旁】</li>
</ul>
<h3 id="捺区"><a href="#捺区" class="headerlink" title="捺区"></a>捺区</h3><p>41 Y 言文方广在四一，高头一捺谁人去</p>
<ul>
<li>1.言——信 警 誉 誓 詹</li>
<li>2.言字旁——说 话 读 记 让</li>
<li>3.文——这 刘 齐 纹 斌</li>
<li>4.方——游 放 旅 防 房</li>
<li>5.广——度 底 府 店 扩</li>
<li>6.亡字头——夜 卒 玄 亡（亥 该 刻）</li>
<li>7.高头——高 就 京 熟 享</li>
<li>8.一点——主 良 匆 斥 啄</li>
<li>9.一捺——久 及 极 入 尺</li>
<li>10.谁人去——难 集 维 鹤 截 【注意 ⚠️ 主 圭 不是这个偏旁】</li>
</ul>
<p>42 U 立辛两点六门疒</p>
<ul>
<li>1.立——产 音 站 部 位</li>
<li>2.立字头——旁 榜 帝 商 滴</li>
<li>3.辛——辞 辨 辩 宰 辜</li>
<li>4.两点——习 匀 决 弱 尽</li>
<li>5.六——交（效 郊 胶 咬）滚 冥</li>
<li>6.门——们 间 问 闻 闹</li>
<li>7.疒——疾 病 痛 痒 疗</li>
<li>8.两点——着 弟 羊 尊 丫</li>
<li>9.将字旁——北（乘 乖） 将 状</li>
<li>10.普字头——平 普 丧 墙 善 半</li>
</ul>
<p>43 I 水旁兴头小倒立</p>
<ul>
<li>1.水——泉 冰 踏 浆 淼</li>
<li>2.三点水——没 法 活 海 深</li>
<li>3.永字旁——永 承 兆 求 拯</li>
<li>4.录字底——录 泰 隶 康 聚</li>
<li>5.学字头——学 觉 常 党 尝</li>
<li>6.兴字头——兴 举 应 光 晃</li>
<li>7.小——不 就 你 系 东 【步】</li>
</ul>
<p>44 O 火业头，四点米</p>
<ul>
<li>1.火——炎 灵 烟 伙 灰</li>
<li>2.业头——业 显 亚 壶 凿</li>
<li>3.亦字底——亦 变 弯 兼 嫌</li>
<li>4.四点底——然 点 照 热 杰</li>
<li>5.米——来 精 断 奥 粤<br>特殊一简：为</li>
</ul>
<p>45 P 之字军盖建道底，摘礻衤</p>
<ul>
<li>1.之——乏 泛 芝 贬 眨</li>
<li>2.宝盖头——家 实 定 它 安</li>
<li>3.军盖——学 军 写 农 劳</li>
<li>4.建字底——建 庭 延 键 挺</li>
<li>5.辶——这 过 还 道 进</li>
<li>6.摘礻衤——被 初 补 裤 裙 社 神 福 祝 礼</li>
</ul>
<h3 id="折区"><a href="#折区" class="headerlink" title="折区"></a>折区</h3><p>51 N 已半巳满不出己，左框折尸心和羽</p>
<ul>
<li>1.已——唯一一个不能组字的字根</li>
<li>2.巳——导 包 异 港 撰 【注意 ⚠️ 犯 仓 不是这个偏旁】</li>
<li>3.己——起 记 改 纪 凯</li>
<li>4.左框——巨 追 所 候 决 快 【鹿】</li>
<li>5.乙——甩 书 与 瓦 片 乜（nie）</li>
<li>6.尸——民 展 尺 尽 户</li>
<li>7.眉字头——声 馨 眉 媚 嵋</li>
<li>8.心——想 意 感 思 必</li>
<li>9.竖心旁——性 情 快 恭 添</li>
<li>10.羽——翻 翼 耀 翰 廖</li>
</ul>
<p>52 B 子耳了也框向上</p>
<ul>
<li>1.子——学 好 教 存 孙 【孑 孓】</li>
<li>2.耳——最 取 闻 敢 聂</li>
<li>3.却字旁——卫 报 却 节 迎</li>
<li>4.耳朵旁——都 那 部 郑 邮（在右）院 队 随 陈 阳（在左）</li>
<li>5.了——疗 辽 亨 哼【予 矛】</li>
<li>6.也——他 地 她 施 拖</li>
<li>7.下框——凶 出 函 离</li>
<li>8.卷子底——创 范 顾 卷 危</li>
<li>9.粼字旁——粼</li>
</ul>
<p>53 V 女刀九臼山朝西</p>
<ul>
<li>1.女——好 如 她 数 安</li>
<li>2.刀——分 解 照 切 超 【那】</li>
<li>3.九——丸 究 热 杂 仇</li>
<li>4.臼——搜 插 陷 毁 鼠</li>
<li>5.山朝西——雪 尹 庚 兼 肃</li>
<li>6.巢字头——巡 巢 瑙 缁 邋<br>特殊一级简码：发</li>
</ul>
<p>54 C 又巴马，丢矢矣</p>
<ul>
<li>1.又——对 度 报 受 变</li>
<li>2.巴——把 色 肥 爬 绝</li>
<li>3.马——吗 验 骂 冯 闯</li>
<li>4.矣字头——能 么 公 治 即 【离】【注意 ⚠️ 偶 不是这个偏旁】</li>
<li>5.勇字头——通 勇 涌 疑 凝【注意 ⚠️ 专 不是这个偏旁】</li>
<li>6.经字头——经 轻 劲 茎 氢<br>特殊一级简码：以</li>
</ul>
<p>55 X 慈母无心弓和比，幼无力【一级简码：经】</p>
<ul>
<li>1.母框——母（每 毒 敏 繁）贯（惯）毋</li>
<li>2.弓——第 强 张 弱 弗</li>
<li>3.匕——能 比 老 它 死 【曳】【注意 ⚠️ 戊 不是这个偏旁】</li>
<li>4.幻字旁——系 素 率 幻 玄</li>
<li>5.绞丝旁——经 给 线 丝 乡</li>
<li>6.缘字头——互 缘 蠡（li）</li>
</ul>
<p>五笔汉子的拆分原则</p>
<ul>
<li>我们先讲讲书写顺序.</li>
<li>在书写汉字时,讲究“先左后右,先上后下,先横后竖,先撇后捺,先内后外,先中间后两边,先进门后关门”等.</li>
</ul>
<p>书写顺序</p>
<p>例如:<br>“新”字取码的顺序应该是“立、木、斤”,不能取“木、立、斤”,也不能是“立、斤、木”.<br>“和”字取码的顺序应该是“禾、口”,不能取“口、禾”.</p>
<p>取大优先<br>取大优先指的是在各种可能的拆法中,保证按书写顺序拆出尽可能大的字根,以保证拆分出的字根数最少.</p>
<p>例如:<br>“适”可以拆分为“丿、古、辶”,还可以拆成“丿、十、古、辶”.哪一种是正确的呢?</p>
<p>根据取大优先原则,拆出的字根要尽可能大,而第二种拆法中的“十”,“口”两个字根可以合成为一个字根“古”,所以第一种拆法是正确的.</p>
<p>再比如除法中的“除”,可以拆分成“阝、八、禾”,或拆成“阝、八、丿、木”.</p>
<p>这时我们可以判断第一种是正确的,把“丿、木”合成为一个字根“禾”.</p>
<p>“世”字可以取为“一、凵、乙”,也可以取“甘、乙”.</p>
<p>兼顾直观<br>就是说在拆字时,尽量照顾字的直观性,一个笔划不能分割在两个字根中.</p>
<p>兼顾直观,在确认字根时,为了使字根的特征明显易辨,有时就要牺牲书写顺序禾取大优先原则.</p>
<p>例如:<br>“国”,如按书写顺序,其字根应是“冂、王、丶、一”,但这样编码不断有违该字的字源,也不能使字根“口”直观易辨.</p>
<p>为了直观,国字的正确拆分应该是“口、王、丶”.</p>
<p>能散不连<br>如果一个结构可以视作几个基础字根的散的关系,就不要认为是连的关系.</p>
<p>例如:<br>“主”字按取大优先,应该取“亠、土”,但根据此规则,只能取“丶、王”.</p>
<p>总之,拆分应兼顾几个方面的要求.一般来说,应当保证每次拆出最大的基本字根,在拆出字根的数目相同时,“散”比“连”优先,“连”比“交”优先.</p>
<p>能连不交<br>当一个字可以视作相连的几个字根,也可视作相交的几个字根时,我们认为,相连的情况是可取的.</p>
<p>天: 一 大 (两者是相连的) (正确)<br>天: 二 人 (两者是相交的) (错误)</p>
<p>五笔汉字的取码规则</p>
<p>1.键名汉字:王 目 禾 言 已<br>规则:所在键位<em>4 2.成字字根:五 戈 皿 小 九<br>规则:所在键位+第一笔+第二笔+(末笔) 3.单笔划:一 丨 丿 丶 乙<br>规则:所在键位</em>2+LL</p>
<p>4.一级简码（一简，共 25 个）<br>我（Q） 人（W） 有（E） 的（R） 和（T） 主（Y） 产（U） 不（I） 为（O） 这（P）<br>工（A） 要（S） 在（D） 地（F） 一（G） 上（H） 是（J） 中（K） 国（L）<br>经（X） 以（C） 发（V） 了（B） 民（N） 同（M）</p>
<ul>
<li><p>他们是使用频率极高的字，必须记住。“经发同和我以为，在人民中国这一主要工地上，有的是产不了”。</p>
</li>
<li><p>打法：打一次所在键位，然后按空格键。</p>
<p>5.二级简码、三级简码、全码：<br>为了提高录入速度，有些字的编码可以简化。如果一个字用两个字母键就可以打出（立 UU&#x2F;水 II&#x2F;五 GG），那么它叫做二级简码；</p>
</li>
</ul>
<p>如果一个字用三个字母键就可以打出（斤 RTT&#x2F;竹 TTG&#x2F;皿 LHN），那么它叫做三级简码;</p>
<p>汉字的全部编码叫做全码，全码最多四码，最少三码。</p>
<p>什么样的全码只有三码？</p>
<ul>
<li><p>只有两个笔画的成字字根如“十（FGH）&#x2F;厂（DGT）&#x2F;九（VTN）&#x2F;二（FGG）”；</p>
</li>
<li><p>只能拆成两部分的字。</p>
</li>
<li><p>只有一个笔画？那叫做单笔画，全码四码！</p>
<p>6.可拆分汉字</p>
</li>
<li><p>可拆成两个字根:改 京 仅<br>规则:字根 1+字根 2+识别码(全码 3 码)</p>
</li>
<li><p>可拆成三个字根:等 漏 仰<br>规则:字根 1+字根 2+字根 3+识别码</p>
</li>
<li><p>可拆成四个字根:毁 两 拿<br>规则:字根 1+字根 2+字根 3+字根 4<br>可拆成四个字根以上:幕 器 慧<br>规则:字根 1+字根 2+字根 3+最后一个字根</p>
</li>
</ul>
<p>末笔交叉识别码</p>
<p>Q:为什么设置识别码?<br>A:由于字根在组成汉字时,即使所使用的字根完全相同,如果排序的方式不同也会得到不同的汉字;</p>
<p>因此,五笔字型提出了末笔交叉识别码,它是有助于区别字根组合相同而字根排列位置相异的不同汉字的一种补充编码.</p>
<p>如果一个汉字可以拆成两个字根或三个字根,输入完他们所在的键位之后,如果汉字没有出现在候选窗当中,那么就需要加一个识别码.</p>
<p>比如:她&#x3D;女+也&#x3D;vb<br>但是:vb&#x3D;好,“她”识别码为 n<br>所以:vbn&#x3D;她</p>
<p>又如:票&#x3D;西+二+小&#x3D;sfi<br>但是 sfi&#x3D;标,“票”识别码为 u<br>所以:sfiu&#x3D;票</p>
<p>⚠️ 注意:下方的蓝色字为示例</p>
<p>前 300 常用字拆分</p>
<p>Q:为什么要练前 300 常用字?<br>A:因为它们很常用,这些字可以占到 65%的使用频率,打熟前 300 常用字,以后再练习打文章的时候也会更快.无论你的水平处于哪个层次,前 300 常用字一定要不断练习的.</p>
<p>识别码用浅蓝色表示(前 300 中有 20 个字需要打识别码)<br>对照字根图理解每个字的编码.</p>
<p>横区<br>G(20 个)</p>
<ul>
<li>一(g) –一级简码</li>
<li>开(ga)</li>
<li>形(gae)</li>
<li>到(gc) – 二级简码</li>
<li>天(gd)</li>
<li>表(ge)</li>
<li>于(gf)</li>
<li>五(gg) – 成字字根</li>
<li>下(gh)</li>
<li>正(ghd)–识别码 d</li>
<li>政(ght)</li>
<li>还(gip)</li>
<li>理(gj)</li>
<li>更(gjq)</li>
<li>事(gk)– 二级简码</li>
<li>现(gm)</li>
<li>两(gmww)</li>
<li>与(gn)– 二级简码</li>
<li>来(go)</li>
<li>平(gu,guh)</li>
</ul>
<p>F(20 个)</p>
<ul>
<li>地(f) –一级简码</li>
<li>支(fc)</li>
<li>动(fcl)</li>
<li>运(fcp)</li>
<li>去(fcu)–识别码 u</li>
<li>土(ffff)–键名汉子</li>
<li>二(fg)– 成字字根</li>
<li>干(fggh)– 成字字根</li>
<li>十(fgh)– 成字字根</li>
<li>直(fh)</li>
<li>起(fhn)</li>
<li>进(fj,fjp)– 二级简码</li>
<li>志(fn)</li>
<li>过(fp)</li>
<li>无(fq)</li>
<li>教(ftbt)</li>
<li>者(ftj)</li>
<li>都(ftjb)</li>
<li>老(ftx)</li>
</ul>
<p>D(11 个)</p>
<ul>
<li>在(d)–一级简码</li>
<li>大(dd)– 二级简码</li>
<li>压(dfy)</li>
<li>三(dg)– 成字字根</li>
<li>石(dgtg)– 成字字根</li>
<li>百(dj)</li>
<li>面(dm)</li>
<li>而(dmj)</li>
<li>成(dn)</li>
<li>克(dq)</li>
<li>原(dr)</li>
</ul>
<p>S(11 个)</p>
<ul>
<li>要(s)</li>
<li>极(se)</li>
<li>本(sg)</li>
<li>西(sghg)</li>
<li>相(sh)</li>
<li>想(shn)</li>
<li>可(sk)</li>
<li>机(sm)</li>
<li>林(ss)</li>
<li>样(su)</li>
<li>根(sve)</li>
</ul>
<p>A(11 个)</p>
<ul>
<li>工(a)</li>
<li>式(aa)</li>
<li>基(ad)</li>
<li>其(adw)</li>
<li>期(adwe)</li>
<li>革(af)</li>
<li>七(ag)</li>
<li>或(ak)</li>
<li>区(aq)</li>
<li>切(av)</li>
<li>共(aw)</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2022/04/03/%E5%8D%A1%E8%80%81%E5%B8%88%E7%9A%84%E7%A1%AC%E6%A0%B8React%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9A%E5%8D%A1%E9%A2%82%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/04/03/%E5%8D%A1%E8%80%81%E5%B8%88%E7%9A%84%E7%A1%AC%E6%A0%B8React%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9A%E5%8D%A1%E9%A2%82%EF%BC%89/" itemprop="url">卡老师的硬核React面试题（视频：卡颂）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-04-03T15:32:54+08:00">
                2022-04-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2022/04/03/%E5%8D%A1%E8%80%81%E5%B8%88%E7%9A%84%E7%A1%AC%E6%A0%B8React%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9A%E5%8D%A1%E9%A2%82%EF%BC%89/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2022/04/03/%E5%8D%A1%E8%80%81%E5%B8%88%E7%9A%84%E7%A1%AC%E6%A0%B8React%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9A%E5%8D%A1%E9%A2%82%EF%BC%89/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2022/04/03/%E5%8D%A1%E8%80%81%E5%B8%88%E7%9A%84%E7%A1%AC%E6%A0%B8React%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9A%E5%8D%A1%E9%A2%82%EF%BC%89/" class="leancloud_visitors" data-flag-title="卡老师的硬核React面试题（视频：卡颂）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  1.9k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  7
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-聊聊-React-生命周期"><a href="#1-聊聊-React-生命周期" class="headerlink" title="1.聊聊 React 生命周期"></a>1.聊聊 React 生命周期</h3><p>UI&#x3D;fn(state)<br>用户交互触发了 this.setState，</p>
<p>state：被称为 Reconciler，用于计算出状态变化。在 reconciler 中会执行一个被称为 reconcile 的算法，也就是 diff 算法。此阶段为 render 阶段。</p>
<p>fn：被称为 Renderer（渲染器），用于将状态变化渲染在视图中。此阶段为 commit 阶段。</p>
<p>这两个阶段会执行所有的生命周期函数。</p>
<blockquote>
<p>render 阶段：</p>
</blockquote>
<ul>
<li>Mount<ul>
<li>constructor</li>
<li>componentWillMount【react17 废弃】</li>
<li>getDerivedStateFromProps（替代 componentWillMount）</li>
<li>render</li>
</ul>
</li>
<li>Update<ul>
<li>componentWillReceiveProps【react17 废弃】</li>
<li>getDerivedStateFromProps</li>
<li>shouldComponentUpdate</li>
<li>componentWillUpdate【react17 废弃】</li>
<li>render</li>
</ul>
</li>
<li>Error<ul>
<li>getDerivedStateFromError（新）</li>
</ul>
</li>
</ul>
<blockquote>
<p>commit 阶段：</p>
</blockquote>
<ul>
<li>Mount<ul>
<li>componentDidMount</li>
</ul>
</li>
<li>Update<ul>
<li>getSnapshotBeforeUpdate</li>
<li>componentDidUpdate</li>
</ul>
</li>
<li>Unmount<ul>
<li>componentWillUnmount</li>
</ul>
</li>
<li>Error<ul>
<li>componentDidCatch</li>
</ul>
</li>
</ul>
<h4 id="生命周期过程"><a href="#生命周期过程" class="headerlink" title="生命周期过程"></a>生命周期过程</h4><p>1.调用 ReactDOM.render</p>
<p>2.进入 Render 阶段</p>
<p>3.采用深度优先遍历创建 fiber 树</p>
<p>4.进入 Commit 阶段</p>
<p>a.用户调用 this.setState,将 c2 变为绿色</p>
<p>b.进入 Render 阶段</p>
<p>c.采用深度优先遍历创建 fiber 树</p>
<p>d.reconcile 算法标记变化</p>
<p>e.进入 Commit 阶段</p>
<p>f.执行 4 中的变化对应的视图操作</p>
<h3 id="2-this-setState-是同步还是异步"><a href="#2-this-setState-是同步还是异步" class="headerlink" title="2.this.setState 是同步还是异步"></a>2.this.setState 是同步还是异步</h3><p>我们完全不需要依赖这个特性。<br>如果我们要依赖状态更新后的值，对于 classComponent，我们可以在 componentDidMount 或者 componentDidUpdate 中执行。<br>对于 function Component，我们可以在 useEffect 的回调函数中执行。</p>
<p>React 当前有 3 种模式，<br>1.legacy 模式<br>ReactDOM.render(<App/>,rootNode)。这是当前 React app 使用的方式。当前没有计划删除本模式，但这个模式可能不支持这些新功能。<br>legacy 模式命中 batchUpdates 时异步<br>legacy 模式未命中 batchUpdates 时同步</p>
<p>2.blocking 模式<br>ReactDOM.createBlockingRoot(rootNode).render(<App/>)。目前正在试验中。作为迁移到 concurrent 模式的第一个步骤。</p>
<p>3.concurrent 模式<br>ReactDOM.createRoot(rootNode).render(<App/>)。目前在试验中，未来稳定之后，打算作为 React 的默认开发模式。这个模式开启了所有的新功能。</p>
<p>创建的更新拥有不同优先级，更新的过程也可以打断<br>concurrent 模式都是异步</p>
<h3 id="3-useEffect-fn-与-componentDidMount-有什么区别？"><a href="#3-useEffect-fn-与-componentDidMount-有什么区别？" class="headerlink" title="3.useEffect(fn,[])与 componentDidMount 有什么区别？"></a>3.useEffect(fn,[])与 componentDidMount 有什么区别？</h3><p>其实是 fn 与 componentDidMount 的执行时机有什么区别。<br>fn 的执行时机与 useEffect 第二个参数有关。所以这个问题问的是：</p>
<blockquote>
<p>1.useEffect 第二个参数[]如何影响 fn 的执行？</p>
</blockquote>
<p>render 阶段通过一种被称为 EFFECT 的数据结构【在新版 react 中它又被称作 FLAGS】将状态变化传递给 commit 阶段。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">对于需要              我们会在对应的fiber节点上增加           的effect</span><br><span class="line">        插入DOM的元素                           Placement</span><br><span class="line">        更新DOM的元素                           Update</span><br><span class="line">        删除DOM的元素                           Deletion</span><br><span class="line">        更新Ref属性的元素                        Ref</span><br><span class="line">        useEffect回调的元素                     Passive</span><br><span class="line"></span><br><span class="line">useEffect回调的元素 时：</span><br><span class="line">useEffect(fn) 会在 Mount和UPDTATE 时，创建Passive的effect</span><br><span class="line">useEffect(fn,[]) 会在 Mount 时，创建Passive的effect</span><br><span class="line">useEffect(fn,[dep]) 会在 Mount和DPEP 时，创建Passive的effect</span><br><span class="line"></span><br><span class="line">插入DOM时：</span><br><span class="line">classComponent 会在 Mount 时创建 Placement的effect</span><br><span class="line"></span><br><span class="line">所以render阶段到commit阶段传递的是一条包含了不同fiber节点的effect的链表</span><br><span class="line"></span><br><span class="line">commit阶段如何处理链表上的每个effect的呢？</span><br><span class="line">commit阶段将状态变化渲染在视图中，转而言之就是将EFFECT渲染在视图中。</span><br><span class="line"></span><br><span class="line">commit阶段可分为：</span><br><span class="line">1.渲染视图前（beforeMutation阶段）</span><br><span class="line"></span><br><span class="line">2.渲染视图（mutation阶段）</span><br><span class="line">对于Placement来说，它会在mutation阶段执行对应DOM节点appendChild操作。这样我们的DOM节点会被插入到视图中。</span><br><span class="line"></span><br><span class="line">3.渲染视图后（layout阶段）</span><br><span class="line">之后，Placement会在layout阶段调用componentDidMount，同步调用。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">对于Passive Effect来说【也就是useEffect(fn,[])】，它会在我们commit阶段的三个子阶段执行完成以后，异步调用useEffect回调。</span><br><span class="line"></span><br><span class="line">useLayoutEffect的调用时机和componentDidMount一致。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>2.fn 与 componentDidMount 的执行时机</p>
</blockquote>
<h3 id="4-什么时候使用-useLayoutEffect-代替-useEffect？"><a href="#4-什么时候使用-useLayoutEffect-代替-useEffect？" class="headerlink" title="4.什么时候使用 useLayoutEffect 代替 useEffect？"></a>4.什么时候使用 useLayoutEffect 代替 useEffect？</h3><p>useEffect 和 useLayoutEffect，是两个工作方式很相似的 React Hook。</p>
<p>你可以像下面这样使用它们：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行副作用</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// clean up</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, [dependency, arr]);</span><br><span class="line"></span><br><span class="line"><span class="title function_">useLayoutEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行副作用</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// clean up</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, [dependency, array]);</span><br></pre></td></tr></table></figure>

<p>但是它们不是完全一样的。通过阅读下面的内容，你将知道两者之间有何不同，以及每一种的适用场景。（大部分场景都适用于 useEffect）</p>
<h4 id="不同点"><a href="#不同点" class="headerlink" title="不同点"></a>不同点</h4><p>一句话总结：两者的不同在于执行时机。</p>
<h5 id="useEffect-是在渲染函数执行完成，并绘制到屏幕之后，再异步执行。"><a href="#useEffect-是在渲染函数执行完成，并绘制到屏幕之后，再异步执行。" class="headerlink" title="useEffect 是在渲染函数执行完成，并绘制到屏幕之后，再异步执行。"></a>useEffect 是在渲染函数执行完成，并绘制到屏幕之后，再异步执行。</h5><p>大致流程如下：</p>
<ul>
<li>1.触发渲染函数执行（改变状态，或者父组件重新渲染）</li>
<li>2.React 调用组件的渲染函数</li>
<li>3.屏幕中重绘完成</li>
<li>4.执行 useEffect</li>
</ul>
<h5 id="useLayoutEffect，是在渲染函数执行之后，但是屏幕重绘前同步执行。（注意：它可能会影响渲染体验）"><a href="#useLayoutEffect，是在渲染函数执行之后，但是屏幕重绘前同步执行。（注意：它可能会影响渲染体验）" class="headerlink" title="useLayoutEffect，是在渲染函数执行之后，但是屏幕重绘前同步执行。（注意：它可能会影响渲染体验）"></a>useLayoutEffect，是在渲染函数执行之后，但是屏幕重绘前同步执行。（注意：它可能会影响渲染体验）</h5><p>大致流程如下：</p>
<ul>
<li>1.触发渲染函数执行（改变状态，或者父组件重新渲染）</li>
<li>2.React 调用组件的渲染函数</li>
<li>3.执行 useLayoutEffect，并且 React 等待它执行完成</li>
<li>4.屏幕中重绘完成</li>
</ul>
<h4 id="99-的场景，适用于-useEffect"><a href="#99-的场景，适用于-useEffect" class="headerlink" title="99%的场景，适用于 useEffect"></a>99%的场景，适用于 useEffect</h4><p>大部分的场景都是通过 effect 同步一些状态或者 props，这些是不需要立即执行的，或者做一些不影响页面显示的事情。</p>
<p>例如请求远程数据，是不需要立即应用结果修改的。<br>或者设置某个事件监听，或者在弹窗显示&#x2F;消失的时候，重置某些状态。</p>
<p>大部分的场景，useEffect 足够了。</p>
<h4 id="什么时候使用-useLayoutEffect"><a href="#什么时候使用-useLayoutEffect" class="headerlink" title="什么时候使用 useLayoutEffect?"></a>什么时候使用 useLayoutEffect?</h4><p>什么样的场景需要使用 useLayoutEffect？当你看见的时候，你就知道了。（字面意思）</p>
<p>如果状态更新，导致组件渲染闪烁，这个时候，就应该用 useLayoutEffect，例如初次渲染只有部分状态正确，然后立刻使用最终状态重新渲染时，可能会发生上述情况。</p>
<p>让我用一个例子来说明具体情况。</p>
<p>当你点击页面时，状态立即发生改变（value 重置为 0），此时会立刻出发组件重新渲染，并重绘到屏幕上，然后 effect 执行，将 value 设置为某个随机数，同时再次立刻触发重新渲染。</p>
<p>这样就会导致 2 次渲染连续发生。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useLayoutEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">BlinkyRender</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useLayoutEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (value === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="title function_">setValue</span>(<span class="number">10</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [value]);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;render&quot;</span>, value);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setValue(0)&#125;&gt;value: &#123;&#123; value &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">BlinkyRender</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#root&quot;</span>));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>一般情况下，在 div 上绑定 onClick 事件是不推荐的（使用 button 代替），但是这只是一个演示例子。【只是想提醒一下】</p>
</blockquote>
<p>可以自己尝试用 useLayoutEffect 和 useEffect 分别实现看看。<br>ps：我自己实践了一下，没啥区别，可能是优化了～<br>相信你已经注意到了，使用 useLayoutEffect 时，虽然渲染函数执行 2 次，但是页面重绘只执行一次。而使用 useEffect 时，渲染函数执行 2 次，页面也重绘 2 次，你会看见有一个快速闪烁的 0。</p>
<h4 id="我应该使用-useEffect-还是-useLayoutEffect"><a href="#我应该使用-useEffect-还是-useLayoutEffect" class="headerlink" title="我应该使用 useEffect 还是 useLayoutEffect?"></a>我应该使用 useEffect 还是 useLayoutEffect?</h4><p>大部分场景中，useEffect 是正确的选择。如果遇到闪烁的场景，可以换到 useLayoutEffect，看一下是否能解决问题。</p>
<p>因为 useLayoutEffect 是同步执行的，因此会发生阻塞，直到 effect 执行完成才会进行页面重绘，如果你的 effect 内部有执行很慢的代码，可能会引起性能问题。</p>
<p>参考视频：<br><a href="https://www.bilibili.com/video/BV16t4y1r7oJ">https://www.bilibili.com/video/BV16t4y1r7oJ</a><br><a href="https://juejin.cn/post/6844904177521426439">https://juejin.cn/post/6844904177521426439</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2022/04/03/React/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E4%B8%93%E9%A2%98-%E2%80%94%E2%80%94-React-Hooks-%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9Atroj-%E6%9C%A8%E7%89%9B%E6%9C%A8%E9%A9%AC%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/04/03/React/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E4%B8%93%E9%A2%98-%E2%80%94%E2%80%94-React-Hooks-%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9Atroj-%E6%9C%A8%E7%89%9B%E6%9C%A8%E9%A9%AC%EF%BC%89/" itemprop="url">前端面试专题 —— React Hooks 完全解析（视频：troj-木牛木马）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-04-03T14:14:08+08:00">
                2022-04-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2022/04/03/React/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E4%B8%93%E9%A2%98-%E2%80%94%E2%80%94-React-Hooks-%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9Atroj-%E6%9C%A8%E7%89%9B%E6%9C%A8%E9%A9%AC%EF%BC%89/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2022/04/03/React/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E4%B8%93%E9%A2%98-%E2%80%94%E2%80%94-React-Hooks-%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9Atroj-%E6%9C%A8%E7%89%9B%E6%9C%A8%E9%A9%AC%EF%BC%89/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2022/04/03/React/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E4%B8%93%E9%A2%98-%E2%80%94%E2%80%94-React-Hooks-%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90%EF%BC%88%E8%A7%86%E9%A2%91%EF%BC%9Atroj-%E6%9C%A8%E7%89%9B%E6%9C%A8%E9%A9%AC%EF%BC%89/" class="leancloud_visitors" data-flag-title="前端面试专题 —— React Hooks 完全解析（视频：troj-木牛木马）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  2.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  12
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-useState"><a href="#1-useState" class="headerlink" title="1.useState"></a>1.useState</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [count1, setCount1] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;render&quot;</span>); <span class="comment">// 只会打印一次</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;count1&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setCount((x) =&gt; x + 1);</span></span><br><span class="line"><span class="language-xml">          setCount1((x) =&gt; x + 1);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-useEffect"><a href="#2-useEffect" class="headerlink" title="2.useEffect"></a>2.useEffect</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 此处的setTimeout在useEffect中,相当于是setInterval;</span></span><br><span class="line">  <span class="comment">// 并且此处的useEffect会执行6次,因为最后1次为6的时候,也会视为依赖5的变化</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> I = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setCount</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> x + <span class="number">1</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(I);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [<span class="title class_">Math</span>.<span class="title function_">min</span>(count, <span class="number">5</span>)]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-lifeCycle-迁移"><a href="#3-lifeCycle-迁移" class="headerlink" title="3.lifeCycle 迁移"></a>3.lifeCycle 迁移</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Input</span> = (<span class="params">props</span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`value changed:<span class="subst">$&#123;props.value&#125;</span>`</span>);</span><br><span class="line">  &#125;, [props.<span class="property">value</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (props) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;component did mount&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;component will unmount&quot;</span>); <span class="comment">// 切换页面销毁执行</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Input</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setValue((x) =&gt; Math.random())&#125;&gt;Click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="4-useRef-useImperitiveHandle"><a href="#4-useRef-useImperitiveHandle" class="headerlink" title="4.useRef&#x2F;useImperitiveHandle"></a>4.useRef&#x2F;useImperitiveHandle</h3><p>如下方式违反了设计原则:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123;</span><br><span class="line">  useEffect,</span><br><span class="line">  useRef,</span><br><span class="line">  forwardRef,</span><br><span class="line">  useImperativeHandle,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Input</span> = (<span class="params">props, ref</span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    ref.<span class="property">current</span>.<span class="property">value</span> = props.<span class="property">initialValue</span>;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> props.onChange(e.target.value)&#125; /&gt;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MInput</span> = <span class="title function_">forwardRef</span>(<span class="title class_">Input</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (props) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 违法面向对象封装原则</span></span><br><span class="line">  <span class="keyword">const</span> r1 = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> r2 = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MInput</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">ref</span>=<span class="string">&#123;r1&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">initialValue</span>=<span class="string">&#123;100&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;(x)</span> =&gt;</span> console.log(&quot;1:&quot; + x)&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MInput</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">ref</span>=<span class="string">&#123;r2&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">initialValue</span>=<span class="string">&#123;</span>&quot;<span class="attr">hello</span>&quot;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;(x)</span> =&gt;</span> console.log(&quot;2:&quot; + x)&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          console.log(r1); // 这里的r1是button</span></span><br><span class="line"><span class="language-xml">          r1.current.focus();</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        focus 1</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span>&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          r2.current.focus();</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        focus 2</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>推荐使用:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123;</span><br><span class="line">  useEffect,</span><br><span class="line">  useRef,</span><br><span class="line">  forwardRef,</span><br><span class="line">  useImperativeHandle,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Input</span> = (<span class="params">props, ref</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> refInput = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useImperativeHandle</span>(</span><br><span class="line">    ref,</span><br><span class="line">    <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">focus</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        refInput.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    []</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    refInput.<span class="property">current</span>.<span class="property">value</span> = props.<span class="property">initialValue</span>;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;refInput&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> props.onChange(e.target.value)&#125; /&gt;</span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MInput</span> = <span class="title function_">forwardRef</span>(<span class="title class_">Input</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (props) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> r1 = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> r2 = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MInput</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">ref</span>=<span class="string">&#123;r1&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">initialValue</span>=<span class="string">&#123;100&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;(x)</span> =&gt;</span> console.log(&quot;1:&quot; + x)&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MInput</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">ref</span>=<span class="string">&#123;r2&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">initialValue</span>=<span class="string">&#123;</span>&quot;<span class="attr">hello</span>&quot;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;(x)</span> =&gt;</span> console.log(&quot;2:&quot; + x)&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          console.log(r1); // 这里的r1就只是子组件封装的一个focus方法</span></span><br><span class="line"><span class="language-xml">          r1.current.focus();</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        focus 1</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          r2.current.focus();</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        focus 2</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="5-useContext"><a href="#5-useContext" class="headerlink" title="5.useContext"></a>5.useContext</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ctx = <span class="title class_">React</span>.<span class="title function_">createContext</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">// ctx.Provider</span></span><br><span class="line"><span class="comment">// ctx.Consumer</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Provider</span> &#125; = ctx;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 孙组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Desendants</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> value = <span class="title function_">useContext</span>(ctx);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;value&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Child</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Desendants</span> /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Parent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">value</span>=<span class="string">&quot;hello world&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Child</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Parent</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-misorder-问题"><a href="#5-misorder-问题" class="headerlink" title="5.misorder 问题"></a>5.misorder 问题</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Greetings</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [display, setDisplay] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 不要使用下面的写法1:</span></span><br><span class="line">  <span class="comment">// 错误:递归</span></span><br><span class="line">  <span class="keyword">if</span> (count &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="title function_">setDisplay</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> <span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 不要使用下面的写法2:</span></span><br><span class="line">  <span class="comment">// render more hooks than previous render</span></span><br><span class="line">  <span class="keyword">if</span> (count &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setDisplay</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> <span class="literal">true</span>);</span><br><span class="line">    &#125;, []);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setDisplay</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> <span class="literal">false</span>);</span><br><span class="line">    &#125;, []);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 建议使用下面的写法:</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setDisplay</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> <span class="literal">false</span>);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount((x) =&gt; x + 1)&#125;&gt;+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;display &amp;&amp; <span class="tag">&lt;<span class="name">Greetings</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="6-useLayoutEffect"><a href="#6-useLayoutEffect" class="headerlink" title="6.useLayoutEffect"></a>6.useLayoutEffect</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect, useLayoutEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`effect:`</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>());</span><br><span class="line">  &#125;, [count]);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useLayoutEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`layout:`</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>());</span><br><span class="line">  &#125;, [count]);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> I = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setCount</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> x + <span class="number">1</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(I);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="7-useDebug"><a href="#7-useDebug" class="headerlink" title="7.useDebug"></a>7.useDebug</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useDebugValue, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [isOnline, setIsOnline] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="title function_">useDebugValue</span>(isOnline ? <span class="string">&quot;Online&quot;</span> : <span class="string">&quot;Offline&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="8-要不要使用-useMemo-和-useCallback"><a href="#8-要不要使用-useMemo-和-useCallback" class="headerlink" title="8.要不要使用 useMemo 和 useCallback?"></a>8.要不要使用 useMemo 和 useCallback?</h3><h5 id="「视频代码参考-https-www-bilibili-com-video-BV1gf4y1X7bQ」"><a href="#「视频代码参考-https-www-bilibili-com-video-BV1gf4y1X7bQ」" class="headerlink" title="「视频代码参考:https://www.bilibili.com/video/BV1gf4y1X7bQ」"></a>「视频代码参考:<a href="https://www.bilibili.com/video/BV1gf4y1X7bQ%E3%80%8D">https://www.bilibili.com/video/BV1gf4y1X7bQ」</a></h5><ul>
<li><p>哪些情况一个组件会重新渲染?</p>
<ul>
<li>1.组件自己的 state 变化</li>
<li>2.父组件传递过来的 props 变化</li>
<li>3.父组件重新渲染了</li>
</ul>
</li>
<li><p>useMemo 使用场景</p>
<ul>
<li>1.如果一些值的计算量很大,那么可以用 useMemo 来做一个缓存,只有依赖变化时才会重新计算,而不是每次渲染时都进行计算</li>
</ul>
</li>
<li><p>useCallback 使用场景</p>
<ul>
<li>1.对于需要传递函数给子组件的场合,不使用 useCallback 的话,子组件每次都会重新渲染;</li>
<li>2.在调用节流、防抖函数时.</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在调用节流、防抖函数时使用useCallback</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useCallback &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Input</span> &#125; <span class="keyword">from</span> <span class="string">&quot;antd&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&quot;lodash&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [name, setName] = <span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">search</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`模拟search操作：<span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> debounchSearch = <span class="title function_">useCallback</span>(_.<span class="title function_">debounce</span>(search, <span class="number">300</span>), []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onChange</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; value &#125; = e.<span class="property">target</span>;</span><br><span class="line">    <span class="title function_">setName</span>(value);</span><br><span class="line">    <span class="title function_">debounchSearch</span>(value);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.wrapper&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Input</span> <span class="attr">value</span>=<span class="string">&#123;name&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;onChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>个人观点:<ul>
<li>在出现性能问题后,进行优化时可以考虑使用 useMemo 和 useCallback 对性能进行一定对优化;</li>
<li>如果没有性能问题可以不用,这样可以更专注于代码本身逻辑.</li>
</ul>
</li>
</ul>
<p>父组件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useCallback &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="title class_">Count</span> <span class="keyword">from</span> <span class="string">&quot;./components/Count&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [score, setScore] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useSatet</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;parent render&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对于需要传递函数给子组件的场合,不使用 useCallback 的话,子组件每次都会重新渲染</span></span><br><span class="line">  <span class="keyword">const</span> onClickCount = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;&#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.wrapper&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(score + 1)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        parent score+1</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>score:&#123;score<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>setCount(count+1)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        child count+1</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Count</span> <span class="attr">value</span>=<span class="string">&#123;count&#125;</span> <span class="attr">onClick</span>=<span class="string">&#123;onClickCount&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>子组件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useMemo &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Card</span> &#125; <span class="keyword">from</span> <span class="string">&quot;antd&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; value &#125; = props;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 一些值的计算量很大,那么可以用 useMemo 来做一个缓存</span></span><br><span class="line">  <span class="keyword">const</span> xxx = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> value * <span class="number">10</span>;</span><br><span class="line">  &#125;, [value]);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;child render&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Card</span>&gt;</span>count:&#123;value&#125; (这里是子组件)<span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="9-useReducer"><a href="#9-useReducer" class="headerlink" title="9.useReducer"></a>9.useReducer</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;increment&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;decrement&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> - <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialState);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      Count: &#123;state.count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;decrement&quot; &#125;)&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;increment&quot; &#125;)&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Counter</span>;</span><br></pre></td></tr></table></figure>

<h3 id="异步请求改造"><a href="#异步请求改造" class="headerlink" title="异步请求改造:"></a>异步请求改造:</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;increment&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;decrement&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> - <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装了一个middleWare</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useMyReducer</span>(<span class="params">reducer, initialState</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialState);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">myDispatch</span>(<span class="params">action</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (action) &#123;</span><br><span class="line">      <span class="comment">// 举例,这里可以做异步请求</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;url&quot;</span>:</span><br><span class="line">        <span class="title function_">fetch</span>(<span class="string">&quot;https://xxx&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">            data,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [state, myDispatch];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useMyReducer</span>(reducer, initialState);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      Count: &#123;state.count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;decrement&quot; &#125;)&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &quot;increment&quot; &#125;)&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Counter</span>;</span><br></pre></td></tr></table></figure>

<h3 id="10-react-hoc"><a href="#10-react-hoc" class="headerlink" title="10.react hoc"></a>10.react hoc</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">&quot;https&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">withUsers</span> = (<span class="params">Target</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">Proxy</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">super</span>();</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">        <span class="attr">users</span>: <span class="literal">null</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">ComponentDidMount</span>() &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">          <span class="attr">users</span>: [<span class="string">&quot;小明&quot;</span>, <span class="string">&quot;小张&quot;</span>],</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; users &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Target</span> <span class="attr">user</span>=<span class="string">&#123;users&#125;</span> /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Proxy</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useRequest</span> = (<span class="params">url, params</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [data, setData] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">request</span>(url, params).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setData</span>(data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;),</span><br><span class="line">    [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">reload</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">setData</span>(<span class="literal">null</span>);</span><br><span class="line">    <span class="title function_">request</span>(url, params).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setData</span>(data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [data, reload];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">withUsers</span>(<span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// const &#123;users&#125; = props;</span></span><br><span class="line">  <span class="keyword">const</span> [users, reload] = <span class="title function_">useRequest</span>(<span class="string">&quot;https:..get-users&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">num</span>: <span class="number">210</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (users === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;users.map((x, i) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;i&#125;</span>&gt;</span>&#123;x&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;reload&#125;</span>&gt;</span>重新加载<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="react-hoc-animation-实现"><a href="#react-hoc-animation-实现" class="headerlink" title="react-hoc animation 实现:"></a>react-hoc animation 实现:</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./animation.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useAnimation</span>(<span class="params">_clsName, duration = <span class="number">300</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [phase, setPhase] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [className, setClassName] = <span class="title function_">useState</span>(_clsName);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">play</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">setPhase</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (phase === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="title function_">setClassName</span>(_clsName + <span class="string">&quot; &quot;</span> + className + <span class="string">&quot;-start&quot;</span>);</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setClassName</span>(_clsName + <span class="string">&quot; &quot;</span> + className + <span class="string">&quot;-end&quot;</span>);</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">setClassName</span>(_clsName);</span><br><span class="line">          <span class="title function_">setPhase</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;, duration);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [phase]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [className, play];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [className, playAnimation] = <span class="title function_">useAnimation</span>(<span class="string">&quot;box&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;className&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;playAnimation&#125;</span>&gt;</span>play<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box-start</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">transition</span>: margin-left <span class="number">0.3s</span> ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box-end</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/source/_posts/img/react-hooks.png" alt="React-hooks"></p>
<p>参考视频：<br><a href="https://www.bilibili.com/video/BV1cE411i7F1">https://www.bilibili.com/video/BV1cE411i7F1</a></p>
<p>github 源码地址:<br><a href="https://github.com/kyjm/react-hooks-example/">https://github.com/kyjm/react-hooks-example/</a></p>
<p>要不要使用 useMemo 和 useCallback：<br><a href="https://www.bilibili.com/video/BV1gf4y1X7bQ">https://www.bilibili.com/video/BV1gf4y1X7bQ</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2022/04/03/JS/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9FJavaScript%E5%AE%9E%E7%8E%B0%E7%9A%84EventEmitter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/04/03/JS/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9FJavaScript%E5%AE%9E%E7%8E%B0%E7%9A%84EventEmitter/" itemprop="url">【转载】使用原生JavaScript实现的EventEmitter</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-04-03T13:20:36+08:00">
                2022-04-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2022/04/03/JS/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9FJavaScript%E5%AE%9E%E7%8E%B0%E7%9A%84EventEmitter/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2022/04/03/JS/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9FJavaScript%E5%AE%9E%E7%8E%B0%E7%9A%84EventEmitter/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2022/04/03/JS/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9FJavaScript%E5%AE%9E%E7%8E%B0%E7%9A%84EventEmitter/" class="leancloud_visitors" data-flag-title="【转载】使用原生JavaScript实现的EventEmitter">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  745
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  3
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>和 Nodejs 中 EventEmitter 功能类似.适合浏览器自定义事件类.新添加了可以定制事件促发次数的功能.</p>
<p>详细见</p>
<p><a href="https://github.com/webery/ajax/tree/master">https://github.com/webery/ajax/tree/master</a></p>
<p>包括了源代码和测试代码.未经过严格测试,暂时为第一个版本.还有很多优化的地方,现在只是一个参考.</p>
<p>使用方法</p>
<p>前端测试文件:emit.ejs</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/stylesheets/style.css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/javascripts/eventemitter.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;click&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;submit&quot;</span>).<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        var emit = new EventEmitter();</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">      </span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        emit.on(&#x27;click&#x27;, function() &#123;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">          console.log(&#x27;clcik&#x27;);</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        &#125;, 2);</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        emit.trigger(&#x27;click&#x27;);</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        emit.trigger(&#x27;click&#x27;);</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        emit.trigger(&#x27;click&#x27;);</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">      */</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> <span class="title class_">Target</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;;</span></span><br><span class="line"><span class="language-javascript">      <span class="title class_">EventEmitter</span>.<span class="title function_">inherit</span>(<span class="title class_">Target</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> test = <span class="keyword">new</span> <span class="title class_">Target</span>();</span></span><br><span class="line"><span class="language-javascript">      test.<span class="title function_">on</span>(</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&quot;click&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;clcik&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="number">2</span></span></span><br><span class="line"><span class="language-javascript">      );</span></span><br><span class="line"><span class="language-javascript">      test.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      test.<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>源代码:eventemitter.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   浏览器端模拟EventEmitter的实现，拓展了部分功能，添加了定制实践促发的次数的功能，</span></span><br><span class="line"><span class="comment">   使用方式和其他的EventEmiiter类似。</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">(<span class="keyword">function</span> (<span class="params"><span class="variable language_">window</span>, <span class="literal">undefined</span></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line">  <span class="comment">/*构造函数*/</span></span><br><span class="line">  <span class="keyword">var</span> <span class="title class_">EventEmitter</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">events</span> = &#123;&#125;; <span class="comment">//保存事务，存储结构为&#123;&#x27;eventName1&#x27;:[&#123;listener:function触发的函数, time:触发的次数&#125;], &#x27;eventName2&#x27;:[],&#125;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">EventEmitter</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">once</span> = <span class="keyword">function</span> (<span class="params">evt, listener</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">addListener</span>(evt, listener, <span class="number">0</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">/*获取所有的事务*/</span></span><br><span class="line">  <span class="title class_">EventEmitter</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getEvents</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">events</span> || (<span class="variable language_">this</span>.<span class="property">events</span> = &#123;&#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">/*获取某个实践的所有触发函数*/</span></span><br><span class="line">  <span class="title class_">EventEmitter</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getListeners</span> = <span class="keyword">function</span> (<span class="params">evt</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> events = <span class="variable language_">this</span>.<span class="title function_">getEvents</span>();</span><br><span class="line">    <span class="keyword">return</span> events[evt] || (events[evt] = []);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">      注册实践触发函数</span></span><br><span class="line"><span class="comment">      evet:事件名称</span></span><br><span class="line"><span class="comment">      listener:事件监听函数</span></span><br><span class="line"><span class="comment">      time:可选，选择可以触发的次数，-1表示无数次，默认为-1</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">  <span class="title class_">EventEmitter</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">on</span> = <span class="keyword">function</span> (<span class="params">evt, listener, time</span>) &#123;</span><br><span class="line">    time = <span class="keyword">typeof</span> time == <span class="string">&quot;number&quot;</span> ? time : -<span class="number">1</span>;</span><br><span class="line">    time = time &gt;= -<span class="number">1</span> ? time : -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> listeners = <span class="variable language_">this</span>.<span class="title function_">getListeners</span>(evt);</span><br><span class="line">    <span class="keyword">var</span> listenerWrapper = &#123;</span><br><span class="line">      <span class="attr">listener</span>: listener,</span><br><span class="line">      <span class="attr">time</span>: time,</span><br><span class="line">    &#125;;</span><br><span class="line">    listeners.<span class="title function_">push</span>(listenerWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">/*addListener 和on 同义 */</span></span><br><span class="line">  <span class="title class_">EventEmitter</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">addListener</span> = <span class="title class_">EventEmitter</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">on</span>;</span><br><span class="line">  <span class="comment">/*移除事件的所有监听函数*/</span></span><br><span class="line">  <span class="title class_">EventEmitter</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">off</span> = <span class="keyword">function</span> (<span class="params">evt</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> events = <span class="variable language_">this</span>.<span class="title function_">getEvents</span>();</span><br><span class="line">    events[evt] = [];</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title class_">EventEmitter</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">removeEvent</span> = <span class="title class_">EventEmitter</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">off</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">      会删除同一事件中的所有listener</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">  <span class="title class_">EventEmitter</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">removeListener</span> = <span class="keyword">function</span> (<span class="params">evt, listener</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> listeners = <span class="variable language_">this</span>.<span class="title function_">getListeners</span>(evt);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; listeners.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (listeners[i].<span class="property">listener</span> == listener) &#123;</span><br><span class="line">        <span class="keyword">delete</span> listeners[i];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">      触发事件</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">  <span class="title class_">EventEmitter</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">trigger</span> = <span class="keyword">function</span> (<span class="params">evt, args</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> listeners = <span class="variable language_">this</span>.<span class="title function_">getListeners</span>(evt);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; listeners.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> listener = listeners[i];</span><br><span class="line">      <span class="keyword">if</span> (listener.<span class="property">time</span> != -<span class="number">1</span>) &#123;</span><br><span class="line">        listener.<span class="property">time</span>--;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (listener.<span class="property">time</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">removeListener</span>(evt, listener.<span class="property">listener</span>); <span class="comment">//可以同步或异步执行</span></span><br><span class="line">      &#125;</span><br><span class="line">      listener.<span class="property">listener</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args || []);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title class_">EventEmitter</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">fire</span> = <span class="title class_">EventEmitter</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">trigger</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">      触发事件</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line"></span><br><span class="line">  <span class="title class_">EventEmitter</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">emit</span> = <span class="keyword">function</span> (<span class="params">evt</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">trigger</span>(evt, args);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">EventEmitter</span>.<span class="property">inherit</span> = <span class="keyword">function</span> (<span class="params">target</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> target.<span class="property"><span class="keyword">prototype</span></span> == <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="string">&quot;target:&quot;</span> + target + <span class="string">&quot;must have prototype&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> souPto = <span class="title class_">EventEmitter</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">    <span class="keyword">var</span> tarPto = target.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> souPto) &#123;</span><br><span class="line">      tarPto[key] = souPto[key];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">EventEmitter</span> = <span class="title class_">EventEmitter</span>;</span><br><span class="line">&#125;)(<span class="variable language_">window</span>);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">115</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/daykalif" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:r00t_daykalif@aliyun.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.daykalif.com/" title="Daykalif" target="_blank">Daykalif</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-snowflake-o"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">r00t_daykalif</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">290.7k</span>
  
</div>






<div style="width:300px;margin:0 auto; padding:20px 0;">
	<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010902002156" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;">
    <img src="https://www.daykalif.com/beian.png" style="float:left;"/>
    <p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">
    浙公网安备 33010902002156号
    </p>
  </a>
</div>






        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'NXoB8ypSoELq08t7Y4t4Y7Co-gzGzoHsz',
        appKey: 'q00Ulu1a5iQSaM6XV0ba4QeF',
        placeholder: 'ヾﾉ≧∀≦)o来啊，快活啊!',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("NXoB8ypSoELq08t7Y4t4Y7Co-gzGzoHsz", "q00Ulu1a5iQSaM6XV0ba4QeF");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
