<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="å‰ç«¯,js,å¼‚æ­¥," />










<meta name="description" content="Promise çš„å‡ é“åŸºç¡€é¢˜ Promise ç»“åˆ setTimeout Promise ä¸­çš„ thenã€catchã€finally Promise ä¸­çš„ all å’Œ race async&#x2F;await çš„å‡ é“é¢˜ async å¤„ç†é”™è¯¯ ç»¼åˆé¢˜ å‡ é“å¤§å‚çš„é¢è¯•é¢˜   å‰æœŸå‡†å¤‡  åœ¨åšä¸‹é¢ ğŸ‘‡ çš„é¢˜ç›®ä¹‹å‰ï¼Œæˆ‘å¸Œæœ›ä½ èƒ½æ¸…æ¥šå‡ ä¸ªçŸ¥è¯†ç‚¹ã€‚ event loop å®ƒçš„æ‰§è¡Œé¡ºåºï¼š  ä¸€å¼€å§‹æ•´ä¸ªè„šæœ¬ä½œ">
<meta property="og:type" content="article">
<meta property="og:title" content="è¦å°±æ¥45é“Promiseé¢è¯•é¢˜ä¸€æ¬¡çˆ½åˆ°åº•">
<meta property="og:url" content="https://daykalif.github.io/2020/11/26/JS/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E8%A6%81%E5%B0%B1%E6%9D%A545%E9%81%93Promise%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80%E6%AC%A1%E7%88%BD%E5%88%B0%E5%BA%95/index.html">
<meta property="og:site_name" content="Daykalif">
<meta property="og:description" content="Promise çš„å‡ é“åŸºç¡€é¢˜ Promise ç»“åˆ setTimeout Promise ä¸­çš„ thenã€catchã€finally Promise ä¸­çš„ all å’Œ race async&#x2F;await çš„å‡ é“é¢˜ async å¤„ç†é”™è¯¯ ç»¼åˆé¢˜ å‡ é“å¤§å‚çš„é¢è¯•é¢˜   å‰æœŸå‡†å¤‡  åœ¨åšä¸‹é¢ ğŸ‘‡ çš„é¢˜ç›®ä¹‹å‰ï¼Œæˆ‘å¸Œæœ›ä½ èƒ½æ¸…æ¥šå‡ ä¸ªçŸ¥è¯†ç‚¹ã€‚ event loop å®ƒçš„æ‰§è¡Œé¡ºåºï¼š  ä¸€å¼€å§‹æ•´ä¸ªè„šæœ¬ä½œ">
<meta property="og:locale">
<meta property="og:image" content="https://www.daykalif.com/blog_img/promise1.png">
<meta property="og:image" content="https://www.daykalif.com/blog_img/promise2.png">
<meta property="og:image" content="https://www.daykalif.com/blog_img/promise3.png">
<meta property="article:published_time" content="2020-11-26T06:39:21.000Z">
<meta property="article:modified_time" content="2024-03-22T23:49:59.000Z">
<meta property="article:author" content="r00t_daykalif">
<meta property="article:tag" content="å‰ç«¯">
<meta property="article:tag" content="js">
<meta property="article:tag" content="å¼‚æ­¥">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.daykalif.com/blog_img/promise1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: "",
      labels: ""
    }
  };
</script>



  <link rel="canonical" href="https://daykalif.github.io/2020/11/26/JS/ã€è½¬è½½ã€‘è¦å°±æ¥45é“Promiseé¢è¯•é¢˜ä¸€æ¬¡çˆ½åˆ°åº•/"/>





  <title>è¦å°±æ¥45é“Promiseé¢è¯•é¢˜ä¸€æ¬¡çˆ½åˆ°åº• | Daykalif</title>
  








<meta name="generator" content="Hexo 7.1.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Daykalif</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-é¦–é¡µ">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-æ–‡ç« ">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            æ–‡ç« 
          </a>
        </li>
      
        
        <li class="menu-item menu-item-åˆ†ç±»">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-å‰ç«¯">
          <a href="/categories/web/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            å‰ç«¯
          </a>
        </li>
      
        
        <li class="menu-item menu-item-åç«¯">
          <a href="/categories/server/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-server"></i> <br />
            
            åç«¯
          </a>
        </li>
      
        
        <li class="menu-item menu-item-å…³äºæˆ‘">
          <a href="/categories/aboutMe/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äºæˆ‘
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daykalif.github.io/2020/11/26/JS/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E8%A6%81%E5%B0%B1%E6%9D%A545%E9%81%93Promise%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80%E6%AC%A1%E7%88%BD%E5%88%B0%E5%BA%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daykalif">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">è¦å°±æ¥45é“Promiseé¢è¯•é¢˜ä¸€æ¬¡çˆ½åˆ°åº•</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-11-26T14:39:21+08:00">
                2020-11-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/11/26/JS/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E8%A6%81%E5%B0%B1%E6%9D%A545%E9%81%93Promise%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80%E6%AC%A1%E7%88%BD%E5%88%B0%E5%BA%95/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/11/26/JS/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E8%A6%81%E5%B0%B1%E6%9D%A545%E9%81%93Promise%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80%E6%AC%A1%E7%88%BD%E5%88%B0%E5%BA%95/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/11/26/JS/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E8%A6%81%E5%B0%B1%E6%9D%A545%E9%81%93Promise%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80%E6%AC%A1%E7%88%BD%E5%88%B0%E5%BA%95/" class="leancloud_visitors" data-flag-title="è¦å°±æ¥45é“Promiseé¢è¯•é¢˜ä¸€æ¬¡çˆ½åˆ°åº•">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  12.4k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  55
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <ul>
<li>Promise çš„å‡ é“åŸºç¡€é¢˜</li>
<li>Promise ç»“åˆ setTimeout</li>
<li>Promise ä¸­çš„ thenã€catchã€finally</li>
<li>Promise ä¸­çš„ all å’Œ race</li>
<li>async&#x2F;await çš„å‡ é“é¢˜</li>
<li>async å¤„ç†é”™è¯¯</li>
<li>ç»¼åˆé¢˜</li>
<li>å‡ é“å¤§å‚çš„é¢è¯•é¢˜</li>
</ul>
<blockquote>
<p>å‰æœŸå‡†å¤‡</p>
</blockquote>
<p>åœ¨åšä¸‹é¢ ğŸ‘‡ çš„é¢˜ç›®ä¹‹å‰ï¼Œæˆ‘å¸Œæœ›ä½ èƒ½æ¸…æ¥šå‡ ä¸ªçŸ¥è¯†ç‚¹ã€‚</p>
<p><em>event loop å®ƒçš„æ‰§è¡Œé¡ºåºï¼š</em></p>
<ul>
<li>ä¸€å¼€å§‹æ•´ä¸ªè„šæœ¬ä½œä¸ºä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œ</li>
<li>æ‰§è¡Œè¿‡ç¨‹ä¸­åŒæ­¥ä»£ç ç›´æ¥æ‰§è¡Œï¼Œå®ä»»åŠ¡è¿›å…¥å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¾®ä»»åŠ¡è¿›å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å½“å‰å®ä»»åŠ¡æ‰§è¡Œå®Œå‡ºé˜Ÿï¼Œæ£€æŸ¥å¾®ä»»åŠ¡åˆ—è¡¨ï¼Œæœ‰åˆ™ä¾æ¬¡æ‰§è¡Œï¼Œç›´åˆ°å…¨éƒ¨æ‰§è¡Œå®Œ</li>
<li>æ‰§è¡Œæµè§ˆå™¨ UI çº¿ç¨‹çš„æ¸²æŸ“å·¥ä½œ</li>
<li>æ£€æŸ¥æ˜¯å¦æœ‰ Web Worker ä»»åŠ¡ï¼Œæœ‰åˆ™æ‰§è¡Œ</li>
<li>æ‰§è¡Œå®Œæœ¬è½®çš„å®ä»»åŠ¡ï¼Œå›åˆ° 2ï¼Œä¾æ­¤å¾ªç¯ï¼Œç›´åˆ°å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡é˜Ÿåˆ—éƒ½ä¸ºç©º</li>
</ul>
<p><strong>å¾®ä»»åŠ¡åŒ…æ‹¬ï¼š</strong> MutationObserverã€Promise.then()æˆ– reject()ã€Promise ä¸ºåŸºç¡€å¼€å‘çš„å…¶å®ƒæŠ€æœ¯ï¼Œæ¯”å¦‚ fetch APIã€V8 çš„åƒåœ¾å›æ”¶è¿‡ç¨‹ã€Node ç‹¬æœ‰çš„ process.nextTickã€‚</p>
<p><strong>å®ä»»åŠ¡åŒ…æ‹¬ï¼š</strong> scriptã€script ã€setTimeoutã€setInterval ã€setImmediate ã€I&#x2F;O ã€UI renderingã€‚</p>
<p><strong>æ³¨æ„ âš ï¸ï¼š</strong> åœ¨æ‰€æœ‰ä»»åŠ¡å¼€å§‹çš„æ—¶å€™ï¼Œç”±äºå®ä»»åŠ¡ä¸­åŒ…æ‹¬äº† scriptï¼Œæ‰€ä»¥æµè§ˆå™¨ä¼šå…ˆæ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä½ çœ‹åˆ°çš„å»¶è¿Ÿä»»åŠ¡(ä¾‹å¦‚ setTimeout)å°†è¢«æ”¾åˆ°ä¸‹ä¸€è½®å®ä»»åŠ¡ä¸­æ¥æ‰§è¡Œã€‚</p>
<h4 id="1-Promise-çš„å‡ é“åŸºç¡€é¢˜"><a href="#1-Promise-çš„å‡ é“åŸºç¡€é¢˜" class="headerlink" title="1. Promise çš„å‡ é“åŸºç¡€é¢˜"></a>1. Promise çš„å‡ é“åŸºç¡€é¢˜</h4><h5 id="1-1-é¢˜ç›®ä¸€"><a href="#1-1-é¢˜ç›®ä¸€" class="headerlink" title="1.1 é¢˜ç›®ä¸€"></a>1.1 é¢˜ç›®ä¸€</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;1&quot;</span>, promise1);</span><br></pre></td></tr></table></figure>

<p>è¿‡ç¨‹åˆ†æï¼š</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆé‡åˆ° new Promiseï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­çš„ä»£ç  promise1</li>
<li>ç„¶åæ‰§è¡ŒåŒæ­¥ä»£ç  1ï¼Œæ­¤æ—¶ promise1 æ²¡æœ‰è¢« resolve æˆ–è€… rejectï¼Œå› æ­¤çŠ¶æ€è¿˜æ˜¯ pending</li>
</ul>
<p>ç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;promise1&#x27;</span></span><br><span class="line"><span class="string">&#x27;1&#x27;</span> <span class="title class_">Promise</span>&#123;&lt;pending&gt;&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-2-é¢˜ç›®äºŒ"><a href="#1-2-é¢˜ç›®äºŒ" class="headerlink" title="1.2 é¢˜ç›®äºŒ"></a>1.2 é¢˜ç›®äºŒ</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>è¿‡ç¨‹åˆ†æï¼š</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆé‡åˆ° new Promiseï¼Œæ‰§è¡Œå…¶ä¸­çš„åŒæ­¥ä»£ç  1</li>
<li>å†é‡åˆ° resolve(â€˜successâ€™)ï¼Œ å°† promise çš„çŠ¶æ€æ”¹ä¸ºäº† resolved å¹¶ä¸”å°†å€¼ä¿å­˜ä¸‹æ¥</li>
<li>ç»§ç»­æ‰§è¡ŒåŒæ­¥ä»£ç  2</li>
<li>è·³å‡º promiseï¼Œå¾€ä¸‹æ‰§è¡Œï¼Œç¢°åˆ° promise.then è¿™ä¸ªå¾®ä»»åŠ¡ï¼Œå°†å…¶åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç  4</li>
<li>æœ¬è½®å®ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œæ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç° promise.then è¿™ä¸ªå¾®ä»»åŠ¡ä¸”çŠ¶æ€ä¸º resolvedï¼Œæ‰§è¡Œå®ƒã€‚</li>
</ul>
<p>ç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">4</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<h5 id="1-3-é¢˜ç›®ä¸‰"><a href="#1-3-é¢˜ç›®ä¸‰" class="headerlink" title="1.3 é¢˜ç›®ä¸‰"></a>1.3 é¢˜ç›®ä¸‰</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>è¿‡ç¨‹åˆ†æ:</p>
<ul>
<li>å’Œé¢˜ç›®äºŒç›¸ä¼¼ï¼Œåªä¸è¿‡åœ¨ promise ä¸­å¹¶æ²¡æœ‰ resolve æˆ–è€… reject</li>
<li>å› æ­¤ promise.then å¹¶ä¸ä¼šæ‰§è¡Œï¼Œå®ƒåªæœ‰åœ¨è¢«æ”¹å˜äº†çŠ¶æ€ä¹‹åæ‰ä¼šæ‰§è¡Œã€‚</li>
</ul>
<p>ç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>

<h5 id="1-4-é¢˜ç›®å››"><a href="#1-4-é¢˜ç›®å››" class="headerlink" title="1.4 é¢˜ç›®å››"></a>1.4 é¢˜ç›®å››</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>);</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;resolve1&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> promise2 = promise1.<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;1&quot;</span>, promise1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;2&quot;</span>, promise2);</span><br></pre></td></tr></table></figure>

<p>è¿‡ç¨‹åˆ†æï¼š</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆé‡åˆ° new Promiseï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­çš„ä»£ç  promise1</li>
<li>ç¢°åˆ° resolve å‡½æ•°, å°† promise1 çš„çŠ¶æ€æ”¹å˜ä¸º resolved, å¹¶å°†ç»“æœä¿å­˜ä¸‹æ¥</li>
<li>ç¢°åˆ° promise1.then è¿™ä¸ªå¾®ä»»åŠ¡ï¼Œå°†å®ƒæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>promise2 æ˜¯ä¸€ä¸ªæ–°çš„çŠ¶æ€ä¸º pending çš„ Promise</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç  1ï¼Œ åŒæ—¶æ‰“å°å‡º promise1 çš„çŠ¶æ€æ˜¯ resolved</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç  2ï¼ŒåŒæ—¶æ‰“å°å‡º promise2 çš„çŠ¶æ€æ˜¯ pending</li>
<li>å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ŒæŸ¥æ‰¾å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç° promise1.then è¿™ä¸ªå¾®ä»»åŠ¡ä¸”çŠ¶æ€ä¸º resolvedï¼Œæ‰§è¡Œå®ƒã€‚</li>
</ul>
<p>ç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;promise1&#x27;</span></span><br><span class="line"><span class="string">&#x27;1&#x27;</span> <span class="title class_">Promise</span>&#123;&lt;resolved&gt;: <span class="string">&#x27;resolve1&#x27;</span>&#125;</span><br><span class="line"><span class="string">&#x27;2&#x27;</span> <span class="title class_">Promise</span>&#123;&lt;pending&gt;&#125;</span><br><span class="line"><span class="string">&#x27;resolve1&#x27;</span></span><br></pre></td></tr></table></figure>

<h5 id="1-5-é¢˜ç›®äº”"><a href="#1-5-é¢˜ç›®äº”" class="headerlink" title="1.5 é¢˜ç›®äº”"></a>1.5 é¢˜ç›®äº”</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="title function_">fn</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜é‡Œæœ€å…ˆæ‰§è¡Œçš„æ˜¯â€™startâ€™å— ğŸ¤”ï¸ ï¼Ÿ</p>
<p>è¯·ä»”ç»†çœ‹çœ‹å“¦ï¼Œfn å‡½æ•°å®ƒæ˜¯ç›´æ¥è¿”å›äº†ä¸€ä¸ª new Promise çš„ï¼Œè€Œä¸” fn å‡½æ•°çš„è°ƒç”¨æ˜¯åœ¨ start ä¹‹å‰ï¼Œæ‰€ä»¥å®ƒé‡Œé¢çš„å†…å®¹åº”è¯¥ä¼šå…ˆæ‰§è¡Œã€‚</p>
<p>ç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>;</span><br><span class="line">(<span class="string">&quot;start&quot;</span>);</span><br><span class="line">(<span class="string">&quot;success&quot;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="1-6-é¢˜ç›®å…­"><a href="#1-6-é¢˜ç›®å…­" class="headerlink" title="1.6 é¢˜ç›®å…­"></a>1.6 é¢˜ç›®å…­</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start&quot;</span>);</span><br><span class="line"><span class="title function_">fn</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>æ˜¯çš„ï¼Œç°åœ¨ start å°±åœ¨ 1 ä¹‹å‰æ‰“å°å‡ºæ¥äº†ï¼Œå› ä¸º fn å‡½æ•°æ˜¯ä¹‹åæ‰§è¡Œçš„ã€‚</p>
<p><strong>æ³¨æ„ âš ï¸ï¼š</strong> ä¹‹å‰æˆ‘ä»¬å¾ˆå®¹æ˜“å°±ä»¥ä¸ºçœ‹åˆ° new Promise()å°±æ‰§è¡Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°å‡½æ•°äº†ï¼Œå…¶å®è¿™æ˜¯ä¸å¯¹çš„ï¼Œå°±åƒè¿™ä¸¤é“é¢˜ä¸­ï¼Œæˆ‘ä»¬å¾—æ³¨æ„å®ƒæ˜¯ä¸æ˜¯è¢«åŒ…è£¹åœ¨å‡½æ•°å½“ä¸­ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œåªæœ‰åœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œã€‚</p>
<p>ç­”æ¡ˆï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;start&quot;</span>;</span><br><span class="line"><span class="number">1</span>;</span><br><span class="line">(<span class="string">&quot;success&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="2-Promise-ç»“åˆ-setTimeout"><a href="#2-Promise-ç»“åˆ-setTimeout" class="headerlink" title="2. Promise ç»“åˆ setTimeout"></a>2. Promise ç»“åˆ setTimeout</h4><h5 id="2-1-é¢˜ç›®ä¸€"><a href="#2-1-é¢˜ç›®ä¸€" class="headerlink" title="2.1 é¢˜ç›®ä¸€"></a>2.1 é¢˜ç›®ä¸€</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start&quot;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;time&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;resolve&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;end&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è¿‡ç¨‹åˆ†æï¼š</p>
<ul>
<li>åˆšå¼€å§‹æ•´ä¸ªè„šæœ¬ä½œä¸ºä¸€ä¸ªå®ä»»åŠ¡æ¥æ‰§è¡Œï¼Œå¯¹äºåŒæ­¥ä»£ç ç›´æ¥å‹å…¥æ‰§è¡Œæ ˆè¿›è¡Œæ‰§è¡Œï¼Œå› æ­¤å…ˆæ‰“å°å‡º start å’Œ endã€‚</li>
<li>setTimout ä½œä¸ºä¸€ä¸ªå®ä»»åŠ¡è¢«æ”¾å…¥å®ä»»åŠ¡é˜Ÿåˆ—(ä¸‹ä¸€ä¸ª)</li>
<li>Promise.then ä½œä¸ºä¸€ä¸ªå¾®ä»»åŠ¡è¢«æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>æœ¬æ¬¡å®ä»»åŠ¡æ‰§è¡Œå®Œï¼Œæ£€æŸ¥å¾®ä»»åŠ¡ï¼Œå‘ç° Promise.thenï¼Œæ‰§è¡Œå®ƒ</li>
<li>æ¥ä¸‹æ¥è¿›å…¥ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼Œå‘ç° setTimeoutï¼Œæ‰§è¡Œã€‚</li>
</ul>
<p>ç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;start&quot;</span>;</span><br><span class="line"><span class="string">&quot;end&quot;</span>;</span><br><span class="line"><span class="string">&quot;resolve&quot;</span>;</span><br><span class="line"><span class="string">&quot;time&quot;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="2-2-é¢˜ç›®äºŒ"><a href="#2-2-é¢˜ç›®äºŒ" class="headerlink" title="2.2 é¢˜ç›®äºŒ"></a>2.2 é¢˜ç›®äºŒ</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timerStart&quot;</span>);</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timerEnd&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>è¿‡ç¨‹åˆ†æï¼š</p>
<p>å’Œ<strong>é¢˜ç›® 1.2</strong>å¾ˆåƒï¼Œä¸è¿‡åœ¨ resolve çš„å¤–å±‚åŠ äº†ä¸€å±‚ setTimeout å®šæ—¶å™¨ã€‚</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆé‡åˆ° new Promiseï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­çš„ä»£ç  1</li>
<li>ç„¶åç¢°åˆ°äº†å®šæ—¶å™¨ï¼Œå°†è¿™ä¸ªå®šæ—¶å™¨ä¸­çš„å‡½æ•°æ”¾åˆ°ä¸‹ä¸€ä¸ªå®ä»»åŠ¡çš„å»¶è¿Ÿé˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œ</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç  2</li>
<li>è·³å‡º promise å‡½æ•°ï¼Œé‡åˆ° promise.thenï¼Œä½†å…¶çŠ¶æ€è¿˜æ˜¯ä¸º pendingï¼Œè¿™é‡Œç†è§£ä¸ºå…ˆä¸æ‰§è¡Œ</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç  4</li>
<li>ä¸€è½®å¾ªç¯è¿‡åï¼Œè¿›å…¥ç¬¬äºŒæ¬¡å®ä»»åŠ¡ï¼Œå‘ç°å»¶è¿Ÿé˜Ÿåˆ—ä¸­æœ‰ setTimeout å®šæ—¶å™¨ï¼Œæ‰§è¡Œå®ƒ</li>
<li>é¦–å…ˆæ‰§è¡Œ timerStartï¼Œç„¶åé‡åˆ°äº† resolveï¼Œå°† promise çš„çŠ¶æ€æ”¹ä¸º resolved ä¸”ä¿å­˜ç»“æœå¹¶å°†ä¹‹å‰çš„ promise.then æ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>ç»§ç»­æ‰§è¡ŒåŒæ­¥ä»£ç  timerEnd</li>
<li>å®ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼ŒæŸ¥æ‰¾å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç° promise.then è¿™ä¸ªå¾®ä»»åŠ¡ï¼Œæ‰§è¡Œå®ƒã€‚</li>
</ul>
<p>å› æ­¤æ‰§è¡Œç»“æœä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>;</span><br><span class="line"><span class="number">2</span>;</span><br><span class="line"><span class="number">4</span>;</span><br><span class="line">(<span class="string">&quot;timerStart&quot;</span>);</span><br><span class="line">(<span class="string">&quot;timerEnd&quot;</span>);</span><br><span class="line">(<span class="string">&quot;success&quot;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="2-3-é¢˜ç›®ä¸‰"><a href="#2-3-é¢˜ç›®ä¸‰" class="headerlink" title="2.3 é¢˜ç›®ä¸‰"></a>2.3 é¢˜ç›®ä¸‰</h5><p>é¢˜ç›®ä¸‰åˆ†äº†ä¸¤ä¸ªé¢˜ç›®ï¼Œå› ä¸ºçœ‹ç€éƒ½å·®ä¸å¤šï¼Œä¸è¿‡æ‰§è¡Œçš„ç»“æœå´ä¸ä¸€æ ·ï¼Œå¤§å®¶ä¸å¦¨å…ˆçŒœçŒœä¸‹é¢ä¸¤ä¸ªé¢˜ç›®åˆ†åˆ«æ‰§è¡Œä»€ä¹ˆï¼š</p>
<h6 id="1"><a href="#1" class="headerlink" title="(1)"></a>(1)</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer1&quot;</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer3&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer2&quot;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start&quot;</span>);</span><br></pre></td></tr></table></figure>

<h6 id="2"><a href="#2" class="headerlink" title="(2)"></a>(2)</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer1&quot;</span>);</span><br><span class="line">  <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer2&quot;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;start&quot;</span>;</span><br><span class="line"><span class="string">&quot;timer1&quot;</span>;</span><br><span class="line"><span class="string">&quot;timer2&quot;</span>;</span><br><span class="line"><span class="string">&quot;timer3&quot;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;start&quot;</span>;</span><br><span class="line"><span class="string">&quot;timer1&quot;</span>;</span><br><span class="line"><span class="string">&quot;promise&quot;</span>;</span><br><span class="line"><span class="string">&quot;timer2&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸¤ä¸ªä¾‹å­ï¼Œçœ‹ç€å¥½åƒåªæ˜¯æŠŠç¬¬ä¸€ä¸ªå®šæ—¶å™¨ä¸­çš„å†…å®¹æ¢äº†ä¸€ä¸‹è€Œå·²ã€‚</p>
<p>ä¸€ä¸ªæ˜¯ä¸ºå®šæ—¶å™¨ timer3ï¼Œä¸€ä¸ªæ˜¯ä¸º Promise.then</p>
<p>ä½†æ˜¯å¦‚æœæ˜¯å®šæ—¶å™¨ timer3 çš„è¯ï¼Œå®ƒä¼šåœ¨ timer2 åæ‰§è¡Œï¼Œè€Œ Promise.then å´æ˜¯åœ¨ timer2 ä¹‹å‰æ‰§è¡Œã€‚</p>
<p>ä½ å¯ä»¥è¿™æ ·ç†è§£ï¼ŒPromise.then æ˜¯å¾®ä»»åŠ¡ï¼Œå®ƒä¼šè¢«åŠ å…¥åˆ°æœ¬è½®ä¸­çš„å¾®ä»»åŠ¡åˆ—è¡¨ï¼Œè€Œå®šæ—¶å™¨ timer3 æ˜¯å®ä»»åŠ¡ï¼Œå®ƒä¼šè¢«åŠ å…¥åˆ°ä¸‹ä¸€è½®çš„å®ä»»åŠ¡ä¸­ã€‚</p>
<h5 id="2-4-é¢˜ç›®å››"><a href="#2-4-é¢˜ç›®å››" class="headerlink" title="2.4 é¢˜ç›®å››"></a>2.4 é¢˜ç›®å››</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> timer2 = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer2&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> timer1 = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer1&quot;</span>);</span><br><span class="line">  <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise2&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜ç¨å¾®çš„éš¾ä¸€äº›ï¼Œåœ¨ promise ä¸­æ‰§è¡Œå®šæ—¶å™¨ï¼Œåˆåœ¨å®šæ—¶å™¨ä¸­æ‰§è¡Œ promiseï¼›</p>
<p>å¹¶ä¸”è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ Promise æ˜¯ç›´æ¥ resolve çš„ï¼Œè€Œä¹‹å‰çš„ new Promise ä¸ä¸€æ ·ã€‚</p>
<p>å› æ­¤è¿‡ç¨‹åˆ†æä¸ºï¼š</p>
<ul>
<li>åˆšå¼€å§‹æ•´ä¸ªè„šæœ¬ä½œä¸ºç¬¬ä¸€æ¬¡å®ä»»åŠ¡æ¥æ‰§è¡Œï¼Œæˆ‘ä»¬å°†å®ƒæ ‡è®°ä¸ºå® 1ï¼Œä»ä¸Šè‡³ä¸‹æ‰§è¡Œ</li>
<li>é‡åˆ° Promise.resolve().then è¿™ä¸ªå¾®ä»»åŠ¡ï¼Œå°† then ä¸­çš„å†…å®¹åŠ å…¥ç¬¬ä¸€æ¬¡çš„å¾®ä»»åŠ¡é˜Ÿåˆ—æ ‡è®°ä¸ºå¾® 1</li>
<li>é‡åˆ°å®šæ—¶å™¨ timer1ï¼Œå°†å®ƒåŠ å…¥ä¸‹ä¸€æ¬¡å®ä»»åŠ¡çš„å»¶è¿Ÿåˆ—è¡¨ï¼Œæ ‡è®°ä¸ºå® 2ï¼Œç­‰å¾…æ‰§è¡Œ(å…ˆä¸ç®¡é‡Œé¢æ˜¯ä»€ä¹ˆå†…å®¹)</li>
<li>æ‰§è¡Œå® 1 ä¸­çš„åŒæ­¥ä»£ç  start</li>
<li>ç¬¬ä¸€æ¬¡å®ä»»åŠ¡(å® 1)æ‰§è¡Œå®Œæ¯•ï¼Œæ£€æŸ¥ç¬¬ä¸€æ¬¡çš„å¾®ä»»åŠ¡é˜Ÿåˆ—(å¾® 1)ï¼Œå‘ç°æœ‰ä¸€ä¸ª promise.then è¿™ä¸ªå¾®ä»»åŠ¡éœ€è¦æ‰§è¡Œ</li>
<li>æ‰§è¡Œæ‰“å°å‡ºå¾® 1 ä¸­åŒæ­¥ä»£ç  promise1ï¼Œç„¶åå‘ç°å®šæ—¶å™¨ timer2ï¼Œå°†å®ƒåŠ å…¥å® 2 çš„åé¢ï¼Œæ ‡è®°ä¸ºå® 3</li>
<li>ç¬¬ä¸€æ¬¡å¾®ä»»åŠ¡é˜Ÿåˆ—(å¾® 1)æ‰§è¡Œå®Œæ¯•ï¼Œæ‰§è¡Œç¬¬äºŒæ¬¡å®ä»»åŠ¡(å® 2)ï¼Œé¦–å…ˆæ‰§è¡ŒåŒæ­¥ä»£ç  timer1</li>
<li>åé‡åˆ°äº† promise2 è¿™ä¸ªå¾®ä»»åŠ¡ï¼Œå°†å®ƒåŠ å…¥æ­¤æ¬¡å¾ªç¯çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ ‡è®°ä¸ºå¾® 2</li>
<li>å® 2 ä¸­æ²¡æœ‰åŒæ­¥ä»£ç å¯æ‰§è¡Œäº†ï¼ŒæŸ¥æ‰¾æœ¬æ¬¡å¾ªç¯çš„å¾®ä»»åŠ¡é˜Ÿåˆ—(å¾® 2)ï¼Œå‘ç°äº† promise2ï¼Œæ‰§è¡Œå®ƒ</li>
<li>ç¬¬äºŒè½®æ‰§è¡Œå®Œæ¯•ï¼Œæ‰§è¡Œå® 3ï¼Œæ‰“å°å‡º timer2</li>
</ul>
<p>æ‰€ä»¥ç»“æœä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;start&quot;</span>;</span><br><span class="line"><span class="string">&quot;promise1&quot;</span>;</span><br><span class="line"><span class="string">&quot;timer1&quot;</span>;</span><br><span class="line"><span class="string">&quot;promise2&quot;</span>;</span><br><span class="line"><span class="string">&quot;timer2&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ„Ÿè§‰æœ‰ç‚¹ç»•çš„è¯ï¼Œå¯ä»¥çœ‹ä¸‹é¢è¿™å¼ å›¾ï¼Œå°±ä¸€ç›®äº†ç„¶äº†ã€‚</p>
<p><img src="https://www.daykalif.com/blog_img/promise1.png" alt="promise"></p>
<h5 id="2-5-é¢˜ç›®äº”"><a href="#2-5-é¢˜ç›®äº”" class="headerlink" title="2.5 é¢˜ç›®äº”"></a>2.5 é¢˜ç›®äº”</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> promise2 = promise1.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;error!!!&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>, promise1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise2&quot;</span>, promise2);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>, promise1);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise2&quot;</span>, promise2);</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure>

<p>è¿‡ç¨‹åˆ†æï¼š</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆæ‰§è¡Œç¬¬ä¸€ä¸ª new Promise ä¸­çš„å‡½æ•°ï¼Œç¢°åˆ° setTimeout å°†å®ƒåŠ å…¥ä¸‹ä¸€ä¸ªå®ä»»åŠ¡åˆ—è¡¨</li>
<li>è·³å‡º new Promiseï¼Œç¢°åˆ° promise1.then è¿™ä¸ªå¾®ä»»åŠ¡ï¼Œä½†å…¶çŠ¶æ€è¿˜æ˜¯ä¸º pendingï¼Œè¿™é‡Œç†è§£ä¸ºå…ˆä¸æ‰§è¡Œ</li>
<li>promise2 æ˜¯ä¸€ä¸ªæ–°çš„çŠ¶æ€ä¸º pending çš„ Promise</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç  console.log(â€˜promise1â€™)ï¼Œä¸”æ‰“å°å‡ºçš„ promise1 çš„çŠ¶æ€ä¸º pending</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç  console.log(â€˜promise2â€™)ï¼Œä¸”æ‰“å°å‡ºçš„ promise2 çš„çŠ¶æ€ä¸º pending</li>
<li>ç¢°åˆ°ç¬¬äºŒä¸ªå®šæ—¶å™¨ï¼Œå°†å…¶æ”¾å…¥ä¸‹ä¸€ä¸ªå®ä»»åŠ¡åˆ—è¡¨</li>
<li>ç¬¬ä¸€è½®å®ä»»åŠ¡æ‰§è¡Œç»“æŸï¼Œå¹¶ä¸”æ²¡æœ‰å¾®ä»»åŠ¡éœ€è¦æ‰§è¡Œï¼Œå› æ­¤æ‰§è¡Œç¬¬äºŒè½®å®ä»»åŠ¡</li>
<li>å…ˆæ‰§è¡Œç¬¬ä¸€ä¸ªå®šæ—¶å™¨é‡Œçš„å†…å®¹ï¼Œå°† promise1 çš„çŠ¶æ€æ”¹ä¸º resolved ä¸”ä¿å­˜ç»“æœå¹¶å°†ä¹‹å‰çš„ promise1.then æ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>è¯¥å®šæ—¶å™¨ä¸­æ²¡æœ‰å…¶å®ƒçš„åŒæ­¥ä»£ç å¯æ‰§è¡Œï¼Œå› æ­¤æ‰§è¡Œæœ¬è½®çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯ promise1.thenï¼Œå®ƒæŠ›å‡ºäº†ä¸€ä¸ªé”™è¯¯ï¼Œä¸”å°† promise2 çš„çŠ¶æ€è®¾ç½®ä¸ºäº† rejected</li>
<li>ç¬¬ä¸€ä¸ªå®šæ—¶å™¨æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œç¬¬äºŒä¸ªå®šæ—¶å™¨ä¸­çš„å†…å®¹</li>
<li>æ‰“å°å‡ºâ€™promise1â€™ï¼Œä¸”æ­¤æ—¶ promise1 çš„çŠ¶æ€ä¸º resolved</li>
<li>æ‰“å°å‡ºâ€™promise2â€™ï¼Œä¸”æ­¤æ—¶ promise2 çš„çŠ¶æ€ä¸º rejected</li>
</ul>
<p>å®Œæ•´çš„ç»“æœä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;promise1&#x27;</span> <span class="title class_">Promise</span>&#123;&lt;pending&gt;&#125;</span><br><span class="line"><span class="string">&#x27;promise2&#x27;</span> <span class="title class_">Promise</span>&#123;&lt;pending&gt;&#125;</span><br><span class="line">test5.<span class="property">html</span>:<span class="number">102</span> <span class="title class_">Uncaught</span> (<span class="keyword">in</span> promise) <span class="title class_">Error</span>: error!!! at test.<span class="property">html</span>:<span class="number">102</span></span><br><span class="line"><span class="string">&#x27;promise1&#x27;</span> <span class="title class_">Promise</span>&#123;&lt;resolved&gt;: <span class="string">&quot;success&quot;</span>&#125;</span><br><span class="line"><span class="string">&#x27;promise2&#x27;</span> <span class="title class_">Promise</span>&#123;&lt;rejected&gt;: <span class="title class_">Error</span>: error!!!&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-6-é¢˜ç›®å…­"><a href="#2-6-é¢˜ç›®å…­" class="headerlink" title="2.6 é¢˜ç›®å…­"></a>2.6 é¢˜ç›®å…­</h5><p>å¦‚æœä½ ä¸Šé¢è¿™é“é¢˜ææ‡‚äº†ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¥åšåšè¿™é“äº†ï¼Œä½ åº”è¯¥èƒ½å¾ˆå¿«å°±ç»™å‡ºç­”æ¡ˆï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer1&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1é‡Œçš„å†…å®¹&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> promise2 = promise1.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;error!!!&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>, promise1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise2&quot;</span>, promise2);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer2&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>, promise1);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise2&quot;</span>, promise2);</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure>

<p>ç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;promise1é‡Œçš„å†…å®¹&#x27;</span></span><br><span class="line"><span class="string">&#x27;promise1&#x27;</span> <span class="title class_">Promise</span>&#123;&lt;pending&gt;&#125;</span><br><span class="line"><span class="string">&#x27;promise2&#x27;</span> <span class="title class_">Promise</span>&#123;&lt;pending&gt;&#125;</span><br><span class="line"><span class="string">&#x27;timer1&#x27;</span></span><br><span class="line">test5.<span class="property">html</span>:<span class="number">102</span> <span class="title class_">Uncaught</span> (<span class="keyword">in</span> promise) <span class="title class_">Error</span>: error!!! at test.<span class="property">html</span>:<span class="number">102</span></span><br><span class="line"><span class="string">&#x27;timer2&#x27;</span></span><br><span class="line"><span class="string">&#x27;promise1&#x27;</span> <span class="title class_">Promise</span>&#123;&lt;resolved&gt;: <span class="string">&quot;success&quot;</span>&#125;</span><br><span class="line"><span class="string">&#x27;promise2&#x27;</span> <span class="title class_">Promise</span>&#123;&lt;rejected&gt;: <span class="title class_">Error</span>: error!!!&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-Promise-ä¸­çš„-thenã€catchã€finally"><a href="#3-Promise-ä¸­çš„-thenã€catchã€finally" class="headerlink" title="3. Promise ä¸­çš„ thenã€catchã€finally"></a>3. Promise ä¸­çš„ thenã€catchã€finally</h4><p><strong>æ€»ç»“ï¼š</strong></p>
<ul>
<li>Promise çš„çŠ¶æ€ä¸€ç»æ”¹å˜å°±ä¸èƒ½å†æ”¹å˜ã€‚(è§ 3.1)</li>
<li>.then å’Œ.catch éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Promiseã€‚(ä¸Šé¢çš„ ğŸ‘†1.4 è¯æ˜äº†)</li>
<li>catch ä¸ç®¡è¢«è¿æ¥åˆ°å“ªé‡Œï¼Œéƒ½èƒ½æ•è·ä¸Šå±‚çš„é”™è¯¯ã€‚(è§ 3.2)</li>
<li>åœ¨ Promise ä¸­ï¼Œè¿”å›ä»»æ„ä¸€ä¸ªé promise çš„å€¼éƒ½ä¼šè¢«åŒ…è£¹æˆ promise å¯¹è±¡ï¼Œä¾‹å¦‚ return 2 ä¼šè¢«åŒ…è£…ä¸º return Promise.resolve(2)ã€‚</li>
<li>Promise çš„ .then æˆ–è€… .catch å¯ä»¥è¢«è°ƒç”¨å¤šæ¬¡, å½“å¦‚æœ Promise å†…éƒ¨çš„çŠ¶æ€ä¸€ç»æ”¹å˜ï¼Œå¹¶ä¸”æœ‰äº†ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆåç»­æ¯æ¬¡è°ƒç”¨.then æˆ–è€….catch çš„æ—¶å€™éƒ½ä¼šç›´æ¥æ‹¿åˆ°è¯¥å€¼ã€‚(è§ 3.5)</li>
<li>.then æˆ–è€… .catch ä¸­ return ä¸€ä¸ª error å¯¹è±¡å¹¶ä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼Œæ‰€ä»¥ä¸ä¼šè¢«åç»­çš„ .catch æ•è·ã€‚(è§ 3.6)</li>
<li>.then æˆ– .catch è¿”å›çš„å€¼ä¸èƒ½æ˜¯ promise æœ¬èº«ï¼Œå¦åˆ™ä¼šé€ æˆæ­»å¾ªç¯ã€‚(è§ 3.7)</li>
<li>.then æˆ–è€… .catch çš„å‚æ•°æœŸæœ›æ˜¯å‡½æ•°ï¼Œä¼ å…¥éå‡½æ•°åˆ™ä¼šå‘ç”Ÿå€¼ç©¿é€ã€‚(è§ 3.8)</li>
<li>.then æ–¹æ³•æ˜¯èƒ½æ¥æ”¶ä¸¤ä¸ªå‚æ•°çš„ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¤„ç†æˆåŠŸçš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯å¤„ç†å¤±è´¥çš„å‡½æ•°ï¼Œå†æŸäº›æ—¶å€™ä½ å¯ä»¥è®¤ä¸º catch æ˜¯.then ç¬¬äºŒä¸ªå‚æ•°çš„ç®€ä¾¿å†™æ³•ã€‚(è§ 3.9)</li>
<li>.finally æ–¹æ³•ä¹Ÿæ˜¯è¿”å›ä¸€ä¸ª Promiseï¼Œä»–åœ¨ Promise ç»“æŸçš„æ—¶å€™ï¼Œæ— è®ºç»“æœä¸º resolved è¿˜æ˜¯ rejectedï¼Œéƒ½ä¼šæ‰§è¡Œé‡Œé¢çš„å›è°ƒå‡½æ•°ã€‚</li>
</ul>
<h5 id="3-1-é¢˜ç›®ä¸€"><a href="#3-1-é¢˜ç›®ä¸€" class="headerlink" title="3.1 é¢˜ç›®ä¸€"></a>3.1 é¢˜ç›®ä¸€</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;success1&quot;</span>);</span><br><span class="line">  <span class="title function_">reject</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;success2&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">promise</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;then: &quot;</span>, res);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;catch: &quot;</span>, err);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>ç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;then: success1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>æ„é€ å‡½æ•°ä¸­çš„ resolve æˆ– reject åªæœ‰ç¬¬ä¸€æ¬¡æ‰§è¡Œæœ‰æ•ˆï¼Œå¤šæ¬¡è°ƒç”¨æ²¡æœ‰ä»»ä½•ä½œç”¨ ã€‚éªŒè¯äº†ç¬¬ä¸€ä¸ªç»“è®ºï¼ŒPromise çš„çŠ¶æ€ä¸€ç»æ”¹å˜å°±ä¸èƒ½å†æ”¹å˜ã€‚</p>
<h5 id="3-2-é¢˜ç›®äºŒ"><a href="#3-2-é¢˜ç›®äºŒ" class="headerlink" title="3.2 é¢˜ç›®äºŒ"></a>3.2 é¢˜ç›®äºŒ</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">reject</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;success2&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">promise</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;then1: &quot;</span>, res);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;then2: &quot;</span>, res);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;catch3: &quot;</span>, err);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;then4: &quot;</span>, res);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>ç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;catch3: &quot;</span> <span class="string">&quot;error&quot;</span></span><br><span class="line"><span class="string">&quot;then4: &quot;</span> <span class="literal">undefined</span></span><br></pre></td></tr></table></figure>

<p>éªŒè¯äº†ç¬¬ä¸‰ä¸ªç»“è®ºï¼Œcatch ä¸ç®¡è¢«è¿æ¥åˆ°å“ªé‡Œï¼Œéƒ½èƒ½æ•è·ä¸Šå±‚çš„é”™è¯¯ã€‚</p>
<h5 id="3-3-é¢˜ç›®ä¸‰"><a href="#3-3-é¢˜ç›®ä¸‰" class="headerlink" title="3.3 é¢˜ç›®ä¸‰"></a>3.3 é¢˜ç›®ä¸‰</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">1</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>ç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>;</span><br><span class="line"><span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>Promise å¯ä»¥é“¾å¼è°ƒç”¨ï¼Œä¸è¿‡ promise æ¯æ¬¡è°ƒç”¨ .then æˆ–è€… .catch éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ promiseï¼Œä»è€Œå®ç°äº†é“¾å¼è°ƒç”¨, å®ƒå¹¶ä¸åƒä¸€èˆ¬æˆ‘ä»¬ä»»åŠ¡çš„é“¾å¼è°ƒç”¨ä¸€æ · return thisã€‚</p>
<p>ä¸Šé¢çš„è¾“å‡ºç»“æœä¹‹æ‰€ä»¥ä¾æ¬¡æ‰“å°å‡º 1 å’Œ 2ï¼Œé‚£æ˜¯å› ä¸º resolve(1)ä¹‹åèµ°çš„æ˜¯ç¬¬ä¸€ä¸ª then æ–¹æ³•ï¼Œå¹¶æ²¡æœ‰èµ° catch é‡Œï¼Œæ‰€ä»¥ç¬¬äºŒä¸ª then ä¸­çš„ res å¾—åˆ°çš„å®é™…ä¸Šæ˜¯ç¬¬ä¸€ä¸ª then çš„è¿”å›å€¼ã€‚</p>
<p>ä¸” return 2 ä¼šè¢«åŒ…è£…æˆ resolve(2)ã€‚</p>
<h5 id="3-4-é¢˜ç›®å››"><a href="#3-4-é¢˜ç›®å››" class="headerlink" title="3.4 é¢˜ç›®å››"></a>3.4 é¢˜ç›®å››</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="number">1</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>ç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>;</span><br><span class="line"><span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>ç»“æœæ‰“å°çš„å½“ç„¶æ˜¯ 1 å’Œ 3 å•¦ï¼Œå› ä¸º reject(1)æ­¤æ—¶èµ°çš„å°±æ˜¯ catchï¼Œä¸”ç¬¬äºŒä¸ª then ä¸­çš„ res å¾—åˆ°çš„å°±æ˜¯ catch ä¸­çš„è¿”å›å€¼ã€‚</p>
<h5 id="3-5-é¢˜ç›®äº”"><a href="#3-5-é¢˜ç›®äº”" class="headerlink" title="3.5 é¢˜ç›®äº”"></a>3.5 é¢˜ç›®äº”</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer&quot;</span>);</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> start = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res, <span class="title class_">Date</span>.<span class="title function_">now</span>() - start);</span><br><span class="line">&#125;);</span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res, <span class="title class_">Date</span>.<span class="title function_">now</span>() - start);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;timer&#x27;</span></span><br><span class="line">success <span class="number">1001</span></span><br><span class="line">success <span class="number">1002</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œå¦‚æœä½ è¶³å¤Ÿå¿«çš„è¯ï¼Œä¹Ÿå¯èƒ½ä¸¤ä¸ªéƒ½æ˜¯ 1001ã€‚</p>
<p>Promise çš„ .then æˆ–è€… .catch å¯ä»¥è¢«è°ƒç”¨å¤šæ¬¡ï¼Œä½†è¿™é‡Œ Promise æ„é€ å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ã€‚æˆ–è€…è¯´ promise å†…éƒ¨çŠ¶æ€ä¸€ç»æ”¹å˜ï¼Œå¹¶ä¸”æœ‰äº†ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆåç»­æ¯æ¬¡è°ƒç”¨ .then æˆ–è€… .catch éƒ½ä¼šç›´æ¥æ‹¿åˆ°è¯¥å€¼ã€‚</p>
<h5 id="3-6-é¢˜ç›®å…­"><a href="#3-6-é¢˜ç›®å…­" class="headerlink" title="3.6 é¢˜ç›®å…­"></a>3.6 é¢˜ç›®å…­</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;error!!!&quot;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;then: &quot;</span>, res);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;catch: &quot;</span>, err);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>çŒœçŒœè¿™é‡Œçš„ç»“æœè¾“å‡ºçš„æ˜¯ä»€ä¹ˆ ğŸ¤”ï¸ ï¼Ÿ</p>
<p>ä½ å¯èƒ½æƒ³åˆ°çš„æ˜¯è¿›å…¥.catch ç„¶åè¢«æ•è·äº†é”™è¯¯ã€‚</p>
<p>ç»“æœå¹¶ä¸æ˜¯è¿™æ ·çš„ï¼Œå®ƒèµ°çš„æ˜¯.then é‡Œé¢ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;then: &quot;</span> <span class="string">&quot;Error: error!!!&quot;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¹ŸéªŒè¯äº†ç¬¬ 4 ç‚¹å’Œç¬¬ 6 ç‚¹ï¼Œè¿”å›ä»»æ„ä¸€ä¸ªé promise çš„å€¼éƒ½ä¼šè¢«åŒ…è£¹æˆ promise å¯¹è±¡ï¼Œå› æ­¤è¿™é‡Œçš„<strong>return new Error(â€˜error!!!â€™)</strong> ä¹Ÿè¢«åŒ…è£¹æˆäº†**return Promise.resolve(new Error(â€˜error!!!â€™))**ã€‚</p>
<p>å½“ç„¶å¦‚æœä½ æŠ›å‡ºä¸€ä¸ªé”™è¯¯çš„è¯ï¼Œå¯ä»¥ç”¨ä¸‹é¢ ğŸ‘‡ ä¸¤çš„ä»»æ„ä¸€ç§ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;error!!!&quot;</span>));</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;error!!!&quot;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="3-7-é¢˜ç›®ä¸ƒ"><a href="#3-7-é¢˜ç›®ä¸ƒ" class="headerlink" title="3.7 é¢˜ç›®ä¸ƒ"></a>3.7 é¢˜ç›®ä¸ƒ</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> promise;</span><br><span class="line">&#125;);</span><br><span class="line">promise.<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">err</span>);</span><br></pre></td></tr></table></figure>

<p>.then æˆ– .catch è¿”å›çš„å€¼ä¸èƒ½æ˜¯ promise æœ¬èº«ï¼Œå¦åˆ™ä¼šé€ æˆæ­»å¾ªç¯ã€‚</p>
<p>å› æ­¤ç»“æœä¼šæŠ¥é”™ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Uncaught</span> (<span class="keyword">in</span> promise) <span class="title class_">TypeError</span>: <span class="title class_">Chaining</span> cycle detected <span class="keyword">for</span> promise #&lt;<span class="title class_">Promise</span>&gt;</span><br></pre></td></tr></table></figure>

<h5 id="3-8-é¢˜ç›®å…«"><a href="#3-8-é¢˜ç›®å…«" class="headerlink" title="3.8 é¢˜ç›®å…«"></a>3.8 é¢˜ç›®å…«</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">1</span>).<span class="title function_">then</span>(<span class="number">2</span>).<span class="title function_">then</span>(<span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">3</span>)).<span class="title function_">then</span>(<span class="variable language_">console</span>.<span class="property">log</span>);</span><br></pre></td></tr></table></figure>

<p>è®°ä½åŸåˆ™ 8ï¼š.then æˆ–è€… .catch çš„å‚æ•°æœŸæœ›æ˜¯å‡½æ•°ï¼Œä¼ å…¥éå‡½æ•°åˆ™ä¼šå‘ç”Ÿå€¼ç©¿é€ã€‚</p>
<p>ç¬¬ä¸€ä¸ª then å’Œç¬¬äºŒä¸ª then ä¸­ä¼ å…¥çš„éƒ½ä¸æ˜¯å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯æ•°å­—ç±»å‹ï¼Œä¸€ä¸ªæ˜¯å¯¹è±¡ç±»å‹ï¼Œå› æ­¤å‘ç”Ÿäº†ç©¿é€ï¼Œå°† resolve(1) çš„å€¼ç›´æ¥ä¼ åˆ°æœ€åä¸€ä¸ª then é‡Œã€‚</p>
<p>æ‰€ä»¥è¾“å‡ºç»“æœä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h5 id="3-9-é¢˜ç›®ä¹"><a href="#3-9-é¢˜ç›®ä¹" class="headerlink" title="3.9 é¢˜ç›®ä¹"></a>3.9 é¢˜ç›®ä¹</h5><p>ä¸‹é¢æ¥ä»‹ç»ä¸€ä¸‹.then å‡½æ•°ä¸­çš„ä¸¤ä¸ªå‚æ•°ã€‚</p>
<p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥å¤„ç† Promise æˆåŠŸçš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯å¤„ç†å¤±è´¥çš„å‡½æ•°ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ Promise.resolve(â€˜1â€™)çš„å€¼ä¼šè¿›å…¥æˆåŠŸçš„å‡½æ•°ï¼ŒPromise.reject(â€˜2â€™)çš„å€¼ä¼šè¿›å…¥å¤±è´¥çš„å‡½æ•°ã€‚</p>
<h6 id="a"><a href="#a" class="headerlink" title="(a)"></a>(a)</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&quot;err!!!&quot;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(</span><br><span class="line">    <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;success&quot;</span>, res);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;error&quot;</span>, err);</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;catch&quot;</span>, err);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„æ‰§è¡Œç»“æœæ˜¯ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;error&#x27;</span> <span class="string">&#x27;err!!!&#x27;</span></span><br></pre></td></tr></table></figure>

<h6 id="b"><a href="#b" class="headerlink" title="(b)"></a>(b)</h6><p>å®ƒè¿›å…¥çš„æ˜¯ then()ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°é‡Œé¢ï¼Œè€Œå¦‚æœæŠŠç¬¬äºŒä¸ªå‚æ•°å»æ‰ï¼Œå°±è¿›å…¥äº† catch()ä¸­ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&quot;err!!!&quot;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;success&quot;</span>, res);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;catch&quot;</span>, err);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;catch&#x27;</span> <span class="string">&#x27;error!!!&#x27;</span></span><br></pre></td></tr></table></figure>

<h6 id="c"><a href="#c" class="headerlink" title="(c)"></a>(c)</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line">  .<span class="title function_">then</span>(</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;error!!!&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">fail1</span>(<span class="params">err</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fail1&quot;</span>, err);</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="keyword">function</span> <span class="title function_">fail2</span>(<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fail2&quot;</span>, err);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>ç”±äº Promise è°ƒç”¨çš„æ˜¯ resolve()ï¼Œå› æ­¤.then()æ‰§è¡Œçš„åº”è¯¥æ˜¯ success()å‡½æ•°ï¼Œå¯æ˜¯ success()å‡½æ•°æŠ›å‡ºçš„æ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œå®ƒä¼šè¢«åé¢çš„ catch()ç»™æ•è·åˆ°ï¼Œè€Œä¸æ˜¯è¢« fail1 å‡½æ•°æ•è·ã€‚</p>
<p>å› æ­¤æ‰§è¡Œç»“æœä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fail2 <span class="title class_">Error</span>: error!!!</span><br></pre></td></tr></table></figure>

<h5 id="3-10-é¢˜ç›®å"><a href="#3-10-é¢˜ç›®å" class="headerlink" title="3.10 é¢˜ç›®å"></a>3.10 é¢˜ç›®å</h5><p>æ¥ç€æ¥çœ‹çœ‹.finally()ï¼Œè¿™ä¸ªåŠŸèƒ½ä¸€èˆ¬ä¸å¤ªç”¨åœ¨é¢è¯•ä¸­ï¼Œä¸è¿‡å¦‚æœç¢°åˆ°äº†ä½ ä¹Ÿåº”è¯¥çŸ¥é“è¯¥å¦‚ä½•å¤„ç†ã€‚</p>
<p>å…¶å®ä½ åªè¦è®°ä½å®ƒä¸‰ä¸ªå¾ˆé‡è¦çš„çŸ¥è¯†ç‚¹å°±å¯ä»¥äº†ï¼š</p>
<ul>
<li>.finally()æ–¹æ³•ä¸ç®¡ Promise å¯¹è±¡æœ€åçš„çŠ¶æ€å¦‚ä½•éƒ½ä¼šæ‰§è¡Œ</li>
<li>.finally()æ–¹æ³•çš„å›è°ƒå‡½æ•°ä¸æ¥å—ä»»ä½•çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ åœ¨.finally()å‡½æ•°ä¸­æ˜¯æ²¡æ³•çŸ¥é“ Promise æœ€ç»ˆçš„çŠ¶æ€æ˜¯ resolved è¿˜æ˜¯ rejected çš„</li>
<li>å®ƒæœ€ç»ˆè¿”å›çš„é»˜è®¤ä¼šæ˜¯ä¸€ä¸ªåŸæ¥çš„ Promise å¯¹è±¡å€¼ï¼Œä¸è¿‡å¦‚æœæŠ›å‡ºçš„æ˜¯ä¸€ä¸ªå¼‚å¸¸åˆ™è¿”å›å¼‚å¸¸çš„ Promise å¯¹è±¡ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;finally&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">  .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;finally2&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;æˆ‘æ˜¯finally2è¿”å›çš„å€¼&quot;</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;finally2åé¢çš„thenå‡½æ•°&quot;</span>, res);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸¤ä¸ª Promise çš„.finally éƒ½ä¼šæ‰§è¡Œï¼Œä¸”å°±ç®— finally2 è¿”å›äº†æ–°çš„å€¼ï¼Œå®ƒåé¢çš„ then()å‡½æ•°æ¥æ”¶åˆ°çš„ç»“æœå´è¿˜æ˜¯â€™2â€™ï¼Œå› æ­¤æ‰“å°ç»“æœä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;1&#x27;</span></span><br><span class="line"><span class="string">&#x27;finally2&#x27;</span></span><br><span class="line"><span class="string">&#x27;finally&#x27;</span></span><br><span class="line"><span class="string">&#x27;finally2åé¢çš„thenå‡½æ•°&#x27;</span> <span class="string">&#x27;2&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è‡³äºä¸ºä»€ä¹ˆ finally2 çš„æ‰“å°è¦åœ¨ finally å‰é¢ï¼Œè¯·çœ‹ä¸‹ä¸€ä¸ªä¾‹å­ä¸­çš„è§£æã€‚</p>
<p>ä¸è¿‡åœ¨æ­¤ä¹‹å‰è®©æˆ‘ä»¬å†æ¥ç¡®è®¤ä¸€ä¸‹ï¼Œfinally ä¸­è¦æ˜¯æŠ›å‡ºçš„æ˜¯ä¸€ä¸ªå¼‚å¸¸æ˜¯æ€æ ·çš„ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">  .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;finally1&quot;</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;æˆ‘æ˜¯finallyä¸­æŠ›å‡ºçš„å¼‚å¸¸&quot;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;finallyåé¢çš„thenå‡½æ•°&quot;</span>, res);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ•è·é”™è¯¯&quot;</span>, err);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;finally1&#x27;</span></span><br><span class="line"><span class="string">&#x27;æ•è·é”™è¯¯&#x27;</span> <span class="title class_">Error</span>: æˆ‘æ˜¯<span class="keyword">finally</span>ä¸­æŠ›å‡ºçš„å¼‚å¸¸</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å¦‚æœæ”¹ä¸º return new Error(â€˜æˆ‘æ˜¯ finally ä¸­æŠ›å‡ºçš„å¼‚å¸¸â€™)ï¼Œæ‰“å°å‡ºæ¥çš„å°±æ˜¯â€™finally åé¢çš„ then å‡½æ•° 1â€™</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">promise1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>);</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">promise2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">promise1</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err))</span><br><span class="line">  .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;finally1&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="title function_">promise2</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err))</span><br><span class="line">  .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;finally2&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<ul>
<li>é¦–å…ˆå®šä¹‰äº†ä¸¤ä¸ªå‡½æ•° promise1 å’Œ promise2ï¼Œå…ˆä¸ç®¡æ¥ç€å¾€ä¸‹çœ‹ã€‚</li>
<li>promise1 å‡½æ•°å…ˆè¢«è°ƒç”¨äº†ï¼Œç„¶åæ‰§è¡Œé‡Œé¢ new Promise çš„åŒæ­¥ä»£ç æ‰“å°å‡º promise1</li>
<li>ä¹‹åé‡åˆ°äº† resolve(1)ï¼Œå°† p çš„çŠ¶æ€æ”¹ä¸ºäº† resolved å¹¶å°†ç»“æœä¿å­˜ä¸‹æ¥ã€‚</li>
<li>æ­¤æ—¶ promise1 å†…çš„å‡½æ•°å†…å®¹å·²ç»æ‰§è¡Œå®Œäº†ï¼Œè·³å‡ºè¯¥å‡½æ•°</li>
<li>ç¢°åˆ°äº† promise1().then()ï¼Œç”±äº promise1 çš„çŠ¶æ€å·²ç»å‘ç”Ÿäº†æ”¹å˜ä¸”ä¸º resolved å› æ­¤å°† promise1().then()è¿™æ¡å¾®ä»»åŠ¡åŠ å…¥æœ¬è½®çš„å¾®ä»»åŠ¡åˆ—è¡¨(è¿™æ˜¯ç¬¬ä¸€ä¸ªå¾®ä»»åŠ¡)</li>
<li>è¿™æ—¶å€™è¦æ³¨æ„äº†ï¼Œä»£ç å¹¶ä¸ä¼šæ¥ç€å¾€é“¾å¼è°ƒç”¨çš„ä¸‹é¢èµ°ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šå…ˆå°†.finally åŠ å…¥å¾®ä»»åŠ¡åˆ—è¡¨ï¼Œé‚£æ˜¯å› ä¸º.then æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¾®ä»»åŠ¡ï¼Œå®ƒé“¾å¼åé¢çš„å†…å®¹å¿…é¡»å¾—ç­‰å½“å‰è¿™ä¸ªå¾®ä»»åŠ¡æ‰§è¡Œå®Œæ‰ä¼šæ‰§è¡Œï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬å…ˆä¸ç®¡.finally()</li>
<li>å†å¾€ä¸‹èµ°ç¢°åˆ°äº† promise2()å‡½æ•°ï¼Œå…¶ä¸­è¿”å›çš„ new Promise ä¸­å¹¶æ²¡æœ‰åŒæ­¥ä»£ç éœ€è¦æ‰§è¡Œï¼Œæ‰€ä»¥æ‰§è¡Œ reject(â€˜errorâ€™)çš„æ—¶å€™å°† promise2 å‡½æ•°ä¸­çš„ Promise çš„çŠ¶æ€å˜ä¸ºäº† rejected</li>
<li>è·³å‡º promise2 å‡½æ•°ï¼Œé‡åˆ°äº† promise2().then()ï¼Œå°†å…¶åŠ å…¥å½“å‰çš„å¾®ä»»åŠ¡é˜Ÿåˆ—(è¿™æ˜¯ç¬¬äºŒä¸ªå¾®ä»»åŠ¡)ï¼Œä¸”é“¾å¼è°ƒç”¨åé¢çš„å†…å®¹å¾—ç­‰è¯¥ä»»åŠ¡æ‰§è¡Œå®Œåæ‰æ‰§è¡Œï¼Œå’Œ.then()ä¸€æ ·ã€‚</li>
<li>OKï¼Œ æœ¬è½®çš„å®ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œäº†ï¼Œæ¥çœ‹çœ‹å¾®ä»»åŠ¡åˆ—è¡¨ï¼Œå­˜åœ¨ promise1().then()ï¼Œæ‰§è¡Œå®ƒï¼Œæ‰“å°å‡º 1ï¼Œç„¶åé‡åˆ°äº†.finally()è¿™ä¸ªå¾®ä»»åŠ¡å°†å®ƒåŠ å…¥å¾®ä»»åŠ¡åˆ—è¡¨(è¿™æ˜¯ç¬¬ä¸‰ä¸ªå¾®ä»»åŠ¡)ç­‰å¾…æ‰§è¡Œ</li>
<li>å†æ‰§è¡Œ promise2().catch()æ‰“å°å‡º errorï¼Œæ‰§è¡Œå®Œåå°† finally2 åŠ å…¥å¾®ä»»åŠ¡åŠ å…¥å¾®ä»»åŠ¡åˆ—è¡¨(è¿™æ˜¯ç¬¬å››ä¸ªå¾®ä»»åŠ¡)</li>
<li>OKï¼Œ æœ¬è½®åˆå…¨éƒ¨æ‰§è¡Œå®Œäº†ï¼Œä½†æ˜¯å¾®ä»»åŠ¡åˆ—è¡¨è¿˜æœ‰ä¸¤ä¸ªæ–°çš„å¾®ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œï¼Œå› æ­¤ä¾æ¬¡æ‰§è¡Œ finally1 å’Œ finally2ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;promise1&quot;</span>;</span><br><span class="line"><span class="string">&quot;1&quot;</span>;</span><br><span class="line"><span class="string">&quot;error&quot;</span>;</span><br><span class="line"><span class="string">&quot;finally1&quot;</span>;</span><br><span class="line"><span class="string">&quot;finally2&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é“é¢˜ä¸­å…¶å®èƒ½æ‰©å±•çš„ä¸œè¥¿æŒºå¤šçš„ï¼Œä¹‹å‰æ²¡æœ‰æåˆ°ï¼Œé‚£å°±æ˜¯ä½ å¯ä»¥ç†è§£ä¸ºé“¾å¼è°ƒç”¨åé¢çš„å†…å®¹éœ€è¦ç­‰å‰ä¸€ä¸ªè°ƒç”¨æ‰§è¡Œå®Œæ‰ä¼šæ‰§è¡Œã€‚</p>
<p>å°±åƒæ˜¯è¿™é‡Œçš„ finally()ä¼šç­‰ promise1().then()æ‰§è¡Œå®Œæ‰ä¼šå°† finally()åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå…¶å®å¦‚æœè¿™é“é¢˜ä¸­ä½ æŠŠ finally()æ¢æˆæ˜¯ then()ä¹Ÿæ˜¯è¿™æ ·çš„:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">promise1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>);</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">promise2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">promise1</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err))</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;finally1&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="title function_">promise2</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err))</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;finally2&quot;</span>));</span><br></pre></td></tr></table></figure>

<h4 id="4-Promise-ä¸­çš„-all-å’Œ-race"><a href="#4-Promise-ä¸­çš„-all-å’Œ-race" class="headerlink" title="4. Promise ä¸­çš„ all å’Œ race"></a>4. Promise ä¸­çš„ all å’Œ race</h4><p>é€šä¿—æ¥è¯´ï¼Œ.all()çš„ä½œç”¨æ˜¯æ¥æ”¶ä¸€ç»„å¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åå¹¶è¡Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œåæ‰æ‰§è¡Œå›è°ƒã€‚</p>
<p>.race()çš„ä½œç”¨ä¹Ÿæ˜¯æ¥æ”¶ä¸€ç»„å¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åå¹¶è¡Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œåªä¿ç•™å–ç¬¬ä¸€ä¸ªæ‰§è¡Œå®Œæˆçš„å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå…¶ä»–çš„æ–¹æ³•ä»åœ¨æ‰§è¡Œï¼Œä¸è¿‡æ‰§è¡Œç»“æœä¼šè¢«æŠ›å¼ƒã€‚</p>
<h5 id="4-1-é¢˜ç›®ä¸€"><a href="#4-1-é¢˜ç›®ä¸€" class="headerlink" title="4.1 é¢˜ç›®ä¸€"></a>4.1 é¢˜ç›®ä¸€</h5><p>æˆ‘ä»¬çŸ¥é“å¦‚æœç›´æ¥åœ¨è„šæœ¬æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ª Promiseï¼Œå®ƒæ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¼šç«‹å³æ‰§è¡Œçš„ï¼Œå°±åƒè¿™æ ·ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ç«‹å³æ‰“å°&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°ä¸­ä¼šç«‹å³æ‰“å°å‡º â€œç«‹å³æ‰“å°â€ã€‚</p>
<p>å› æ­¤ä¸ºäº†æ§åˆ¶å®ƒä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå‡½æ•°åŒ…è£¹ç€å®ƒï¼Œåœ¨éœ€è¦å®ƒæ‰§è¡Œçš„æ—¶å€™ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">runP1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ç«‹å³æ‰“å°&quot;</span>));</span><br><span class="line">  <span class="keyword">return</span> p1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">runP1</span>(); <span class="comment">// è°ƒç”¨æ­¤å‡½æ•°æ—¶æ‰æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>

<p>OK ğŸ‘Œï¼Œ è®©æˆ‘ä»¬å›å½’æ­£é¢˜ã€‚</p>
<p>ç°åœ¨æ¥æ„å»ºè¿™ä¹ˆä¸€ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">runAsync</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">r</span>(x, <span class="variable language_">console</span>.<span class="title function_">log</span>(x)), <span class="number">1000</span>));</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°ä¼ å…¥ä¸€ä¸ªå€¼ xï¼Œè°ƒç”¨ runAsync(x)ç„¶åé—´éš”ä¸€ç§’åæ‰“å°å‡ºè¿™ä¸ª xã€‚</p>
<p>å¦‚æœæˆ‘ç”¨.all()æ¥æ‰§è¡Œå®ƒä¼šæ€æ ·å‘¢ï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">runAsync</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">r</span>(x, <span class="variable language_">console</span>.<span class="title function_">log</span>(x)), <span class="number">1000</span>));</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([<span class="title function_">runAsync</span>(<span class="number">1</span>), <span class="title function_">runAsync</span>(<span class="number">2</span>), <span class="title function_">runAsync</span>(<span class="number">3</span>)]).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>å…ˆæ¥æƒ³æƒ³æ­¤æ®µä»£ç åœ¨æµè§ˆå™¨ä¸­ä¼šå¦‚ä½•æ‰§è¡Œï¼Ÿ</p>
<p>æ²¡é”™ï¼Œå½“ä½ æ‰“å¼€é¡µé¢çš„æ—¶å€™ï¼Œåœ¨é—´éš”ä¸€ç§’åï¼Œæ§åˆ¶å°ä¼šåŒæ—¶æ‰“å°å‡º 1, 2, 3ï¼Œè¿˜æœ‰ä¸€ä¸ªæ•°ç»„[1, 2, 3]ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>;</span><br><span class="line"><span class="number">2</span>;</span><br><span class="line">(<span class="number">3</span>)[(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)];</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ä½ ç°åœ¨èƒ½ç†è§£è¿™å¥è¯çš„æ„æ€äº†å—ï¼šæœ‰äº† allï¼Œä½ å°±å¯ä»¥å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå¼‚æ­¥æ“ä½œï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ªå›è°ƒä¸­å¤„ç†æ‰€æœ‰çš„è¿”å›æ•°æ®ã€‚</p>
<p>.all()åé¢çš„.then()é‡Œçš„å›è°ƒå‡½æ•°æ¥æ”¶çš„å°±æ˜¯æ‰€æœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœã€‚</p>
<p>è€Œä¸”è¿™ä¸ªç»“æœä¸­æ•°ç»„çš„é¡ºåºå’Œ Promise.all()æ¥æ”¶åˆ°çš„æ•°ç»„é¡ºåºä¸€è‡´ï¼ï¼ï¼</p>
<p>ğŸ‘£ æœ‰ä¸€ä¸ªåœºæ™¯æ˜¯å¾ˆé€‚åˆç”¨è¿™ä¸ªçš„ï¼Œä¸€äº›æ¸¸æˆç±»çš„ç´ ææ¯”è¾ƒå¤šçš„åº”ç”¨ï¼Œæ‰“å¼€ç½‘é¡µæ—¶ï¼Œé¢„å…ˆåŠ è½½éœ€è¦ç”¨åˆ°çš„å„ç§èµ„æºå¦‚å›¾ç‰‡ã€flash ä»¥åŠå„ç§é™æ€æ–‡ä»¶ã€‚æ‰€æœ‰çš„éƒ½åŠ è½½å®Œåï¼Œæˆ‘ä»¬å†è¿›è¡Œé¡µé¢çš„åˆå§‹åŒ–ã€‚</p>
<h5 id="4-2-é¢˜ç›®äºŒ"><a href="#4-2-é¢˜ç›®äºŒ" class="headerlink" title="4.2 é¢˜ç›®äºŒ"></a>4.2 é¢˜ç›®äºŒ</h5><p>æˆ‘æ–°å¢äº†ä¸€ä¸ª runReject å‡½æ•°ï¼Œå®ƒç”¨æ¥åœ¨ 1000 * x ç§’å reject ä¸€ä¸ªé”™è¯¯ã€‚<br>åŒæ—¶.catch()å‡½æ•°èƒ½å¤Ÿæ•è·åˆ°.all()é‡Œæœ€å…ˆçš„é‚£ä¸ªå¼‚å¸¸ï¼Œå¹¶ä¸”åªæ‰§è¡Œä¸€æ¬¡ã€‚</p>
<p>æƒ³æƒ³è¿™é“é¢˜ä¼šæ€æ ·æ‰§è¡Œå‘¢ ğŸ¤”ï¸ï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">runAsync</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">r</span>(x, <span class="variable language_">console</span>.<span class="title function_">log</span>(x)), <span class="number">1000</span>));</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">runReject</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">res, rej</span>) =&gt;</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">rej</span>(<span class="string">`Error: <span class="subst">$&#123;x&#125;</span>`</span>, <span class="variable language_">console</span>.<span class="title function_">log</span>(x)), <span class="number">1000</span> * x)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([<span class="title function_">runAsync</span>(<span class="number">1</span>), <span class="title function_">runReject</span>(<span class="number">4</span>), <span class="title function_">runAsync</span>(<span class="number">3</span>), <span class="title function_">runReject</span>(<span class="number">2</span>)])</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res, <span class="string">&quot;a&quot;</span>))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err, <span class="string">&quot;b&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>ä¸å–å…³å­äº† ğŸ˜ï¼Œè®©æˆ‘æ¥å…¬å¸ƒç­”æ¡ˆï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="comment">// 2såè¾“å‡º:</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="title class_">Error</span>: <span class="number">2</span> b</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4såè¾“å‡º:</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>æ²¡é”™ï¼Œå°±åƒæˆ‘ä¹‹å‰è¯´çš„ï¼Œ.catch æ˜¯ä¼šæ•è·æœ€å…ˆçš„é‚£ä¸ªå¼‚å¸¸ï¼Œåœ¨è¿™é“é¢˜ç›®ä¸­æœ€å…ˆçš„å¼‚å¸¸å°±æ˜¯ runReject(2)çš„ç»“æœã€‚</p>
<p>å¦å¤–ï¼Œ<strong>å¦‚æœä¸€ç»„å¼‚æ­¥æ“ä½œä¸­æœ‰ä¸€ä¸ªå¼‚å¸¸éƒ½ä¸ä¼šè¿›å…¥.then()çš„ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°å‚æ•°ä¸­</strong>ã€‚</p>
<p>æ³¨æ„ï¼Œä¸ºä»€ä¹ˆä¸è¯´æ˜¯ä¸è¿›å…¥.then()ä¸­å‘¢ ğŸ¤”ï¸ï¼Ÿ</p>
<p>å“ˆå“ˆï¼Œå¤§å®¶åˆ«å¿˜äº†.then()æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿæ˜¯å¯ä»¥æ•è·é”™è¯¯çš„ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([<span class="title function_">runAsync</span>(<span class="number">1</span>), <span class="title function_">runReject</span>(<span class="number">4</span>), <span class="title function_">runAsync</span>(<span class="number">3</span>), <span class="title function_">runReject</span>(<span class="number">2</span>)]).<span class="title function_">then</span>(</span><br><span class="line">  <span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res),</span><br><span class="line">  <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="4-3-é¢˜ç›®ä¸‰"><a href="#4-3-é¢˜ç›®ä¸‰" class="headerlink" title="4.3 é¢˜ç›®ä¸‰"></a>4.3 é¢˜ç›®ä¸‰</h5><p>.race()æ–¹æ³•ï¼Œå®ƒåªä¼šè·å–æœ€å…ˆæ‰§è¡Œå®Œæˆçš„é‚£ä¸ªç»“æœï¼Œå…¶å®ƒçš„å¼‚æ­¥ä»»åŠ¡è™½ç„¶ä¹Ÿä¼šç»§ç»­è¿›è¡Œä¸‹å»ï¼Œä¸è¿‡ race å·²ç»ä¸ç®¡é‚£äº›ä»»åŠ¡çš„ç»“æœäº†ã€‚</p>
<p>æ¥ï¼Œæ”¹é€ ä¸€ä¸‹ 4.1 è¿™é“é¢˜ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">runAsync</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">r</span>(x, <span class="variable language_">console</span>.<span class="title function_">log</span>(x)), <span class="number">1000</span>));</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">race</span>([<span class="title function_">runAsync</span>(<span class="number">1</span>), <span class="title function_">runAsync</span>(<span class="number">2</span>), <span class="title function_">runAsync</span>(<span class="number">3</span>)])</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result: &quot;</span>, res))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err));</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="string">&#x27;result: &#x27;</span> <span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>ğŸ‘£ è¿™ä¸ª race æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿä½¿ç”¨åœºæ™¯è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ç”¨ race ç»™æŸä¸ªå¼‚æ­¥è¯·æ±‚è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå¹¶ä¸”åœ¨è¶…æ—¶åæ‰§è¡Œç›¸åº”çš„æ“ä½œ</p>
<h5 id="4-4-é¢˜ç›®å››"><a href="#4-4-é¢˜ç›®å››" class="headerlink" title="4.4 é¢˜ç›®å››"></a>4.4 é¢˜ç›®å››</h5><p>æ”¹é€ ä¸€ä¸‹é¢˜ç›® 4.2ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">runAsync</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">r</span>(x, <span class="variable language_">console</span>.<span class="title function_">log</span>(x)), <span class="number">1000</span>));</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">runReject</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">res, rej</span>) =&gt;</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">rej</span>(<span class="string">`Error: <span class="subst">$&#123;x&#125;</span>`</span>, <span class="variable language_">console</span>.<span class="title function_">log</span>(x)), <span class="number">1000</span> * x)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">race</span>([<span class="title function_">runReject</span>(<span class="number">0</span>), <span class="title function_">runAsync</span>(<span class="number">1</span>), <span class="title function_">runAsync</span>(<span class="number">2</span>), <span class="title function_">runAsync</span>(<span class="number">3</span>)])</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result: &quot;</span>, res))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err));</span><br></pre></td></tr></table></figure>

<p>é‡åˆ°é”™è¯¯çš„è¯ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œåœ¨è¿™é“é¢˜ä¸­ï¼ŒrunReject(0)æœ€å…ˆæ‰§è¡Œå®Œï¼Œæ‰€ä»¥è¿›å…¥äº† catch()ä¸­ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>;</span><br><span class="line">(<span class="string">&quot;Error: 0&quot;</span>);</span><br><span class="line"><span class="number">1</span>;</span><br><span class="line"><span class="number">2</span>;</span><br><span class="line"><span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p><strong>æ€»ç»“</strong>:<br>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹.then()å’Œ.race()å§ï¼ŒğŸ˜„</p>
<ul>
<li>Promise.all()çš„ä½œç”¨æ˜¯æ¥æ”¶ä¸€ç»„å¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åå¹¶è¡Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œåæ‰æ‰§è¡Œå›è°ƒã€‚</li>
<li>.race()çš„ä½œç”¨ä¹Ÿæ˜¯æ¥æ”¶ä¸€ç»„å¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åå¹¶è¡Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œåªä¿ç•™å–ç¬¬ä¸€ä¸ªæ‰§è¡Œå®Œæˆçš„å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå…¶ä»–çš„æ–¹æ³•ä»åœ¨æ‰§è¡Œï¼Œä¸è¿‡æ‰§è¡Œç»“æœä¼šè¢«æŠ›å¼ƒã€‚</li>
<li>Promise.all().then()ç»“æœä¸­æ•°ç»„çš„é¡ºåºå’Œ Promise.all()æ¥æ”¶åˆ°çš„æ•°ç»„é¡ºåºä¸€è‡´ã€‚</li>
</ul>
<h4 id="5-async-await-çš„å‡ é“é¢˜"><a href="#5-async-await-çš„å‡ é“é¢˜" class="headerlink" title="5. async&#x2F;await çš„å‡ é“é¢˜"></a>5. async&#x2F;await çš„å‡ é“é¢˜</h4><p>æ—¢ç„¶è°ˆåˆ°äº† Promiseï¼Œé‚£å°±è‚¯å®šå¾—å†è¯´è¯´ async&#x2F;awaitï¼Œåœ¨å¾ˆå¤šæ—¶å€™ async å’Œ Promise çš„è§£æ³•å·®ä¸å¤šï¼Œåˆæœ‰äº›ä¸ä¸€æ ·ã€‚ä¸ä¿¡ä½ æ¥çœ‹çœ‹é¢˜ç›®ä¸€ã€‚</p>
<h5 id="5-1-é¢˜ç›®ä¸€"><a href="#5-1-é¢˜ç›®ä¸€" class="headerlink" title="5.1 é¢˜ç›®ä¸€"></a>5.1 é¢˜ç›®ä¸€</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 start&quot;</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">async2</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async2&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start1&quot;</span>);</span><br><span class="line"><span class="title function_">async1</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start2&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ç­”æ¡ˆï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;start1&quot;</span>;</span><br><span class="line"><span class="string">&quot;async1 start&quot;</span>;</span><br><span class="line"><span class="string">&quot;async2&quot;</span>;</span><br><span class="line"><span class="string">&quot;start2&quot;</span>;</span><br><span class="line"><span class="string">&quot;async1 end&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>è¿‡ç¨‹åˆ†æï¼š</p>
<ul>
<li>é¦–å…ˆä¸€è¿›æ¥æ˜¯åˆ›å»ºäº†ä¸¤ä¸ªå‡½æ•°çš„ï¼Œæˆ‘ä»¬å…ˆä¸çœ‹å‡½æ•°çš„åˆ›å»ºä½ç½®ï¼Œè€Œæ˜¯çœ‹å®ƒçš„è°ƒç”¨ä½ç½®</li>
<li>å‘ç° async1 å‡½æ•°è¢«è°ƒç”¨äº†ï¼Œç„¶åå»çœ‹çœ‹è°ƒç”¨çš„å†…å®¹</li>
<li>æ‰§è¡Œå‡½æ•°ä¸­çš„åŒæ­¥ä»£ç  async1 startï¼Œä¹‹åç¢°åˆ°äº† awaitï¼Œå®ƒä¼šé˜»å¡ async1 åé¢ä»£ç çš„æ‰§è¡Œï¼Œå› æ­¤ä¼šå…ˆå»æ‰§è¡Œ async2 ä¸­çš„åŒæ­¥ä»£ç  async2ï¼Œç„¶åè·³å‡º async1</li>
<li>è·³å‡º async1 å‡½æ•°åï¼Œæ‰§è¡ŒåŒæ­¥ä»£ç  start</li>
<li>åœ¨ä¸€è½®å®ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œä¹‹åï¼Œå†æ¥æ‰§è¡Œåˆšåˆš await åé¢çš„å†…å®¹ async1 endã€‚<br>ï¼ˆåœ¨è¿™é‡Œï¼Œä½ å¯ä»¥ç†è§£ä¸º await åé¢çš„å†…å®¹å°±ç›¸å½“äºæ”¾åˆ°äº† Promise.then çš„é‡Œé¢ï¼‰</li>
</ul>
<p>æ¥çœ‹çœ‹åŒºåˆ«ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ await async2()æ¢æˆä¸€ä¸ª new Promise å‘¢ï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 start&quot;</span>);</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">async1</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;async1 start&quot;</span>;</span><br><span class="line"><span class="string">&quot;promise&quot;</span>;</span><br><span class="line"><span class="string">&quot;async1 end&quot;</span>;</span><br><span class="line"><span class="string">&quot;start&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ° new Promise()å¹¶ä¸ä¼šé˜»å¡åé¢çš„åŒæ­¥ä»£ç  async1 end çš„æ‰§è¡Œã€‚</p>
<h5 id="5-2-é¢˜ç›®äºŒ"><a href="#5-2-é¢˜ç›®äºŒ" class="headerlink" title="5.2 é¢˜ç›®äºŒ"></a>5.2 é¢˜ç›®äºŒ</h5><p>ç°åœ¨å°† async ç»“åˆå®šæ—¶å™¨çœ‹çœ‹ã€‚</p>
<p>ç»™é¢˜ç›®ä¸€ä¸­çš„ async2 å‡½æ•°ä¸­åŠ ä¸Šä¸€ä¸ªå®šæ—¶å™¨ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 start&quot;</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">async2</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async2&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">async1</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æ²¡é”™ï¼Œå®šæ—¶å™¨å§‹ç»ˆè¿˜æ˜¯æœ€åæ‰§è¡Œçš„ï¼Œå®ƒè¢«æ”¾åˆ°ä¸‹ä¸€æ¡å®ä»»åŠ¡çš„å»¶è¿Ÿé˜Ÿåˆ—ä¸­ã€‚</p>
<p>ç­”æ¡ˆï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;async1 start&quot;</span>;</span><br><span class="line"><span class="string">&quot;async2&quot;</span>;</span><br><span class="line"><span class="string">&quot;start&quot;</span>;</span><br><span class="line"><span class="string">&quot;async1 end&quot;</span>;</span><br><span class="line"><span class="string">&quot;timer&quot;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="5-3-é¢˜ç›®ä¸‰"><a href="#5-3-é¢˜ç›®ä¸‰" class="headerlink" title="5.3 é¢˜ç›®ä¸‰"></a>5.3 é¢˜ç›®ä¸‰</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 start&quot;</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">async2</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 end&quot;</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer1&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer2&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async2&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">async1</span>();</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer3&quot;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æ€è€ƒä¸€ä¸‹ ğŸ¤”ï¼Œæ‰§è¡Œç»“æœä¼šæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å…¶å®å¦‚æœä½ èƒ½åšåˆ°è¿™é‡Œäº†ï¼Œè¯´æ˜ä½ å‰é¢çš„é‚£äº›çŸ¥è¯†ç‚¹ä¹Ÿéƒ½æŒæ¡äº†ï¼Œæˆ‘å°±ä¸éœ€è¦å¤ªè¿‡è¯¦ç»†çš„æ­¥éª¤åˆ†æäº†ã€‚</p>
<p>ç›´æ¥å…¬å¸ƒç­”æ¡ˆå§ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;async1 start&quot;</span>;</span><br><span class="line"><span class="string">&quot;async2&quot;</span>;</span><br><span class="line"><span class="string">&quot;start&quot;</span>;</span><br><span class="line"><span class="string">&quot;async1 end&quot;</span>;</span><br><span class="line"><span class="string">&quot;timer2&quot;</span>;</span><br><span class="line"><span class="string">&quot;timer3&quot;</span>;</span><br><span class="line"><span class="string">&quot;timer1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>å®šæ—¶å™¨è°å…ˆæ‰§è¡Œï¼Œä½ åªéœ€è¦å…³æ³¨è°å…ˆè¢«è°ƒç”¨çš„ä»¥åŠå»¶è¿Ÿæ—¶é—´æ˜¯å¤šå°‘ï¼Œè¿™é“é¢˜ä¸­å»¶è¿Ÿæ—¶é—´éƒ½æ˜¯ 0ï¼Œæ‰€ä»¥åªè¦å…³æ³¨è°å…ˆè¢«è°ƒç”¨çš„ã€‚ã€‚</p>
<h5 id="5-4-é¢˜ç›®å››"><a href="#5-4-é¢˜ç›®å››" class="headerlink" title="5.4 é¢˜ç›®å››"></a>5.4 é¢˜ç›®å››</h5><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œasync ä¸­çš„ await å‘½ä»¤æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè¿”å›è¯¥å¯¹è±¡çš„ç»“æœã€‚</p>
<p>ä½†å¦‚æœä¸æ˜¯ Promise å¯¹è±¡çš„è¯ï¼Œå°±ä¼šç›´æ¥è¿”å›å¯¹åº”çš„å€¼ï¼Œç›¸å½“äº Promise.resolve()</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// return await 1234</span></span><br><span class="line">  <span class="comment">// ç­‰åŒäº</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res));</span><br></pre></td></tr></table></figure>

<p>ç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">123</span>;</span><br></pre></td></tr></table></figure>

<h5 id="5-5-é¢˜ç›®äº”"><a href="#5-5-é¢˜ç›®äº”" class="headerlink" title="5.5 é¢˜ç›®äº”"></a>5.5 é¢˜ç›®äº”</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 start&quot;</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 success&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;async1 end&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;srcipt start&quot;</span>);</span><br><span class="line"><span class="title function_">async1</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;srcipt end&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>åœ¨ async1 ä¸­ await åé¢çš„ Promise æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„çŠ¶æ€å§‹ç»ˆæ˜¯ pending çŠ¶æ€ï¼Œå› æ­¤ç›¸å½“äºä¸€ç›´åœ¨ awaitï¼Œawaitï¼Œawait å´å§‹ç»ˆæ²¡æœ‰å“åº”â€¦</p>
<p>æ‰€ä»¥åœ¨ await ä¹‹åçš„å†…å®¹æ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œä¹ŸåŒ…æ‹¬ async1 åé¢çš„ .thenã€‚</p>
<p>ç­”æ¡ˆä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;script start&quot;</span>;</span><br><span class="line"><span class="string">&quot;async1 start&quot;</span>;</span><br><span class="line"><span class="string">&quot;promise1&quot;</span>;</span><br><span class="line"><span class="string">&quot;script end&quot;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="5-6-é¢˜ç›®å…­"><a href="#5-6-é¢˜ç›®å…­" class="headerlink" title="5.6 é¢˜ç›®å…­"></a>5.6 é¢˜ç›®å…­</h5><p>è®©æˆ‘ä»¬ç»™ 5.5 ä¸­çš„ Promise åŠ ä¸Š resolveï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 start&quot;</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise33&quot;</span>);</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;promise22 resolve&quot;</span>);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res, <span class="string">&quot;55&quot;</span>));</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async11 success&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;async1 end&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;srcipt start&quot;</span>);</span><br><span class="line"><span class="title function_">async1</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res, <span class="string">&quot;44&quot;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;srcipt end&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ Promise æœ‰äº†è¿”å›å€¼äº†ï¼Œå› æ­¤ await åé¢çš„å†…å®¹å°†ä¼šè¢«æ‰§è¡Œï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">srcipt start</span><br><span class="line">async1 start</span><br><span class="line">promise33</span><br><span class="line">srcipt end</span><br><span class="line">promise22 resolve <span class="number">55</span></span><br><span class="line">async11 success</span><br><span class="line">async1 end <span class="number">44</span></span><br></pre></td></tr></table></figure>

<h5 id="5-7-é¢˜ç›®ä¸ƒ"><a href="#5-7-é¢˜ç›®ä¸ƒ" class="headerlink" title="5.7 é¢˜ç›®ä¸ƒ"></a>5.7 é¢˜ç›®ä¸ƒ</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 start&quot;</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>);</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;promise resolve&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 success&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;async1 end&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;srcipt start&quot;</span>);</span><br><span class="line"><span class="title function_">async1</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise2&quot;</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜åº”è¯¥ä¹Ÿä¸éš¾ï¼Œä¸è¿‡æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„ï¼Œåœ¨ async1 ä¸­çš„ new Promise å®ƒçš„ resovle çš„å€¼å’Œ async1().then()é‡Œçš„å€¼æ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œå¾ˆå¤šå°ä¼™ä¼´å¯èƒ½çœ‹åˆ° resovle(â€˜promise resolveâ€™)å°±ä¼šè¯¯ä»¥ä¸ºæ˜¯ async1().then()ä¸­çš„è¿”å›å€¼ã€‚</p>
<p>å› æ­¤è¿™é‡Œçš„æ‰§è¡Œç»“æœä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;script start&quot;</span>;</span><br><span class="line"><span class="string">&quot;async1 start&quot;</span>;</span><br><span class="line"><span class="string">&quot;promise1&quot;</span>;</span><br><span class="line"><span class="string">&quot;promise2&quot;</span>;</span><br><span class="line"><span class="string">&quot;async1 success&quot;</span>;</span><br><span class="line"><span class="string">&quot;sync1 end&quot;</span>;</span><br><span class="line"><span class="string">&quot;timer&quot;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="5-8-é¢˜ç›®å…«"><a href="#5-8-é¢˜ç›®å…«" class="headerlink" title="5.8 é¢˜ç›®å…«"></a>5.8 é¢˜ç›®å…«</h5><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€é“å¤´æ¡æ›¾ç»çš„é¢è¯•é¢˜ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 start&quot;</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">async2</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async2&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;script start&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setTimeout&quot;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">async1</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>);</span><br><span class="line">  <span class="title function_">resolve</span>();</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise2&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;script end&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è‡ªä¿¡çš„å†™ä¸‹ä½ ä»¬çš„ç­”æ¡ˆå§ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;script start&quot;</span>;</span><br><span class="line"><span class="string">&quot;async1 start&quot;</span>;</span><br><span class="line"><span class="string">&quot;async2&quot;</span>;</span><br><span class="line"><span class="string">&quot;promise1&quot;</span>;</span><br><span class="line"><span class="string">&quot;script end&quot;</span>;</span><br><span class="line"><span class="string">&quot;async1 end&quot;</span>;</span><br><span class="line"><span class="string">&quot;promise2&quot;</span>;</span><br><span class="line"><span class="string">&quot;setTimeout&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>(è¿™é“é¢˜æœ€å async1 end å’Œ promise2 çš„é¡ºåºå…¶å®åœ¨ç½‘ä¸Šé¥±å—äº‰è®®ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨æµè§ˆå™¨ Chrome V80ï¼ŒNode v12.16.1 çš„æ‰§è¡Œç»“æœéƒ½æ˜¯ä¸Šé¢è¿™ä¸ªç­”æ¡ˆ)</p>
<h5 id="5-9-é¢˜ç›®ä¹"><a href="#5-9-é¢˜ç›®ä¹" class="headerlink" title="5.9 é¢˜ç›®ä¹"></a>5.9 é¢˜ç›®ä¹</h5><p>å¥½çš„ ğŸ‘Œï¼Œasync&#x2F;await å¤§æ³•å·²ç»ƒæˆï¼Œå’±ä»¬ç»§ç»­ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">testSometing</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ‰§è¡ŒtestSometing&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;testSometing&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">testAsync</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ‰§è¡ŒtestAsync&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&quot;hello async&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;test start...&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> v1 = <span class="keyword">await</span> <span class="title function_">testSometing</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(v1);</span><br><span class="line">  <span class="keyword">const</span> v2 = <span class="keyword">await</span> <span class="title function_">testAsync</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(v2);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(v1, v2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise start...&quot;</span>);</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;promise&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">(<span class="params">val</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(val));</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;test end...&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ç­”æ¡ˆï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;test start...&#x27;</span></span><br><span class="line"><span class="string">&#x27;æ‰§è¡ŒtestSometing&#x27;</span></span><br><span class="line"><span class="string">&#x27;promise start...&#x27;</span></span><br><span class="line"><span class="string">&#x27;test end...&#x27;</span></span><br><span class="line"><span class="string">&#x27;testSometing&#x27;</span></span><br><span class="line"><span class="string">&#x27;æ‰§è¡ŒtestAsync&#x27;</span></span><br><span class="line"><span class="string">&#x27;promise&#x27;</span></span><br><span class="line"><span class="string">&#x27;hello async&#x27;</span></span><br><span class="line"><span class="string">&#x27;testSometing&#x27;</span> <span class="string">&#x27;hello async&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="6-async-å¤„ç†é”™è¯¯"><a href="#6-async-å¤„ç†é”™è¯¯" class="headerlink" title="6. async å¤„ç†é”™è¯¯"></a>6. async å¤„ç†é”™è¯¯</h4><h5 id="6-1-é¢˜ç›®ä¸€"><a href="#6-1-é¢˜ç›®ä¸€" class="headerlink" title="6.1 é¢˜ç›®ä¸€"></a>6.1 é¢˜ç›®ä¸€</h5><p>åœ¨ async ä¸­ï¼Œå¦‚æœ await åé¢çš„å†…å®¹æ˜¯ä¸€ä¸ªå¼‚å¸¸æˆ–è€…é”™è¯¯çš„è¯ï¼Œä¼šæ€æ ·å‘¢ï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">async2</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;async1 success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async2&quot;</span>);</span><br><span class="line">    <span class="title function_">reject</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">async1</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res));</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚è¿™é“é¢˜ä¸­ï¼Œawait åé¢è·Ÿç€çš„æ˜¯ä¸€ä¸ªçŠ¶æ€ä¸º rejected çš„ promiseã€‚</p>
<p>å¦‚æœåœ¨ async å‡½æ•°ä¸­æŠ›å‡ºäº†é”™è¯¯ï¼Œåˆ™ç»ˆæ­¢é”™è¯¯ç»“æœï¼Œä¸ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚</p>
<p>æ‰€ä»¥ç­”æ¡ˆä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;async2&#x27;</span></span><br><span class="line"><span class="title class_">Uncaught</span> (<span class="keyword">in</span> promise) error</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ”¹ä¸º throw new Error ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1&quot;</span>);</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;error!!!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;async1 success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">async1</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res));</span><br></pre></td></tr></table></figure>

<p>ç»“æœä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;async1&#x27;</span></span><br><span class="line"><span class="title class_">Uncaught</span> (<span class="keyword">in</span> promise) <span class="title class_">Error</span>: error!!!</span><br></pre></td></tr></table></figure>

<h5 id="6-2-é¢˜ç›®äºŒ"><a href="#6-2-é¢˜ç›®äºŒ" class="headerlink" title="6.2 é¢˜ç›®äºŒ"></a>6.2 é¢˜ç›®äºŒ</h5><p>å¦‚æœæƒ³è¦ä½¿å¾—é”™è¯¯çš„åœ°æ–¹ä¸å½±å“ async å‡½æ•°åç»­çš„æ‰§è¡Œçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ try catch</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&quot;error!!!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&quot;async1 success&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">async1</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;script start&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ç»“æœä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;script start&quot;</span>;</span><br><span class="line"><span class="string">&quot;error!!!&quot;</span>;</span><br><span class="line"><span class="string">&quot;async1&quot;</span>;</span><br><span class="line"><span class="string">&quot;async1 success&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ä½ å¯ä»¥ç›´æ¥åœ¨ Promise.reject åé¢è·Ÿç€ä¸€ä¸ª catch()æ–¹æ³•ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// try &#123;</span></span><br><span class="line">  <span class="comment">//   await Promise.reject(&#x27;error!!!&#x27;)</span></span><br><span class="line">  <span class="comment">// &#125; catch(e) &#123;</span></span><br><span class="line">  <span class="comment">//   console.log(e)</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&quot;error!!!&quot;</span>).<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(e));</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&quot;async1 success&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">async1</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;script start&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœæ˜¯ä¸€æ ·çš„ã€‚</p>
<h4 id="7-ç»¼åˆé¢˜"><a href="#7-ç»¼åˆé¢˜" class="headerlink" title="7. ç»¼åˆé¢˜"></a>7. ç»¼åˆé¢˜</h4><h5 id="7-1-é¢˜ç›®ä¸€"><a href="#7-1-é¢˜ç›®ä¸€" class="headerlink" title="7.1 é¢˜ç›®ä¸€"></a>7.1 é¢˜ç›®ä¸€</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">first</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">7</span>);</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>);</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="number">6</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(p);</span><br><span class="line">      &#125;, <span class="number">0</span>);</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">2</span>);</span><br><span class="line">    p.<span class="title function_">then</span>(<span class="function">(<span class="params">arg</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(arg);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">first</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">arg</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(arg);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>è¿‡ç¨‹åˆ†æï¼š</p>
<ul>
<li>ç¬¬ä¸€æ®µä»£ç å®šä¹‰çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—çœ‹çœ‹å®ƒæ˜¯åœ¨å“ªæ‰§è¡Œçš„ï¼Œå‘ç°å®ƒåœ¨ 4 ä¹‹å‰ï¼Œæ‰€ä»¥å¯ä»¥æ¥çœ‹çœ‹ first å‡½æ•°é‡Œé¢çš„å†…å®¹äº†ã€‚(è¿™ä¸€æ­¥æœ‰ç‚¹ç±»ä¼¼äºé¢˜ç›® 1.5)</li>
<li>å‡½æ•° first è¿”å›çš„æ˜¯ä¸€ä¸ª new Promise()ï¼Œå› æ­¤å…ˆæ‰§è¡Œé‡Œé¢çš„åŒæ­¥ä»£ç  3</li>
<li>æ¥ç€åˆé‡åˆ°äº†ä¸€ä¸ª new Promise()ï¼Œç›´æ¥æ‰§è¡Œé‡Œé¢çš„åŒæ­¥ä»£ç  7</li>
<li>æ‰§è¡Œå®Œ 7 ä¹‹åï¼Œåœ¨ p ä¸­ï¼Œé‡åˆ°äº†ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå…ˆå°†å®ƒæ”¾åˆ°ä¸‹ä¸€ä¸ªå®ä»»åŠ¡é˜Ÿåˆ—é‡Œä¸ç®¡å®ƒï¼Œæ¥ç€å‘ä¸‹èµ°</li>
<li>ç¢°åˆ°äº† resolve(1)ï¼Œè¿™é‡Œå°±æŠŠ p çš„çŠ¶æ€æ”¹ä¸ºäº† resolvedï¼Œä¸”è¿”å›å€¼ä¸º 1ï¼Œä¸è¿‡è¿™é‡Œä¹Ÿå…ˆä¸æ‰§è¡Œ</li>
<li>è·³å‡º pï¼Œç¢°åˆ°äº† resolve(2)ï¼Œè¿™é‡Œçš„ resolve(2)ï¼Œè¡¨ç¤ºçš„æ˜¯æŠŠ first å‡½æ•°è¿”å›çš„é‚£ä¸ª Promise çš„çŠ¶æ€æ”¹äº†ï¼Œä¹Ÿå…ˆä¸ç®¡å®ƒã€‚</li>
<li>ç„¶åç¢°åˆ°äº† p.thenï¼Œå°†å®ƒåŠ å…¥æœ¬æ¬¡å¾ªç¯çš„å¾®ä»»åŠ¡åˆ—è¡¨ï¼Œç­‰å¾…æ‰§è¡Œ</li>
<li>è·³å‡º first å‡½æ•°ï¼Œé‡åˆ°äº† first().then()ï¼Œå°†å®ƒåŠ å…¥æœ¬æ¬¡å¾ªç¯çš„å¾®ä»»åŠ¡åˆ—è¡¨(p.then çš„åé¢æ‰§è¡Œ)</li>
<li>ç„¶åæ‰§è¡ŒåŒæ­¥ä»£ç  4</li>
<li>æœ¬è½®çš„åŒæ­¥ä»£ç å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼ŒæŸ¥æ‰¾å¾®ä»»åŠ¡åˆ—è¡¨ï¼Œå‘ç° p.then å’Œ first().then()ï¼Œä¾æ¬¡æ‰§è¡Œï¼Œæ‰“å°å‡º 1 å’Œ 2</li>
<li>æœ¬è½®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•äº†ï¼Œå‘ç°è¿˜æœ‰ä¸€ä¸ªå®šæ—¶å™¨æ²¡æœ‰è·‘å®Œï¼Œæ¥ç€æ‰§è¡Œè¿™ä¸ªå®šæ—¶å™¨é‡Œçš„å†…å®¹ï¼Œæ‰§è¡ŒåŒæ­¥ä»£ç  5</li>
<li>ç„¶ååˆé‡åˆ°äº†ä¸€ä¸ª resolve(6)ï¼Œå®ƒæ˜¯æ”¾åœ¨ p é‡Œçš„ï¼Œä½†æ˜¯ p çš„çŠ¶æ€åœ¨ä¹‹å‰å·²ç»å‘ç”Ÿè¿‡æ”¹å˜äº†ï¼Œ- å› æ­¤è¿™é‡Œå°±ä¸ä¼šå†æ”¹å˜ï¼Œä¹Ÿå°±æ˜¯è¯´ resolve(6)ç›¸å½“äºæ²¡ä»»ä½•ç”¨å¤„ï¼Œå› æ­¤æ‰“å°å‡ºæ¥çš„ p ä¸º<code>Promise&#123;&lt;resolved&gt;: 1&#125;</code>ã€‚(è¿™ä¸€æ­¥ç±»ä¼¼äºé¢˜ç›® 3.1)</li>
</ul>
<p>ç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="title class_">Promise</span>&#123;&lt;resolved&gt;: <span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure>

<h5 id="7-2-é¢˜ç›®äºŒ"><a href="#7-2-é¢˜ç›®äºŒ" class="headerlink" title="7.2 é¢˜ç›®äºŒ"></a>7.2 é¢˜ç›®äºŒ</h5><h6 id="A"><a href="#A" class="headerlink" title="A"></a>A</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">async1</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1&quot;</span>); <span class="comment">//2</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer1&quot;</span>); <span class="comment">//h1 - 2s 8</span></span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>); <span class="comment">//3</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 end&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;async1 success&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;script start&quot;</span>); <span class="comment">//1</span></span><br><span class="line"><span class="title function_">async1</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;script end&quot;</span>); <span class="comment">//4</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">1</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="number">2</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">3</span>))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="number">4</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res)); <span class="comment">//w1 5-1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer2&quot;</span>); <span class="comment">//h2 - 1s 6</span></span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„çš„çŸ¥è¯†ç‚¹ï¼š</p>
<ul>
<li>async å‡½æ•°ä¸­ await çš„ new Promise è¦æ˜¯æ²¡æœ‰è¿”å›å€¼çš„è¯åˆ™ä¸æ‰§è¡Œåé¢çš„å†…å®¹(ç±»ä¼¼é¢˜ 5.5)</li>
<li>.then å‡½æ•°ä¸­çš„å‚æ•°æœŸå¾…çš„æ˜¯å‡½æ•°ï¼Œå¦‚æœä¸æ˜¯å‡½æ•°çš„è¯ä¼šå‘ç”Ÿç©¿é€(ç±»ä¼¼é¢˜ 3.8 )</li>
<li>æ³¨æ„å®šæ—¶å™¨çš„å»¶è¿Ÿæ—¶é—´</li>
</ul>
<p>å› æ­¤æœ¬é¢˜ç­”æ¡ˆä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;script start&quot;</span>;</span><br><span class="line"><span class="string">&quot;async1&quot;</span>;</span><br><span class="line"><span class="string">&quot;promise1&quot;</span>;</span><br><span class="line"><span class="string">&quot;script end&quot;</span>;</span><br><span class="line"><span class="number">1</span>;</span><br><span class="line">(<span class="string">&quot;timer2&quot;</span>);</span><br><span class="line">(<span class="string">&quot;timer1&quot;</span>);</span><br></pre></td></tr></table></figure>

<h6 id="B"><a href="#B" class="headerlink" title="B"></a>B</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">async1</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1&quot;</span>); <span class="comment">//2</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer1&quot;</span>); <span class="comment">//h1 - 2s 9</span></span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>); <span class="comment">//3</span></span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 end&quot;</span>); <span class="comment">//w1 5</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;async1 success&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;script start&quot;</span>); <span class="comment">//1</span></span><br><span class="line"><span class="title function_">async1</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res)); <span class="comment">//w2 6async1 success</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;script end&quot;</span>); <span class="comment">//4</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">1</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="number">2</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">3</span>))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="number">4</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res)); <span class="comment">//w3 7 1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer2&quot;</span>); <span class="comment">//h2 - 1s 8</span></span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<p>ç­”æ¡ˆï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">script start</span><br><span class="line">async1</span><br><span class="line">promise1</span><br><span class="line">script end</span><br><span class="line">async1 end</span><br><span class="line">async1 success</span><br><span class="line"><span class="number">1</span></span><br><span class="line">timer2</span><br><span class="line">timer1</span><br></pre></td></tr></table></figure>

<h5 id="7-3-é¢˜ç›®ä¸‰"><a href="#7-3-é¢˜ç›®ä¸‰" class="headerlink" title="7.3 é¢˜ç›®ä¸‰"></a>7.3 é¢˜ç›®ä¸‰</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;resolve3&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer1&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;resovle1&quot;</span>);</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;resolve2&quot;</span>);</span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(p1);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">finally</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;finally&quot;</span>, res);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„çš„çŸ¥è¯†ç‚¹ï¼š</p>
<ul>
<li>Promise çš„çŠ¶æ€ä¸€æ—¦æ”¹å˜å°±æ— æ³•æ”¹å˜(ç±»ä¼¼é¢˜ç›® 3.5)</li>
<li>finally ä¸ç®¡ Promise çš„çŠ¶æ€æ˜¯ resolved è¿˜æ˜¯ rejected éƒ½ä¼šæ‰§è¡Œï¼Œä¸”å®ƒçš„å›è°ƒå‡½æ•°æ˜¯æ²¡æœ‰å‚æ•°çš„(ç±»ä¼¼ 3.10)</li>
</ul>
<p>ç­”æ¡ˆï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;resolve1&#x27;</span></span><br><span class="line"><span class="string">&#x27;finally&#x27;</span> <span class="literal">undefined</span></span><br><span class="line"><span class="string">&#x27;timer1&#x27;</span></span><br><span class="line"><span class="title class_">Promise</span>&#123;&lt;resolved&gt;: <span class="literal">undefined</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-å‡ é“å¤§å‚çš„é¢è¯•é¢˜"><a href="#8-å‡ é“å¤§å‚çš„é¢è¯•é¢˜" class="headerlink" title="8. å‡ é“å¤§å‚çš„é¢è¯•é¢˜"></a>8. å‡ é“å¤§å‚çš„é¢è¯•é¢˜</h4><h5 id="8-1-ä½¿ç”¨-Promise-å®ç°æ¯éš”-1-ç§’è¾“å‡º-1-2-3"><a href="#8-1-ä½¿ç”¨-Promise-å®ç°æ¯éš”-1-ç§’è¾“å‡º-1-2-3" class="headerlink" title="8.1 ä½¿ç”¨ Promise å®ç°æ¯éš” 1 ç§’è¾“å‡º 1,2,3"></a>8.1 ä½¿ç”¨ Promise å®ç°æ¯éš” 1 ç§’è¾“å‡º 1,2,3</h5><p>è¿™é“é¢˜æ¯”è¾ƒç®€å•çš„ä¸€ç§åšæ³•æ˜¯å¯ä»¥ç”¨ Promise é…åˆç€ reduce ä¸åœçš„åœ¨ promise åé¢å åŠ .thenï¼Œè¯·çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a, b);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="variable language_">console</span>.<span class="title function_">log</span>(b));</span><br><span class="line">      &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="title class_">Promise</span>.<span class="title function_">resolve</span>());</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ä½ å¯ä»¥æ›´ç®€å•ä¸€ç‚¹å†™ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">arr.<span class="title function_">reduce</span>(</span><br><span class="line">  <span class="function">(<span class="params">p, x</span>) =&gt;</span></span><br><span class="line">    p.<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">r</span>(<span class="variable language_">console</span>.<span class="title function_">log</span>(x)), <span class="number">1000</span>))),</span><br><span class="line">  <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="8-2-ä½¿ç”¨-Promise-å®ç°çº¢ç»¿ç¯äº¤æ›¿é‡å¤äº®"><a href="#8-2-ä½¿ç”¨-Promise-å®ç°çº¢ç»¿ç¯äº¤æ›¿é‡å¤äº®" class="headerlink" title="8.2 ä½¿ç”¨ Promise å®ç°çº¢ç»¿ç¯äº¤æ›¿é‡å¤äº®"></a>8.2 ä½¿ç”¨ Promise å®ç°çº¢ç»¿ç¯äº¤æ›¿é‡å¤äº®</h5><p>çº¢ç¯ 3 ç§’äº®ä¸€æ¬¡ï¼Œé»„ç¯ 2 ç§’äº®ä¸€æ¬¡ï¼Œç»¿ç¯ 1 ç§’äº®ä¸€æ¬¡ï¼›å¦‚ä½•è®©ä¸‰ä¸ªç¯ä¸æ–­äº¤æ›¿é‡å¤äº®ç¯ï¼Ÿï¼ˆç”¨ Promise å®ç°ï¼‰ä¸‰ä¸ªäº®ç¯å‡½æ•°å·²ç»å­˜åœ¨ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">red</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;red&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">green</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;green&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">yellow</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;yellow&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç­”æ¡ˆï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">red</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;red&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">green</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;green&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">yellow</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;yellow&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> light = <span class="keyword">function</span> (<span class="params">timer, cb</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">cb</span>();</span><br><span class="line">      <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;, timer);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> step = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">light</span>(<span class="number">3000</span>, red);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">light</span>(<span class="number">2000</span>, green);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">light</span>(<span class="number">1000</span>, yellow);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">step</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">step</span>();</span><br></pre></td></tr></table></figure>

<h5 id="8-3-å®ç°-mergePromise-å‡½æ•°"><a href="#8-3-å®ç°-mergePromise-å‡½æ•°" class="headerlink" title="8.3 å®ç° mergePromise å‡½æ•°"></a>8.3 å®ç° mergePromise å‡½æ•°</h5><p>å®ç° mergePromise å‡½æ•°ï¼ŒæŠŠä¼ è¿›å»çš„æ•°ç»„æŒ‰é¡ºåºå…ˆåæ‰§è¡Œï¼Œå¹¶ä¸”æŠŠè¿”å›çš„æ•°æ®å…ˆåæ”¾åˆ°æ•°ç»„ data ä¸­ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">time</span> = (<span class="params">timer</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;, timer);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ajax1</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">  <span class="title function_">time</span>(<span class="number">2000</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ajax2</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">  <span class="title function_">time</span>(<span class="number">1000</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ajax3</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">  <span class="title function_">time</span>(<span class="number">1000</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mergePromise</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// åœ¨è¿™é‡Œå†™ä»£ç </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">mergePromise</span>([ajax1, ajax2, ajax3]).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;done&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data); <span class="comment">// data ä¸º [1, 2, 3]</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¦æ±‚åˆ†åˆ«è¾“å‡º</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"><span class="comment">// done</span></span><br><span class="line"><span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜æœ‰ç‚¹ç±»ä¼¼äº Promise.all()ï¼Œä¸è¿‡.all()ä¸éœ€è¦ç®¡æ‰§è¡Œé¡ºåºï¼Œåªéœ€è¦å¹¶å‘æ‰§è¡Œå°±è¡Œäº†ã€‚ä½†æ˜¯è¿™é‡Œéœ€è¦ç­‰ä¸Šä¸€ä¸ªæ‰§è¡Œå®Œæ¯•ä¹‹åæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ªã€‚</p>
<p>è§£é¢˜æ€è·¯ï¼š</p>
<ul>
<li>å®šä¹‰ä¸€ä¸ªæ•°ç»„ data ç”¨äºä¿å­˜æ‰€æœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœ</li>
<li>åˆå§‹åŒ–ä¸€ä¸ª const promise &#x3D; Promise.resolve()ï¼Œç„¶åå¾ªç¯éå†æ•°ç»„ï¼Œåœ¨ promise åé¢æ·»åŠ æ‰§è¡Œ ajax ä»»åŠ¡ï¼ŒåŒæ—¶è¦å°†æ·»åŠ çš„ç»“æœé‡æ–°èµ‹å€¼åˆ° promise ä¸Šã€‚</li>
</ul>
<p>ç­”æ¡ˆï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mergePromise</span>(<span class="params">ajaxArray</span>) &#123;</span><br><span class="line">  <span class="comment">// å­˜æ”¾æ¯ä¸ªajaxçš„ç»“æœ</span></span><br><span class="line">  <span class="keyword">const</span> data = [];</span><br><span class="line">  <span class="keyword">let</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line">  ajaxArray.<span class="title function_">forEach</span>(<span class="function">(<span class="params">ajax</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡çš„thenä¸ºäº†ç”¨æ¥è°ƒç”¨ajax</span></span><br><span class="line">    <span class="comment">// ç¬¬äºŒæ¬¡çš„thenæ˜¯ä¸ºäº†è·å–ajaxçš„ç»“æœ</span></span><br><span class="line">    promise = promise.<span class="title function_">then</span>(ajax).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      data.<span class="title function_">push</span>(res);</span><br><span class="line">      <span class="keyword">return</span> data; <span class="comment">// æŠŠæ¯æ¬¡çš„ç»“æœè¿”å›</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// æœ€åå¾—åˆ°çš„promiseå®ƒçš„å€¼å°±æ˜¯data</span></span><br><span class="line">  <span class="keyword">return</span> promise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="8-4-æ ¹æ®-promiseA-å®ç°ä¸€ä¸ªè‡ªå·±çš„-promise"><a href="#8-4-æ ¹æ®-promiseA-å®ç°ä¸€ä¸ªè‡ªå·±çš„-promise" class="headerlink" title="8.4 æ ¹æ® promiseA+å®ç°ä¸€ä¸ªè‡ªå·±çš„ promise"></a>8.4 æ ¹æ® promiseA+å®ç°ä¸€ä¸ªè‡ªå·±çš„ promise</h5><p>è¯´çœŸçš„ï¼Œè¿™é“é¢˜è¢«é—®åˆ°çš„æ¦‚ç‡è¿˜æ˜¯æŒºé«˜çš„ï¼Œè€Œä¸”è¦è¯´çš„å†…å®¹ä¹Ÿå¾ˆå¤šâ€¦<br>éœ–å‘†å‘†è¿™é‡Œå·ä¸ªæ‡’ï¼Œä¸æƒ³ç»†è¯´äº†â€¦<br>ä¸è¿‡å“ˆï¼Œæˆ‘ä¿è¯ï¼Œä¸‹ä¸‹é¢˜æˆ‘ä¸€å®šä»”ç»†è¯´ ğŸ˜¼.</p>
<p>æ¥å§ï¼Œç»™ä½ ä»¬ä¸€äº›å¥½çš„å®å…¸ï¼š<br>ã€ŠPromise ä¸ä¼šï¼Ÿï¼Ÿçœ‹è¿™é‡Œï¼ï¼ï¼å²ä¸Šæœ€é€šä¿—æ˜“æ‡‚çš„ Promiseï¼ï¼ï¼ã€‹<br>ã€Šå†™ä¸€ä¸ªç¬¦åˆ Promises&#x2F;A+ è§„èŒƒå¹¶å¯é…åˆ ES7 async&#x2F;await ä½¿ç”¨çš„ Promiseã€‹</p>
<h5 id="8-5-å°è£…ä¸€ä¸ªå¼‚æ­¥åŠ è½½å›¾ç‰‡çš„æ–¹æ³•"><a href="#8-5-å°è£…ä¸€ä¸ªå¼‚æ­¥åŠ è½½å›¾ç‰‡çš„æ–¹æ³•" class="headerlink" title="8.5 å°è£…ä¸€ä¸ªå¼‚æ­¥åŠ è½½å›¾ç‰‡çš„æ–¹æ³•"></a>8.5 å°è£…ä¸€ä¸ªå¼‚æ­¥åŠ è½½å›¾ç‰‡çš„æ–¹æ³•</h5><p>è¿™ä¸ªç›¸å¯¹ç®€å•ä¸€äº›ï¼Œåªéœ€è¦åœ¨å›¾ç‰‡çš„ onload å‡½æ•°ä¸­ï¼Œä½¿ç”¨ resolve è¿”å›ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚</p>
<p>æ¥çœ‹çœ‹å…·ä½“ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">loadImg</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">    img.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ä¸€å¼ å›¾ç‰‡åŠ è½½å®Œæˆ&quot;</span>);</span><br><span class="line">      <span class="title function_">resolve</span>(img);</span><br><span class="line">    &#125;;</span><br><span class="line">    img.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Could not load image at&#x27;</span> + url));</span><br><span class="line">    &#125;;</span><br><span class="line">    img.<span class="property">src</span> = url;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h5 id="8-6-é™åˆ¶å¼‚æ­¥æ“ä½œçš„å¹¶å‘ä¸ªæ•°å¹¶å°½å¯èƒ½å¿«çš„å®Œæˆå…¨éƒ¨"><a href="#8-6-é™åˆ¶å¼‚æ­¥æ“ä½œçš„å¹¶å‘ä¸ªæ•°å¹¶å°½å¯èƒ½å¿«çš„å®Œæˆå…¨éƒ¨" class="headerlink" title="8.6 é™åˆ¶å¼‚æ­¥æ“ä½œçš„å¹¶å‘ä¸ªæ•°å¹¶å°½å¯èƒ½å¿«çš„å®Œæˆå…¨éƒ¨"></a>8.6 é™åˆ¶å¼‚æ­¥æ“ä½œçš„å¹¶å‘ä¸ªæ•°å¹¶å°½å¯èƒ½å¿«çš„å®Œæˆå…¨éƒ¨</h5><p>æœ‰ 8 ä¸ªå›¾ç‰‡èµ„æºçš„ urlï¼Œå·²ç»å­˜å‚¨åœ¨æ•°ç»„ urls ä¸­ã€‚</p>
<p>urls ç±»ä¼¼äº[â€˜<a href="https://image1.png/">https://image1.png</a>â€˜, â€˜<a href="https://image2.png/">https://image2.png</a>â€˜, â€¦.]</p>
<p>è€Œä¸”å·²ç»æœ‰ä¸€ä¸ªå‡½æ•° function loadImgï¼Œè¾“å…¥ä¸€ä¸ª url é“¾æ¥ï¼Œè¿”å›ä¸€ä¸ª Promiseï¼Œè¯¥ Promise åœ¨å›¾ç‰‡ä¸‹è½½å®Œæˆçš„æ—¶å€™ resolveï¼Œä¸‹è½½å¤±è´¥åˆ™ rejectã€‚</p>
<p>ä½†æœ‰ä¸€ä¸ªè¦æ±‚ï¼Œä»»ä½•æ—¶åˆ»åŒæ—¶ä¸‹è½½çš„é“¾æ¥æ•°é‡ä¸å¯ä»¥è¶…è¿‡ 3 ä¸ªã€‚</p>
<p>è¯·å†™ä¸€æ®µä»£ç å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œè¦æ±‚å°½å¯èƒ½å¿«é€Ÿåœ°å°†æ‰€æœ‰å›¾ç‰‡ä¸‹è½½å®Œæˆã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> urls = [</span><br><span class="line">  <span class="string">&quot;https://hexo-blog-1256114407.cos.ap-shenzhen-fsi.myqcloud.com/AboutMe-painting1.png&quot;</span>,</span><br><span class="line">  <span class="string">&quot;https://hexo-blog-1256114407.cos.ap-shenzhen-fsi.myqcloud.com/AboutMe-painting2.png&quot;</span>,</span><br><span class="line">  <span class="string">&quot;https://hexo-blog-1256114407.cos.ap-shenzhen-fsi.myqcloud.com/AboutMe-painting3.png&quot;</span>,</span><br><span class="line">  <span class="string">&quot;https://hexo-blog-1256114407.cos.ap-shenzhen-fsi.myqcloud.com/AboutMe-painting4.png&quot;</span>,</span><br><span class="line">  <span class="string">&quot;https://hexo-blog-1256114407.cos.ap-shenzhen-fsi.myqcloud.com/AboutMe-painting5.png&quot;</span>,</span><br><span class="line">  <span class="string">&quot;https://hexo-blog-1256114407.cos.ap-shenzhen-fsi.myqcloud.com/bpmn6.png&quot;</span>,</span><br><span class="line">  <span class="string">&quot;https://hexo-blog-1256114407.cos.ap-shenzhen-fsi.myqcloud.com/bpmn7.png&quot;</span>,</span><br><span class="line">  <span class="string">&quot;https://hexo-blog-1256114407.cos.ap-shenzhen-fsi.myqcloud.com/bpmn8.png&quot;</span>,</span><br><span class="line">];</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadImg</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">    img.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ä¸€å¼ å›¾ç‰‡åŠ è½½å®Œæˆ&quot;</span>);</span><br><span class="line">      <span class="title function_">resolve</span>(img);</span><br><span class="line">    &#125;;</span><br><span class="line">    img.<span class="property">onerror</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">reject</span>(<span class="title function_">newError</span>(<span class="string">&quot;Could not load image at&quot;</span> + url));</span><br><span class="line">    &#125;;</span><br><span class="line">    img.<span class="property">src</span> = url;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°è¿™é“é¢˜æ—¶ï¼Œæˆ‘æœ€å¼€å§‹çš„æƒ³æ³•æ˜¯ï¼š</p>
<p>æ‹¿åˆ° urlsï¼Œç„¶åå°†è¿™ä¸ªæ•°ç»„æ¯ 3 ä¸ª url ä¸€ç»„åˆ›å»ºæˆä¸€ä¸ªäºŒç»´æ•°ç»„<br>ç„¶åç”¨ Promise.all()æ¯æ¬¡åŠ è½½ä¸€ç»„ urlï¼ˆä¹Ÿå°±æ˜¯å¹¶å‘ 3 ä¸ªï¼‰ï¼Œè¿™ä¸€ç»„åŠ è½½å®Œå†åŠ è½½ä¸‹ä¸€ç»„ã€‚<br>è¿™ä¸ªæƒ³æ³•ä»æŠ€æœ¯ä¸Šè¯´å¹¶ä¸éš¾å®ç°ï¼Œæœ‰ç‚¹ç±»ä¼¼äºç¬¬ä¸‰é¢˜ã€‚ä¸è¿‡ç¼ºç‚¹ä¹Ÿæ˜æ˜¾ï¼Œé‚£å°±æ˜¯æ¯æ¬¡éƒ½è¦ç­‰åˆ°ä¸Šä¸€ç»„å…¨éƒ¨åŠ è½½å®Œä¹‹åï¼Œæ‰åŠ è½½ä¸‹ä¸€ç»„ï¼Œé‚£å¦‚æœä¸Šä¸€ç»„æœ‰ 2 ä¸ªå·²ç»åŠ è½½å®Œäº†ï¼Œè¿˜æœ‰ 1 ä¸ªç‰¹åˆ«æ…¢ï¼Œè¿˜åœ¨åŠ è½½ï¼Œè¦ç­‰è¿™ä¸ªæ…¢çš„ä¹ŸåŠ è½½å®Œæ‰èƒ½è¿›å…¥ä¸‹ä¸€ç»„ã€‚è¿™æ˜æ˜¾ä¼šç…§å¸¸å¡é¡¿ï¼Œå½±å“åŠ è½½æ•ˆç‡ã€‚</p>
<p>ä½†æ˜¯å¼€å§‹æ²¡æœ‰è€ƒè™‘è¿™ä¹ˆå¤šï¼Œå› æ­¤æœ‰äº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬ã€‚</p>
<p>å¦‚æœä½ æœ‰å…´è¶£å¯ä»¥çœ‹çœ‹æƒ³æ³•ä¸€çš„ä»£ç ï¼Œè™½ç„¶å¯¹ä½ æ²¡ä»€ä¹ˆå¸®åŠ©ï¼Œæƒ³ç›´æ¥çŸ¥é“æ¯”è¾ƒå¥½çš„åšæ³•çš„å°ä¼™ä¼´è¯·è·³åˆ°æƒ³æ³•äºŒ</p>
<h6 id="æƒ³æ³•ä¸€-ğŸ’¡ï¼š"><a href="#æƒ³æ³•ä¸€-ğŸ’¡ï¼š" class="headerlink" title="æƒ³æ³•ä¸€ ğŸ’¡ï¼š"></a>æƒ³æ³•ä¸€ ğŸ’¡ï¼š</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">limitLoad</span>(<span class="params">urls, handler, limit</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = []; <span class="comment">// å­˜å‚¨æ‰€æœ‰çš„åŠ è½½ç»“æœ</span></span><br><span class="line">  <span class="keyword">let</span> p = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleUrls</span> = (<span class="params">urls</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªå‡½æ•°æ˜¯ä¸ºäº†ç”Ÿæˆ3ä¸ªurlä¸ºä¸€ç»„çš„äºŒç»´æ•°ç»„</span></span><br><span class="line">    <span class="keyword">const</span> doubleDim = [];</span><br><span class="line">    <span class="keyword">const</span> len = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(urls.<span class="property">length</span> / limit); <span class="comment">// Math.ceil(8 / 3) = 3</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(len); <span class="comment">// 3, è¡¨ç¤ºäºŒç»´æ•°ç»„çš„é•¿åº¦ä¸º3</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">      doubleDim.<span class="title function_">push</span>(urls.<span class="title function_">slice</span>(i * limit, (i + <span class="number">1</span>) * limit));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> doubleDim;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">ajaxImage</span> = (<span class="params">urlCollect</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// å°†ä¸€ç»„å­—ç¬¦ä¸²url è½¬æ¢ä¸ºä¸€ä¸ªåŠ è½½å›¾ç‰‡çš„æ•°ç»„</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(urlCollect);</span><br><span class="line">    <span class="keyword">return</span> urlCollect.<span class="title function_">map</span>(<span class="function">(<span class="params">url</span>) =&gt;</span> <span class="title function_">handler</span>(url));</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> doubleDim = <span class="title function_">handleUrls</span>(urls); <span class="comment">// å¾—åˆ°3ä¸ªurlä¸ºä¸€ç»„çš„äºŒç»´æ•°ç»„</span></span><br><span class="line">  doubleDim.<span class="title function_">forEach</span>(<span class="function">(<span class="params">urlCollect</span>) =&gt;</span> &#123;</span><br><span class="line">    p = p</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(<span class="title function_">ajaxImage</span>(urlCollect)))</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        data.<span class="title function_">push</span>(...res); <span class="comment">// å°†æ¯æ¬¡çš„ç»“æœå±•å¼€ï¼Œå¹¶å­˜å‚¨åˆ°dataä¸­ (resä¸ºï¼š[img, img, img])</span></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">limitLoad</span>(urls, loadImg, <span class="number">3</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// æœ€ç»ˆå¾—åˆ°çš„æ˜¯é•¿åº¦ä¸º8çš„imgæ•°ç»„: [img, img, img, ...]</span></span><br><span class="line">  res.<span class="title function_">forEach</span>(<span class="function">(<span class="params">img</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(img);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h6 id="æƒ³æ³•äºŒ-ğŸ’¡"><a href="#æƒ³æ³•äºŒ-ğŸ’¡" class="headerlink" title="æƒ³æ³•äºŒ ğŸ’¡:"></a>æƒ³æ³•äºŒ ğŸ’¡:</h6><p>å‚è€ƒ LHH å¤§ç¿°ä»”ä»”-Promise é¢è¯•é¢˜</p>
<p>æ—¢ç„¶é¢˜ç›®çš„è¦æ±‚æ˜¯ä¿è¯æ¯æ¬¡å¹¶å‘è¯·æ±‚çš„æ•°é‡ä¸º 3ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…ˆè¯·æ±‚ urls ä¸­çš„å‰é¢ä¸‰ä¸ª(ä¸‹æ ‡ä¸º 0,1,2)ï¼Œå¹¶ä¸”è¯·æ±‚çš„æ—¶å€™ä½¿ç”¨ Promise.race()æ¥åŒæ—¶è¯·æ±‚ï¼Œä¸‰ä¸ªä¸­æœ‰ä¸€ä¸ªå…ˆå®Œæˆäº†(ä¾‹å¦‚ä¸‹æ ‡ä¸º 1 çš„å›¾ç‰‡)ï¼Œæˆ‘ä»¬å°±æŠŠè¿™ä¸ªå½“å‰æ•°ç»„ä¸­å·²ç»å®Œæˆçš„é‚£ä¸€é¡¹(ç¬¬ 1 é¡¹)æ¢æˆè¿˜æ²¡æœ‰è¯·æ±‚çš„é‚£ä¸€é¡¹(urls ä¸­ä¸‹æ ‡ä¸º 3)ã€‚</p>
<p>ç›´åˆ° urls å·²ç»éå†å®Œäº†ï¼Œç„¶åå°†æœ€åä¸‰ä¸ªæ²¡æœ‰å®Œæˆçš„è¯·æ±‚(ä¹Ÿå°±æ˜¯çŠ¶æ€æ²¡æœ‰æ”¹å˜çš„ Promise)ç”¨ Promise.all()æ¥åŠ è½½å®ƒä»¬ã€‚</p>
<p>ä¸å¤šè¯´ï¼Œæµç¨‹å›¾éƒ½ç»™ä½ ç”»å¥½äº†ï¼Œä½ å¯ä»¥ç»“åˆæµç¨‹å›¾å†æ¥çœ‹ä»£ç ã€‚</p>
<p><img src="https://www.daykalif.com/blog_img/promise2.png" alt="promise"></p>
<p>ä¸ºäº†æ–¹ä¾¿ä½ æŸ¥çœ‹ï¼Œæˆ‘æˆªäº†ä¸ªå›¾ï¼Œä¸è¿‡ä»£ç åœ¨åé¢ä¹Ÿæœ‰</p>
<p>(è¯´çœŸçš„ï¼Œè¦æˆ‘çœ‹è¿™ä¸€å¤§é•¿ä¸²ä»£ç æˆ‘ä¹Ÿä¸æ„¿æ„â€¦)</p>
<p><img src="https://www.daykalif.com/blog_img/promise3.png" alt="promise"></p>
<p>ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">limitLoad</span>(<span class="params">urls, handler, limit</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> sequence = [].<span class="title function_">concat</span>(urls); <span class="comment">// å¤åˆ¶urls</span></span><br><span class="line">  <span class="comment">// è¿™ä¸€æ­¥æ˜¯ä¸ºäº†åˆå§‹åŒ– promises è¿™ä¸ª&quot;å®¹å™¨&quot;</span></span><br><span class="line">  <span class="keyword">let</span> promises = sequence.<span class="title function_">splice</span>(<span class="number">0</span>, limit).<span class="title function_">map</span>(<span class="function">(<span class="params">url, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">handler</span>(url).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// è¿”å›ä¸‹æ ‡æ˜¯ä¸ºäº†çŸ¥é“æ•°ç»„ä¸­æ˜¯å“ªä¸€é¡¹æœ€å…ˆå®Œæˆ</span></span><br><span class="line">      <span class="keyword">return</span> index;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// æ³¨æ„è¿™é‡Œè¦å°†æ•´ä¸ªå˜é‡è¿‡ç¨‹è¿”å›ï¼Œè¿™æ ·å¾—åˆ°çš„å°±æ˜¯ä¸€ä¸ªPromiseï¼Œå¯ä»¥åœ¨å¤–é¢é“¾å¼è°ƒç”¨</span></span><br><span class="line">  <span class="keyword">return</span> sequence</span><br><span class="line">    .<span class="title function_">reduce</span>(<span class="function">(<span class="params">pCollect, url</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> pCollect</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">race</span>(promises); <span class="comment">// è¿”å›å·²ç»å®Œæˆçš„ä¸‹æ ‡</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">(<span class="params">fastestIndex</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// è·å–åˆ°å·²ç»å®Œæˆçš„ä¸‹æ ‡</span></span><br><span class="line">          <span class="comment">// å°†&quot;å®¹å™¨&quot;å†…å·²ç»å®Œæˆçš„é‚£ä¸€é¡¹æ›¿æ¢</span></span><br><span class="line">          promises[fastestIndex] = <span class="title function_">handler</span>(url).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> fastestIndex; <span class="comment">// è¦ç»§ç»­å°†è¿™ä¸ªä¸‹æ ‡è¿”å›ï¼Œä»¥ä¾¿ä¸‹ä¸€æ¬¡å˜é‡</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;, <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()) <span class="comment">// åˆå§‹åŒ–ä¼ å…¥</span></span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// æœ€åä¸‰ä¸ªç”¨.allæ¥è°ƒç”¨</span></span><br><span class="line">      returnPromise.<span class="title function_">all</span>(promises);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">limitLoad</span>(urls, loadImg, <span class="number">3</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å›¾ç‰‡å…¨éƒ¨åŠ è½½å®Œæ¯•&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒæ–‡æ¡£ï¼š<br>ã€ŠES6 ä¹‹ Promise å¸¸è§é¢è¯•é¢˜ã€‹<br>ã€Šå¦‚ä½•è®©å¼‚æ­¥æ“ä½œé¡ºåºæ‰§è¡Œã€‹<br>ã€Šå¤§ç™½è¯è®²è§£ Promiseï¼ˆä¸€ï¼‰<br>ã€ŠLHH å¤§ç¿°ä»”ä»”-Promise é¢è¯•é¢˜ã€‹<br>ã€Šä»Šæ—¥å¤´æ¡ async&#x2F;await é¢è¯•é¢˜æ‰§è¡Œé¡ºåºã€‹<br>ã€Š(2.4w å­—,å»ºè®®æ”¶è—)ğŸ˜‡ åŸç”Ÿ JS çµé­‚ä¹‹é—®(ä¸‹), å†²åˆº ğŸš€ è¿›é˜¶æœ€åä¸€å…¬é‡Œ(é™„ä¸ªäººæˆé•¿ç»éªŒåˆ†äº«)ã€‹</p>
<p>è½¬è½½æ–‡æ¡£ï¼š<br><a href="https://mp.weixin.qq.com/s/Y-DCZHpEI0g2K8n5vvBcAw">https://mp.weixin.qq.com/s/Y-DCZHpEI0g2K8n5vvBcAw</a></p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>åšæŒåŸåˆ›æŠ€æœ¯åˆ†äº«ï¼Œæ‚¨çš„æ”¯æŒé¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/WechatPay.png" alt=" WeChat Pay"/>
        <p>WeChat Pay</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/AliPay.jpg" alt=" Alipay"/>
        <p>Alipay</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag"># å‰ç«¯</a>
          
            <a href="/tags/js/" rel="tag"># js</a>
          
            <a href="/tags/%E5%BC%82%E6%AD%A5/" rel="tag"># å¼‚æ­¥</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/11/18/webpack%E5%AD%A6%E4%B9%A0/Webpack%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/" rel="next" title="Webpackæ·±å…¥æµ…å‡º">
                <i class="fa fa-chevron-left"></i> Webpackæ·±å…¥æµ…å‡º
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/11/27/%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86/Hexo%E9%94%99%E8%AF%AF%E2%80%9Dexpected-end-of-comment-got-end-of-file%E2%80%9D/" rel="prev" title="Hexoé”™è¯¯â€expected end of comment, got end of fileâ€">
                Hexoé”™è¯¯â€expected end of comment, got end of fileâ€ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">115</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/daykalif" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:r00t_daykalif@aliyun.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.daykalif.com/" title="Daykalif" target="_blank">Daykalif</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Promise-%E7%9A%84%E5%87%A0%E9%81%93%E5%9F%BA%E7%A1%80%E9%A2%98"><span class="nav-number">1.</span> <span class="nav-text">1. Promise çš„å‡ é“åŸºç¡€é¢˜</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-1-%E9%A2%98%E7%9B%AE%E4%B8%80"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 é¢˜ç›®ä¸€</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-%E9%A2%98%E7%9B%AE%E4%BA%8C"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 é¢˜ç›®äºŒ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-3-%E9%A2%98%E7%9B%AE%E4%B8%89"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 é¢˜ç›®ä¸‰</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-4-%E9%A2%98%E7%9B%AE%E5%9B%9B"><span class="nav-number">1.4.</span> <span class="nav-text">1.4 é¢˜ç›®å››</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-5-%E9%A2%98%E7%9B%AE%E4%BA%94"><span class="nav-number">1.5.</span> <span class="nav-text">1.5 é¢˜ç›®äº”</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-6-%E9%A2%98%E7%9B%AE%E5%85%AD"><span class="nav-number">1.6.</span> <span class="nav-text">1.6 é¢˜ç›®å…­</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Promise-%E7%BB%93%E5%90%88-setTimeout"><span class="nav-number">2.</span> <span class="nav-text">2. Promise ç»“åˆ setTimeout</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-%E9%A2%98%E7%9B%AE%E4%B8%80"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 é¢˜ç›®ä¸€</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-%E9%A2%98%E7%9B%AE%E4%BA%8C"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 é¢˜ç›®äºŒ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-3-%E9%A2%98%E7%9B%AE%E4%B8%89"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 é¢˜ç›®ä¸‰</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1"><span class="nav-number">2.3.1.</span> <span class="nav-text">(1)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2"><span class="nav-number">2.3.2.</span> <span class="nav-text">(2)</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-4-%E9%A2%98%E7%9B%AE%E5%9B%9B"><span class="nav-number">2.4.</span> <span class="nav-text">2.4 é¢˜ç›®å››</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-5-%E9%A2%98%E7%9B%AE%E4%BA%94"><span class="nav-number">2.5.</span> <span class="nav-text">2.5 é¢˜ç›®äº”</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-6-%E9%A2%98%E7%9B%AE%E5%85%AD"><span class="nav-number">2.6.</span> <span class="nav-text">2.6 é¢˜ç›®å…­</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Promise-%E4%B8%AD%E7%9A%84-then%E3%80%81catch%E3%80%81finally"><span class="nav-number">3.</span> <span class="nav-text">3. Promise ä¸­çš„ thenã€catchã€finally</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-1-%E9%A2%98%E7%9B%AE%E4%B8%80"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 é¢˜ç›®ä¸€</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-%E9%A2%98%E7%9B%AE%E4%BA%8C"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 é¢˜ç›®äºŒ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-%E9%A2%98%E7%9B%AE%E4%B8%89"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 é¢˜ç›®ä¸‰</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-%E9%A2%98%E7%9B%AE%E5%9B%9B"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 é¢˜ç›®å››</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-5-%E9%A2%98%E7%9B%AE%E4%BA%94"><span class="nav-number">3.5.</span> <span class="nav-text">3.5 é¢˜ç›®äº”</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-6-%E9%A2%98%E7%9B%AE%E5%85%AD"><span class="nav-number">3.6.</span> <span class="nav-text">3.6 é¢˜ç›®å…­</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-7-%E9%A2%98%E7%9B%AE%E4%B8%83"><span class="nav-number">3.7.</span> <span class="nav-text">3.7 é¢˜ç›®ä¸ƒ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-8-%E9%A2%98%E7%9B%AE%E5%85%AB"><span class="nav-number">3.8.</span> <span class="nav-text">3.8 é¢˜ç›®å…«</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-9-%E9%A2%98%E7%9B%AE%E4%B9%9D"><span class="nav-number">3.9.</span> <span class="nav-text">3.9 é¢˜ç›®ä¹</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#a"><span class="nav-number">3.9.1.</span> <span class="nav-text">(a)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#b"><span class="nav-number">3.9.2.</span> <span class="nav-text">(b)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#c"><span class="nav-number">3.9.3.</span> <span class="nav-text">(c)</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-10-%E9%A2%98%E7%9B%AE%E5%8D%81"><span class="nav-number">3.10.</span> <span class="nav-text">3.10 é¢˜ç›®å</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-Promise-%E4%B8%AD%E7%9A%84-all-%E5%92%8C-race"><span class="nav-number">4.</span> <span class="nav-text">4. Promise ä¸­çš„ all å’Œ race</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-1-%E9%A2%98%E7%9B%AE%E4%B8%80"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 é¢˜ç›®ä¸€</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-%E9%A2%98%E7%9B%AE%E4%BA%8C"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 é¢˜ç›®äºŒ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-3-%E9%A2%98%E7%9B%AE%E4%B8%89"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 é¢˜ç›®ä¸‰</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-4-%E9%A2%98%E7%9B%AE%E5%9B%9B"><span class="nav-number">4.4.</span> <span class="nav-text">4.4 é¢˜ç›®å››</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-async-await-%E7%9A%84%E5%87%A0%E9%81%93%E9%A2%98"><span class="nav-number">5.</span> <span class="nav-text">5. async&#x2F;await çš„å‡ é“é¢˜</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-%E9%A2%98%E7%9B%AE%E4%B8%80"><span class="nav-number">5.1.</span> <span class="nav-text">5.1 é¢˜ç›®ä¸€</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-2-%E9%A2%98%E7%9B%AE%E4%BA%8C"><span class="nav-number">5.2.</span> <span class="nav-text">5.2 é¢˜ç›®äºŒ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-3-%E9%A2%98%E7%9B%AE%E4%B8%89"><span class="nav-number">5.3.</span> <span class="nav-text">5.3 é¢˜ç›®ä¸‰</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-4-%E9%A2%98%E7%9B%AE%E5%9B%9B"><span class="nav-number">5.4.</span> <span class="nav-text">5.4 é¢˜ç›®å››</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-5-%E9%A2%98%E7%9B%AE%E4%BA%94"><span class="nav-number">5.5.</span> <span class="nav-text">5.5 é¢˜ç›®äº”</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-6-%E9%A2%98%E7%9B%AE%E5%85%AD"><span class="nav-number">5.6.</span> <span class="nav-text">5.6 é¢˜ç›®å…­</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-7-%E9%A2%98%E7%9B%AE%E4%B8%83"><span class="nav-number">5.7.</span> <span class="nav-text">5.7 é¢˜ç›®ä¸ƒ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-8-%E9%A2%98%E7%9B%AE%E5%85%AB"><span class="nav-number">5.8.</span> <span class="nav-text">5.8 é¢˜ç›®å…«</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-9-%E9%A2%98%E7%9B%AE%E4%B9%9D"><span class="nav-number">5.9.</span> <span class="nav-text">5.9 é¢˜ç›®ä¹</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-async-%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF"><span class="nav-number">6.</span> <span class="nav-text">6. async å¤„ç†é”™è¯¯</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#6-1-%E9%A2%98%E7%9B%AE%E4%B8%80"><span class="nav-number">6.1.</span> <span class="nav-text">6.1 é¢˜ç›®ä¸€</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-2-%E9%A2%98%E7%9B%AE%E4%BA%8C"><span class="nav-number">6.2.</span> <span class="nav-text">6.2 é¢˜ç›®äºŒ</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-%E7%BB%BC%E5%90%88%E9%A2%98"><span class="nav-number">7.</span> <span class="nav-text">7. ç»¼åˆé¢˜</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#7-1-%E9%A2%98%E7%9B%AE%E4%B8%80"><span class="nav-number">7.1.</span> <span class="nav-text">7.1 é¢˜ç›®ä¸€</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-2-%E9%A2%98%E7%9B%AE%E4%BA%8C"><span class="nav-number">7.2.</span> <span class="nav-text">7.2 é¢˜ç›®äºŒ</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#A"><span class="nav-number">7.2.1.</span> <span class="nav-text">A</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#B"><span class="nav-number">7.2.2.</span> <span class="nav-text">B</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-3-%E9%A2%98%E7%9B%AE%E4%B8%89"><span class="nav-number">7.3.</span> <span class="nav-text">7.3 é¢˜ç›®ä¸‰</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-%E5%87%A0%E9%81%93%E5%A4%A7%E5%8E%82%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="nav-number">8.</span> <span class="nav-text">8. å‡ é“å¤§å‚çš„é¢è¯•é¢˜</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#8-1-%E4%BD%BF%E7%94%A8-Promise-%E5%AE%9E%E7%8E%B0%E6%AF%8F%E9%9A%94-1-%E7%A7%92%E8%BE%93%E5%87%BA-1-2-3"><span class="nav-number">8.1.</span> <span class="nav-text">8.1 ä½¿ç”¨ Promise å®ç°æ¯éš” 1 ç§’è¾“å‡º 1,2,3</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-2-%E4%BD%BF%E7%94%A8-Promise-%E5%AE%9E%E7%8E%B0%E7%BA%A2%E7%BB%BF%E7%81%AF%E4%BA%A4%E6%9B%BF%E9%87%8D%E5%A4%8D%E4%BA%AE"><span class="nav-number">8.2.</span> <span class="nav-text">8.2 ä½¿ç”¨ Promise å®ç°çº¢ç»¿ç¯äº¤æ›¿é‡å¤äº®</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-3-%E5%AE%9E%E7%8E%B0-mergePromise-%E5%87%BD%E6%95%B0"><span class="nav-number">8.3.</span> <span class="nav-text">8.3 å®ç° mergePromise å‡½æ•°</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-4-%E6%A0%B9%E6%8D%AE-promiseA-%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E7%9A%84-promise"><span class="nav-number">8.4.</span> <span class="nav-text">8.4 æ ¹æ® promiseA+å®ç°ä¸€ä¸ªè‡ªå·±çš„ promise</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-5-%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E5%BC%82%E6%AD%A5%E5%8A%A0%E8%BD%BD%E5%9B%BE%E7%89%87%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">8.5.</span> <span class="nav-text">8.5 å°è£…ä¸€ä¸ªå¼‚æ­¥åŠ è½½å›¾ç‰‡çš„æ–¹æ³•</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-6-%E9%99%90%E5%88%B6%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C%E7%9A%84%E5%B9%B6%E5%8F%91%E4%B8%AA%E6%95%B0%E5%B9%B6%E5%B0%BD%E5%8F%AF%E8%83%BD%E5%BF%AB%E7%9A%84%E5%AE%8C%E6%88%90%E5%85%A8%E9%83%A8"><span class="nav-number">8.6.</span> <span class="nav-text">8.6 é™åˆ¶å¼‚æ­¥æ“ä½œçš„å¹¶å‘ä¸ªæ•°å¹¶å°½å¯èƒ½å¿«çš„å®Œæˆå…¨éƒ¨</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%83%B3%E6%B3%95%E4%B8%80-%F0%9F%92%A1%EF%BC%9A"><span class="nav-number">8.6.1.</span> <span class="nav-text">æƒ³æ³•ä¸€ ğŸ’¡ï¼š</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%83%B3%E6%B3%95%E4%BA%8C-%F0%9F%92%A1"><span class="nav-number">8.6.2.</span> <span class="nav-text">æƒ³æ³•äºŒ ğŸ’¡:</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-snowflake-o"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">r00t_daykalif</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">290.7k</span>
  
</div>






<div style="width:300px;margin:0 auto; padding:20px 0;">
	<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010902002156" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;">
    <img src="https://www.daykalif.com/beian.png" style="float:left;"/>
    <p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">
    æµ™å…¬ç½‘å®‰å¤‡ 33010902002156å·
    </p>
  </a>
</div>






        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'NXoB8ypSoELq08t7Y4t4Y7Co-gzGzoHsz',
        appKey: 'q00Ulu1a5iQSaM6XV0ba4QeF',
        placeholder: 'ãƒ¾ï¾‰â‰§âˆ€â‰¦)oæ¥å•Šï¼Œå¿«æ´»å•Š!',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("NXoB8ypSoELq08t7Y4t4Y7Co-gzGzoHsz", "q00Ulu1a5iQSaM6XV0ba4QeF");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
